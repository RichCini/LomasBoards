Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-1


       1				TITLE LDP THUNDER REV 1.0 10/21/85 Colo
					r Magic ROM
       2				PAGE  59,132
       3				
       4				;option M510	; Assume MASM 5.1 if using MASM 6.11
       5				
       6				;
       7				; This is an IBM/PC-compatible BIOS ROM for installation in 
       8				; the Thunder 186 single-board computer when used with the
       9				; Color Magic CGA video board. By default, the Thunder 186
      10				; comes with a conventional monitor ROM -- I would guess that
      11				; this ROM was included with the purchase of the Color Magic,
      12				; possibly as an extra-cost option since the Color Magic
      13				; could be used in any other PC-capable S100 setup.
      14				;
      15				
      16				; NOTE: The Ampro LittleBoard 186 can boot from the SCSI channel
      17				;	so this might be an option... 
      18				;
      19				; There is a system equates file referenced from the monitor and
      20				; several hardware-specific files for initializing the 80186 and
      21				; as the includes for the storage hardware. These have been 
      22				; partially re-created.
      23				;
      24				; general items:
      25				;	tmr0 = serial 0 clock
      26				;	tmr1 = serial 1 clock
      27				;	UCS = ROM @ FE000
      28				;	LCS = 256k RAM
      29				;	DRQ0 = bus DMA0
      30				;	DRQ1 = floppy DRQ and bus DMA1
      31				;	INT0 = bus VI0			} need to verify
      32				;	INT1 = bus VI2/VI3		}
      33				;	INT2 = bus VI4			}
      34				;	INT3 = bus VI6/VI7 and RX1/RX2	}
      35				;	NMI = parity fail (unused with SRAM) and bus NMI
      36				;
      37				; There are several references to ports D0-D6 which are 
      38				; not documented. This could be the 8255 (config switches
      39				; and printer port). Since the CM5 ROM is for the Color
      40				; Magic, I doubt the baud rate switches would be important.
      41				;
      42				; SCSI IRQ 3, port 310h, D8000h
      43				;
      44				; The last byte has to be patched with DEBUG as follows
      45				;
      46				;   FFFF 00.xx          ( avoid ER_BIOS on bootstrap ) --------------------
      47				;									  |
      48				;									  |
      49				; where "xx" results in a zero checksum for the whole BIOS rom, for ex 	  |
      50				;                                                                         |
      51				;               masm BIOS;              ( Assemble BIOS source code)      |
      52				;               link BIOS;              ( Link the BIOS object code)      |
      53				;               debug BIOS.EXE          ( Exe2bin  BIOS binary code)      |
      54				;               -nBIOS.BIN              ( Name of the output binary)      |
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-2


      55				;               -eCS:1FFF               ( Opens BIOS checksum  byte)      |
      56				;;  ------->    .DC                     ( Force ROM checksum = zero) <-----
      57				;;              -rBX                    ( Opens hi order byte count)
      58				;;              :0                      (  ... must be 0 bytes long)
      59				;;              -rCX                    ( Opens lo order byte count)
      60				;;              :2000                   (  ... BIOS 2000 bytes long)
      61				;;              -wCS:0	                ( Output to BIOS.BIN   file)
      62				;;              -q
      63				
      64				
      65				;===============================================================================
      66				;  Defines
      67 = 0000				FALSE		equ	0
      68 = 00FF				TRUE		equ	0ffh
      69 =				DEBUGF		equ	TRUE		; allows marco expansion
      70 =				ROMSEARCH	equ	FALSE		; set true to include expansion ROM search
      71				
      72				; System compilation options
      73 =				WD100X		equ	FALSE
      74 =				CIA_HDO		equ	FALSE		;Control-it-all HD options installed
      75 =				CIA		equ	CIA_HDO
      76 =				SCSI		equ	FALSE
      77 =				HDO		equ	FALSE		;hard disk option; indicate either CIA or SCSI
      78				
      79				ELSE
      80 = 0000					scsi_options	equ	00000000b	;indicate no SCSI is present
      81				ENDIF
      82				
      83				entry   macro   x
      84				        pad     =BANNER - $ + x	; - 0E000h
      85				        if pad LT 0
      86				        .err
      87				        %out    'No room for ENTRY point'
      88				        endif
      89				        if pad GT 0
      90				        db      pad DUP(0)
      91				        endif
      92				endm
      93				
      94				jmpf    macro   x,y
      95				        db      0EAh;
      96				        dw      y,x
      97				endm
      98				
      99				;===============================================================================
     100				;  Constants
     101				include "T186.ASM"		; system equates
     102			     C	; Lomas Thunder 186 specific code
     103			     C	;
     104			     C	
     105			     C	;
     106			     C	; Board-specific Registers.
     107			     C	;
     108			     C	; These blocks are decoded with a 74LS138. Blocks B0h,
     109			     C	; E0h, and F0h are unused.
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-3


     110			     C	;
     111			     C	; i8255 PPI. Note that the four registers are addresses
     112			     C	; using A1/A2 rather than A0/A1, meaning the ports are
     113			     C	; on the even bytes.
     114 = 00D0                      C	PPIBASE		equ	0D0h
     115 = 00D0                      C	printer_port	equ	PPIBASE+0	; port A
     116 = 00D2                      C	PPI_B		equ	PPIBASE+2	; port B
     117 = 00D4                      C	PPI_C		equ	PPIBASE+4	; port C
     118 = 00D6                      C	PPI_CR		equ	PPIBASE+6	; control register
     119			     C	
     120			     C	; 8251A, ports 0 and 1. Similar to the PPI, A1 is used to
     121			     C	; select the register.
     122 = 00C0                      C	ACIA0BASE	equ	0C0h		; J2 = COM2
     123 = 0080                      C	ACIA1BASE	equ	080h		; J1 = COM1
     124 = 0000                      C	DATAP		equ	0
     125 = 0002                      C	CTRLP		equ	2
     126			     C	
     127			     C	; Floppy
     128 = 0090                      C	FDCBASE		equ	090h
     129 = 00A0                      C	FDCDMA		equ	0A0h
     130 =                           C	FDSTAT		EQU	FDCBASE		;STATUS REGISTER
     131 = 0092                      C	FDDATA		EQU	FDCBASE+2	;DATA REGISTER
     132 = 0094                      C	FDDMA		EQU	FDCBASE+4	;DMA ADDRESS (WHEN WRITE)
     133 = 0094                      C	DFINTS		EQU	FDCBASE+4	;STATUS REGISTER (WHEN READ)
     134			     C	
     135			     C	
     136			     C	; 80186 Peripheral Control Registers
     137			     C	; At reset, this block starts at 0FF00h in I/O space
     138 = FF00                      C	PCRBASE	equ	0ff00h
     139			     C	; Interrupts
     140 = FF20                      C	ICR	equ	PCRBASE+020h
     141 =                           C	IVR	equ	ICR
     142 = 0002                      C	EOIREG	equ	2	; specific EOI register
     143 = 0004                      C	POLLR	equ	4	; poll register
     144 = 0006                      C	POLLS	equ	6	; poll status register
     145 = 0008                      C	MASKR	equ	8	; mask register
     146 = 000A                      C	PMR	equ	0ah	; priority-level mask register
     147 = 000C                      C	ISVR	equ	0ch	; in-service register
     148 = 000E                      C	IRR	equ	0eh	; interrupt request register
     149 = 0010                      C	ISR	equ	010h	; interrupt status register
     150 = 0012                      C	T0CR	equ	012h	; timer 0 control register
     151 = 0014                      C	D0CR	equ	014h	; DMA0 control register
     152 = 0016                      C	D1CR	equ	016h	; DMA1 control register
     153 = 0018                      C	INT0CR	equ	018h	; INT0 control register
     154 = 001A                      C	INT1CR	equ	01ah	; INT1 control register
     155 = 001C                      C	INT2CR	equ	01ch	; INT2 control register
     156 = 001E                      C	INT3CR	equ	01eh	; INT3 control register
     157			     C	; Timers
     158 = FF50                      C	TM0CR	equ	PCRBASE+050h
     159 = FF58                      C	TM1CR	equ	PCRBASE+058h
     160 = FF60                      C	TM2CR	equ	PCRBASE+060h
     161			     C	; offsets in timer control block
     162 = 0000                      C	TMRCR	equ	0	; control register
     163 = 0002                      C	TMRCA	equ	2	; count register A
     164 = 0004                      C	TMRCB	equ	4	; count register B
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-4


     165 = 0006                      C	TMRCW	equ	6	; mode/control word
     166			     C	; memory control
     167 = FFA0                      C	CSCR	equ	PCRBASE+0a0h
     168 = 0000                      C	UMCR	equ	0
     169 = 0002                      C	LMCR	equ	2
     170 = 0004                      C	PACS	equ	4
     171 = 0006                      C	MMCS	equ	6
     172 = 0008                      C	MPCS	equ	8
     173			     C	; DMA
     174 = FFC0                      C	DMA0	equ	PCRBASE+0C0h
     175 = FFD0                      C	DMA1	equ	PCRBASE+0d0h
     176			     C	; offsets in DMA control block
     177 = 0000                      C	DMASP	equ	0	; source pointer
     178 = 0002                      C	DMASP1	equ	2	; source pointer high 4 bits
     179 = 0004                      C	DMADP	equ	4	; destination pointer
     180 = 0006                      C	DMADP1	equ	6	; destination pointer high 4 bits
     181 = 0008                      C	DMATC	equ	8	; transfer count
     182 = 000A                      C	DMACW	equ	0ah	; control word
     183			     C	; other registers
     184 = FFE0                      C	MDRAM	equ	PCRBASE+0e0h
     185 = FFE2                      C	CDRAM	equ	PCRBASE+0e2h
     186 = FFE4                      C	EDRAM	equ	PCRBASE+0e4h
     187 = FFF0                      C	PDCOM	equ	PCRBASE+0f0h
     188			     C	; Relocation Register
     189 = FFFE                      C	RR	equ	PCRBASE+0feh
     190				include "CM5D.ASM"		; ColorMagic-specific ports/data
     191			     C	; Lomas Color Magic specific equates. These are the
     192			     C	; IBM/PC-compatible port addresses.
     193			     C	;
     194 = 0040                      C	C5TIMER0	equ	40h
     195 = 0041                      C	C5TIMER1	equ	41h
     196 = 0042                      C	C5TIMER2	equ	42h
     197 = 0043                      C	C58253CTL	equ	43h
     198 = 0060                      C	C58255PA	equ	60h 
     199 = 0061                      C	C58255PB	equ	61h 
     200 = 0062                      C	C58255PC	equ	62h
     201 = 0063                      C	C58255CMD	equ	63h
     202 = 03D0                      C	MC6845R0	equ	03D0h
     203 = 03D1                      C	MC6845R1	equ	03D1h
     204 = 03D2                      C	MC6845R2	equ	03D2h
     205 = 03D3                      C	MC6845R3	equ	03D3h
     206 = 03D4                      C	MC6845R4	equ	03D4h
     207 = 03D5                      C	MC6845R5	equ	03D5h
     208 = 03D6                      C	MC6845R6	equ	03D6h
     209 = 03D7                      C	MC6845R7	equ	03D7h
     210 = 03D8                      C	CGAMODE		equ	03D8h
     211 = 03D9                      C	CGACOLOR	equ	03D9h
     212 = 03DA                      C	CGASTAT		equ	03DAh
     213 = 03DB                      C	LPENCLR		equ	03DBh
     214 = 03DC                      C	LPENSET		equ	03DCh
     215			     C	; 8272 layout, which differs from NEC D765
     216 = 03F0                      C	FDPORT		EQU	03F0H		;BASE PORT ADDRESS FOR CONTROLLER (F0-F7)
     217 =                           C	FDCS		EQU	FDPORT		;STATUS REGISTER
     218 = 03F1                      C	FDCD		EQU	FDPORT+1	;DATA REGISTER
     219 = 03F2                      C	FDMA		EQU	FDPORT+2	;DMA ADDRESS (WHEN WRITE)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-5


     220 = 03F2                      C	INTS		EQU	FDPORT+2	;STATUS REGISTER (WHEN READ)
     221			     C	; D765 Layout
     222			     C	;FDCP		EQU	FDPORT+2	;Control Port
     223			     C	;INTS		EQU	FDPORT+4	;Main Status Register
     224			     C	;FDCD		EQU	FDPORT+5	;Data Register
     225			     C	
     226			     C	
     227				
     228 = 0000				Int00v		equ	0			; (0000:0000=0CA60h)  0 DIV/0
     229 = 0004				Int01v		equ	4			; (0000:0004=0F4h)    1 SST
     230 = 0018				Int06v		equ	18h			; (0000:0018=0CA60h)  6 invalid opcode
     231 = 0020				Int08v		equ	20h			; (0000:0020=0FEA5h)  8 Timer hardware IRQ
     232 = 0024				Int09v		equ	24h			; (0000:0024=0E987h)  9 Keyboard IRQ
     233 = 002C				Int0Bv		equ	2Ch			; (0000:002C=0CE80h) 0B serial 2 IRQ
     234 = 0030				Int0Cv		equ	30h			; (0000:0030=0CE80h) 0C serial 1 IRQ
     235 = 0034				Int0Dv		equ	34h			; (0000:0034=3ADBh)  0D hard disk IRQ
     236 = 0040				Int10v		equ	40h			; (0000:0040=0EEh)   10 video
     237 = 0044				Int11v		equ	44h			; (0000:0044=0CB20h) 11 equipment
     238 = 0048				Int12v		equ	48h			; (0000:0048=0CB40h) 12 memory size
     239 = 004C				Int13v		equ	4Ch			; (0000:004C=0CF60h) 13 diskette/HD I/O
     240 = 0050				Int14v		equ	50h			; (0000:0050=0CB80h) 14 serial
     241 = 0054				Int15v		equ	54h			; (0000:0054=0CBA0h) 15 system services
     242 = 0058				Int16v		equ	58h			; (0000:0058=0CFC0h) 16 keyboard
     243 = 005C				Int17v		equ	5Ch			; (0000:005C=0CBC0h) 17 printer
     244 = 0060				Int18v		equ	60h			; (0000:0060=0CD00h) 18 Basic ROM
     245 = 0064				Int19v		equ	64h			; (0000:0064=0CC60h) 19 IPL
     246 = 0068				Int1Av		equ	68h			; (0000:0068=0CBE0h) 1A TOD
     247 = 006C				Int1Bv		equ	6Ch			; (0000:006C=0D1C0h) 1B Keyboard BREAK addr
     248 = 0070				Int1Cv		equ	70h			; (0000:0070=0CC00h) 1C user timer
     249 = 0074				Int1Dv		equ	74h			; (0000:0074=0C958h) 1D 6845 video init
     250 = 0078				Int1Ev		equ	78h			; (0000:0078=0CA60h) 1E DPB
     251 = 007C				Int1Fv		equ	7Ch			; (0000:007C=5E9h)   1F video graphic table
     252				
     253 = 7C00				IPLLOC		equ	7C00h			;*(0000:7C00=0)	boot location
     254 = 0000				data_49e	equ	0			;*(1000:0000=75h)
     255 = 03FE				data_50e	equ	3FEh			;*(1040:03FE=3)	COM1 block? Count?
     256				; Outside of ROM address; likely just 8K address increments
     257 = 2000				data_121e	equ	2000h			;*(A.2000=0)
     258 = 2001				data_122e	equ	2001h			;*(A.2001=0)
     259				; Also odd location.
     260				;data_123e	equ	49h			; (C000:0049=0) ds:49 is CRT mode
     261				
     262				; The Lomas BIOS doesn't produce error codes, but these might be useful.
     263 = 0001				ER_BIOS equ     01h             ; Bad ROM bios checksum, patch last byte
     264 = 0002				ER_RAM  equ     02h             ; Bad RAM in main memory, replace
     265 = 0004				ER_CRT  equ     04h             ; Bad RAM in video card, replace
     266 = 0010				ER_MEM  equ     10h             ; Bad RAM in vector area, replace
     267 = 0020				ER_ROM  equ     20h             ; Bad ROM in expansion area, bad checksum
     268				
     269 = 000A				LF      equ     0Ah
     270 = 000D				CR      equ     0Dh
     271				
     272				;===============================================================================
     273				;  Compiler directives
     274				;
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-6


     275				.LFCOND                                         ; List  False  Conditionals
     276				.186
     277				ASSUME  DS:data, SS:code, CS:code, ES:code
     278				
     279				
     280				;===============================================================================
     281				;  Data segment - BIOS Data Segment
     282				;
     283 0000				data	segment at 40H				; IBM compatible data structures
     284 0000  0004[			rs232_port_1	dw	4 dup (?)		; (0040:0000=3F8h)
     285	   ????			
     286			 ]	
     287				
     288 0008  0004[			prn_port_1	dw	4 dup (?)		; (0040:0008=378h)
     289	   ????			
     290			 ]	
     291				
     292 0010  0000			equip_bits	dw	?			; (0040:0010=4467h)
     293 0012  00			mfg_test	db	?			; 0012
     294 0013  0000			main_ram_size	dw	?			; (0040:0013=280h)
     295 0015  00			scratch1	db	? 			; scratch pad
     296 0016  00					db	?
     297				;---------------[Keyboard data area]------------;
     298 0017  00			keybd_flags_1	db	?			; (0040:0017=0)
     299				;------ SHIFT FLAG EQUATES WITHIN KB_FLAG
     300 = 0080				INS_STATE	EQU	80H			; INSERT STATE IS ACTIVE
     301 = 0040				CAPS_STATE	EQU	40H			; CAPS LOCK STATE HAS BEEN TOGGLED
     302 = 0020				NUM_STATE	EQU	20H			; NUM LOCK STATE HAS BEEN TOGGLED
     303 = 0010				SCROLL_STATE	EQU	10H			; SCROLL LOCK STATE HAS BEEN TOGGLED
     304 = 0008				ALT_SHIFT	EQU	08H			; ALTERNATE SHIFT KEY DEPRESSED
     305 = 0004				CTL_SHIFT	EQU	04H			; CONTROL SHIFT KEY DEPRESSED
     306 = 0002				LEFT_SHIFT	EQU	02H			; LEFT SHIFT KEY DEPRESSED
     307 = 0001				RIGHT_SHIFT	EQU	01H			; RIGHT SHIFT KEY DEPRESSED
     308 0018  00			keybd_flags_2	db	?			; (0040:0018=0)
     309 = 0080				INS_SHIFT	EQU	80H			; INSERT KEY IS DEPRESSED
     310 = 0040				CAPS_SHIFT	EQU	40H			; CAPS LOCK KEY IS DEPRESSED
     311 = 0020				NUM_SHIFT	EQU	20H			; NUM LOCK KEY IS DEPRESSED
     312 = 0010				SCROLL_SHIFT	EQU	10H			; SCROLL LOCK KEY IS DEPRESSED
     313 = 0008				HOLD_STATE	EQU	08H			; SUSPEND KEY HAS BEEN TOGGLED
     314 0019  00			keybd_alt_num	db	?			; (0040:0019=0)
     315 001A  0000			keybd_q_head	dw	?			; (0040:001A=30h)
     316 001C  0000			keybd_q_tail	dw	?			; (0040:001C=30h)
     317 001E  0010[			keybd_buff	dw	16 dup (?)		; 001E
     318	   ????			
     319			 ]	
     320				
     321				;------ HEAD = TAIL INDICATES THAT THE BUFFER IS EMPTY
     322 = 0045				NUM_KEY 	EQU	69			; SCAN CODE FOR NUMBER LOCK
     323 = 0046				SCROLL_KEY	EQU	70			; SCROLL LOCK KEY
     324 = 0038				ALT_KEY 	EQU	56			; ALTERNATE SHIFT KEY SCAN CODE
     325 = 001D				CTL_KEY 	EQU	29			; SCAN CODE FOR CONTROL KEY
     326 = 003A				CAPS_KEY	EQU	58			; SCAN CODE FOR SHIFT LOCK
     327 = 002A				LEFT_KEY	EQU	42			; SCAN CODE FOR LEFT SHIFT
     328 = 0036				RIGHT_KEY	EQU	54			; SCAN CODE FOR RIGHT SHIFT
     329 = 0052				INS_KEY 	EQU	82			; SCAN CODE FOR INSERT KEY
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-7


     330 = 0053				DEL_KEY 	EQU	83			; SCAN CODE FOR DELETE KEY
     331				;---------------[Diskette data area]------------;
     332 003E  00			dsk_recal_stat	db	?			; (0040:003E=0)
     333 003F  00			dsk_motor_stat	db	?			; (0040:003F=0)
     334 0040  00			dsk_motor_tmr	db	?			; (0040:0040=0)
     335 0041  00			dsk_ret_code	db	?			; (0040:0041=0)
     336 0042  0007[			nec_stat	db	7 dup (?)		; (0040:0042=0)	NEC status 7 bytes
     337	   ??			
     338			 ]	
     339				
     340				;---------------[Video display area]------------;
     341 0049  00			video_mode	db	?			; (0040:0049=3)
     342										;  0 = 40 x 25 text (no color)
     343										;  1 = 40 x 25 text (16 color)
     344										;  2 = 80 x 25 text (no color)
     345										;  3 = 80 x 25 text (16 color)
     346										;  4 = 320 x 200 grafix 4 color
     347										;  5 = 320 x 200 grafix 0 color
     348										;  6 = 640 x 200 grafix 0 color
     349										;  7 = 80 x 25 text (mono card)
     350 004A  0000			video_columns	dw	?			; (0040:004A=50h)
     351 004C  0000			video_buf_siz	dw	?			; (0040:004C=1000h)
     352 004E  0000			video_segment	dw	?			; (0040:004E=0)
     353 0050  0008[			vid_curs_pos0	dw	8 dup (?)		; (0040:0050=184Fh)
     354	   ????			
     355			 ]	
     356				
     357 0060  0000			vid_curs_mode	dw	?			; (0040:0060=2000h)
     358 0062  00			video_page	db	?			; (0040:0062=0)
     359				; normal BIOS does not store the base address
     360 0063  0000			video_port	dw	?			; (0040:0063=3D4h) 
     361				;video_base	dw	?			; PC has card base address at 63h
     362 0065  00			video_mode_reg	db	?			; (0040:0065=29h) 6845 mode setting
     363 0066  00			video_color	db	?			; (0040:0066=30h)
     364				;---------------[Used to setup ROM]-------------;
     365 0067  0000 0000		gen_io_ptr	dw	?,?			; (0040:0067=0) ; Eprom base Offset,Segment
     366 006B  00			gen_int_occured	db	?			; (0040:006B=0) ; Last spurious interrupt IR
					Q
     367				;---------------[Timer data area]---------------;
     368 006C  0000			timer_low	dw	?			; (0040:006C=696Fh)
     369 006E  0000			timer_hi	dw	?			; (0040:006E=16h)
     370 0070  00			timer_rolled	db	?			; (0040:0070=0)
     371				;---------------[System data area]--------------;
     372 0071  00			signbit		db      ?		; 40:71 ; Sign bit set if break
     373 0072  0000			warmboot	dw      ?		; 40:72 ; Warm boot if 1234h value
     374				;---------------[Hard disk scratchpad]----------;
     375 0074  0004[			HD		db	4 dup (0)  	; 40:74 ; scratch pad area
     376	   00			
     377			 ]	
     378				
     379				;---------------[Timout areas/PRT/LPT]----------;
     380 0078  0004[			lptto		db      4 dup(?)        ; 40:78 ; Ticks for LPT 1-4 timeouts
     381	   ??			
     382			 ]	
     383				
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-8


     384 007C  0004[			comto 		db      4 dup(?)        ; 40:7C ; Ticks for COM 1-4 timeouts
     385	   ??			
     386			 ]	
     387				
     388				;---------------[Keyboard buf start/nd]---------;
     389				; 	dw      ?               ; 40:80         ; Contains 1Eh, buffer start
     390				;	dw      ?               ; 40:82         ; Contains 3Eh, buffer end
     391				;
     392				; SCSI -- might not be needed if using card with option ROM because work space
     393				; would be allocated from there. This table is 25 bytes (19h) long.
     394				IF	SCSI
     395					COMMAND_TABLE	dw	?		;command offset pointer
     396					CMND_PTR	dw	?		;segment of commands
     397					CMND_SEG	dw	?		;segment of commands
     398					TRANS_CNT	dw	?		;will read 512 bytes
     399					SDMA_OFF	dw	?		;buffer pointer
     400					SDMA_SEG	dw	?		;segment of buffer pointer
     401					SCSI_STATUS_IN	db	?		;status in
     402					SCSI_STATUS_OUT	db	?		;status out
     403					SCSI_MSG_IN	db	?		;received message
     404					SCSI_MSG_OUT	db	?		;send message
     405					SCSI_MSG_FLAG	db	?		;send message flag
     406				
     407					READ_WRITE_BLOCK	db	?	;read command for 8425
     408					SCSI_CMND_CNT		db	?	;number of byte in the command
     409					SCSI_CMND		db	?	;read command
     410					BLOCK_HIGH		db	?	;msb of 21 bit block address, low 5 bits of 
					byte
     411					BLOCK_MIDDLE		db	?	;middle bbyte of address
     412					BLOCK_LOW		db	?	;low byte of address
     413					SCOUNT			db	?	;number of blocks to read, 0 =256
     414					CONTROL_BYTE		db	?	;control byte is always 0
     415				ENDIF
     416				
     417 0080				data	ends
     418				
     419				;===============================================================================
     420				;  D O S   D A T A   S E G M E N T
     421				;===============================================================================
     422				; probably not needed for the Lomas but might be used for hard disk
     423				; sector data.
     424 0000				dosdir  SEGMENT at 50h                          ; Boot disk directory from IPL
     425 0000				xerox   label   byte                            ;  0 if Print Screen idle
     426				                                                ;  1 if PrtSc xeroxing screen
     427				                                                ;255 if PrtSc error in xerox
     428				                                                ;  ...non-grafix PrtSc in bios
     429 0000  0200[			        db      200h dup(?)                     ; PC-DOS bootstrap procedure
     430	   ??			
     431			 ]	
     432				
     433				                                                ;  ...IO.SYS buffers the
     434				                                                ;  ...directory of the boot
     435				                                                ;  ...device here at IPL time
     436				                                                ;  ...when locating the guts
     437				                                                ;  ...of the operating system
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-9


     438				                                                ;  ...filename "MSDOS.SYS"
     439 0200				dosdir  ends
     440				
     441				
     442				;===============================================================================
     443				;  I O . S Y S   D A T A   S E G M E N T  (IO.SYS initial load segment)
     444				;===============================================================================
     445				;dosseg  SEGMENT at 70H 
     446				
     447				;IO.SYS driver/bootstrap code loaded by the boot block to       CONTIGUOUS<---
     448				;	70:0 Usually loads the first 3 sectors of IO.SYS.		     |
     449				;MSDOS.SYS operating system kernel immediately follows IO.SYS and            |
     450				;	doesn`t have to be contiguous. The DOS operating system		     |
     451				;	binary image is loaded by transient code in IO.SYS.	             |
     452				;dosseg  ends                                    ;                            |
     453				
     454				
     455				;===============================================================================
     456				;  I P L   D A T A   S E G M E N T  (loaded with bootstrap code from MBR)
     457				;===============================================================================
     458				;iplseg  SEGMENT at 0h                           ; Segment for boot block      |
     459				;The following boot block is loaded with 512 bytes on the first sector of     |
     460				;the bootable device by code resident in the ROM-resident bios.  Control is   |
     461				;then transferred to the first word 0000:7C00 of the disk-resident bootstrap  |
     462				;	ORG     07C00h                          ;  ..offset for boot block    |
     463				;boot	db      200h dup(?)                     ;  ..start disk resident boot--
     464				;iplseg 	ends
     465				
     466				
     467				;===============================================================================
     468				;  C O D E   S E G M E N T  (BIOS code segment)
     469				;===============================================================================
     470 0000				code    SEGMENT
     471				
     472				; this code sits at F:E000
     473 0000					org	0		; zero-start ROM
     474				;	org	0E000h		; should this be the real org?
     475				
     476 0000  4C 44 50 20 54 48	banner: 	db	"LDP THUNDER REV 1.0 10/21/85"
     477       55 4E 44 45 52 20	
     478       52 45 56 20 31 2E	
     479       30 20 31 30 2F 32	
     480       31 2F 38 35		
     481					IF	SCSI
     482						db	"-S"
     483					ENDIF
     484 001C  0A 0D 00					db	0ah, 0dh, 0
     485				
     486				; Continues from CPU initialization code at 1C00h that initializes the 80186
     487				; internal registers. The expansion ROM call has to occur after the hardware
     488				; initializes but before video.
     489 001F				COLD2:
     490 001F  FA			        	cli
     491 0020  B8 8000			 		mov	ax,8000h 		; send EOI twice
     492 0023  BA FF22			 		mov	dx,0FF22h		; PCRBASE+ICR+EOIREG
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-10


     493 0026  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     494 0027  B8 8000			 		mov	ax,8000h
     495 002A  BA FF22			 		mov	dx,0FF22h		; PCRBASE+ICR+EOIREG
     496 002D  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     497				
     498				; test first 64k of RAM
     499 002E  FC			 		cld				; Clear direction
     500 002F  33 DB			 		xor	bx,bx			; Zero register
     501 0031  8E DB			 		mov	ds,bx
     502 0033  8E C3			 		mov	es,bx
     503 0035  B8 5555			 		mov	ax,5555h
     504 0038				loc_3:						;  xref A.0056
     505 0038  B9 8000			 		mov	cx,8000h
     506 003B  8B F3			 		mov	si,bx
     507 003D  8B FB			 		mov	di,bx
     508 003F  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
     509 0041  B9 8000			 		mov	cx,8000h
     510 0044  F3/ AF			 		repe	scasw			; Rep zf=1+cx >0 Scan es:[di] for ax
     511 0046  E3 06			 		jcxz	loc_4			; Jump if cx=0
     512 0048  BA 0066			 		mov	dx,66h
     513 004B  E9 0597 R		 		jmp	DynHalt			; (0597) memory test error?
     514				
     515 004E				loc_4:						;  xref A.0046
     516 004E  3D AAAA					cmp	ax,0AAAAh
     517 0051  74 05			 		je	loc_5			; Jump if equal
     518 0053  B8 AAAA			 		mov	ax,0AAAAh
     519 0056  EB E0			 		jmp	short loc_3		; (0038)
     520				
     521				; this clears 64k of RAM.
     522 0058				loc_5:						;  xref A.0051
     523 0058  B8 0000			 		mov	ax,0
     524 005B  B9 8000			 		mov	cx,8000h
     525 005E  8B F8			 		mov	di,ax
     526 0060  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
     527				
     528				; grab DIV/0 and SST vectors
     529 0062  B8 0113 R		 		mov	ax,offset INT00HANDLER	;113h
     530 0065  A3 0000			 		mov	ds:Int00v,ax		; (0000:0000=0CA60h)
     531 0068  8C 0E 0002		 		mov	ds:Int00v+2,cs		; (0000:0002=0F000h)
     532 006C  BE 0000			 		mov	si,Int00v		; (0000:0000=60h)
     533 006F  BF 0004			 		mov	di,Int01v		; (0000:0004=0F4h)
     534				
     535				;fill interrupt table with default vector pointing to INT00
     536 0072  B9 01FE			 		mov	cx,1FEh			; 7F * 4
     537 0075  F3/ A5			 		rep	movsw			; Rep when cx >0 Mov [si] to es:[di]
     538				
     539				; set invalid opcode handler
     540 0077  B8 00E0 R		 		mov	ax,offset INT06HANDLER	;0E0h
     541 007A  A3 0018			 		mov	ds:Int06v,ax		; (0000:0018=0CA60h)
     542 007D  8C 0E 001A		 		mov	ds:Int06v+2,cs		; (0000:001A=0F000h)
     543				
     544				; do main ROM checksum. It's odd that if the checksum fails, it
     545				; continues booting anyway. In the IBM PC, the PC halts.
     546 0081  FA			 		cli				; Disable interrupts
     547 0082  B8 0030			 		mov	ax,30h
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-11


     548 0085  8E D0			 		mov	ss,ax
     549 0087  BC 0100			 		mov	sp,100h
     550 008A  E8 0FB2 R		 		call	sub_32			; (0FB1)
     551 008D  E8 0140 R		 		call	DoChecksum		; (0140)
     552 0090  74 06			 		jz	loc_6			; Jump if zero
     553 0092  BE 00C9 R		 		mov	si,offset msg1		; (A.00C9='ROM checksum fai')
     554 0095  E8 05E5 R		 		call	prtzstr			; (05E5)
     555				; display boot message and assign key vectors. In the IBM PC,
     556				; the video sign-on is the last thing done after it passes
     557				; all hardware tests and all subsystems are initialized. In the Lomas
     558				; the sign-on message is printed before much of that is done, and
     559				; no hardware tests, other than memory, are performed.
     560 0098				loc_6:						;  xref A.0090
     561 0098  BE 0000 R		 		mov	si,offset banner	; (A.0000=4Ch)
     562 009B  E8 05E5 R		 		call	prtzstr			; (05E5)
     563 009E  E8 0473 R		 		call	InitEquipList		; (0473) vectors 18, 19, 15, 1B, 11 and 1C
     564 00A1  E8 04B5 R		 		call	InitTimers		; (04B5) vectors 0C, 08, 1A and timers
     565 00A4  E8 01BF R		 		call	RamTest			; (01BF) ram sizing and vactor 12
     566 00A7  E8 0AD4 R		 		call	InitKeyboard		; (0AD4) vectors 16, 0D, 09 keyboard
     567 00AA  E8 05F6 R				call	InitFloppy		; (05F6) vectos 13, 0B, 1E
     568 00AD  B4 00			 		mov	ah,0			; reset floppy disk
     569 00AF  CD 13			 		int	13h			; call diskette services
     570 00B1  E8 02BC R		 		call	InitSerialPorts		; (02BC) vector 14 serial 0
     571 00B4  E8 0224 R		 		call	InitPrinter		; (0224) vector 17 printer
     572				;*****
     573				; This might be a good place to put the expansion ROM code after all hardware is
     574				; initialized. Only DS is preserved.
     575				IF ROMSEARCH
     576						call	EXPROM
     577				ENDIF
     578				; re-send EOIs
     579 00B7  B8 8000			 		mov	ax,8000h
     580 00BA  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
     581 00BD  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     582 00BE  B8 8000			 		mov	ax,8000h
     583 00C1  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
     584 00C4  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     585 00C5  FB			 		sti				; Enable interrupts
     586 00C6  E9 0151 R		 		jmp	SysBoot			; (0151) boot the floppy drive
     587				
     588 00C9  52 4F 4D 20 63 68	msg1:		db	'ROM checksum failure', 0Ah, 0Dh, 0
     589       65 63 6B 73 75 6D	
     590       20 66 61 69 6C 75	
     591       72 65 0A 0D 00		
     592				
     593				;===============================================================================
     594				;a.00e0
     595				; INT 06 - Invalid opcode handler. Just prints a message and increments to the 
     596				; next instruction.
     597 00E0				INT06HANDLER:
     598 00E0  55			 		push	bp
     599 00E1  8B EC			 		mov	bp,sp
     600 00E3  50			 		push	ax
     601 00E4  53			 		push	bx
     602 00E5  51			 		push	cx
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-12


     603 00E6  52			 		push	dx
     604 00E7  56			 		push	si
     605 00E8  57			 		push	di
     606 00E9  BE 00FA R		 		mov	si,offset msg2
     607 00EC  E8 05E5 R		 		call	prtzstr
     608 00EF				data_79:
     609 00EF  FF 46 02			 		inc	word ptr [bp+2]
     610 00F2  5F			 		pop	di
     611 00F3  5E			 		pop	si
     612 00F4  5A			 		pop	dx
     613 00F5  59			 		pop	cx
     614 00F6  5B			 		pop	bx
     615 00F7  58			 		pop	AX
     616 00F8  5D					pop	bp
     617 00F9  CF			 		iret
     618				
     619 00FA  42 61 64 20 6F 70	msg2:		db	'Bad opcode encountered', 0Ah, 0Dh,0
     620       63 6F 64 65 20 65	
     621       6E 63 6F 75 6E 74	
     622       65 72 65 64 0A 0D	
     623       00			
     624				
     625				
     626				;===============================================================================
     627				;a.0113
     628				; INT 00 - Invalid interrupt handler. Just prints a message.
     629 0113				INT00HANDLER:
     630 0113  50			 		push	ax
     631 0114  53			 		push	bx
     632 0115  51			 		push	cx
     633 0116  52			 		push	dx
     634 0117  56			 		push	si
     635 0118  57			 		push	di
     636 0119  BE 0126 R		 		mov	si,offset msg3
     637 011C  E8 05E5 R		 		call	prtzstr
     638 011F  5F			 		pop	di
     639 0120  5E			 		pop	si
     640 0121  5A			 		pop	dx
     641 0122  59			 		pop	cx
     642 0123  5B			 		pop	bx
     643 0124  58			 		pop	AX
     644 0125  CF			 		iret
     645				;a.0126
     646 0126  42 61 64 20 69 6E	msg3:		db	'Bad interrupt received.', 0Ah, 0Dh,0
     647       74 65 72 72 75 70	
     648       74 20 72 65 63 65	
     649       69 76 65 64 2E 0A	
     650       0D 00			
     651				
     652				
     653				
     654				;===============================================================================
     655				;                              SUBROUTINE
     656				;
     657				;         Called from:   A.008D
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-13


     658				;===============================================================================
     659				;a.0140
     660 0140				DoChecksum	proc	near
     661 0140  BB 0000			 		mov	bx,0			; (A.0000=4Ch)
     662 0143  B0 00			 		mov	al,0
     663 0145  B9 2000			 		mov	cx,2000h
     664				
     665 0148				locloop_7:					;  xref A.014C
     666 0148  2E: 02 07		 		add	al,cs:[bx]
     667 014B  43			 		inc	bx
     668 014C  E2 FA			 		loop	locloop_7		; Loop if cx > 0
     669				
     670 014E  84 C0			 		test	al,al
     671 0150  C3			 		retn
     672 0151				DoChecksum	endp
     673				
     674				;===============================================================================
     675				;  Boot the Diskette
     676				;===============================================================================
     677				;a.0151
     678 0151				SysBoot:					;  xref A.00C6, 017E
     679 0151  BE 0185 R		 		mov	si,offset msg4		;185h	; (A.0185='Attempting to ')
     680 0154  E8 05E5 R		 		call	prtzstr			; (05E5)
     681 0157  33 C0			 		xor	ax,ax			; Zero register
     682 0159  8E C0			 		mov	es,ax
     683 015B  B9 0004			 		mov	cx,4			; 4 retries
     684				
     685 015E				locloop_9:					;  xref A.0166
     686 015E  51			 		push	cx
     687 015F  B4 00			 		mov	ah,0
     688 0161  CD 13			 		int	13h			; Disk  dl=drive a  ah=func 00h
     689				 						;  reset disk, al=return status
     690 0163  59			 		pop	cx
     691 0164  73 02			 		jnc	loc_10			; Jump if carry=0
     692 0166  E2 F6			 		loop	locloop_9		; Loop if cx > 0
     693				
     694 0168				loc_10:						;  xref A.0164
     695 0168  BB 7C00			 		mov	bx,IPLLOC		; 07c00h (0000:7C00=0)
     696 016B  8B D0			 		mov	dx,ax			; head 0, drive a
     697 016D  B9 0001			 		mov	cx,1			; cyl 0, sector 1
     698 0170  B0 08			 		mov	al,8			; 8 sectors
     699 0172  B4 02			 		mov	ah,2			; func 2
     700 0174  CD 13			 		int	13h			; Disk  dl=drive a  ah=func 02h
     701				 						;  read sectors to memory es:bx
     702				 						;   al=#,ch=cyl,cl=sectr,dh=head
     703 0176  73 08			 		jnc	loc_11			; all good, jump to boot code
     704 0178  B9 0019			 		mov	cx,19h
     705 017B  E8 0468 R		 		call	sub_6			; (0468) delay
     706 017E  EB D1			 		jmp	short SysBoot		; (0151)
     707				
     708				; Jump to the loaded boot sector
     709 0180				loc_11:						;  xref A.0176
     710						jmpf	0,IPLLOC
     711 0180  EA                    1	        db      0EAh; 
     712 0181  7C00 0000             1	        dw      IPLLOC,0 
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-14


     713				;		db	0EAh
     714				; 		dw	7C00h, 0
     715				
     716 0185  41 74 74 65 6D 70	msg4:		db	'Attempting to boot from diskette.', 0Dh, 0Ah, 0
     717       74 69 6E 67 20 74	
     718       6F 20 62 6F 6F 74	
     719       20 66 72 6F 6D 20	
     720       64 69 73 6B 65 74	
     721       74 65 2E 0D 0A 00	
     722				
     723				
     724				;===============================================================================
     725				;a.01a9
     726				; INT 12 - Memory Size AX
     727 01A9				INT12HANDLER:
     728 01A9  1E			        push   ds
     729 01AA  B8 0040			        mov    ax,40h
     730 01AD  8E D8			        mov    ds,ax
     731 01AF  A1 0013 R		        mov    ax,ds:main_ram_size	; 40:13 memory size in kbytes (INT 12h)
     732 01B2  1F			        pop    ds
     733 01B3  CF			        iret
     734				
     735				;===============================================================================
     736				;a.01b4
     737				; INT 11 - Equipment List
     738 01B4				INT11HANDLER:
     739 01B4  1E			        push   ds
     740 01B5  B8 0040			        mov    ax,40h
     741 01B8  8E D8			        mov    ds,ax
     742 01BA  A1 0010 R		        mov    ax,ds:equip_bits		; 40:10 equip list (INT 11h)
     743 01BD  1F			        pop    ds
     744 01BE  CF			        iret
     745				
     746				
     747				;===============================================================================
     748				 ;                              SUBROUTINE
     749				 ;
     750				 ;         Called from:   A.00A4
     751				;===============================================================================
     752				;a.1bf 
     753				; this tests all RAM
     754 01BF				RamTest		proc	near
     755 01BF  FC			 		cld				; Clear direction
     756 01C0  1E			 		push	ds
     757 01C1  06			 		push	es
     758 01C2  B8 0040			 		mov	ax,40h
     759 01C5  8E D8			 		mov	ds,ax
     760 01C7  BB 1000			 		mov	bx,1000h
     761				; the first 64k was already tested so set main RAM size at 64k to start
     762 01CA  C7 06 0013 R 0040	 		mov	word ptr ds:main_ram_size,40h	; (0040:0013=280h)
     763 01D0  B8 55AA			 		mov	ax,55AAh
     764 01D3  BA AA55			 		mov	dx,0AA55h
     765 01D6  BF 03FE			 		mov	di,data_50e		; (1040:03FE=3)
     766 01D9				loc_12:						;  xref A.01F2
     767 01D9  8E C3			 		mov	es,bx
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-15


     768 01DB  26: 89 05		 		mov	es:[di],ax
     769 01DE  52			 		push	dx
     770 01DF  5A			 		pop	dx
     771 01E0  26: 39 05		 		cmp	es:[di],ax
     772 01E3  75 0F			 		jne	loc_13			; Jump if not equal
     773 01E5  FF 06 0013 R		 		inc	word ptr ds:main_ram_size	; (0040:0013=280h)
     774 01E9  83 C3 40			 		add	bx,40h
     775 01EC  81 FB B7FF		 		cmp	bx,0B7FFh
     776 01F0  73 02			 		jae	loc_13			; Jump if above or =
     777 01F2  EB E5			 		jmp	short loc_12		; (01D9)
     778 01F4				loc_13:						;  xref A.01E3, 01F0
     779 01F4  A1 0013 R		 		mov	ax,ds:main_ram_size	; (0040:0013=280h)
     780 01F7  2D 0040			 		sub	ax,40h
     781 01FA  8B C8			 		mov	cx,ax
     782 01FC  BB 1000			 		mov	bx,1000h
     783 01FF  B8 0000			 		mov	ax,0
     784				
     785 0202				locloop_14:					;  xref A.0211
     786 0202  BF 0000			 		mov	di,data_49e		; (1000:0000=75h)
     787 0205  8E C3			 		mov	es,bx
     788 0207  51			 		push	cx
     789 0208  B9 0200			 		mov	cx,200h
     790 020B  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
     791 020D  59			 		pop	cx
     792 020E  83 C3 40			 		add	bx,40h
     793 0211  E2 EF			 		loop	locloop_14		; Loop if cx > 0
     794				
     795 0213  33 C0			 		xor	ax,ax			; Zero register
     796 0215  8E D8			 		mov	ds,ax
     797 0217  B8 01A9 R		 		mov	ax,offset INT12HANDLER	;1A9h
     798 021A  A3 0048			 		mov	ds:Int12v,ax		; (0000:0048=0CB40h)
     799 021D  8C 0E 004A		 		mov	ds:Int12v+2,cs		; (0000:004A=0F000h)
     800 0221  07			 		pop	es
     801 0222  1F			 		pop	ds
     802 0223  C3			 		retn
     803 0224				RamTest		endp
     804				
     805				
     806				;===============================================================================
     807				 ;                              SUBROUTINE
     808				 ;
     809				 ;         Called from:   A.00B4
     810				;===============================================================================
     811				;a.0224 
     812				; Grab INT17 (printer) vector
     813 0224				InitPrinter	proc	near
     814 0224  1E			 		push	ds
     815 0225  33 C0			 		xor	ax,ax			; Zero register
     816 0227  8E D8			 		mov	ds,ax
     817 0229  B8 0244 R		 		mov	ax,offset INT17HANDLER	;244h
     818 022C  A3 005C			 		mov	ds:Int17v,ax		; (0000:005C=0CBC0h)
     819 022F  8C 0E 005E		 		mov	ds:Int17v+2,cs		; (0000:005E=0F000h)
     820 0233  B8 0040			 		mov	ax,40h
     821 0236  8E D8			 		mov	ds,ax
     822 0238  C7 06 0008 R 00D0	 		mov	word ptr ds:prn_port_1,printer_port	;0D0h (0040:0008=378h)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-16


     823 023E  1F			 		pop	ds
     824 023F  B4 01			 		mov	ah,1
     825 0241  CD 17			 		int	17h			; Printer  dx=prn?, ah=func 01h
     826				 						;  initialize, ah=return status
     827 0243  C3			 		retn
     828 0244				InitPrinter	endp
     829				
     830				;===============================================================================
     831				;a.0244
     832				; INT 17 - Printer Services
     833 0244				INT17HANDLER:
     834 0244  FB			 		sti				; Enable interrupts
     835 0245  1E			 		push	ds
     836 0246  52			 		push	dx
     837 0247  51			 		push	cx
     838 0248  53			 		push	bx
     839 0249  56			 		push	si
     840 024A  BB 0040			 		mov	bx,40h
     841 024D  8E DB			 		mov	ds,bx
     842				; jump to functions
     843 024F  84 E4			 		test	ah,ah			; AH=2 read status to AH
     844 0251  74 0E			 		jz	loc_16	
     845				
     846 0253  FE CC			 		dec	ah			; AX=1 initialize 
     847 0255  74 35			 		jz	loc_19	
     848				
     849 0257  FE CC			 		dec	ah			; AX-0 print character in AL
     850 0259  74 50			 		jz	loc_20	
     851 025B				int17_exit:					;  xref A.0277, 02BA
     852 025B  5E			 		pop	si
     853 025C  5B			 		pop	bx
     854 025D  59			 		pop	cx
     855 025E  5A			 		pop	dx
     856 025F  1F			 		pop	ds
     857 0260  CF			 		iret				; Interrupt return
     858				
     859				; Read printer status.
     860 0261				loc_16:						;  xref A.0251
     861 0261  50			 		push	ax
     862 0262  B3 32			 		mov	bl,32h			; '2'
     863 0264  33 C9			 		xor	cx,cx
     864 0266  E6 D0			 		out	0D0h,al			; port 0D0h printer_port
     865				
     866 0268				locloop_17:					;  xref A.026E, 0272
     867 0268  E4 D2			 		in	al,0D2h			; port 0D2h PPI_B
     868 026A  A8 20			 		test	al,20h			; ' '
     869 026C  74 0B			 		jz	loc_18			; Jump if zero
     870 026E  E2 F8			 		loop	locloop_17		; Loop if cx > 0
     871				
     872 0270  FE CB			 		dec	bl
     873 0272  75 F4			 		jnz	locloop_17		; Jump if not zero
     874 0274  80 CC 01			 		or	ah,1
     875 0277  EB E2			 		jmp	short int17_exit		; (025B)
     876				;a.0279		
     877 0279				loc_18:						;  xref A.026C
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-17


     878 0279  B0 01			 		mov	al,1
     879 027B  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
     880 027D  50			 		push	ax
     881 027E  58			 		pop	ax
     882 027F  B0 00			 		mov	al,0
     883 0281  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
     884 0283  50			 		push	ax
     885 0284  58			 		pop	ax
     886 0285  B0 01			 		mov	al,1
     887 0287  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
     888 0289  58			 		pop	ax
     889 028A  EB 1F			 		jmp	short loc_20		; (02AB)
     890				
     891				; Initialize printer
     892				;a.028c
     893 028C				loc_19:						;  xref A.0255
     894 028C  50			 		push	ax
     895 028D  B0 01			 		mov	al,1
     896 028F  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
     897 0291  50			 		push	ax
     898 0292  58			 		pop	ax
     899 0293  B0 03			 		mov	al,3
     900 0295  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
     901 0297  50			 		push	ax
     902 0298  58			 		pop	ax
     903 0299  B0 06			 		mov	al,6
     904 029B  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
     905 029D  50			 		push	ax
     906 029E  58			 		pop	ax
     907 029F  B0 04			 		mov	al,4
     908 02A1  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
     909 02A3  E8 08C3 R		 		call	sub_17			; (08C3)
     910 02A6  B0 05			 		mov	al,5
     911 02A8  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
     912 02AA  58			 		pop	ax
     913				
     914				
     915				;a.02ab		
     916 02AB				loc_20:						;  xref A.0259, 028A
     917 02AB  50			 		push	ax
     918 02AC  E4 D2			 		in	al,0D2h			; PPI_B
     919 02AE  B3 10			 		mov	bl,10h
     920 02B0  A8 20			 		test	al,20h			; ' '
     921 02B2  74 03			 		jz	loc_21			; Jump if zero
     922 02B4  80 CB 80			 		or	bl,80h
     923 02B7				loc_21:						;  xref A.02B2
     924 02B7  58			 		pop	ax
     925 02B8  8A E3			 		mov	ah,bl
     926 02BA  EB 9F			 		jmp	short int17_exit		; (025B)
     927				
     928				;===============================================================================
     929				 ;                              SUBROUTINE
     930				 ;
     931				 ;         Called from:   A.00B1
     932				;===============================================================================
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-18


     933				;a.02bc
     934				; Grab INT14 serial vector
     935 02BC				InitSerialPorts		proc	near
     936 02BC  1E			 		push	ds
     937 02BD  33 C0			 		xor	ax,ax	
     938 02BF  8E D8			 		mov	ds,ax
     939 02C1  B8 02E2 R		 		mov	ax,offset INT14HANDLER	;2E2h
     940 02C4  A3 0050			 		mov	ds:Int14v,ax		; (0000:0050=0CB80h)
     941 02C7  8C 0E 0052		 		mov	ds:Int14v+2,cs		; (0000:0052=0F000h)
     942 02CB  B8 0040			 		mov	ax,40h
     943 02CE  8E D8			 		mov	ds,ax
     944				; should code bb 00 00
     945 02D0  BB 0000 R		 		mov	bx,offset rs232_port_1		; (0040:0000=0F8h)
     946				; sets serial ports to port 80h (com1) and 0c0h (com2)
     947 02D3  B8 0080			 		mov	ax,ACIA1BASE		; 80h COM1
     948 02D6  89 07			 		mov	[bx],ax
     949 02D8  B8 00C0			 		mov	ax,ACIA0BASE		; 0C0h COM2
     950 02DB  83 C3 02			 		add	bx,2
     951 02DE  89 07			 		mov	[bx],ax
     952 02E0  1F			 		pop	ds
     953 02E1  C3			 		retn
     954 02E2				InitSerialPorts		endp
     955				
     956				;===============================================================================
     957				; a.02e2
     958				; INT 14 - Serial Communications
     959 02E2				INT14HANDLER:
     960 02E2  1E			 		push	ds
     961 02E3  52			 		push	dx
     962 02E4  56			 		push	si
     963 02E5  57			 		push	di
     964 02E6  53			 		push	bx
     965 02E7  51			 		push	cx
     966 02E8  8B F2			 		mov	si,dx			; DX= port ID 0/1
     967 02EA  D1 E6			 		shl	si,1	
     968 02EC  BA 0040			 		mov	dx,40h
     969 02EF  8E DA			 		mov	ds,dx
     970 02F1  8B 94 0000 R		 		mov	dx,ds:rs232_port_1[si]	; (0040:0000=3F8h)
     971 02F5  0B D2			 		or	dx,dx			; dx= address of port
     972 02F7  74 19			 		jz	I14_exit		; no port available? Exit
     973				
     974				; function dispatch
     975				; AH=0 init	AH=1 send	AH=2 receive	AH=3 status
     976 02F9  0A E4			 		or	ah,ah			; AX=0 initialize
     977 02FB  74 1C			 		jz	InitSerPorts	
     978				
     979 02FD  FE CC			 		dec	ah
     980 02FF  75 03			 		jnz	I14_1
     981 0301  E9 03AB R		 		jmp	loc_30			; (03AB) send
     982				
     983 0304				I14_1:						;  xref A.02FF
     984 0304  FE CC			 		dec	ah
     985 0306  75 03			 		jnz	I14_2
     986 0308  E9 03E6 R		 		jmp	loc_35			; (03E6) receive
     987				
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-19


     988 030B				I14_2:						;  xref A.0306
     989 030B  FE CC			 		dec	ah
     990 030D  75 03			 		jnz	I14_exit
     991 030F  E9 0454 R		 		jmp	loc_47			; (0454) status
     992				
     993 0312				I14_exit:					;  xref A.02F7, 030D, 03C5, 03DB
     994				 						;            03E3, 0402, 041D, 0465
     995 0312  59			 		pop	cx
     996 0313  5B			 		pop	bx
     997 0314  5F			 		pop	di
     998 0315  5E			 		pop	si
     999 0316  5A			 		pop	dx
    1000 0317  1F			 		pop	ds
    1001 0318  CF			 		iret	
    1002				
    1003				
    1004 0319				InitSerPorts:					;  xref A.02FB
    1005 0319  50			 		push	ax
    1006 031A  B4 42			 		mov	ah,42h			; 'B'
    1007 031C  8A D8			 		mov	bl,al
    1008 031E  F6 C3 04			 		test	bl,4
    1009 0321  74 03			 		jz	loc_26			; Jump if zero
    1010 0323  80 CC C0			 		or	ah,0C0h
    1011 0326				loc_26:						;  xref A.0321
    1012 0326  80 CC 40			 		or	ah,40h			; '@'
    1013 0329  D0 C3			 		rol	bl,1			; Rotate
    1014 032B  B0 30			 		mov	al,30h			; '0'
    1015 032D  22 C3			 		and	al,bl
    1016 032F  0A E0			 		or	ah,al
    1017 0331  D0 C3			 		rol	bl,1			; Rotate
    1018 0333  B0 0C			 		mov	al,0Ch
    1019 0335  22 C3			 		and	al,bl
    1020 0337  0A E0			 		or	ah,al
    1021 0339  83 C2 02			 		add	dx,2
    1022 033C  B0 00			 		mov	al,0
    1023 033E  B9 0003			 		mov	cx,3
    1024				
    1025				;a.0341
    1026 0341				locloop_27:					;  xref A.0345
    1027 0341  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1028 0342  E8 08C3 R		 		call	sub_17			; (08C3)
    1029 0345  E2 FA			 		loop	locloop_27		; Loop if cx > 0
    1030				
    1031 0347  B0 40			 		mov	al,40h			; '@'
    1032 0349  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1033 034A  E8 08C3 R		 		call	sub_17			; (08C3)
    1034 034D  8A C4			 		mov	al,ah
    1035 034F  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1036 0350  58			 		pop	ax
    1037 0351  D0 C0			 		rol	al,1			; Rotate
    1038 0353  D0 C0			 		rol	al,1			; Rotate
    1039 0355  D0 C0			 		rol	al,1			; Rotate
    1040 0357  24 07			 		and	al,7
    1041 0359  52			 		push	dx
    1042 035A  81 FA 0082		 		cmp	dx,82h
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-20


    1043 035E  77 05			 		ja	loc_28			; Jump if above
    1044				
    1045				; set timer register for right UART
    1046 0360  BA FF5A			 		mov	dx,0FF5Ah		;PCRBASE+T1CR+TMRCA
    1047 0363  EB 03			 		jmp	short loc_29		; (0368)
    1048 0365				loc_28:						;  xref A.035E
    1049 0365  BA FF52			 		mov	dx,0FF52h		;PCRBASE+T0CR+TMRCA
    1050 0368				loc_29:						;  xref A.0363
    1051 0368  B4 00			 		mov	ah,0
    1052 036A  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    1053 036C  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    1054 036E  BB 038B R		 		mov	bx,offset data_81	; (A.038B=38h)
    1055 0371  03 D8			 		add	bx,ax
    1056 0373  2E: 8B 07		 		mov	ax,cs:[bx]
    1057 0376  EF			 		out	dx,ax			; port 0FF52h PCRBASE+T0CR+TMRCA
    1058 0377  83 C2 02			 		add	dx,2			; go to count register B
    1059 037A  83 C3 02			 		add	bx,2
    1060 037D  2E: 8B 07		 		mov	ax,cs:[bx]
    1061 0380  E8 08C3 R		 		call	sub_17			; (08C3)
    1062 0383  EF			 		out	dx,ax			; port 0FF54h
    1063 0384  5A			 		pop	dx			; PCRBASE+T0CR+TMRCB
    1064 0385  83 EA 02			 		sub	dx,2			; back to CRA?
    1065 0388  E9 0454 R		 		jmp	loc_47			; (0454)
    1066				
    1067				; parameters to program internal timers? Read as words.
    1068				;a.038b
    1069 038B				data_81:						; xref A.036E
    1070				;     		db	 38h, 02h, 38h, 02h,0A1h, 01h,0A1h
    1071				;     		db	 01h,0D0h, 00h,0D1h, 00h, 68h
    1072				;     		db	 00h, 68h, 00h, 34h, 00h, 34h
    1073				;     		db	 00h, 1Ah, 00h, 1Ah, 00h, 0Dh
    1074				;     		db	 00h, 0Dh, 00h, 06h, 00h, 07h
    1075				; 		db	 00h
    1076 038B  0238 0238 01A1 01A1			dw	0238h, 0238h, 01a1h, 01a1h
    1077 0393  00D0 00D1 0068 0068			dw	00d0h, 00d1h, 0068h, 0068h
    1078 039B  0034 0034 001A 001A			dw	0034h, 0034h, 001ah, 001ah
    1079 03A3  000D 000D 0006 0007			dw	000dh, 000dh, 0006h, 0007h
    1080				
    1081				; Serial send
    1082 03AB				loc_30:						;  xref A.0301
    1083 03AB  50			 		push	ax
    1084 03AC  83 C2 02			 		add	dx,2
    1085 03AF  B0 37			 		mov	al,37h			; '7'
    1086 03B1  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1087 03B2  33 C9			 		xor	cx,cx	
    1088 03B4  B3 04			 		mov	bl,4
    1089				
    1090 03B6				locloop_31:					;  xref A.03BB, 03BF
    1091 03B6  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1092 03B7  A8 80			 		test	al,80h
    1093 03B9  75 0D			 		jnz	loc_32	
    1094 03BB  E2 F9			 		loop	locloop_31		; Loop if cx > 0
    1095				
    1096 03BD  FE CB			 		dec	bl
    1097 03BF  75 F5			 		jnz	locloop_31
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-21


    1098 03C1  58			 		pop	ax
    1099 03C2  80 CC 80			 		or	ah,80h
    1100 03C5  E9 0312 R		 		jmp	I14_exit		; (0312)
    1101 03C8				loc_32:						;  xref A.03B9
    1102 03C8  33 C9			 		xor	cx,cx	
    1103 03CA  B3 02			 		mov	bl,2
    1104				
    1105 03CC				locloop_33:					;  xref A.03D1, 03D5
    1106 03CC  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1107 03CD  A8 01			 		test	al,1
    1108 03CF  75 0D			 		jnz	loc_34
    1109 03D1  E2 F9			 		loop	locloop_33		; Loop if cx > 0
    1110				
    1111 03D3  FE CB			 		dec	bl
    1112 03D5  75 F5			 		jnz	locloop_33
    1113 03D7  58			 		pop	ax
    1114 03D8  80 CC 80			 		or	ah,80h
    1115 03DB  E9 0312 R		 		jmp	I14_exit		; (0312)
    1116 03DE				loc_34:						;  xref A.03CF
    1117 03DE  83 EA 02			 		sub	dx,2
    1118 03E1  58			 		pop	ax
    1119 03E2  EE			 		out	dx,al			; port 0, DMA-1 bas&add ch 0
    1120 03E3  E9 0312 R		 		jmp	I14_exit		; (0312)
    1121				
    1122				; Receive
    1123 03E6				loc_35:						;  xref A.0308
    1124				; 		and	byte ptr ds:[71h],7Fh	; (A.0071=0) signbit
    1125 03E6  80 26 0071 R 7F				and	byte ptr ds:[signbit],7Fh
    1126 03EB  83 C2 02			 		add	dx,2
    1127 03EE  B0 37			 		mov	al,37h			; '7'
    1128 03F0  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1129 03F1  33 C9			 		xor	cx,cx
    1130 03F3  B3 04			 		mov	bl,4
    1131				
    1132				;a.03f5
    1133 03F5				locloop_36:					;  xref A.03FA, 03FE
    1134 03F5  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1135 03F6  A8 80			 		test	al,80h
    1136 03F8  75 0B			 		jnz	loc_38	
    1137 03FA  E2 F9			 		loop	locloop_36		; Loop if cx > 0
    1138				
    1139 03FC  FE CB			 		dec	bl
    1140 03FE  75 F5			 		jnz	locloop_36
    1141 0400				loc_37:						;  xref A.0411
    1142 0400  B4 80			 		mov	ah,80h
    1143 0402  E9 0312 R		 		jmp	I14_exit			; (0312)
    1144				
    1145 0405				loc_38:						;  xref A.03F8, 040F
    1146 0405  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1147 0406  A8 02			 		test	al,2
    1148 0408  75 09			 		jnz	loc_39	
    1149				; 		test	byte ptr ds:[71h],80h	; (A.0071=0)
    1150 040A  F6 06 0071 R 80				test	byte ptr ds:[signbit],80h
    1151 040F  74 F4			 		jz	loc_38	
    1152 0411  EB ED			 		jmp	short loc_37		; (0400)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-22


    1153				
    1154				; checks for receive errors
    1155 0413				loc_39:						;  xref A.0408
    1156 0413  E8 0420 R		 		call	SetSerErrFl			; (0420)
    1157 0416  80 E4 1E			 		and	ah,00011110b		;1Eh
    1158 0419  83 EA 02			 		sub	dx,2
    1159 041C  EC			 		in	al,dx			; port 0, DMA-1 bas&add ch 0
    1160 041D  E9 0312 R		 		jmp	I14_exit			; (0312)
    1161				
    1162				;===============================================================================
    1163				 ;                              SUBROUTINE
    1164				 ;
    1165				 ;         Called from:   A.0413, 0458
    1166				;===============================================================================
    1167				; Tests some variable for bit flags. Maybe serial errors? AL= line status reg
    1168				; actual error bits are 7 (time out), 4 (BRK), 3 (FE), 2 (PE), 1 (OR). 
    1169				; AH !=0 on error
    1170				; Entry AL = status bits from the 8251
    1171				;a.0420
    1172 0420				SetSerErrFl		proc	near
    1173 0420  B4 00			 		mov	ah,0
    1174 0422  A8 01			 		test	al,1
    1175 0424  74 03			 		jz	loc_40
    1176 0426  80 CC 20			 		or	ah,20h			; THRE
    1177 0429				loc_40:						;  xref A.0424
    1178 0429  A8 02			 		test	al,2
    1179 042B  74 03			 		jz	loc_41	
    1180 042D  80 CC 01			 		or	ah,1			; DR
    1181 0430				loc_41:						;  xref A.042B
    1182 0430  A8 04			 		test	al,4
    1183 0432  74 03			 		jz	loc_42	
    1184 0434  80 CC 40			 		or	ah,40h			; TSRE
    1185 0437				loc_42:						;  xref A.0432
    1186 0437  A8 08			 		test	al,8
    1187 0439  74 03			 		jz	loc_43	
    1188 043B  80 CC 04			 		or	ah,4			; PE
    1189 043E				loc_43:						;  xref A.0439
    1190 043E  A8 10			 		test	al,10h
    1191 0440  74 03			 		jz	loc_44	
    1192 0442  80 CC 02			 		or	ah,2			; OR
    1193 0445				loc_44:						;  xref A.0440
    1194 0445  A8 20			 		test	al,20h	
    1195 0447  74 03			 		jz	loc_45
    1196 0449  80 CC 08			 		or	ah,8			; FE
    1197 044C				loc_45:						;  xref A.0447
    1198 044C  A8 40			 		test	al,40h	
    1199 044E  74 03			 		jz	loc_ret_46
    1200 0450  80 CC 10			 		or	ah,10h			; BRK
    1201				
    1202 0453				loc_ret_46:					;  xref A.044E
    1203 0453  C3			 		retn
    1204 0454				SetSerErrFl		endp
    1205				
    1206				; Serial Status
    1207 0454				loc_47:						;  xref A.030F, 0388
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-23


    1208 0454  83 C2 02			 		add	dx,2
    1209 0457  EC			 		in	al,dx			; port 4, DMA-1 bas&add ch 2
    1210 0458  E8 0420 R		 		call	SetSerErrFl		; (0420)
    1211 045B  24 80			 		and	al,80h			; timeout bit
    1212 045D  84 C0			 		test	al,al
    1213 045F  B0 F0			 		mov	al,0F0h
    1214 0461  75 02			 		jnz	loc_48			; Jump if not zero
    1215 0463  B0 00			 		mov	al,0			; set MSR=0
    1216 0465				loc_48:						;  xref A.0461
    1217 0465  E9 0312 R		 		jmp	I14_exit		; (0312)
    1218				
    1219				;===============================================================================
    1220				 ;                              SUBROUTINE
    1221				 ;
    1222				 ;         Called from:   A.017B
    1223				;===============================================================================
    1224				;a.0468
    1225				; delay loop CX=# of msec?
    1226 0468				sub_6		proc	near
    1227 0468				loc_49:						;  xref A.0470
    1228 0468  FB			 		sti				; Enable interrupts
    1229 0469  51			 		push	cx
    1230 046A  33 C9			 		xor	cx,cx			; Zero register
    1231 046C				locloop_50:					;  xref A.046C
    1232 046C  E2 FE			 		loop	locloop_50		; Loop if cx > 0
    1233 046E  59			 		pop	cx
    1234 046F  49			 		dec	cx
    1235 0470  75 F6			 		jnz	loc_49			; Jump if not zero
    1236 0472  C3			 		retn
    1237 0473				sub_6		endp
    1238				
    1239				
    1240				;===============================================================================
    1241				 ;                              SUBROUTINE
    1242				 ;
    1243				 ;         Called from:   A.009E
    1244				;===============================================================================
    1245				; setup certain handlers to default to IRET and set equipment bits
    1246				;a.0473
    1247 0473				InitEquipList	proc	near
    1248 0473  1E			 		push	ds
    1249 0474  33 C0			 		xor	ax,ax			; Zero register
    1250 0476  8E D8			 		mov	ds,ax
    1251 0478  B8 0596 R		 		mov	ax,offset DefIRET	; default IRET 596h
    1252 047B  A3 0060			 		mov	ds:Int18v,ax		; (0000:0060=0CD00h)
    1253 047E  A3 0064			 		mov	ds:Int19v,ax		; (0000:0064=0CC60h)
    1254 0481  8C 0E 0062		 		mov	ds:Int18v+2,cs		; (0000:0062=0F000h)
    1255 0485  8C 0E 0066		 		mov	ds:Int19v+2,cs		; (0000:0066=0F000h)
    1256 0489  A3 0054			 		mov	ds:Int15v,ax		; (0000:0054=0CBA0h)
    1257 048C  8C 0E 0056		 		mov	ds:Int15v+2,cs		; (0000:0056=0F000h)
    1258 0490  A3 006C			 		mov	ds:Int1Bv,ax		; (0000:006C=0D1C0h)
    1259 0493  8C 0E 006E		 		mov	ds:Int1Bv+2,cs		; (0000:006E=0F000h)
    1260 0497  A3 0070			 		mov	ds:Int1Cv,ax		; (0000:0070=0CC00h)
    1261 049A  8C 0E 0072		 		mov	ds:Int1Cv+2,cs		; (0000:0072=0F000h)
    1262				
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-24


    1263 049E  B8 01B4 R		 		mov	ax,offset INT11HANDLER	; equip list 1B4h
    1264 04A1  A3 0044			 		mov	ds:Int11v,ax		; (0000:0044=0CB20h)
    1265 04A4  8C 0E 0046		 		mov	ds:Int11v+2,cs		; (0000:0046=0F000h)
    1266 04A8  B8 0040			 		mov	ax,40h
    1267 04AB  8E D8			 		mov	ds,ax
    1268				; equipment list - assumes:
    1269				;	01 0 0 010 0 01 10 11 0 1 = 446Dh
    1270				;	LP X G SER X FD VM KM X B
    1271				;
    1272				;	BIT 15,14 = NUMBER OF PRINTERS ATTACHED
    1273				;	BIT 13 NOT USED
    1274				;	BIT 12 = GAME I/O ATTACHED
    1275				;	BIT 11,10,9 = NUMBER OF RS232 CARDS ATTACHED
    1276				;	BIT 8 UNUSED
    1277				;	BIT 7,6 = NUMBER OF DISKETTE DRIVES
    1278				;		00=1, 01=2, 10=3, 11=4 ONLY IF BIT 0 = 1
    1279				;	BIT 5,4 = INITIAL VIDEO MODE
    1280				;			00 - UNUSED
    1281				;			01 - 40X25 BW USING COLOR CARD
    1282				;			10 - 80X25 BW USING COLOR CARD
    1283				;			11 - 80X25 BW USING BW CARD
    1284				;	BIT 3,2 = PLANAR RAM SIZE (00=16K,01=32K,10=48K,11=64K)
    1285				;	BIT 1 NOT USED
    1286				;	BIT 0 = IPL FROM DISKETTE -- THIS BIT INDICATES THAT THERE ARE DISKETTE
    1287				;		DRIVES ON THE SYSTEM
    1288 04AD  B8 446D			 		mov	ax,446Dh		; 01000100 / 01101101
    1289 04B0  A3 0010 R		 		mov	ds:equip_bits,ax	; (0040:0010=4467h)
    1290 04B3  1F			 		pop	ds
    1291 04B4  C3			 		retn
    1292 04B5				InitEquipList	endp
    1293				
    1294				
    1295				;===============================================================================
    1296				 ;                              SUBROUTINE
    1297				 ;
    1298				 ;         Called from:   A.00A1
    1299				;===============================================================================
    1300				; setup default handlers 08h, 0ch, and 1ah.
    1301				;a.04b5
    1302 04B5				InitTimers	proc	near
    1303 04B5  1E			 		push	ds
    1304 04B6  9C			 		pushf				; Push flags
    1305 04B7  FA			 		cli				; Disable interrupts
    1306 04B8				loc_51:
    1307 04B8  33 C0			 		xor	ax,ax			; Zero register
    1308 04BA  8E D8			 		mov	ds,ax
    1309				;***** Note: the following codes as B8 0511 while the original
    1310				;***** codes as B8 0513.
    1311 04BC  B8 0511 R		 		mov	ax,offset INT0CHANDLER	;513h
    1312				;*****
    1313 04BF  A3 0030			 		mov	ds:Int0Cv,ax		; (0000:0030=0CE80h)
    1314 04C2  8C 0E 0032		 		mov	ds:Int0Cv+2,cs		; (0000:0032=0F000h)
    1315 04C6  B8 0521 R		 		mov	ax,offset INT08HANDLER	;521h
    1316 04C9  A3 0020			 		mov	ds:Int08v,ax		; (0000:0020=0FEA5h)
    1317 04CC  8C 0E 0022		 		mov	ds:Int08v+2,cs		; (0000:0022=0F000h)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-25


    1318 04D0  B8 0562 R		 		mov	ax,offset INT1AHANDLER	;562h
    1319 04D3  A3 0068			 		mov	ds:Int1Av,ax		; (0000:0068=0CBE0h)
    1320 04D6  8C 0E 006A		 		mov	ds:Int1Av+2,cs		; (0000:006A=0F000h)
    1321 04DA  B8 0040			 		mov	ax,40h
    1322 04DD  8E D8			 		mov	ds,ax
    1323 04DF  33 C0			 		xor	ax,ax			; Zero register
    1324 04E1  A3 006C R		 		mov	ds:timer_low,ax		; (0040:006C=6980h)
    1325 04E4  A3 006E R		 		mov	ds:timer_hi,ax		; (0040:006E=16h)
    1326 04E7  A2 0070 R		 		mov	ds:timer_rolled,al	; (0040:0070=0)
    1327 04EA  BE 050A R		 		mov	si,offset data_82	; (A.050A=36h)
    1328 04ED  B9 0003			 		mov	cx,3
    1329 04F0  BA 0040			 		mov	dx,40h
    1330				
    1331 04F3				locloop_52:					;  xref A.04FE
    1332 04F3  2E: AC			 		lods	byte ptr cs:[si]	; String [si] to al
    1333 04F5  E6 43			 		out	43h,al			; port 43h, 8253 timer control C58253CTL
    1334 04F7  2E: AC			 		lods	byte ptr cs:[si]	; String [si] to al
    1335 04F9  EE			 		out	dx,al			; port 40h, 8253 timer 0 clock
    1336 04FA  2E: AC			 		lods	byte ptr cs:[si]	; String [si] to al
    1337 04FC  EE			 		out	dx,al			; port 40h, 8253 timer 0 clock
    1338 04FD  42			 		inc	dx
    1339 04FE  E2 F3			 		loop	locloop_52		; Loop if cx > 0
    1340				
    1341 0500  BA FF38			 		mov	dx,0FF38h		;PCRBASE+ICR+INT0CR
    1342 0503  B8 0000			 		mov	ax,0
    1343 0506  EF			 		out	dx,ax			; port 0FF38h ??I/O Non-standard
    1344 0507  9D			 		popf				; Pop flags
    1345 0508  1F			 		pop	ds
    1346 0509  C3			 		retn
    1347 050A				InitTimers	endp
    1348				
    1349				; 80186 timer 0 configuration bytes
    1350				;a.050a
    1351 050A  36 00 00 76 A9 04	data_82:	db	36h, 00h, 00h, 76h,0A9h, 04h,0B6h
    1352       B6			
    1353				
    1354				;===============================================================================
    1355				; a.0511
    1356				; (80186 INT1 Handler)
    1357 0511				INT0CHANDLER:
    1358 0511  A9 5004			 		test	ax,5004h		; 01100000-00000100
    1359 0514  52			 		push	dx
    1360 0515  B8 8000			 		mov	ax,8000h		; 10000000-00000000
    1361 0518  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
    1362 051B  EF			 		out	dx,ax
    1363 051C  5A			 		pop	dx
    1364 051D  58			 		pop	ax
    1365 051E  CD 08			 		INT	08h 
    1366 0520  CF			 		iret
    1367				
    1368				;===============================================================================
    1369				;a.0521
    1370				; INT 08 - Hardware Timer Tick
    1371 0521				INT08HANDLER:
    1372 0521  50			 		push	ax
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-26


    1373 0522  52			 		push	dx
    1374 0523  1E			 		push	ds
    1375 0524  B8 0040			 		mov	ax,40h
    1376 0527  8E D8			 		mov	ds,ax
    1377 0529  FF 06 006C R		 		inc	word ptr ds:[timer_low]
    1378 052D  75 04			 		jnz	loc_53
    1379 052F  FF 06 006E R		 		inc	word ptr ds:[timer_hi]
    1380 0533				loc_53:
    1381 0533  83 3E 006E R 18		 		cmp	word ptr ds:[timer_hi],18h	; (A.006E=0BF00h)
    1382 0538  75 19			 		jne	loc_54				; Jump if not equal
    1383 053A  81 3E 006C R 00B0	 		cmp	word ptr ds:[timer_low],0B0h	; (A.006C=0BEh)
    1384 0540  75 11			 		jne	loc_54				; Jump if not equal
    1385 0542  C7 06 006E R 0000	 		mov	word ptr ds:[timer_hi],0	; (A.006E=0BF00h)
    1386 0548  C7 06 006C R 0000	 		mov	word ptr ds:[timer_low],0	; (A.006C=0BEh)
    1387 054E  C6 06 0070 R 01		 		mov	byte ptr ds:[timer_rolled],1	; (A.0070=4)
    1388 0553				loc_54:							;  xref A.0538, 0540
    1389 0553  FE 0E 0040 R		 		dec	byte ptr ds:[dsk_motor_tmr]	; (A.0040=0ABh)
    1390 0557  75 03			 		jnz	loc_55				; Jump if not zero
    1391 0559  E8 09AD R		 		call	sub_19				; (09AD)
    1392 055C				loc_55:							;  xref A.0557
    1393 055C  CD 1C			 		int	1Ch				; Timer break (call each 18.2ms)
    1394 055E  1F			 		pop	ds
    1395 055F  5A			 		pop	dx
    1396 0560  58			 		pop	ax
    1397 0561  CF			 		iret				; Interrupt return
    1398				
    1399				;===============================================================================
    1400				;a.0562
    1401				; INT 1A - Time-of-Day/RTC
    1402 0562				INT1AHANDLER:
    1403 0562  1E			 		push	ds
    1404 0563  FA			 		cli				; Disable interrupts
    1405 0564  50			 		push	ax
    1406 0565  B8 0040			 		mov	ax,40h
    1407 0568  8E D8			 		mov	ds,ax
    1408 056A  58			 		pop	ax
    1409 056B  0A E4			 		or	ah,ah			; Zero ?
    1410 056D  74 06			 		jz	loc_57			; Jump if zero
    1411 056F  FE CC			 		dec	ah
    1412 0571  74 14			 		jz	loc_58			; Jump if zero
    1413 0573				loc_56:						;  xref A.0585, 0594
    1414 0573  1F			 		pop	ds
    1415 0574  CF			 		iret				; Interrupt return
    1416				
    1417 0575				loc_57:							;  xref A.056D
    1418 0575  A0 0070 R		 		mov	al,byte ptr ds:[timer_rolled]	; (A.0070=4)
    1419 0578  C6 06 0070 R 00		 		mov	byte ptr ds:[timer_rolled],0	; (A.0070=4)
    1420 057D  8B 0E 006E R		 		mov	cx,word ptr ds:[timer_hi]	; (A.006E=0BF00h)
    1421 0581  8B 16 006C R		 		mov	dx,word ptr ds:[timer_low]	; (A.006C=0BEh)
    1422 0585  EB EC			 		jmp	short loc_56			; (0573)
    1423 0587				loc_58:							;  xref A.0571
    1424 0587  89 16 006C R		 		mov	word ptr ds:[timer_low],dx	; (A.006C=0BEh)
    1425 058B  89 0E 006E R		 		mov	word ptr ds:[timer_hi],cx	; (A.006E=0BF00h)
    1426 058F  C6 06 0070 R 00		 		mov	byte ptr ds:[timer_rolled],0	; (A.0070=4)
    1427 0594  EB DD			 		jmp	short loc_56			; (0573)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-27


    1428 0596  CF			 DefIRET:	iret	
    1429				
    1430				;===============================================================================
    1431				; Dynamic Halt
    1432 0597				 DynHalt:					;  xref A.004B, 0598
    1433 0597  FA			 		cli				; Disable interrupts
    1434 0598  EB FD			 		jmp	short DynHalt		; (0597)
    1435				
    1436				;===============================================================================
    1437				;a.059a
    1438				;* No entry point to code
    1439				; Doesn't seem to have an absolute reference anywhere
    1440 059A				loc_59:
    1441 059A  9C			 		pushf				; Push flags
    1442 059B  FA			 		cli				; Disable interrupts
    1443 059C  1E			 		push	ds
    1444 059D  B8 0040			 		mov	ax,40h
    1445 05A0  8E D8			 		mov	ds,ax
    1446 05A2  0A F6			 		or	dh,dh			; Zero ?
    1447 05A4  74 0B			 		jz	loc_62			; Jump if zero
    1448 05A6				loc_60:						;  xref A.05AF
    1449 05A6  B3 06			 		mov	bl,6
    1450 05A8  E8 05C3 R		 		call	BEEP			; (05C3)
    1451				
    1452 05AB				locloop_61:					;  xref A.05AB
    1453 05AB  E2 FE			 		loop	locloop_61		; Loop if cx > 0
    1454				
    1455 05AD  FE CE			 		dec	dh
    1456 05AF  75 F5			 		jnz	loc_60			; Jump if not zero
    1457 05B1				loc_62:						;  xref A.05A4, 05BA
    1458 05B1  B3 01			 		mov	bl,1
    1459 05B3  E8 05C3 R		 		call	BEEP			; (05C3)
    1460				
    1461 05B6				locloop_63:					;  xref A.05B6
    1462 05B6  E2 FE			 		loop	locloop_63		; Loop if cx > 0
    1463				
    1464 05B8  FE CA			 		dec	dl
    1465 05BA  75 F5			 		jnz	loc_62			; Jump if not zero
    1466				
    1467 05BC				locloop_64:					;  xref A.05BC
    1468 05BC  E2 FE			 		loop	locloop_64		; Loop if cx > 0
    1469				
    1470				
    1471 05BE				locloop_65:					;  xref A.05BE
    1472 05BE  E2 FE			 		loop	locloop_65		; Loop if cx > 0
    1473				
    1474 05C0  1F			 		pop	ds
    1475 05C1  9D			 		popf				; Pop flags
    1476 05C2  C3			 		retn
    1477				
    1478				;===============================================================================
    1479				 ;                              SUBROUTINE
    1480				 ;
    1481				 ;         Called from:   A.05A8, 05B3, 16C8
    1482				;===============================================================================
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-28


    1483				;a.05c3
    1484				; should ax,cx be preserved?
    1485 05C3				BEEP		proc	near
    1486 05C3  B0 B6			 		mov	al,0B6h
    1487 05C5  E6 43			 		out	43h,al			; port 43h, 8253 timer control C58253CTL
    1488 05C7  B8 0533			 		mov	ax,533h
    1489 05CA  E6 42			 		out	42h,al			; port 42h, 8253 timer 2 spkr C5TIMER2
    1490 05CC  8A C4			 		mov	al,ah
    1491 05CE  E6 42			 		out	42h,al			; port 42h, 8253 timer 2 spkr C5TIMER2
    1492 05D0  E4 61			 		in	al,61h			; port 61h, 8255 port B, read C58255PB
    1493 05D2  8A E0			 		mov	ah,al
    1494 05D4  0C 03			 		or	al,3
    1495 05D6  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc C58255PB
    1496 05D8  2B C9			 		sub	cx,cx
    1497				
    1498 05DA				BEEP_1:						;  xref A.05DA, 05DE
    1499 05DA  E2 FE			 		loop	BEEP_1			; Loop if cx > 0
    1500 05DC  FE CB			 		dec	bl
    1501 05DE  75 FA			 		jnz	BEEP_1			; Jump if not zero
    1502 05E0  8A C4			 		mov	al,ah
    1503 05E2  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc C58255PB
    1504 05E4  C3			 		retn
    1505 05E5				BEEP		endp
    1506				
    1507				
    1508				;===============================================================================
    1509				 ;                              SUBROUTINE
    1510				 ;
    1511				 ;         Called from:   A.0095, 009B, 0154, 0BA9
    1512				;===============================================================================
    1513				;a.05e5
    1514 05E5				prtzstr		proc	near
    1515 05E5				loc_67:						;  xref A.05F3
    1516 05E5  2E: 8A 04		 		mov	al,cs:[si]
    1517 05E8  46			 		inc	si
    1518 05E9  84 C0			 		test	al,al
    1519 05EB  74 08			 		jz	loc_ret_68		; Jump if zero
    1520 05ED  B7 00			 		mov	bh,0
    1521 05EF  B4 0E			 		mov	ah,0Eh
    1522 05F1  CD 10			 		int	10h			; Video display   ah=functn 0Eh
    1523				 						;  write char al, teletype mode
    1524 05F3  EB F0			 		jmp	short loc_67		; (05E5)
    1525				
    1526 05F5				loc_ret_68:					;  xref A.05EB
    1527 05F5  C3			 		retn
    1528 05F6				 prtzstr	endp
    1529				
    1530				
    1531				;===============================================================================
    1532				 ;                              SUBROUTINE
    1533				 ;
    1534				 ;         Called from:   A.00AA
    1535				;===============================================================================
    1536				;a.05f6
    1537				; grab disk vectors and second serial hardware IRQ
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-29


    1538 05F6				InitFloppy	proc	near
    1539 05F6  1E			 		push	ds
    1540 05F7  33 C0			 		xor	ax,ax			; Zero register
    1541 05F9  8E D8			 		mov	ds,ax
    1542 05FB  B8 061B R		 		mov	ax,offset INT13HANDLER	;61Bh
    1543 05FE  A3 004C			 		mov	ds:Int13v,ax		; (0000:004C=0CF60h)
    1544 0601  8C 0E 004E		 		mov	ds:Int13v+2,cs		; (0000:004E=0F000h)
    1545 0605  B8 07E9 R		 		mov	ax,offset INT0BHANDLER	;7E9h
    1546 0608  A3 002C			 		mov	ds:Int0Bv,ax		; (0000:002C=0CE80h)
    1547 060B  8C 0E 002E		 		mov	ds:Int0Bv+2,cs		; (0000:002E=0F000h)
    1548 060F  B8 0AC9 R		 		mov	ax,offset INT_1E	;0AC9h
    1549 0612  A3 0078			 		mov	ds:Int1Ev,ax		; (0000:0078=0CA60h)
    1550 0615  8C 0E 007A		 		mov	word ptr ds:Int1Ev+2,cs	; (0000:007A=0F000h)
    1551 0619  1F			 		pop	ds
    1552 061A  C3			 		retn
    1553 061B				InitFloppy	endp
    1554				
    1555				;===============================================================================
    1556				;a.061b
    1557				; INT 13 - Diskette Services
    1558 061B				INT13HANDLER:
    1559 061B  FB			 		sti				; Enable interrupts
    1560 061C  53			 		push	bx
    1561 061D  51			 		push	cx
    1562 061E  1E			 		push	ds
    1563 061F  56			 		push	si
    1564 0620  57			 		push	di
    1565 0621  55			 		push	bp
    1566 0622  52			 		push	dx
    1567 0623  8B EC			 		mov	bp,sp
    1568 0625  BE 0040			 		mov	si,40h
    1569 0628  8E DE			 		mov	ds,si
    1570 062A  E8 0649 R		 		call	ProcDiskCmd		; (0649)
    1571 062D  BB 0004			 		mov	bx,4
    1572 0630  E8 0834 R		 		call	GetpDPB			; (0834)
    1573 0633  88 26 0040 R		 		mov	ds:dsk_motor_tmr,ah	; (0040:0040=0)
    1574 0637  8A 26 0041 R		 		mov	ah,ds:dsk_ret_code	; (0040:0041=0)
    1575 063B  80 FC 01			 		cmp	ah,1
    1576 063E  F5			 		cmc				; Complement carry
    1577 063F  5A			 		pop	dx
    1578 0640  5D			 		pop	bp
    1579 0641  5F			 		pop	di
    1580 0642  5E			 		pop	si
    1581 0643  1F			 		pop	ds
    1582 0644  59			 		pop	cx
    1583 0645  5B			 		pop	bx
    1584 0646  CA 0002			 		retf	2			; Return far
    1585				
    1586				;===============================================================================
    1587				;                               SUBROUTINE
    1588				;
    1589				;         Called from:   A.062A
    1590				;===============================================================================
    1591				;a.0649
    1592 0649				ProcDiskCmd	proc	near
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-30


    1593 0649  8A F0			 		mov	dh,al
    1594 064B  A2 006B R		 		mov	ds:gen_int_occured,al	; (0040:006B=0)
    1595 064E  80 26 003F R 3F		 		and	byte ptr ds:dsk_motor_stat,3Fh	; (0040:003F=0) '?'
    1596 0653  B0 FF			 		mov	al,0FFh
    1597 0655  A2 0040 R		 		mov	ds:dsk_motor_tmr,al	; (0040:0040=0)
    1598				
    1599				; function dispatch
    1600				; AH=0 reset AH=1 read status AH=2 read sectors AH=3 write AH=4 verify AH=5 format
    1601 0658  0A E4			 		or	ah,ah			; reset?
    1602 065A  74 33			 		jz	cmdResetDisk		; reset the disk system
    1603				
    1604 065C  FE CC			 		dec	ah
    1605 065E  75 03			 		jnz	proccmd1		; AH=2-5
    1606 0660  EB 5A			 		jmp	short cmdDiskStat	; (06BC) read disk status
    1607 0662  90			 		db	90h
    1608				
    1609 0663				proccmd1:					;  xref A.065E
    1610 0663  C6 06 0041 R 00		 		mov	byte ptr ds:dsk_ret_code,0	; (0040:0041=0)
    1611 0668  80 FA 04			 		cmp	dl,4			; only 4 drives allowed
    1612 066B  73 1C			 		jae	proccmd5		; Jump if above or =
    1613				
    1614 066D  FE CC			 		dec	ah			;
    1615 066F  75 03			 		jnz	proccmd2
    1616 0671  EB 4D			 		jmp	short cmdDiskRD		; (06C0) read sectors
    1617 0673  90			 		db	90h
    1618				
    1619 0674				proccmd2:					;  xref A.066F
    1620 0674  FE CC			 		dec	ah
    1621 0676  75 03			 		jnz	proccmd3
    1622 0678  E9 0714 R		 		jmp	cmdDiskWrt		; (0714) write
    1623				
    1624 067B				proccmd3:					;  xref A.0676
    1625 067B  FE CC			 		dec	ah
    1626 067D  75 03			 		jnz	proccmd4
    1627 067F  EB 46			 		jmp	short cmdDiskVer	; (06C7) verify
    1628 0681  90			 		db	90h
    1629				
    1630 0682				proccmd4:					;  xref A.067D
    1631 0682  FE CC			 		dec	ah
    1632 0684  75 03			 		jnz	proccmd5
    1633 0686  EB 46			 		jmp	short cmdDiskFmt	; (06CE) format
    1634 0688  90			 		db	90h
    1635				
    1636 0689				proccmd5:					;  xref A.066B, 0684
    1637 0689  C6 06 0041 R 01		 		mov	byte ptr ds:dsk_ret_code,1	; (0040:0041=0)
    1638 068E  C3			 		retn
    1639				
    1640				;===============================================================================
    1641				; AH=0 reset the disk
    1642 068F				cmdResetDisk:					;  xref A.065A
    1643 068F  E8 0A4C R		 		call	sub_23			; (0A4C)
    1644 0692  E8 0A9E R		 		call	sub_26			; (0A9E)
    1645 0695  B4 03			 		mov	ah,3
    1646 0697  E8 0808 R		 		call	sub_13			; (0808)
    1647 069A  BB 0001			 		mov	bx,1
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-31


    1648 069D  E8 0834 R		 		call	GetpDPB			; (0834)
    1649 06A0  BB 0003			 		mov	bx,3
    1650 06A3  E8 0834 R		 		call	GetpDPB			; (0834)
    1651 06A6  C6 06 0041 R 00		 		mov	byte ptr ds:[dsk_ret_code],0	; (A.0041=0B9h)
    1652 06AB  C6 06 003E R 00		 		mov	byte ptr ds:[dsk_recal_stat],0	; (A.003E=0FBh)
    1653 06B0  C6 06 003F R 00		 		mov	byte ptr ds:[dsk_motor_stat],0	; (A.003F=0F3h)
    1654 06B5  E8 0A9E R		 		call	sub_26			; (0A9E)
    1655 06B8  E8 09AD R		 		call	sub_19			; (09AD)
    1656 06BB  C3			 		retn
    1657				
    1658				;===============================================================================
    1659				; AH=1 get disk status
    1660 06BC				cmdDiskStat:					;  xref A.0660
    1661 06BC  A0 0041 R		 		mov	al,byte ptr ds:[dsk_ret_code]	; (A.0041=0B9h)
    1662 06BF  C3			 		retn
    1663				
    1664				;===============================================================================
    1665				; AH=2 read sectors
    1666				;a.06c0
    1667 06C0				cmdDiskRD:					;  xref A.0671, 06CC
    1668 06C0  E8 08E7 R		 		call	sub_18			; (08E7)
    1669 06C3  B4 66			 		mov	ah,66h			; 'f'
    1670 06C5  EB 57			 		jmp	short loc_81		; (071E)
    1671				
    1672				;===============================================================================
    1673				; AH=4 verify sectors
    1674 06C7				cmdDiskVer:					;  xref A.067F
    1675 06C7  80 0E 003F R 40		 		or	byte ptr ds:dsk_motor_stat,40h	; (0040:003F=0) '@'
    1676 06CC  EB F2			 		jmp	short cmdDiskRD		; (06C0)
    1677				
    1678				;===============================================================================
    1679				; AH=5 format sectors
    1680 06CE				cmdDiskFmt:					;  xref A.0686
    1681 06CE  80 0E 003F R 80		 		or	byte ptr ds:dsk_motor_stat,80h	; (0040:003F=0)
    1682 06D3  E8 08E7 R		 		call	sub_18			; (08E7)
    1683 06D6  B4 4D			 		mov	ah,4Dh			; 'M'
    1684 06D8  50			 		push	ax
    1685 06D9  53			 		push	bx
    1686 06DA  52			 		push	dx
    1687 06DB  BB 0008			 		mov	bx,8
    1688 06DE  E8 0834 R		 		call	GetpDPB			; (0834)
    1689 06E1  8A C4			 		mov	al,ah
    1690 06E3  32 E4			 		xor	ah,ah			; Zero register
    1691 06E5  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    1692 06E7  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    1693 06E9  BA FFD8			 		mov	dx,0FFD8h		;PCRBASE+DMA1+DMATC
    1694 06EC  EF			 		out	dx,ax			; port 0FFD8h ??I/O Non-standard
    1695 06ED  5A			 		pop	dx
    1696 06EE  5B			 		pop	bx
    1697 06EF  58			 		pop	ax
    1698 06F0  EB 2C			 		jmp	short loc_81		; (071E)
    1699 06F2				loc_79:						;  xref A.075C
    1700 06F2  BB 0007			 		mov	bx,7
    1701 06F5  E8 0834 R		 		call	GetpDPB			; (0834)
    1702 06F8  BB 0009			 		mov	bx,9
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-32


    1703 06FB  E8 0834 R		 		call	GetpDPB			; (0834)
    1704 06FE  BB 000F			 		mov	bx,0Fh
    1705 0701  E8 0834 R		 		call	GetpDPB			; (0834)
    1706 0704  A1 0067 R		 		mov	ax,word ptr ds:[gen_io_ptr]	; (A.0067=8C00h)
    1707 0707  BA FFDA			 		mov	dx,0FFDAh		;PCRBASE+DMA1+DMACW
    1708 070A  EF			 		out	dx,ax			; port 0FFDAh ??I/O Non-standard
    1709 070B  BB 0011			 		mov	bx,11h
    1710 070E  E8 0834 R		 		call	GetpDPB			; (0834)
    1711 0711  EB 7C			 		jmp	short loc_85		; (078F)
    1712 0713  90			 		db	90h
    1713				
    1714				;===============================================================================
    1715				; AH=3 write sectors
    1716				;a.0714
    1717 0714				cmdDiskWrt:						;  xref A.0678
    1718 0714  80 0E 003F R 80		 		or	byte ptr ds:[dsk_motor_stat],80h	; (A.003F=0F3h)
    1719 0719  E8 08E7 R		 		call	sub_18			; (08E7)
    1720 071C  B4 45			 		mov	ah,45h			; 'E'
    1721 071E				loc_81:						;  xref A.06C5, 06F0
    1722 071E  73 08			 		jnc	loc_82			; Jump if carry=0
    1723 0720  C6 06 0041 R 09		 		mov	byte ptr ds:[dsk_ret_code],9	; (A.0041=0B9h)
    1724 0725  B0 00			 		mov	al,0
    1725 0727  C3			 		retn
    1726 0728				loc_82:						;  xref A.071E
    1727 0728  E8 0A9E R		 		call	sub_26			; (0A9E)
    1728 072B  80 26 003E R 7F		 		and	byte ptr ds:[dsk_recal_stat],7Fh	; (A.003E=0FBh)
    1729 0730  50			 		push	ax
    1730 0731  E8 09B6 R		 		call	sub_20			; (09B6)
    1731 0734  E8 0A59 R		 		call	sub_24			; (0A59)
    1732 0737  72 03			 		jc	loc_83			; Jump if carry Set
    1733 0739  E8 0845 R		 		call	sub_15			; (0845)
    1734				;a.073c
    1735 073C				loc_83:						;  xref A.0737
    1736 073C  58			 		pop	ax
    1737 073D  8A FC			 		mov	bh,ah
    1738 073F  72 51			 		jc	loc_86			; Jump if carry Set
    1739 0741  E8 0A9E R		 		call	sub_26			; (0A9E)
    1740 0744  E8 0808 R		 		call	sub_13			; (0808)
    1741 0747  8A 66 01			 		mov	ah,[bp+1]
    1742 074A  D0 E4			 		shl	ah,1			; Shift w/zeros fill
    1743 074C  D0 E4			 		shl	ah,1			; Shift w/zeros fill
    1744 074E  80 E4 04			 		and	ah,4
    1745 0751  0A 66 00			 		or	ah,[bp]
    1746 0754  E8 0808 R		 		call	sub_13			; (0808)
    1747 0757  80 FF 4D			 		cmp	bh,4Dh			; 'M'
    1748 075A  75 02			 		jne	loc_84			; Jump if not equal
    1749 075C  EB 94			 		jmp	short loc_79		; (06F2)
    1750				;a.075e
    1751 075E				loc_84:						;  xref A.075A
    1752 075E  8A E5			 		mov	ah,ch
    1753 0760  E8 0808 R		 		call	sub_13			; (0808)
    1754 0763  8A 66 01			 		mov	ah,[bp+1]
    1755 0766  E8 0808 R		 		call	sub_13			; (0808)
    1756 0769  8A E1			 		mov	ah,cl
    1757 076B  E8 0808 R		 		call	sub_13			; (0808)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-33


    1758 076E  BB 0007			 		mov	bx,7
    1759 0771  E8 0834 R		 		call	GetpDPB			; (0834)
    1760 0774  8A E1			 		mov	ah,cl
    1761 0776  BB 0009			 		mov	bx,9
    1762 0779  E8 0834 R		 		call	GetpDPB			; (0834)
    1763 077C  BB 000B			 		mov	bx,0Bh
    1764 077F  E8 0834 R		 		call	GetpDPB			; (0834)
    1765 0782  A1 0067 R		 		mov	ax,word ptr ds:[gen_io_ptr]	; (A.0067=8C00h)
    1766 0785  BA FFDA			 		mov	dx,0FFDAh		;PCRBASE+DMA1+DMACW
    1767 0788  EF			 		out	dx,ax			; port 0FFDAh ??I/O Non-standard
    1768 0789  BB 000D			 		mov	bx,0Dh
    1769 078C  E8 0834 R		 		call	GetpDPB			; (0834)
    1770				;a.078f
    1771 078F				loc_85:						;  xref A.0711
    1772 078F  E8 09BF R		 		call	sub_21			; (09BF)
    1773 0792				loc_86:						;  xref A.073F
    1774 0792  72 45			 		jc	loc_90			; Jump if carry Set
    1775 0794  E8 0A08 R		 		call	sub_22			; (0A08)
    1776 0797  72 3F			 		jc	loc_ret_89		; Jump if carry Set
    1777 0799  FC			 		cld				; Clear direction
    1778 079A  BE 0042 R		 		mov	si,offset nec_stat		; (0040:0042=0)
    1779 079D  AC			 		lodsb				; String [si] to al
    1780 079E  24 C0			 		and	al,0C0h
    1781 07A0  74 41			 		jz	loc_91			; Jump if zero
    1782 07A2  3C 40			 		cmp	al,40h			; '@'
    1783 07A4  75 29			 		jne	loc_87			; Jump if not equal
    1784 07A6  AC			 		lodsb				; String [si] to al
    1785 07A7  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1786 07A9  B4 04			 		mov	ah,4
    1787 07AB  72 24			 		jc	loc_88			; Jump if carry Set
    1788 07AD  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1789 07AF  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1790 07B1  B4 10			 		mov	ah,10h
    1791 07B3  72 1C			 		jc	loc_88			; Jump if carry Set
    1792 07B5  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1793 07B7  B4 08			 		mov	ah,8
    1794 07B9  72 16			 		jc	loc_88			; Jump if carry Set
    1795 07BB  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1796 07BD  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1797 07BF  B4 04			 		mov	ah,4
    1798 07C1  72 0E			 		jc	loc_88			; Jump if carry Set
    1799 07C3  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1800 07C5  B4 03			 		mov	ah,3
    1801 07C7  72 08			 		jc	loc_88			; Jump if carry Set
    1802 07C9  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1803 07CB  B4 02			 		mov	ah,2
    1804 07CD  72 02			 		jc	loc_88			; Jump if carry Set
    1805 07CF				loc_87:						;  xref A.07A4
    1806 07CF  B4 20			 		mov	ah,20h			; ' '
    1807 07D1				loc_88:						;  xref A.07AB, 07B3, 07B9, 07C1
    1808				 						;            07C7, 07CD
    1809 07D1  08 26 0041 R		 		or	byte ptr ds:[dsk_ret_code],ah	; (A.0041=0B9h)
    1810 07D5  E8 0AB2 R		 		call	sub_27			; (0AB2)
    1811				
    1812 07D8				loc_ret_89:					;  xref A.0797
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-34


    1813 07D8  C3			 		retn
    1814				
    1815				;a.07d9
    1816 07D9				loc_90:						;  xref A.0792
    1817 07D9  E8 0A4C R		 		call	sub_23			; (0A4C)
    1818 07DC  E8 0A08 R		 		call	sub_22			; (0A08)
    1819 07DF  E8 0A9E R		 		call	sub_26			; (0A9E)
    1820 07E2  C3			 		retn
    1821 07E3				loc_91:						;  xref A.07A0
    1822 07E3  E8 0AB2 R		 		call	sub_27			; (0AB2)
    1823 07E6  32 E4			 		xor	ah,ah			; Zero register
    1824 07E8  C3			 		retn
    1825 07E9				ProcDiskCmd	endp
    1826				
    1827				;===============================================================================
    1828				;a.07e9
    1829				; INT 0B - 80186 DMA1 Handler
    1830 07E9				INT0BHANDLER:				
    1831 07E9  50			 		push	ax
    1832 07EA  53			 		push	bx
    1833 07EB  51			 		push	cx
    1834 07EC  52			 		push	dx
    1835 07ED  1E			 		push	ds
    1836 07EE  E8 0A4C R		 		call	sub_23			; (0A4C)
    1837 07F1  B8 0040			 		mov	ax,40h
    1838 07F4  8E D8			 		mov	ds,ax
    1839 07F6  80 0E 003E R 80		 		or	byte ptr ds:dsk_recal_stat,80h	; (0040:003E=0)
    1840 07FB  B8 8000			 		mov	ax,8000h
    1841 07FE  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
    1842 0801  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
    1843 0802  1F			 		pop	ds
    1844 0803  5A			 		pop	dx
    1845 0804  59			 		pop	cx
    1846 0805  5B			 		pop	bx
    1847 0806  58			 		pop	ax
    1848 0807  CF			 		iret				; Interrupt return
    1849				
    1850				;===============================================================================
    1851				 ;                              SUBROUTINE
    1852				 ;
    1853				 ;         Called from:   A.0697, 0744, 0754, 0760, 0766, 076B, 0859
    1854				 ;                             085F, 086C, 0872, 0877, 08A2, 0993, 0A63
    1855				 ;                             0A69, 0AA1
    1856				;===============================================================================
    1857				;a.0808
    1858 0808				sub_13		proc	near
    1859 0808				loc_92:						;  xref A.0842
    1860 0808  52			 		push	dx
    1861 0809  51			 		push	cx
    1862 080A  BA 0090			 		mov	dx,90h
    1863 080D  33 C9			 		xor	cx,cx			; Zero register
    1864				
    1865 080F				locloop_93:					;  xref A.0814
    1866 080F  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    1867 0810  A8 40			 		test	al,40h			; '@'
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-35


    1868 0812  74 0B			 		jz	loc_95			; Jump if zero
    1869 0814  E2 F9			 		loop	locloop_93		; Loop if cx > 0
    1870				
    1871 0816				loc_94:						;  xref A.0828
    1872 0816  80 0E 0041 R 80		 		or	byte ptr ds:[dsk_ret_code],80h	; (A.0041=0B9h)
    1873 081B  59			 		pop	cx
    1874 081C  5A			 		pop	dx
    1875 081D  F9			 		stc				; Set carry flag
    1876 081E  C3			 		retn
    1877 081F				loc_95:						;  xref A.0812
    1878 081F  33 C9			 		xor	cx,cx			; Zero register
    1879				
    1880 0821				locloop_96:					;  xref A.0826
    1881 0821  EC			 		in	al,dx			; port 0, DMA-1 bas&add ch 0
    1882 0822  A8 80			 		test	al,80h
    1883 0824  75 04			 		jnz	loc_97			; Jump if not zero
    1884 0826  E2 F9			 		loop	locloop_96		; Loop if cx > 0
    1885				
    1886 0828  EB EC			 		jmp	short loc_94		; (0816)
    1887 082A				loc_97:						;  xref A.0824
    1888 082A  8A C4			 		mov	al,ah
    1889 082C  BA 0092			 		mov	dx,92h
    1890 082F  EE			 		out	dx,al			; port 92h ??I/O Non-standard
    1891 0830  59			 		pop	cx
    1892 0831  5A			 		pop	dx
    1893 0832  F8			 		clc				; Clear carry flag
    1894 0833  C3			 		retn
    1895 0834				sub_13		endp
    1896				
    1897				
    1898				;===============================================================================
    1899				 ;                              SUBROUTINE
    1900				 ;
    1901				 ;         Called from:   A.0630, 069D, 06A3, 06DE, 06F5, 06FB, 0701
    1902				 ;                             070E, 0771, 0779, 077F, 078C, 0884, 0979
    1903				 ;                             0ABF
    1904				;===============================================================================
    1905				; Get disk parameter table
    1906				;a.0834
    1907 0834				GetpDPB		proc	near
    1908 0834  1E			 		push	ds
    1909 0835  2B C0			 		sub	ax,ax
    1910 0837  8E D8			 		mov	ds,ax
    1911 0839  C5 36 0078		 		lds	si,dword ptr ds:Int1Ev	; (0000:0078=0CA60h) Load seg:offset p
    1912 083D  D1 EB			 		shr	bx,1			; Shift w/zeros fill
    1913 083F  8A 20			 		mov	ah,[bx+si]
    1914 0841  1F			 		pop	ds
    1915 0842  72 C4			 		jc	loc_92			; Jump if carry Set
    1916 0844  C3			 		retn
    1917 0845				GetpDPB		endp
    1918				
    1919				
    1920				;===============================================================================
    1921				 ;                              SUBROUTINE
    1922				 ;
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-36


    1923				 ;         Called from:   A.0739
    1924				;===============================================================================
    1925				;a.0845
    1926 0845				sub_15		proc	near
    1927 0845  51			 		push	cx
    1928 0846  B0 01			 		mov	al,1
    1929 0848  8A CA			 		mov	cl,dl
    1930 084A  D2 C0			 		rol	al,cl			; Rotate
    1931 084C  59			 		pop	cx
    1932 084D  84 06 003E R		 		test	al,byte ptr ds:[dsk_recal_stat]	; (A.003E=0FBh)
    1933 0851  75 17			 		jnz	loc_98			; Jump if not zero
    1934 0853  08 06 003E R		 		or	byte ptr ds:[dsk_recal_stat],al	; (A.003E=0FBh)
    1935 0857  B4 07			 		mov	ah,7
    1936 0859  E8 0808 R		 		call	sub_13			; (0808)
    1937 085C  8A 66 00			 		mov	ah,[bp]
    1938 085F  E8 0808 R		 		call	sub_13			; (0808)
    1939 0862  E8 0898 R		 		call	sub_16			; (0898)
    1940 0865  72 30			 		jc	loc_ret_102		; Jump if carry Set
    1941 0867  E8 0A9E R		 		call	sub_26			; (0A9E)
    1942 086A				loc_98:						;  xref A.0851
    1943 086A  B4 0F			 		mov	ah,0Fh
    1944 086C  E8 0808 R		 		call	sub_13			; (0808)
    1945 086F  8A 66 00			 		mov	ah,[bp]
    1946 0872  E8 0808 R		 		call	sub_13			; (0808)
    1947 0875  8A E5			 		mov	ah,ch
    1948 0877  E8 0808 R		 		call	sub_13			; (0808)
    1949 087A  E8 0898 R		 		call	sub_16			; (0898)
    1950 087D  9C			 		pushf				; Push flags
    1951 087E  E8 0A9E R		 		call	sub_26			; (0A9E)
    1952 0881  BB 0012			 		mov	bx,12h
    1953 0884  E8 0834 R		 		call	GetpDPB			; (0834)
    1954 0887  51			 		push	cx
    1955 0888				loc_99:						;  xref A.0893
    1956 0888  B9 044C			 		mov	cx,44Ch
    1957 088B  0A E4			 		or	ah,ah			; Zero ?
    1958 088D  74 06			 		jz	loc_101			; Jump if zero
    1959				
    1960 088F				locloop_100:					;  xref A.088F
    1961 088F  E2 FE			 		loop	locloop_100		; Loop if cx > 0
    1962				
    1963 0891  FE CC			 		dec	ah
    1964 0893  EB F3			 		jmp	short loc_99		; (0888)
    1965 0895				loc_101:					;  xref A.088D
    1966 0895  59			 		pop	cx
    1967 0896  9D			 		popf				; Pop flags
    1968				
    1969 0897				loc_ret_102:					;  xref A.0865
    1970 0897  C3			 		retn
    1971 0898				sub_15		endp
    1972				
    1973				
    1974				;===============================================================================
    1975				 ;                              SUBROUTINE
    1976				 ;
    1977				 ;         Called from:   A.0862, 087A
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-37


    1978				;===============================================================================
    1979				;a.0898
    1980 0898				sub_16		proc	near
    1981 0898  50			 		push	ax
    1982 0899  51			 		push	cx
    1983 089A  B9 4000			 		mov	cx,4000h
    1984				
    1985 089D				locloop_103:					;  xref A.08AE, 08B3
    1986 089D  E8 08C3 R		 		call	sub_17			; (08C3)
    1987 08A0  B4 08			 		mov	ah,8
    1988 08A2  E8 0808 R		 		call	sub_13			; (0808)
    1989 08A5  E8 0A87 R		 		call	sub_25			; (0A87)
    1990 08A8  A8 20			 		test	al,20h			; ' '
    1991 08AA  75 10			 		jnz	loc_104			; Jump if not zero
    1992 08AC  3C 80			 		cmp	al,80h
    1993 08AE  E1 ED			 		loopz	locloop_103		; Loop if zf=1, cx>0
    1994				
    1995 08B0  E8 0A87 R		 		call	sub_25			; (0A87)
    1996 08B3  E2 E8			 		loop	locloop_103		; Loop if cx > 0
    1997				
    1998 08B5  E8 0A87 R		 		call	sub_25			; (0A87)
    1999 08B8  F9			 		stc				; Set carry flag
    2000 08B9  59			 		pop	cx
    2001 08BA  58			 		pop	ax
    2002 08BB  C3			 		retn
    2003 08BC				loc_104:					;  xref A.08AA
    2004 08BC  E8 0A87 R		 		call	sub_25			; (0A87)
    2005 08BF  F8			 		clc				; Clear carry flag
    2006 08C0  59			 		pop	cx
    2007 08C1  58			 		pop	ax
    2008 08C2  C3			 		retn
    2009 08C3				sub_16		endp
    2010				
    2011				
    2012				;===============================================================================
    2013				 ;                              SUBROUTINE
    2014				 ;
    2015				 ;         Called from:   A.02A3, 0342, 034A, 0380, 089D
    2016				;===============================================================================
    2017				;a.08c3
    2018 08C3				sub_17		proc	near
    2019 08C3  51			 		push	cx
    2020 08C4  B9 0100			 		mov	cx,100h
    2021				
    2022 08C7				locloop_105:					;  xref A.08C9
    2023 08C7  50			 		push	ax
    2024 08C8  58			 		pop	ax
    2025 08C9  E2 FC			 		loop	locloop_105		; Loop if cx > 0
    2026				
    2027 08CB  59			 		pop	cx
    2028 08CC  C3			 		retn
    2029 08CD				sub_17		endp
    2030				
    2031				 			                        ;* No entry point to code
    2032 08CD  50			 		push	ax
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-38


    2033 08CE  53			 		push	bx
    2034 08CF  51			 		push	cx
    2035 08D0  33 C9			 		xor	cx,cx			; Zero register
    2036 08D2  BB 0014			 		mov	bx,14h
    2037				
    2038 08D5				locloop_106:					;  xref A.08D9, 08DE
    2039 08D5  E4 90			 		in	al,90h			; port 90h ??I/O Non-standard
    2040 08D7  A8 80			 		test	al,80h
    2041 08D9  E1 FA			 		loopz	locloop_106		; Loop if zf=1, cx>0
    2042				
    2043 08DB  74 03			 		jz	loc_107			; Jump if zero
    2044 08DD  4B			 		dec	bx
    2045 08DE  75 F5			 		jnz	locloop_106		; Jump if not zero
    2046 08E0				loc_107:					;  xref A.08DB
    2047 08E0  E8 0A4C R		 		call	sub_23			; (0A4C)
    2048 08E3  59			 		pop	cx
    2049 08E4  5B			 		pop	bx
    2050 08E5  58			 		pop	ax
    2051 08E6  C3			 		retn
    2052				
    2053				;===============================================================================
    2054				 ;                              SUBROUTINE
    2055				 ;
    2056				 ;         Called from:   A.06C0, 06D3, 0719
    2057				;===============================================================================
    2058				;a.08e7
    2059 08E7				sub_18		proc	near
    2060 08E7  50			 		push	ax
    2061 08E8  53			 		push	bx
    2062 08E9  51			 		push	cx
    2063 08EA  52			 		push	dx
    2064 08EB  56			 		push	si
    2065 08EC  52			 		push	dx
    2066 08ED  8C C0			 		mov	ax,es
    2067 08EF  8B CB			 		mov	cx,bx
    2068 08F1  D1 C0			 		rol	ax,1			; Rotate
    2069 08F3  D1 C0			 		rol	ax,1			; Rotate
    2070 08F5  D1 C0			 		rol	ax,1			; Rotate
    2071 08F7  D1 C0			 		rol	ax,1			; Rotate
    2072 08F9  BB 000F			 		mov	bx,0Fh
    2073 08FC  23 D8			 		and	bx,ax
    2074 08FE  25 FFF0			 		and	ax,0FFF0h
    2075 0901  03 C1			 		add	ax,cx
    2076 0903  73 01			 		jnc	loc_108			; Jump if carry=0
    2077 0905  43			 		inc	bx
    2078				
    2079				 ; DMA1 transaction setup
    2080				 ;a.0906
    2081 0906				loc_108:					;  xref A.0903
    2082 0906  F6 06 003F R 80		 		test	byte ptr ds:dsk_motor_stat,80h	; (0040:003F=0)
    2083 090B  74 1C			 		jz	loc_109		; Jump if zero
    2084 090D  BA FFD0			 		mov	dx,0FFD0h		;PCRBASE+DMA1+DMASP
    2085 0910  EF			 		out	dx,ax			; port 0FFD0h ??I/O Non-standard
    2086 0911  BA FFD2			 		mov	dx,0FFD2h		;PCRBASE+DMA1+DMASP1
    2087 0914  8B C3			 		mov	ax,bx
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-39


    2088 0916  EF			 		out	dx,ax			; port 0FFD2h ??I/O Non-standard
    2089 0917  33 C0			 		xor	ax,ax			; Zero register
    2090 0919  BA FFD6			 		mov	dx,0FFD6h		;PCRBASE+DMA1+DMADP1
    2091 091C  EF			 		out	dx,ax			; port 0FFD6h ??I/O Non-standard
    2092 091D  BA FFD4			 		mov	dx,0FFD4h		;PCRBASE+DMA1+DMADP
    2093 0920  B8 00A0			 		mov	ax,0A0h
    2094 0923  EF			 		out	dx,ax			; port 0FFD4h ??I/O Non-standard
    2095 0924  BE 1786			 		mov	si,1786h
    2096 0927  EB 41			 		jmp	short loc_111		; (096A)
    2097 0929				loc_109:					;  xref A.090B
    2098 0929  F6 06 003F R 40		 		test	byte ptr ds:dsk_motor_stat,40h	; (0040:003F=0) '@'
    2099 092E  75 1C			 		jnz	loc_110		; Jump if not zero
    2100 0930  BA FFD4			 		mov	dx,0FFD4h		;PCRBASE+DMA1+DMADP
    2101 0933  EF			 		out	dx,ax			; port 0FFD4h ??I/O Non-standard
    2102 0934  BA FFD6			 		mov	dx,0FFD6h		;PCRBASE+DMA1+DMADP1
    2103 0937  8B C3			 		mov	ax,bx
    2104 0939  EF			 		out	dx,ax			; port 0FFD6h ??I/O Non-standard
    2105 093A  33 C0			 		xor	ax,ax			; Zero register
    2106 093C  BA FFD2			 		mov	dx,0FFD2h		;PCRBASE+DMA1+DMASP1
    2107 093F  EF			 		out	dx,ax			; port 0FFD2h ??I/O Non-standard
    2108 0940  BA FFD0			 		mov	dx,0FFD0h		;PCRBASE+DMA1+DMASP
    2109 0943  B8 00A0			 		mov	ax,0A0h
    2110 0946  EF			 		out	dx,ax			; port 0FFD0h ??I/O Non-standard
    2111 0947  BE A346			 		mov	si,0A346h
    2112 094A  EB 1E			 		jmp	short loc_111		; (096A)
    2113				;a.094c
    2114 094C				loc_110:					;  xref A.092E
    2115 094C  B8 E000			 		mov	ax,0E000h
    2116 094F  BA FFD4			 		mov	dx,0FFD4h		;PCRBASE+DMA1+DMADP
    2117 0952  EF			 		out	dx,ax			; port 0FFD4h ??I/O Non-standard
    2118 0953  BA FFD6			 		mov	dx,0FFD6h		;PCRBASE+DMA1+DMADP1
    2119 0956  B8 000F			 		mov	ax,0Fh
    2120 0959  EF			 		out	dx,ax			; port 0FFD6h ??I/O Non-standard
    2121 095A  33 C0			 		xor	ax,ax			; Zero register
    2122 095C  BA FFD2			 		mov	dx,0FFD2h		;PCRBASE+DMA1+DMASP1
    2123 095F  EF			 		out	dx,ax			; port 0FFD2h ??I/O Non-standard
    2124 0960  BA FFD0			 		mov	dx,0FFD0h		;PCRBASE+DMA1+DMASP
    2125 0963  B8 00A0			 		mov	ax,0A0h
    2126 0966  EF			 		out	dx,ax			; port 0FFD0h ??I/O Non-standard
    2127 0967  BE 8346			 		mov	si,8346h
    2128				;a.096a
    2129 096A				loc_111:					;  xref A.0927, 094A
    2130 096A  89 36 0067 R		 		mov	ds:gen_io_ptr,si	; (0040:0067=0)
    2131 096E  5A			 		pop	dx
    2132 096F  8A E6			 		mov	ah,dh
    2133 0971  2A C0			 		sub	al,al
    2134 0973  D1 E8			 		shr	ax,1			; Shift w/zeros fill
    2135 0975  50			 		push	ax
    2136 0976  BB 0006			 		mov	bx,6
    2137 0979  E8 0834 R		 		call	GetpDPB			; (0834)
    2138 097C  8A CC			 		mov	cl,ah
    2139 097E  58			 		pop	ax
    2140 097F  D3 E0			 		shl	ax,cl			; Shift w/zeros fill
    2141 0981  BA FFD8			 		mov	dx,0FFD8h		;PCRBASE+DMA1+DMATC
    2142 0984  EF			 		out	dx,ax			; port 0FFD8h ??I/O Non-standard
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-40


    2143 0985  F8			 		clc				; Clear carry flag
    2144 0986  5E			 		pop	si
    2145 0987  5A			 		pop	dx
    2146 0988  59			 		pop	cx
    2147 0989  5B			 		pop	bx
    2148 098A  58			 		pop	ax
    2149 098B  C3			 		retn
    2150 098C				sub_18		endp
    2151				
    2152				;a.098c
    2153				; used in setting up DMA transactions
    2154 098C				loc_112:
    2155				 			                        ;* No entry point to code
    2156 098C  E8 09BF R		 		call	sub_21			; (09BF)
    2157 098F  72 14			 		jc	loc_ret_112		; Jump if carry Set
    2158 0991  B4 08			 		mov	ah,8
    2159 0993  E8 0808 R		 		call	sub_13			; (0808)
    2160 0996  E8 0A08 R		 		call	sub_22			; (0A08)
    2161 0999  72 0A			 		jc	loc_ret_112		; Jump if carry Set
    2162 099B  A0 0042 R		 		mov	al,byte ptr ds:[nec_stat]	; (A.0042=0)
    2163 099E  24 60			 		and	al,60h			; '`'
    2164 09A0  3C 60			 		cmp	al,60h			; '`'
    2165 09A2  74 02			 		je	loc_113			; Jump if equal
    2166 09A4  F8			 		clc				; Clear carry flag
    2167				
    2168 09A5				loc_ret_112:					;  xref A.098F, 0999
    2169 09A5  C3			 		retn
    2170 09A6				loc_113:					;  xref A.09A2
    2171 09A6  80 0E 0041 R 40		 		or	byte ptr ds:[dsk_ret_code],40h	; (A.0041=0B9h) '@'
    2172 09AB  F9			 		stc				; Set carry flag
    2173 09AC  C3			 		retn
    2174				
    2175				
    2176				;===============================================================================
    2177				 ;                              SUBROUTINE
    2178				 ;
    2179				 ;         Called from:   A.0559, 06B8
    2180				;===============================================================================
    2181				;a.09ad
    2182				; PPI Control Word. Bit7=0 for bit-set-reset mode. D6-D4 is do not care.
    2183				;	D3-D1 is 3-to-8 encoded for which bit of port C. Bit 0 is 0=reset 1=set
    2184				; 	7  6  5  4  3  2  1  0
    2185				;	MD -portA-  -portBC- S/R
    2186 09AD				sub_19		proc	near
    2187 09AD  50			 		push	ax
    2188 09AE  52			 		push	dx
    2189 09AF  B0 05			 		mov	al,00000101b		;5 PC2 set LP_INIT=H
    2190 09B1  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
    2191 09B3  5A			 		pop	dx
    2192 09B4  58			 		pop	ax
    2193 09B5  C3			 		retn
    2194 09B6				sub_19		endp
    2195				
    2196				
    2197				;===============================================================================
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-41


    2198				 ;                              SUBROUTINE
    2199				 ;
    2200				 ;         Called from:   A.0731
    2201				;===============================================================================
    2202				;a.09b6
    2203				; See notes on sub_19
    2204 09B6				sub_20		proc	near
    2205 09B6  50			 		push	ax
    2206 09B7  52			 		push	dx
    2207 09B8  B0 04			 		mov	al,00000100b		;4 PC2 reset LP_INIT=L
    2208 09BA  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
    2209 09BC  5A			 		pop	dx
    2210 09BD  58			 		pop	ax
    2211 09BE  C3			 		retn
    2212 09BF				sub_20		endp
    2213				
    2214				
    2215				;===============================================================================
    2216				 ;                              SUBROUTINE
    2217				 ;
    2218				 ;         Called from:   A.078F, 098C
    2219				;===============================================================================
    2220				; Configure DMA1
    2221				;a.09ad-09bf
    2222 09BF				sub_21		proc	near
    2223 09BF  50			 		push	ax
    2224 09C0  53			 		push	bx
    2225 09C1  51			 		push	cx
    2226 09C2  52			 		push	dx
    2227 09C3  FA			 		cli				; Disable interrupts
    2228 09C4  B8 0000			 		mov	ax,0
    2229 09C7  BA FF36			 		mov	dx,0FF36h		;PCRBASE+ICR+D1CR
    2230 09CA  EF			 		out	dx,ax			; port 0FF36h ??I/O Non-standard
    2231 09CB  FB			 		sti				; Enable interrupts
    2232 09CC  BA 0090			 		mov	dx,90h
    2233 09CF  B3 C0			 		mov	bl,0C0h
    2234 09D1  33 C9			 		xor	cx,cx			; Zero register
    2235				
    2236 09D3				locloop_114:					;  xref A.09DA, 09DE
    2237 09D3  F6 06 003E R 80		 		test	byte ptr ds:[dsk_recal_stat],80h	; (A.003E=0FBh)
    2238 09D8  75 1F			 		jnz	loc_115			; Jump if not zero
    2239 09DA  E2 F7			 		loop	locloop_114		; Loop if cx > 0
    2240				
    2241 09DC  FE CB			 		dec	bl
    2242 09DE  75 F3			 		jnz	locloop_114		; Jump if not zero
    2243 09E0  FA			 		cli				; Disable interrupts
    2244 09E1  E8 0A4C R		 		call	sub_23			; (0A4C)
    2245 09E4  80 0E 0041 R 80		 		or	byte ptr ds:[dsk_ret_code],80h	; (A.0041=0B9h)
    2246 09E9  80 26 003E R 7F		 		and	byte ptr ds:[dsk_recal_stat],7Fh	; (A.003E=0FBh)
    2247 09EE  B8 0008			 		mov	ax,8
    2248 09F1  BA FF36			 		mov	dx,0FF36h		;PCRBASE+ICR+D1CR
    2249 09F4  EF			 		out	dx,ax			; port 0FF36h ??I/O Non-standard
    2250 09F5  FB			 		sti				; Enable interrupts
    2251 09F6  F9			 		stc				; Set carry flag
    2252 09F7  EB 09			 		jmp	short loc_116		; (0A02)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-42


    2253 09F9				loc_115:					;  xref A.09D8
    2254 09F9  FA			 		cli				; Disable interrupts
    2255 09FA  B8 0008			 		mov	ax,8
    2256 09FD  BA FF36			 		mov	dx,0FF36h		;PCRBASE+ICR+D1CR
    2257 0A00  EF			 		out	dx,ax			; port 0FF36h ??I/O Non-standard
    2258 0A01  F8			 		clc				; Clear carry flag
    2259 0A02				loc_116:					;  xref A.09F7
    2260 0A02  FB			 		sti				; Enable interrupts
    2261 0A03  5A			 		pop	dx
    2262 0A04  59			 		pop	cx
    2263 0A05  5B			 		pop	bx
    2264 0A06  58			 		pop	ax
    2265 0A07  C3			 		retn
    2266 0A08				sub_21		endp
    2267				
    2268				
    2269				;===============================================================================
    2270				 ;                              SUBROUTINE
    2271				 ;
    2272				 ;         Called from:   A.0794, 07DC, 0996
    2273				;===============================================================================
    2274				; Port 90h is the base address of the floppy
    2275				;a.0a08
    2276 0A08				sub_22		proc	near
    2277 0A08  FC			 		cld				; Clear direction
    2278 0A09  BF 0042			 		mov	di,42h			; (A.0042=0)
    2279 0A0C  51			 		push	cx
    2280 0A0D  52			 		push	dx
    2281 0A0E  53			 		push	bx
    2282 0A0F  B3 07			 		mov	bl,7
    2283 0A11				loc_117:					;  xref A.0A44
    2284 0A11  33 C9			 		xor	cx,cx			; Zero register
    2285 0A13  BA 0090			 		mov	dx,90h
    2286				
    2287 0A16				locloop_118:					;  xref A.0A1B
    2288 0A16  EC			 		in	al,dx			; port 90h FDCBASE
    2289 0A17  A8 80			 		test	al,80h
    2290 0A19  75 07			 		jnz	loc_120			; Jump if not zero
    2291 0A1B  E2 F9			 		loop	locloop_118		; Loop if cx > 0
    2292				
    2293 0A1D				loc_119:					;  xref A.0A2C
    2294 0A1D  F9			 		stc				; Set carry flag
    2295 0A1E  5B			 		pop	bx
    2296 0A1F  5A			 		pop	dx
    2297 0A20  59			 		pop	cx
    2298 0A21  C3			 		retn
    2299 0A22				loc_120:					;  xref A.0A19
    2300 0A22  EC			 		in	al,dx			; port 0FFDAh ??I/O Non-standard
    2301 0A23  A8 40			 		test	al,40h			; '@'
    2302 0A25  75 07			 		jnz	loc_122			; Jump if not zero
    2303 0A27				loc_121:					;  xref A.0A46
    2304 0A27  80 0E 0041 R 20		 		or	byte ptr ds:[dsk_ret_code],20h	; (A.0041=0B9h) ' '
    2305 0A2C  EB EF			 		jmp	short loc_119		; (0A1D)
    2306 0A2E				loc_122:					;  xref A.0A25
    2307 0A2E  BA 0092			 		mov	dx,92h
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-43


    2308 0A31  EC			 		in	al,dx			; port 92h ??I/O Non-standard
    2309 0A32  88 05			 		mov	[di],al
    2310 0A34  47			 		inc	di
    2311 0A35  B9 0028			 		mov	cx,28h
    2312				
    2313				;a.0a38
    2314 0A38				locloop_123:					;  xref A.0A38
    2315 0A38  E2 FE			 		loop	locloop_123		; Loop if cx > 0
    2316				
    2317 0A3A  BA 0090			 		mov	dx,90h
    2318 0A3D  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    2319 0A3E  A8 10			 		test	al,10h
    2320 0A40  74 06			 		jz	loc_124			; Jump if zero
    2321 0A42  FE CB			 		dec	bl
    2322 0A44  75 CB			 		jnz	loc_117			; Jump if not zero
    2323 0A46  EB DF			 		jmp	short loc_121		; (0A27)
    2324 0A48				loc_124:					;  xref A.0A40
    2325 0A48  5B			 		pop	bx
    2326 0A49  5A			 		pop	dx
    2327 0A4A  59			 		pop	cx
    2328 0A4B  C3			 		retn
    2329 0A4C				sub_22		endp
    2330				
    2331				
    2332				;===============================================================================
    2333				 ;                              SUBROUTINE
    2334				 ;
    2335				 ;         Called from:   A.068F, 07D9, 07EE, 08E0, 09E1
    2336				;===============================================================================
    2337				; bit set/reset on PPI port C PC7 goes to floppy write clock circuit
    2338				;a.0a4c
    2339 0A4C				sub_23		proc	near
    2340 0A4C  50			 		push	ax
    2341 0A4D  B0 0D			 		mov	al,00001101b		;0Dh PC7 set
    2342 0A4F  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
    2343 0A51  50			 		push	ax
    2344 0A52  58			 		pop	ax
    2345 0A53  B0 0C			 		mov	al,0Ch
    2346 0A55  E6 D6			 		out	0D6h,al			; port 0D6h PPI_CR
    2347 0A57  58			 		pop	ax
    2348 0A58  C3			 		retn
    2349 0A59				sub_23		endp
    2350				
    2351				
    2352				;===============================================================================
    2353				 ;                              SUBROUTINE
    2354				 ;
    2355				 ;         Called from:   A.0734
    2356				;===============================================================================
    2357				;a.0a59
    2358 0A59				sub_24		proc	near
    2359 0A59  50			 		push	ax
    2360 0A5A  53			 		push	bx
    2361 0A5B  51			 		push	cx
    2362 0A5C  52			 		push	dx
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-44


    2363 0A5D  B3 04			 		mov	bl,4
    2364 0A5F  33 C9			 		xor	cx,cx			; Zero register
    2365				
    2366 0A61				locloop_125:					;  xref A.0A73, 0A77
    2367 0A61  B4 04			 		mov	ah,4
    2368 0A63  E8 0808 R		 		call	sub_13			; (0808)
    2369 0A66  8A 66 00			 		mov	ah,[bp]
    2370 0A69  E8 0808 R		 		call	sub_13			; (0808)
    2371 0A6C  E8 0A87 R		 		call	sub_25			; (0A87)
    2372 0A6F  A8 20			 		test	al,20h			; ' '
    2373 0A71  75 0E			 		jnz	loc_126			; Jump if not zero
    2374 0A73  E2 EC			 		loop	locloop_125		; Loop if cx > 0
    2375				
    2376 0A75  FE CB			 		dec	bl
    2377 0A77  75 E8			 		jnz	locloop_125		; Jump if not zero
    2378 0A79  80 0E 0041 R 80		 		or	byte ptr ds:[dsk_ret_code],80h	; (A.0041=0B9h)
    2379 0A7E  F9			 		stc				; Set carry flag
    2380 0A7F  EB 01			 		jmp	short loc_127		; (0A82)
    2381 0A81				loc_126:					;  xref A.0A71
    2382 0A81  F8			 		clc				; Clear carry flag
    2383 0A82				loc_127:					;  xref A.0A7F
    2384 0A82  5A			 		pop	dx
    2385 0A83  59			 		pop	cx
    2386 0A84  5B			 		pop	bx
    2387 0A85  58			 		pop	ax
    2388 0A86  C3			 		retn
    2389 0A87				sub_24		endp
    2390				
    2391				
    2392				;===============================================================================
    2393				 ;                              SUBROUTINE
    2394				 ;
    2395				 ;         Called from:   A.08A5, 08B0, 08B5, 08BC, 0A6C, 0AA4, 0AAB
    2396				;===============================================================================
    2397				;a.0a87
    2398 0A87				sub_25		proc	near
    2399 0A87  52			 		push	dx
    2400 0A88  BA 0090			 		mov	dx,90h
    2401 0A8B				loc_128:					;  xref A.0A8E
    2402 0A8B  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    2403 0A8C  A8 80			 		test	al,80h
    2404 0A8E  74 FB			 		jz	loc_128			; Jump if zero
    2405 0A90  A8 40			 		test	al,40h			; '@'
    2406 0A92  74 07			 		jz	loc_129			; Jump if zero
    2407 0A94  BA 0092			 		mov	dx,92h
    2408 0A97  EC			 		in	al,dx			; port 92h ??I/O Non-standard
    2409 0A98  5A			 		pop	dx
    2410 0A99  F8			 		clc				; Clear carry flag
    2411 0A9A  C3			 		retn
    2412 0A9B				loc_129:					;  xref A.0A92
    2413 0A9B  5A			 		pop	dx
    2414 0A9C  F9			 		stc				; Set carry flag
    2415 0A9D  C3			 		retn
    2416 0A9E				sub_25		endp
    2417				
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-45


    2418				
    2419				;===============================================================================
    2420				 ;                              SUBROUTINE
    2421				 ;
    2422				 ;         Called from:   A.0692, 06B5, 0728, 0741, 07DF, 0867, 087E
    2423				;===============================================================================
    2424				;a.0a9e
    2425 0A9E				sub_26		proc	near
    2426 0A9E  50			 		push	ax
    2427 0A9F				loc_130:					;  xref A.0AAE
    2428 0A9F  B4 08			 		mov	ah,8
    2429 0AA1  E8 0808 R		 		call	sub_13			; (0808)
    2430 0AA4  E8 0A87 R		 		call	sub_25			; (0A87)
    2431 0AA7  3C 80			 		cmp	al,80h
    2432 0AA9  74 05			 		je	loc_131			; Jump if equal
    2433 0AAB  E8 0A87 R		 		call	sub_25			; (0A87)
    2434 0AAE  EB EF			 		jmp	short loc_130		; (0A9F)
    2435 0AB0				loc_131:					;  xref A.0AA9
    2436 0AB0  58			 		pop	ax
    2437 0AB1  C3			 		retn
    2438 0AB2				sub_26		endp
    2439				
    2440				
    2441				;===============================================================================
    2442				 ;                              SUBROUTINE
    2443				 ;
    2444				 ;         Called from:   A.07D5, 07E3
    2445				;===============================================================================
    2446				;a.0ab2
    2447 0AB2				sub_27		proc	near
    2448 0AB2  A0 0045 R		 		mov	al,byte ptr ds:[nec_stat+3]	; (A.0045=0AFh) part of NEC status b
					ytes
    2449 0AB5  3A C5			 		cmp	al,ch
    2450 0AB7  A0 0047 R		 		mov	al,byte ptr ds:[nec_stat+5]	; (A.0047=6)
    2451 0ABA  74 0A			 		jz	loc_132			; Jump if zero
    2452 0ABC  BB 0008			 		mov	bx,8
    2453 0ABF  E8 0834 R		 		call	GetpDPB			; (0834)
    2454 0AC2  8A C4			 		mov	al,ah
    2455 0AC4  FE C0			 		inc	al
    2456 0AC6				loc_132:					;  xref A.0ABA
    2457 0AC6  2A C1			 		sub	al,cl
    2458 0AC8  C3			 		retn
    2459 0AC9				sub_27		endp
    2460				
    2461				
    2462				;===============================================================================
    2463				;a.0ac9
    2464				; INT 1E - Diskette parameter table
    2465 0AC9				INT_1E:
    2466 0AC9  DF				db      11011111b	; specify byte 1: step rate (ms), head unload time (ms)
    2467								; 7:4 step 0E = 4ms
    2468								; 3:0 HUT  0F = 240ms
    2469 0ACA  02				db      2		; specify byte 2: head load time, non-DMA mode
    2470								; 7:1 HLT 01=4ms
    2471								; 0: non-DMA mode (always 0)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-46


    2472 0ACB  80				db      80h		; motor turn-off delay (ticks)
    2473 0ACC  02				db      2		; bytes per sector (2=512)
    2474 0ACD  08				db      8		; sectors per track
    2475 0ACE  2A				db      2Ah		; gap length (2A=5.25"; 1B=3.5")
    2476 0ACF  FF				db      0FFh		; data length (ignored if BPS !=0)
    2477 0AD0  50				db      50h		; gap length (50=5.25"; 6C=3.5")
    2478 0AD1  F6				db      0F6h		; format fill byte
    2479 0AD2  19				db      19h		; head settle time (ms)
    2480 0AD3  04				db      4		; motor start time (in 1/8 seconds)
    2481				
    2482				
    2483				;===============================================================================
    2484				 ;                              SUBROUTINE
    2485				 ;
    2486				 ;         Called from:   A.00A7
    2487				;===============================================================================
    2488				; grab keyboard vectors
    2489				;a.0ad4
    2490 0AD4				InitKeyboard	proc	near
    2491 0AD4  1E			 		push	ds
    2492 0AD5  9C			 		pushf				; Push flags
    2493 0AD6  FA			 		cli				; Disable interrupts
    2494 0AD7  33 C0			 		xor	ax,ax			; Zero register
    2495 0AD9  8E D8			 		mov	ds,ax
    2496 0ADB  B8 0B27 R		 		mov	ax,offset INT16HANDLER	;0B27h
    2497 0ADE  A3 0058			 		mov	ds:Int16v,ax		; (0000:0058=0CFC0h)
    2498 0AE1  8C 0E 005A		 		mov	ds:Int16v+2,cs		; (0000:005A=0F000h)
    2499 0AE5  B8 0CE5 R		 		mov	ax,offset INT0DHANDLER	;0CE4h
    2500 0AE8  A3 0034			 		mov	ds:Int0Dv,ax		; (0000:0034=3ADBh)
    2501 0AEB  8C 0E 0036		 		mov	ds:Int0Dv+2,cs		; (0000:0036=17B0h)
    2502 0AEF  B8 0CF3 R		 		mov	ax,offset INT09HANDLER	;0CF2h
    2503 0AF2  A3 0024			 		mov	ds:Int09v,ax		; (0000:0024=0E987h)
    2504 0AF5  8C 0E 0026		 		mov	ds:Int09v+2,cs		; (0000:0026=0F000h)
    2505				
    2506 0AF9  B8 0040			 		mov	ax,40h
    2507 0AFC  8E D8			 		mov	ds,ax
    2508 0AFE  B8 001E			 		mov	ax,1Eh			; keyboard queue
    2509 0B01  A3 001A R		 		mov	ds:keybd_q_head,ax	; (0040:001A=30h)
    2510 0B04  A3 001C R		 		mov	ds:keybd_q_tail,ax	; (0040:001C=30h)
    2511				
    2512 0B07  33 C0			 		xor	ax,ax			; Zero register
    2513 0B09  A2 0017 R		 		mov	ds:keybd_flags_1,al	; (0040:0017=0)
    2514 0B0C  A2 0018 R		 		mov	ds:keybd_flags_2,al	; (0040:0018=0)
    2515 0B0F  A2 0019 R		 		mov	ds:keybd_alt_num,al	; (0040:0019=0)
    2516				
    2517 0B12  BA FF3A			 		mov	dx,0FF3Ah		;PCRBASE+ICR+INT1CR
    2518 0B15  B8 0001			 		mov	ax,1
    2519 0B18  EF			 		out	dx,ax			; port 0FF3Ah ??I/O Non-standard
    2520 0B19  B0 98			 		mov	al,98h
    2521 0B1B  E6 63			 		out	63h,al			; port 63h, 8255 mode reg
    2522 0B1D  B0 C0			 		mov	al,0C0h
    2523 0B1F  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2524 0B21  E8 0B6E R		 		call	InitKbdCtrlr		; (0B6E)	reset kbd
    2525 0B24  9D			 		popf				; Pop flags
    2526 0B25  1F			 		pop	ds
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-47


    2527 0B26  C3			 		retn
    2528 0B27				InitKeyboard	endp
    2529				
    2530				
    2531				;===============================================================================
    2532				;a.0b27
    2533				; INT 16 - Keyboard Services
    2534 0B27				INT16HANDLER:
    2535 0B27  FB			 		sti				; Enable interrupts
    2536 0B28  1E			 		push	ds
    2537 0B29  53			 		push	bx
    2538 0B2A  BB 0040			 		mov	bx,40h
    2539 0B2D  8E DB			 		mov	ds,bx
    2540				
    2541				; dispatcher
    2542				; AH=0 read char AH=1 check AH=2 shift
    2543 0B2F  0A E4			 		or	ah,ah			; Zero - read character
    2544 0B31  74 0B			 		jz	cmdKbdChrIn	
    2545				
    2546 0B33  FE CC			 		dec	ah			; check for character
    2547 0B35  74 20			 		jz	cmdKbdChk	
    2548				
    2549 0B37  FE CC			 		dec	ah			; shift state
    2550 0B39  74 2D			 		jz	cmdKbdShift	
    2551				
    2552 0B3B  5B			 		pop	bx
    2553 0B3C  1F			 		pop	ds
    2554 0B3D  CF			 		iret				; Interrupt return
    2555				
    2556				; read character
    2557 0B3E				cmdKbdChrIn:					;  xref A.0B31, 0B49
    2558 0B3E  FB			 		sti				; Enable interrupts
    2559 0B3F  90			 		nop
    2560 0B40  FA			 		cli				; Disable interrupts
    2561 0B41  8B 1E 001A R		 		mov	bx,word ptr ds:[keybd_q_head]	; (A.001A=3538h)
    2562 0B45  3B 1E 001C R		 		cmp	bx,word ptr ds:[keybd_q_tail]	; (A.001C=0D0Ah)
    2563 0B49  74 F3			 		je	cmdKbdChrIn	
    2564 0B4B  8B 07			 		mov	ax,[bx]
    2565 0B4D  E8 0BD3 R		 		call	sub_30			; (0BD3)
    2566 0B50  89 1E 001A R		 		mov	word ptr ds:[keybd_q_head],bx	; (A.001A=3538h)
    2567 0B54  5B			 		pop	bx
    2568 0B55  1F			 		pop	ds
    2569 0B56  CF			 		iret				; Interrupt return
    2570				
    2571				; check for available char
    2572 0B57				cmdKbdChk:					;  xref A.0B35
    2573 0B57  FA			 		cli				; Disable interrupts
    2574 0B58  8B 1E 001A R		 		mov	bx,word ptr ds:[keybd_q_head]	; (A.001A=3538h)
    2575 0B5C  3B 1E 001C R		 		cmp	bx,word ptr ds:[keybd_q_tail]	; (A.001C=0D0Ah)
    2576 0B60  8B 07			 		mov	ax,[bx]
    2577 0B62  FB			 		sti				; Enable interrupts
    2578 0B63  5B			 		pop	bx
    2579 0B64  1F			 		pop	ds
    2580 0B65  CA 0002			 		retf	2			; Return far
    2581				
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-48


    2582				; get shift state
    2583 0B68				cmdKbdShift:					;  xref A.0B39
    2584 0B68  A0 0017 R		 		mov	al,byte ptr ds:[keybd_flags_1]	; (A.0017=32h)
    2585 0B6B  5B			 		pop	bx
    2586 0B6C  1F			 		pop	ds
    2587 0B6D  CF			 		iret				; Interrupt return
    2588				
    2589				
    2590				;===============================================================================
    2591				 ;                              SUBROUTINE
    2592				 ;
    2593				 ;         Called from:   A.0B21
    2594				;===============================================================================
    2595				;a.0b6e
    2596				; Looks like this initialzies the keyboard controller in the keyboard itself.
    2597 0B6E				InitKbdCtrlr		proc	near
    2598 0B6E  FA			 		cli				; Disable interrupts
    2599 0B6F  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2600 0B71  24 3F			 		and	al,3Fh			; '?'
    2601 0B73  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2602				 						;  al = 0, speaker off
    2603 0B75  B9 A558			 		mov	cx,0A558h
    2604				
    2605 0B78				locloop_137:					;  xref A.0B78
    2606 0B78  E2 FE			 		loop	locloop_137		; Loop if cx > 0
    2607				
    2608 0B7A  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2609 0B7C  0C C0			 		or	al,0C0h
    2610 0B7E  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2611 0B80  24 3F			 		and	al,3Fh			; '?'
    2612 0B82  0C 40			 		or	al,40h			; '@'
    2613 0B84  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2614 0B86  33 C9			 		xor	cx,cx			; Zero register
    2615 0B88  FA			 		cli				; Disable interrupts
    2616				
    2617 0B89				locloop_138:					;  xref A.0B8D
    2618 0B89  E4 62			 		in	al,62h			; port 62h, 8255 C - sw2, etc.
    2619 0B8B  A8 10			 		test	al,10h
    2620 0B8D  E1 FA			 		loopz	locloop_138		; Loop if zf=1, cx>0
    2621				
    2622 0B8F  E3 15			 		jcxz	loc_139			; Jump if cx=0
    2623 0B91  E4 60			 		in	al,60h			; port 60h, keybd scan or sw1
    2624 0B93  50			 		push	ax
    2625 0B94  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2626 0B96  8A E0			 		mov	ah,al
    2627 0B98  0C 80			 		or	al,80h
    2628 0B9A  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2629 0B9C  8A C4			 		mov	al,ah
    2630 0B9E  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2631 0BA0  58			 		pop	ax
    2632 0BA1  3C AA			 		cmp	al,0AAh
    2633 0BA3  75 01			 		jne	loc_139			; Jump if not equal
    2634 0BA5  C3			 		retn
    2635 0BA6				loc_139:					;  xref A.0B8F, 0BA3
    2636 0BA6  BE 0BBA R		 		mov	si,offset msg5		; (A.0BBA='Keyboard reset f')
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-49


    2637 0BA9  E8 05E5 R		 		call	prtzstr			; (05E5)
    2638 0BAC  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2639 0BAE  8A E0			 		mov	ah,al
    2640 0BB0  0C 80			 		or	al,80h
    2641 0BB2  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2642 0BB4  8A C4			 		mov	al,ah
    2643 0BB6  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2644 0BB8  F9			 		stc				; Set carry flag
    2645 0BB9  C3			 		retn
    2646 0BBA				InitKbdCtrlr		endp
    2647				
    2648 0BBA  4B 65 79 62 6F 61	msg5:		db	'Keyboard reset failure', 0Ah, 0Dh,0
    2649       72 64 20 72 65 73	
    2650       65 74 20 66 61 69	
    2651       6C 75 72 65 0A 0D	
    2652       00			
    2653				
    2654				
    2655				;===============================================================================
    2656				 ;                              SUBROUTINE
    2657				 ;
    2658				 ;         Called from:   A.0B4D, 0F6A
    2659				;===============================================================================
    2660				;a.0bd3
    2661 0BD3				sub_30		proc	near
    2662 0BD3  83 C3 02			 		add	bx,2
    2663 0BD6  81 FB 003E		 		cmp	bx,word ptr 3Eh		; 81 fb 3e 00
    2664 0BDA  75 03			 		jne	loc_ret_140		; Jump if not equal
    2665 0BDC  BB 001E			 		mov	bx,1Eh
    2666				
    2667 0BDF				loc_ret_140:					;  xref A.0BDA
    2668 0BDF  C3			 		retn
    2669 0BE0				sub_30		endp
    2670				
    2671				
    2672				;a.0be0 - could be scan codes for modifier keys. Note lack of DEL key
    2673				; modifier.
    2674				; xref A.0D20
    2675				;K6
    2676 0BE0				data_84:	;db	52h, 3Ah, 45h, 46h
    2677 0BE0  52 3A 45 46				db	INS_KEY, CAPS_KEY, NUM_KEY, SCROLL_KEY
    2678				;		db	38h, 1Dh, 2Ah, 36h
    2679 0BE4  38 1D 2A 36				db	ALT_KEY, CTL_KEY, LEFT_KEY, RIGHT_KEY
    2680				
    2681				; Shift mask table
    2682				;a.0be9
    2683				;K7
    2684 0BE8				data_85:	;db	80h, 40h, 20h, 10h		;  xref A.0D33
    2685 0BE8  80 40 20 10				db	INS_SHIFT, CAPS_SHIFT, NUM_SHIFT, SCROLL_SHIFT
    2686				;     		db	08h, 04h, 02h, 01h	
    2687 0BEC  08 04 02 01				db	ALT_SHIFT ,CTL_SHIFT, LEFT_SHIFT, RIGHT_SHIFT
    2688					
    2689				; Scan Code Tables
    2690				;a.0bf0
    2691				;K8
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-50


    2692 0BF0  1B FF 00 FF FF				db	1Bh,0FFh, 00h,0FFh,0FFh
    2693 0BF5  FF 1E FF FF FF FF	     		db	0FFh, 1Eh,0FFh,0FFh,0FFh,0FFh
    2694 0BFB  1F FF 7F FF 11 17	     		db	1Fh,0FFh, 7Fh,0FFh, 11h, 17h
    2695 0C01  05 12 14 19 15 09	     		db	05h, 12h, 14h, 19h, 15h, 09h
    2696 0C07  0F 10 1B 1D 0A FF	     		db	0Fh, 10h, 1Bh, 1Dh, 0Ah,0FFh
    2697 0C0D  01 13 04 06 07 08	     		db	01h, 13h, 04h, 06h, 07h, 08h
    2698 0C13  0A 0B 0C FF FF FF	     		db	0Ah, 0Bh, 0Ch,0FFh,0FFh,0FFh
    2699 0C19  FF 1C 1A 18 03 16	     		db	0FFh, 1Ch, 1Ah, 18h, 03h, 16h
    2700 0C1F  02 0E 0D FF FF FF	     		db	02h, 0Eh, 0Dh,0FFh,0FFh,0FFh
    2701 0C25  FF FF FF 20 FF		 		db	0FFh,0FFh,0FFh, 20h,0FFh
    2702				
    2703				; Control Table Scan
    2704				;a.0c2a
    2705				;K9		
    2706 0C2A  5E 5F 60 61 62 63	     		db	'^_`abcdefg'
    2707       64 65 66 67		
    2708 0C34  FF FF 77 FF 84 FF	     		db	0FFh,0FFh, 77h,0FFh, 84h,0FFh
    2709 0C3A  73 FF 74 FF 75 FF	     		db	 73h,0FFh, 74h,0FFh, 75h,0FFh
    2710 0C40  76 FF FF			 		db	 76h,0FFh,0FFh
    2711				
    2712				; LC Table
    2713				;a.0c43
    2714				;K10
    2715 0C43  1B 31 32 33 34 35	data_86:	db	1Bh, '1234567890-=', 8, 9, 'qwert'	;  xref A.0F2D
    2716       36 37 38 39 30 2D	
    2717       3D 08 09 71 77 65	
    2718       72 74			
    2719 0C57  79 75 69 6F 70 5B	     		db	'yuiop[]', 0Dh, 0FFh
    2720       5D 0D FF			
    2721 0C60  61 73 64 66 67 68	     		db	'asdfghjkl',3bh,27h,60h, 0FFh
    2722       6A 6B 6C 3B 27 60	
    2723       FF			
    2724 0C6D  5C 7A 78 63 76 62	     		db	'\zxcvbnm,./'
    2725       6E 6D 2C 2E 2F		
    2726 0C78  FF 2A FF 20 FF		 		db	0FFh, 2Ah,0FFh, 20h,0FFh
    2727				
    2728				; UC Table
    2729				;a.0c7d
    2730				;K11
    2731 0C7D  1B 21 40 23 24		 		db	1Bh, '!@#$'
    2732 0C82  25 5E 26 2A 28 29	     		db	'%^&*()_+', 8, 0
    2733       5F 2B 08 00		
    2734 0C8C  51 57 45 52 54 59	     		db	'QWERTYUIOP{}', 0Dh, 0FFh
    2735       55 49 4F 50 7B 7D	
    2736       0D FF			
    2737 0C9A  41 53 44 46 47 48	     		db	'ASDFGHJKL:"~', 0FFh
    2738       4A 4B 4C 3A 22 7E	
    2739       FF			
    2740 0CA7  7C 5A 58 43 56 42	     		db	'|ZXCVBNM<>?'
    2741       4E 4D 3C 3E 3F		
    2742 0CB2  FF 00 FF 20 FF		     		db	0FFh, 00h,0FFh, 20h,0FFh
    2743				
    2744				; UC Table Scan
    2745				;a.0cb7
    2746				;K12
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-51


    2747				;		db	54h, 55h, 'VWXYZ[\]'
    2748 0CB7  54 55 56 57 58 59			db	84,85,86,87,88,89,90
    2749       5A			
    2750 0CBE  5B 5C 5D					db	91,92,93
    2751				
    2752				; Alt Table Scan
    2753				;K13
    2754				;a.0cc1
    2755				;		db	'hiklmnopq'
    2756 0CC1  68 69 6A 6B 6C				db	104,105,106,107,108
    2757 0CC6  6D 6E 6F 70 71				db	109,110,111,112,113
    2758				
    2759				; Num State Table
    2760				;a.0cca
    2761				;K14
    2762 0CCB  37 38 39 2D 34 35			db	'789-456+1230.'
    2763       36 2B 31 32 33 30	
    2764       2E			
    2765				
    2766				;a.0cd7
    2767				;K15
    2768				;		db	'GHI', 0FFh, 4Bh,0FFh, 4Dh,0FFh, 4Fh
    2769				;		db	50h, 51h, 52h, 53h 
    2770 0CD8  47 48 49 FF 4B FF			db	71,72,73,-1,75,-1,77
    2771       4D			
    2772 0CDF  FF 4F 50 51 52 53			db	-1,79,80,81,82,83
    2773				 
    2774				;===============================================================================
    2775				;a.0ce4
    2776				; INT 0D - 80186 INT1 Handler
    2777 0CE5				INT0DHANDLER:
    2778				; 	db	 50h, 52h
    2779				;    	db	0B8h, 00h, 80h,0BAh, 22h,0FFh
    2780				;     	db	0EFh, 5Ah, 58h,0CDh, 09h,0CFh
    2781 0CE5  50			 		push	ax
    2782 0CE6  52			 		push	dx
    2783 0CE7  B8 8000			 		mov	ax,8000h		; do EOI
    2784 0CEA  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
    2785 0CED  EF			 		out	dx,ax
    2786 0CEE  5A			 		pop	dx
    2787 0CEF  58			 		pop	ax
    2788 0CF0  CD 09			 		int	09
    2789 0CF2  CF			 		iret
    2790				
    2791				
    2792				;===============================================================================
    2793				;a.0cf2
    2794				; INT 09 - Reserved
    2795 0CF3				INT09HANDLER:
    2796				;     	db	 50h, 53h, 51h, 52h, 56h, 57h
    2797				;     	db	 1Eh, 06h,0FCh,0B8h, 40h, 00h
    2798				;     	db	 8Eh,0D8h,0E4h, 60h,0A2h, 7Bh
    2799				;     	db	 00h, 50h,0E4h, 61h, 8Ah,0E0h
    2800				;     	db	 0Ch, 80h,0E6h, 61h, 86h,0E0h
    2801				;     	db	0E6h, 61h, 58h, 8Ah,0E0h, 3Ch
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-52


    2802				;     	db	0FFh, 75h, 03h,0E9h, 60h, 02h
    2803					;	sti
    2804 0CF3  50			 		push	ax
    2805 0CF4  53			 		push	bx
    2806 0CF5  51			 		push	cx
    2807 0CF6  52			 		push	dx
    2808 0CF7  56			 		push	si
    2809 0CF8  57			 		push	di
    2810 0CF9  1E			 		push	ds
    2811 0CFA  06			 		push	es
    2812 0CFB  FC			 		cld
    2813 0CFC  B8 0040			 		mov	ax,40h
    2814 0CFF  8E D8			 		mov	ds,ax
    2815 0D01  E4 60			 		in	al,60h 
    2816 0D03  A2 007B R		 		mov	ds:[lptto+3],al		;7b
    2817 0D06  50			 		push	ax
    2818 0D07  E4 61			 		in	al,61h 
    2819 0D09  8A E0			 		mov	ah,al
    2820 0D0B  0C 80			 		or	al,80h 
    2821 0D0D  E6 61			 		out	61h,al
    2822 0D0F  86 E0			 		xchg	ah,al
    2823 0D11  E6 61			 		out	61h,al
    2824 0D13  58			 		pop	ax
    2825 0D14  8A E0			 		mov	ah,al
    2826 0D16  3C FF			 		cmp	al,0FFh
    2827 0D18  75 03			 		jnz	loc_141
    2828 0D1A  E9 0F7D R		 		jmp	loc_186			;0F7C
    2829				;a.0d1c
    2830 0D1D				loc_141:
    2831 0D1D  24 7F			 		and	al,7Fh
    2832 0D1F  0E			 		push	cs
    2833 0D20  07			 		pop	es
    2834 0D21  BF 0BE0 R		 		mov	di,offset data_84	; (A.0BE0=52h)
    2835 0D24  B9 0008			 		mov	cx,8
    2836 0D27  F2/ AE			 		repne	scasb			; Rep zf=0+cx >0 Scan es:[di] for al
    2837 0D29  8A C4			 		mov	al,ah
    2838 0D2B  74 03			 		jz	loc_142			; Jump if zero
    2839 0D2D  E9 0DB8 R		 		jmp	loc_151			; (0DB7)
    2840 0D30				loc_142:					;  xref A.0D2A
    2841 0D30  81 EF 0BE1		 		sub	di,0BE1h
    2842 0D34  2E: 8A A5 0BE8 R		 		mov	ah,byte ptr cs:data_85[di]	; (A.0BE8=80h)
    2843 0D39  A8 80			 		test	al,80h
    2844 0D3B  75 54			 		jnz	loc_149			; Jump if not zero
    2845 0D3D  80 FC 10			 		cmp	ah,10h
    2846 0D40  73 07			 		jae	loc_144			; Jump if above or =
    2847 0D42  08 26 0017 R		 		or	byte ptr ds:[keybd_flags_1],ah	; (A.0017=32h)
    2848 0D46  E9 0DCC R		 		jmp	loc_152			; (0DCB)
    2849 0D49				loc_144:					;  xref A.0D3F
    2850 0D49  F6 06 0017 R 04		 		test	byte ptr ds:[keybd_flags_1],4	; (A.0017=32h)
    2851 0D4E  75 68			 		jnz	loc_151			; Jump if not zero
    2852 0D50  3C 52			 		cmp	al,52h			; 'R'
    2853 0D52  75 25			 		jne	loc_148			; Jump if not equal
    2854 0D54  F6 06 0017 R 08		 		test	byte ptr ds:[keybd_flags_1],8	; (A.0017=32h)
    2855 0D59  74 03			 		jz	loc_145			; Jump if zero
    2856 0D5B  EB 5B			 		jmp	short loc_151		; (0DB7)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-53


    2857 0D5D  90			 		db	90h
    2858				;a.0d5d
    2859 0D5E				loc_145:					;  xref A.0D58
    2860 0D5E  F6 06 0017 R 20		 		test	byte ptr ds:[keybd_flags_1],20h	; (A.0017=32h) ' '
    2861 0D63  75 0D			 		jnz	loc_147			; Jump if not zero
    2862 0D65  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    2863 0D6A  74 0D			 		jz	loc_148			; Jump if zero
    2864 0D6C				loc_146:					;  xref A.0D76
    2865 0D6C  B8 5230			 		mov	ax,5230h
    2866 0D6F  E9 0F35 R		 		jmp	loc_181			; (0F34)
    2867 0D72				loc_147:					;  xref A.0D62
    2868 0D72  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    2869 0D77  74 F3			 		jz	loc_146			; Jump if zero
    2870 0D79				loc_148:					;  xref A.0D51, 0D69
    2871 0D79  84 26 0018 R		 		test	ah,byte ptr ds:[keybd_flags_2]	; (A.0018=31h)
    2872 0D7D  75 4D			 		jnz	loc_152			; Jump if not zero
    2873 0D7F  08 26 0018 R		 		or	byte ptr ds:[keybd_flags_2],ah	; (A.0018=31h)
    2874 0D83  30 26 0017 R		 		xor	byte ptr ds:[keybd_flags_1],ah	; (A.0017=32h)
    2875 0D87  3C 52			 		cmp	al,52h			; 'R'
    2876 0D89  75 41			 		jne	loc_152			; Jump if not equal
    2877 0D8B  B8 5200			 		mov	ax,5200h
    2878 0D8E  E9 0F35 R		 		jmp	loc_181			; (0F34)
    2879 0D91				loc_149:					;  xref A.0D3A
    2880 0D91  80 FC 10			 		cmp	ah,10h
    2881 0D94  73 1A			 		jae	loc_150			; Jump if above or =
    2882 0D96  F6 D4			 		not	ah
    2883 0D98  20 26 0017 R		 		and	byte ptr ds:[keybd_flags_1],ah	; (A.0017=32h)
    2884 0D9C  3C B8			 		cmp	al,0B8h
    2885 0D9E  75 2C			 		jne	loc_152			; Jump if not equal
    2886 0DA0  A0 0019			 		mov	al,byte ptr ds:[19h]	; (A.0019=2Fh)
    2887 0DA3  B4 00			 		mov	ah,0
    2888 0DA5  88 26 0019		 		mov	byte ptr ds:[19h],ah	; (A.0019=2Fh)
    2889 0DA9  3C 00			 		cmp	al,0
    2890 0DAB  74 1F			 		je	loc_152			; Jump if equal
    2891 0DAD  E9 0F3E R		 		jmp	loc_182			; (0F3D)
    2892				;a.0daf
    2893 0DB0				loc_150:					;  xref A.0D93
    2894 0DB0  F6 D4			 		not	ah
    2895 0DB2  20 26 0018 R		 		and	byte ptr ds:[keybd_flags_2],ah	; (A.0018=31h)
    2896 0DB6  EB 14			 		jmp	short loc_152		; (0DCB)
    2897 0DB8				loc_151:					;  xref A.0D2C, 0D4D, 0D5A
    2898 0DB8  3C 80			 		cmp	al,80h
    2899 0DBA  73 10			 		jae	loc_152			; Jump if above or =
    2900 0DBC  F6 06 0018 R 08		 		test	byte ptr ds:[keybd_flags_2],8	; (A.0018=31h)
    2901 0DC1  74 12			 		jz	loc_153			; Jump if zero
    2902 0DC3  3C 45			 		cmp	al,45h			; 'E'
    2903 0DC5  74 05			 		je	loc_152			; Jump if equal
    2904 0DC7  80 26 0018 R F7		 		and	byte ptr ds:[keybd_flags_2],0F7h	; (A.0018=31h)
    2905 0DCC				loc_152:					;  xref A.0D45, 0D7C, 0D88, 0D9D
    2906				 						;            0DAA, 0DB5, 0DB9, 0DC4
    2907				 						;            0E39, 0E60, 0EA8, 0EDE
    2908				 						;            0F57, 0F79, 0F7F
    2909 0DCC  07			 		pop	es
    2910 0DCD  1F			 		pop	ds
    2911 0DCE  5F			 		pop	di
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-54


    2912 0DCF  5E			 		pop	si
    2913 0DD0  5A			 		pop	dx
    2914 0DD1  59			 		pop	cx
    2915 0DD2  5B			 		pop	bx
    2916 0DD3  58			 		pop	ax
    2917 0DD4  CF			 		iret				; Interrupt return
    2918				
    2919				;===============================================================================
    2920				;a.0dd4
    2921				; Process warm boot keyboard combination Ctrl-Alt-Del
    2922				;
    2923 0DD5				loc_153:					;  xref A.0DC0
    2924 0DD5  F6 06 0017 R 08		 		test	byte ptr ds:[keybd_flags_1],8	; (A.0017=32h)
    2925 0DDA  75 03			 		jnz	loc_154			; Jump if not zero
    2926 0DDC  E9 0E6E R		 		jmp	loc_162			; (0E6D)
    2927 0DDF				loc_154:					;  xref A.0DD9
    2928 0DDF  F6 06 0017 R 04		 		test	byte ptr ds:[keybd_flags_1],4	; (A.0017=32h)
    2929 0DE4  74 31			 		jz	loc_155			; Jump if zero
    2930 0DE6  3C 53			 		cmp	al,53h			; 'S'
    2931 0DE8  75 2D			 		jne	loc_155			; Jump if not equal
    2932 0DEA  C7 06 0072 1234		 		mov	word ptr ds:[72h],1234h	; (A.0072=0FEB9h)
    2933 0DF0  E9 001F R				jmp	COLD2			;*(001F) go to cold restart
    2934				; 		db	0E9h, 2Dh,0F2h
    2935				
    2936				
    2937				;a.0df2
    2938 0DF3  52 4F 50 51 4B 4C	data_88:	db	'ROPQKLMGHI'		;  xref A.0E1F
    2939       4D 47 48 49		
    2940 0DFD  10 11 12 13 14 15	     		db	 10h, 11h, 12h, 13h, 14h, 15h
    2941 0E03  16 17 18 19 1E 1F	     		db	 16h, 17h, 18h, 19h, 1Eh, 1Fh
    2942 0E09  20 21 22 23 24		 		db	' !"#$'
    2943 0E0E  25 26 2C 2D 2E 2F	     		db	'%&,-./012'
    2944       30 31 32			
    2945				;a.0e16
    2946 0E17				loc_155:					;  xref A.0DE3, 0DE7
    2947 0E17  3C 39			 		cmp	al,39h			; '9'
    2948 0E19  75 05			 		jne	loc_156			; Jump if not equal
    2949 0E1B  B0 20			 		mov	al,20h			; ' '
    2950 0E1D  E9 0F35 R		 		jmp	loc_181			; (0F34)
    2951 0E20				loc_156:					;  xref A.0E18
    2952 0E20  BF 0DF3 R		 		mov	di,offset data_88	; (A.0DF2='ROPQKLMGHI')
    2953 0E23  B9 000A			 		mov	cx,0Ah
    2954 0E26  F2/ AE			 		repne	scasb			; Rep zf=0+cx >0 Scan es:[di] for al
    2955 0E28  75 12			 		jnz	loc_157			; Jump if not zero
    2956 0E2A  81 EF 0DF3		 		sub	di,0DF3h
    2957 0E2E  A0 0019			 		mov	al,byte ptr ds:[19h]	; (A.0019=2Fh)
    2958 0E31  B4 0A			 		mov	ah,0Ah
    2959 0E33  F6 E4			 		mul	ah			; ax = reg * al
    2960 0E35  03 C7			 		add	ax,di
    2961 0E37  A2 0019			 		mov	byte ptr ds:[19h],al	; (A.0019=2Fh)
    2962 0E3A  EB 90			 		jmp	short loc_152		; (0DCB)
    2963 0E3C				loc_157:					;  xref A.0E27
    2964 0E3C  C6 06 0019 00		 		mov	byte ptr ds:[19h],0	; (A.0019=2Fh)
    2965 0E41  B9 001A			 		mov	cx,1Ah
    2966 0E44  F2/ AE			 		repne	scasb			; Rep zf=0+cx >0 Scan es:[di] for al
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-55


    2967 0E46  75 05			 		jnz	loc_158			; Jump if not zero
    2968 0E48  B0 00			 		mov	al,0
    2969 0E4A  E9 0F35 R		 		jmp	loc_181			; (0F34)
    2970 0E4D				loc_158:					;  xref A.0E45
    2971 0E4D  3C 02			 		cmp	al,2
    2972 0E4F  72 0C			 		jb	loc_159			; Jump if below
    2973 0E51  3C 0E			 		cmp	al,0Eh
    2974 0E53  73 08			 		jae	loc_159			; Jump if above or =
    2975 0E55  80 C4 76			 		add	ah,76h			; 'v'
    2976 0E58  B0 00			 		mov	al,0
    2977 0E5A  E9 0F35 R		 		jmp	loc_181			; (0F34)
    2978 0E5D				loc_159:					;  xref A.0E4E, 0E52
    2979 0E5D  3C 3B			 		cmp	al,3Bh			; ';'
    2980 0E5F  73 03			 		jae	loc_161			; Jump if above or =
    2981				;a.0e60
    2982 0E61				loc_160:					;  xref A.0E65
    2983 0E61  E9 0DCC R		 		jmp	loc_152			; (0DCB)
    2984 0E64				loc_161:					;  xref A.0E5E
    2985 0E64  3C 47			 		cmp	al,47h			; 'G'
    2986 0E66  73 F9			 		jae	loc_160			; Jump if above or =
    2987 0E68  BB 0CC1			 		mov	bx,0CC1h
    2988 0E6B  E9 0F83 R		 		jmp	loc_187			; (0F82)
    2989 0E6E				loc_162:					;  xref A.0DDB
    2990 0E6E  F6 06 0017 R 04		 		test	byte ptr ds:[keybd_flags_1],4	; (A.0017=32h)
    2991 0E73  74 51			 		jz	loc_168			; Jump if zero
    2992 0E75  3C 46			 		cmp	al,46h			; 'F'
    2993 0E77  75 18			 		jne	loc_163			; Jump if not equal
    2994 0E79  BB 001E			 		mov	bx,1Eh
    2995 0E7C  89 1E 001A R		 		mov	word ptr ds:[keybd_q_head],bx	; (A.001A=3538h)
    2996 0E80  89 1E 001C R		 		mov	word ptr ds:[keybd_q_tail],bx	; (A.001C=0D0Ah)
    2997 0E84  C6 06 0071 80		 		mov	byte ptr ds:[71h],80h	; (A.0071=0)
    2998 0E89  CD 1B			 		int	1Bh			; Keyboard break (cntrl-break)
    2999 0E8B  B8 0000			 		mov	ax,0
    3000 0E8E  E9 0F35 R		 		jmp	loc_181			; (0F34)
    3001 0E91				loc_163:					;  xref A.0E76
    3002 0E91  3C 45			 		cmp	al,45h			; 'E'
    3003 0E93  75 17			 		jne	loc_165			; Jump if not equal
    3004 0E95  80 0E 0018 R 08		 		or	byte ptr ds:[keybd_flags_2],8	; (A.0018=31h)
    3005 0E9A  BA 03D8			 		mov	dx,3D8h
    3006 0E9D  A0 0065			 		mov	al,byte ptr ds:[65h]	; (A.0065=0A3h)
    3007 0EA0  EE			 		out	dx,al			; port 3D8h, CGA video control
    3008 0EA1  FB			 		sti				; Enable interrupts
    3009 0EA2				loc_164:					;  xref A.0EA6
    3010 0EA2  F6 06 0018 R 08		 		test	byte ptr ds:[keybd_flags_2],8	; (A.0018=31h)
    3011 0EA7  75 F9			 		jnz	loc_164			; Jump if not zero
    3012 0EA9  E9 0DCC R		 		jmp	loc_152			; (0DCB)
    3013				;a.0eab
    3014 0EAC				loc_165:					;  xref A.0E92
    3015 0EAC  3C 37			 		cmp	al,37h			; '7'
    3016 0EAE  75 06			 		jne	loc_166			; Jump if not equal
    3017 0EB0  B8 7200			 		mov	ax,7200h
    3018 0EB3  E9 0F35 R		 		jmp	loc_181			; (0F34)
    3019 0EB6				loc_166:					;  xref A.0EAD
    3020 0EB6  BB 0BF0			 		mov	bx,0BF0h
    3021 0EB9  3C 3B			 		cmp	al,3Bh			; ';'
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-56


    3022 0EBB  73 03			 		jae	loc_167			; Jump if above or =
    3023 0EBD  EB 72			 		jmp	short loc_180		; (0F30)
    3024 0EBF  90			 		db	90h
    3025 0EC0				loc_167:					;  xref A.0EBA
    3026 0EC0  BB 0C2A			 		mov	bx,0C2Ah
    3027 0EC3  E9 0F83 R		 		jmp	loc_187			; (0F82)
    3028 0EC6				loc_168:					;  xref A.0E72
    3029 0EC6  3C 47			 		cmp	al,47h			; 'G'
    3030 0EC8  73 27			 		jae	loc_172			; Jump if above or =
    3031 0ECA  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    3032 0ECF  74 55			 		jz	loc_178			; Jump if zero
    3033 0ED1  3C 0F			 		cmp	al,0Fh
    3034 0ED3  75 06			 		jne	loc_169			; Jump if not equal
    3035 0ED5  B8 0F00			 		mov	ax,0F00h
    3036 0ED8  EB 5B			 		jmp	short loc_181		; (0F34)
    3037 0EDA  90			 		db	90h
    3038 0EDB				loc_169:					;  xref A.0ED2
    3039 0EDB  3C 37			 		cmp	al,37h			; '7'
    3040 0EDD  75 03			 		jne	loc_170			; Jump if not equal
    3041 0EDF  E9 0DCC R		 		jmp	loc_152			; (0DCB)
    3042				;a.0ee1
    3043 0EE2				loc_170:					;  xref A.0EDC
    3044 0EE2  3C 3B			 		cmp	al,3Bh			; ';'
    3045 0EE4  72 06			 		jb	loc_171			; Jump if below
    3046 0EE6  BB 0CB7			 		mov	bx,0CB7h
    3047 0EE9  E9 0F83 R		 		jmp	loc_187			; (0F82)
    3048 0EEC				loc_171:					;  xref A.0EE3
    3049 0EEC  BB 0C7D			 		mov	bx,0C7Dh
    3050 0EEF  EB 40			 		jmp	short loc_180		; (0F30)
    3051 0EF1				loc_172:					;  xref A.0EC7
    3052 0EF1  F6 06 0017 R 20		 		test	byte ptr ds:[keybd_flags_1],20h	; (A.0017=32h) ' '
    3053 0EF6  75 20			 		jnz	loc_176			; Jump if not zero
    3054 0EF8  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    3055 0EFD  75 20			 		jnz	loc_177			; Jump if not zero
    3056 0EFF				loc_173:					;  xref A.0F1C
    3057 0EFF  3C 4A			 		cmp	al,4Ah			; 'J'
    3058 0F01  74 0B			 		je	loc_174			; Jump if equal
    3059 0F03  3C 4E			 		cmp	al,4Eh			; 'N'
    3060 0F05  74 0C			 		je	loc_175			; Jump if equal
    3061 0F07  2C 47			 		sub	al,47h			; 'G'
    3062 0F09  BB 0CD7			 		mov	bx,0CD7h
    3063 0F0C  EB 77			 		jmp	short loc_188		; (0F84)
    3064 0F0E				loc_174:					;  xref A.0F00
    3065 0F0E  B8 4A2D			 		mov	ax,4A2Dh
    3066 0F11  EB 22			 		jmp	short loc_181		; (0F34)
    3067				;a.0f12
    3068 0F13				loc_175:					;  xref A.0F04
    3069 0F13  B8 4E2B			 		mov	ax,4E2Bh
    3070 0F16  EB 1D			 		jmp	short loc_181		; (0F34)
    3071 0F18				loc_176:					;  xref A.0EF5
    3072 0F18  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    3073 0F1D  75 E0			 		jnz	loc_173			; Jump if not zero
    3074 0F1F				loc_177:					;  xref A.0EFC
    3075 0F1F  2C 46			 		sub	al,46h			; 'F'
    3076 0F21  BB 0CCA			 		mov	bx,0CCAh
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-57


    3077 0F24  EB 0B			 		jmp	short loc_180		; (0F30)
    3078 0F26				loc_178:					;  xref A.0ECE
    3079 0F26  3C 3B			 		cmp	al,3Bh			; ';'
    3080 0F28  72 04			 		jb	loc_179			; Jump if below
    3081 0F2A  B0 00			 		mov	al,0
    3082 0F2C  EB 07			 		jmp	short loc_181		; (0F34)
    3083 0F2E				loc_179:					;  xref A.0F27
    3084 0F2E  BB 0C43 R		 		mov	bx,offset data_86	; (A.0C43=' 1234567890-=  q')
    3085				;a.0f30
    3086 0F31				loc_180:					;  xref A.0EBC, 0EEE, 0F23
    3087 0F31  FE C8			 		dec	al
    3088 0F33  2E: D7			 		xlat	cs:[bx]			; al=[al+[bx]] table
    3089 0F35				loc_181:					;  xref A.0D6E, 0D8D, 0E1C, 0E49
    3090				 						;            0E59, 0E8D, 0EB2, 0ED7
    3091				 						;            0F10, 0F15, 0F2B, 0F8A
    3092 0F35  3C FF			 		cmp	al,0FFh
    3093 0F37  74 1F			 		je	loc_183			; Jump if equal
    3094 0F39  80 FC FF			 		cmp	ah,0FFh
    3095 0F3C  74 1A			 		je	loc_183			; Jump if equal
    3096 0F3E				loc_182:					;  xref A.0DAC
    3097 0F3E  F6 06 0017 R 40		 		test	byte ptr ds:[keybd_flags_1],40h	; (A.0017=32h) '@'
    3098 0F43  74 20			 		jz	loc_185			; Jump if zero
    3099 0F45  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    3100 0F4A  74 0F			 		jz	loc_184			; Jump if zero
    3101 0F4C  3C 41			 		cmp	al,41h			; 'A'
    3102 0F4E  72 15			 		jb	loc_185			; Jump if below
    3103 0F50  3C 5A			 		cmp	al,5Ah			; 'Z'
    3104 0F52  77 11			 		ja	loc_185			; Jump if above
    3105 0F54  04 20			 		add	al,20h			; ' '
    3106 0F56  EB 0D			 		jmp	short loc_185		; (0F64)
    3107 0F58				loc_183:					;  xref A.0F36, 0F3B
    3108 0F58  E9 0DCC R		 		jmp	loc_152			; (0DCB)
    3109 0F5B				loc_184:					;  xref A.0F49
    3110 0F5B  3C 61			 		cmp	al,61h			; 'a'
    3111 0F5D  72 06			 		jb	loc_185			; Jump if below
    3112 0F5F  3C 7A			 		cmp	al,7Ah			; 'z'
    3113 0F61  77 02			 		ja	loc_185			; Jump if above
    3114 0F63  2C 20			 		sub	al,20h			; ' '
    3115				;a.0f64
    3116 0F65				loc_185:					;  xref A.0F42, 0F4D, 0F51, 0F55
    3117				 						;            0F5C, 0F60
    3118 0F65  8B 1E 001C R		 		mov	bx,word ptr ds:[keybd_q_tail]	; (A.001C=0D0Ah)
    3119 0F69  8B F3			 		mov	si,bx
    3120 0F6B  E8 0BD3 R		 		call	sub_30			; (0BD3)
    3121 0F6E  3B 1E 001A R		 		cmp	bx,word ptr ds:[keybd_q_head]	; (A.001A=3538h)
    3122 0F72  74 09			 		je	loc_186			; Jump if equal
    3123 0F74  89 04			 		mov	[si],ax
    3124 0F76  89 1E 001C R		 		mov	word ptr ds:[keybd_q_tail],bx	; (A.001C=0D0Ah)
    3125 0F7A  E9 0DCC R		 		jmp	loc_152			; (0DCB)
    3126 0F7D				loc_186:					;  xref A.0F71
    3127 0F7D  E8 0F8D R		 		call	sub_31			; (0F8C)
    3128 0F80  E9 0DCC R		 		jmp	loc_152			; (0DCB)
    3129 0F83				loc_187:					;  xref A.0E6A, 0EC2, 0EE8
    3130 0F83  2C 3B			 		sub	al,3Bh			; ';'
    3131 0F85				loc_188:					;  xref A.0F0B
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-58


    3132 0F85  2E: D7			 		xlat	cs:[bx]			; al=[al+[bx]] table
    3133 0F87  8A E0			 		mov	ah,al
    3134 0F89  B0 00			 		mov	al,0
    3135 0F8B  EB A8			 		jmp	short loc_181		; (0F34)
    3136				
    3137				
    3138				;===============================================================================
    3139				 ;                              SUBROUTINE
    3140				 ;
    3141				 ;         Called from:   A.0F7C
    3142				;===============================================================================
    3143				;a.0f8c
    3144 0F8D				sub_31		proc	near
    3145 0F8D  50			 		push	ax
    3146 0F8E  53			 		push	bx
    3147 0F8F  51			 		push	cx
    3148 0F90  BB 00C0			 		mov	bx,0C0h
    3149 0F93  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    3150 0F95  50			 		push	ax
    3151 0F96				loc_189:					;  xref A.0FA8
    3152 0F96  24 FC			 		and	al,0FCh
    3153 0F98  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    3154				 						;  al = 0, speaker off
    3155 0F9A  B9 0048			 		mov	cx,48h
    3156				
    3157 0F9D				locloop_190:					;  xref A.0F9C
    3158 0F9D  E2 FE			 		loop	locloop_190		; Loop if cx > 0
    3159				
    3160 0F9F  0C 02			 		or	al,2
    3161 0FA1  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    3162 0FA3  B9 0048			 		mov	cx,48h
    3163				
    3164 0FA6				locloop_191:					;  xref A.0FA5
    3165 0FA6  E2 FE			 		loop	locloop_191		; Loop if cx > 0
    3166				
    3167 0FA8  4B			 		dec	bx
    3168 0FA9  75 EB			 		jnz	loc_189			; Jump if not zero
    3169 0FAB  58			 		pop	ax
    3170 0FAC  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    3171				 						;  al = 0, speaker off
    3172 0FAE  59			 		pop	cx
    3173 0FAF  5B			 		pop	bx
    3174 0FB0  58			 		pop	ax
    3175 0FB1  C3			 		retn
    3176 0FB2				sub_31		endp
    3177				
    3178				
    3179				;===============================================================================
    3180				 ;                              SUBROUTINE
    3181				 ;
    3182				 ;         Called from:   A.008A
    3183				;===============================================================================
    3184				; Grab INT10/1D video
    3185				;a.0fb1
    3186 0FB2				sub_32		proc	near
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-59


    3187 0FB2  1E			 		push	ds
    3188 0FB3  33 C0			 		xor	ax,ax				; Zero register
    3189 0FB5  8E D8			 		mov	ds,ax
    3190 0FB7  B8 0FF2 R		 		mov	ax,offset INT10HANDLER		;0FF1h
    3191 0FBA  A3 0040			 		mov	ds:Int10v,ax			; (0000:0040=0EEh)
    3192 0FBD  8C 0E 0042		 		mov	ds:Int10v+2,cs			; (0000:0042=0C000h)
    3193 0FC1  B8 1021 R		 		mov	ax,offset INT_1D		;1020h
    3194 0FC4  A3 0074			 		mov	ds:Int1Dv,ax			; (0000:0074=0C958h)
    3195 0FC7  8C 0E 0076		 		mov	word ptr ds:Int1Dv+2,cs		; (0000:0076=0F000h)
    3196 0FCB  1F			 		pop	ds
    3197 0FCC  B8 0003			 		mov	ax,3
    3198 0FCF  CD 10			 		int	10h				; Video display   ah=functn 00h
    3199				 							;  set display mode in al
    3200 0FD1  C3			 		retn
    3201 0FD2				sub_32		endp
    3202				
    3203				;===============================================================================
    3204				;	ENTRY   0F045h                          ; IBM entry point for table
    3205				;a.0fd1
    3206				; INT 10 - Video Dispatch table
    3207				
    3208				;M1	LABEL	WORD	; TABLE OF ROUTINES WITHIN VIDEO I/O
    3209 0FD2  1079 R			V_TABLE:	dw	offset SET_MODE			;  xref A.101B
    3210 0FD4  113F R					dw	offset SET_CTYPE		;  xref A.101B
    3211 0FD6  1160 R					dw	offset SET_CPOS			;  xref A.101B
    3212 0FD8  118A R					dw	offset READ_CURSOR		;  xref A.101B
    3213 0FDA  16D6 R					dw	offset READ_LPEN		;  xref A.101B
    3214 0FDC  11A0 R					dw	offset ACT_DISP_PAGE		;  xref A.101B
    3215 0FDE  120C R					dw	offset SCROLL_UP		;  xref A.101B
    3216 0FE0  1291 R					dw	offset SCROLL_DOWN		;  xref A.101B
    3217 0FE2  12CD R					dw	offset READ_AC_CURRENT		;  xref A.101B
    3218 0FE4  1313 R					dw	offset WRITE_AC_CURRENT		;  xref A.101B
    3219 0FE6  1335 R					dw	offset WRITE_C_CURRENT		;  xref A.101B
    3220 0FE8  11C4 R					dw	offset SET_COLOR		;  xref A.101B
    3221 0FEA  1365 R					dw	offset WRITE_DOT		;  xref A.101B
    3222 0FEC  1354 R					dw	offset READ_DOT			;  xref A.101B
    3223 0FEE  164F R					dw	offset WRITE_TTY		;  xref A.101B
    3224 0FF0  11EA R					dw	offset VIDEO_STATE		;  xref A.101B
    3225				
    3226				
    3227				;===============================================================================
    3228				;  INT 10h  -  B I O S   V I D E O   S E R V I C E S
    3229				;
    3230				;	Purpose:  INT 10h BIOS video services.
    3231				;	Entry  :	Registers	Function
    3232				;			AH=		Major function code
    3233				;			AL=		Sub-function
    3234				;	Exit   :
    3235				;
    3236				;===============================================================================
    3237				;	ENTRY   0F065h                          ; IBM entry, video bios service
    3238				;a.0ff1
    3239 0FF2				INT10HANDLER:
    3240				;     	db	0FBh,0FCh, 06h, 1Eh, 52h, 51h
    3241				;     	db	 53h, 56h, 57h, 50h, 8Ah,0C4h
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-60


    3242				;     	db	 32h,0E4h,0D1h,0E0h, 8Bh,0F0h
    3243				;     	db	 3Dh, 20h, 00h, 72h, 04h, 58h
    3244				; 	db	0E9h, 2Ah, 01h
    3245 0FF2  FB					sti
    3246 0FF3  FC					cld
    3247 0FF4  06					push	es
    3248 0FF5  1E					push	ds
    3249 0FF6  52					push	dx
    3250 0FF7  51					push	cx
    3251 0FF8  53					push	bx
    3252 0FF9  56					push	si
    3253 0FFA  57					push	di
    3254 0FFB  50					push	ax
    3255 0FFC  8A C4					mov	al,ah
    3256 0FFE  32 E4					xor	ah,ah
    3257 1000  D1 E0					shl	ax,1
    3258 1002  8B F0					mov	si,ax			; convert function code to table offset
    3259 1004  3D 0020					cmp	ax,20h			; max function code * 2 
    3260 1007  72 04					jb	loc_192			;100C valid function, continue
    3261 1009  58					pop	ax
    3262 100A  E9 1137 R				jmp	loc_200			;1136 restore AX and exit
    3263				
    3264 100D				loc_192:
    3265 100D  B8 0040			 		mov	ax,40h
    3266 1010  8E D8			 		mov	ds,ax
    3267 1012  B8 B800			 		mov	ax,0B800h		; CGA memory
    3268 1015  8E C0			 		mov	es,ax
    3269 1017  58			 		pop	ax
    3270 1018  8A 26 0049 R		 		mov	ah,ds:video_mode	; (0040:0049=3)
    3271 101C  2E: FF A4 0FD2 R		 		jmp	word ptr cs:V_TABLE[si]	;*(A.0FD1=1078h)     16 entries
    3272				
    3273				
    3274				;===============================================================================
    3275				;  INT 1Dh  -  V I D E O   M O D E S
    3276				;
    3277				;	Purpose:  INT 1Dh BIOS video modes.
    3278				;	Entry  :	Registers	Function
    3279				;
    3280				;
    3281				;	Exit   :
    3282				;
    3283				;===============================================================================
    3284				;	ENTRY   0F0A4h                          ; IBM entry, SET_MODE tables
    3285				;a.1020
    3286				; Video Parameter Table
    3287				;00h 16 BYTEs   6845 register values for modes 00h and 01h
    3288				;10h 16 BYTEs   6845 register values for modes 02h and 03h
    3289				;20h 16 BYTEs   6845 register values for modes 04h and 05h
    3290				;30h 16 BYTEs   6845 register values for modes 06h and 07h
    3291				;40h    WORD    bytes in video buffer for modes 00h and 01h (0800h)
    3292				;42h    WORD    bytes in video buffer for modes 02h and 03h (1000h)
    3293				;44h    WORD    bytes in video buffer for modes 04h and 05h (4000h)
    3294				;46h    WORD    bytes in video buffer for mode 06h (4000h)
    3295				;48h  8 BYTEs   columns on screen for each of modes 00h through 07h
    3296				;50h  8 BYTEs   CRT controller mode bytes for each of modes 00h through 07h
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-61


    3297 1021				INT_1D:
    3298 1021  38 28 2D 0A 1F 06			db	38h, 28h, 2Dh, 0Ah, 1Fh, 06h	; Init string for 40 x 25
    3299 1027  19 1C 02 07 06 07			db	19h, 1Ch, 02h, 07h, 06h, 07h
    3300 102D  00 00 00 00				db	0, 0, 0, 0
    3301				
    3302 1031  71 50 5A 0A 1F 06			db	71h, 50h, 5Ah, 0Ah, 1Fh, 06h	; Init string for 80 x 25 col
    3303 1037  19 1C 02 07 06 07			db	19h, 1Ch, 02h, 07h, 06h, 07h
    3304 103D  00 00 00 00				db	0, 0, 0, 0
    3305				
    3306 1041  38 28 2D 0A 7F 06			db	38h, 28h, 2Dh, 0Ah, 7Fh, 06h	; Init string for GRAPHIX
    3307 1047  64 70 02 01 06 07			db	64h, 70h, 02h, 01h, 06h, 07h
    3308 104D  00 00 00 00				db	0, 0, 0, 0
    3309				
    3310 1051  61 50 52 0F 19 06			db	61h, 50h, 52h, 0Fh, 19h, 06h	; Init string for 80 x 25 b/w
    3311 1057  19 19 02 0D 0B 0C			db	19h, 19h, 02h, 0Dh, 0Bh, 0Ch
    3312 105D  00 00 00 00				db	0, 0, 0, 0
    3313				
    3314				;a.1060	Regen lengths
    3315 1061  0800			REGENL:		dw	2048			; xref A.1111 40x25
    3316 1063  1000			     		dw	4096			; 80x25
    3317 1065  4000					dw	16384			; graphics
    3318 1067  4000					dw	16384
    3319				;a.1068 Column lengths				; Data table (indexed access) xref A.1103
    3320 1069  28 28 50 50 28 28	MAXCOLS:	db	28h, 28h, 50h, 50h, 28h, 28h, 50h, 50h
    3321       50 50			
    3322				
    3323				;a;1070 table of mode sets			; Data table (indexed access) xref A.10FA
    3324 1071  2C 28 2D 29 2A 2E	MODES:		db	2Ch, 28h, 2Dh, 29h, 2Ah, 2Eh, 1Eh, 29h
    3325       1E 29			
    3326				
    3327				
    3328				;===============================================================================
    3329				;  Individual routines within the INT 10H Video Services
    3330				;
    3331				;	Entry  :	Registers	Function
    3332				;			AH		Video mode (0-7) from BDA 40:49
    3333				;			AL		Parameter
    3334				;			DS		BIOS data area (40h)
    3335				;			ES		video memory area (B800h)
    3336				;
    3337				;	Exit   :
    3338				;
    3339				;===============================================================================
    3340				;--- SET MODE ------------------------------------------------------------------
    3341				;
    3342				;	AL=	desired video mode 0-7
    3343				;	3D4h= 6845 index register
    3344				;	3D5h= 6845 data register
    3345				;	3D8h= master display mode latch control register
    3346				;	3D9h= background color latch select register
    3347				;	3DAh= status/feature register
    3348				;	3DB/3DC = light pen
    3349				;a.1078
    3350 1079				SET_MODE:					;  xref A.0FD1, 101B
    3351 1079  BA 03D4			 		mov	dx,3D4h			; index register
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-62


    3352 107C  B3 00			 		mov	bl,0
    3353 107E  3C 07			 		cmp	al,7			; max video mode
    3354 1080  72 03			 		jb	loc_194			; Allowed mode?
    3355 1082  E9 1137 R		 		jmp	loc_200			; no...exit (1136)
    3356				
    3357 1085				loc_194:
    3358 1085  8A E0			 		mov	ah,al
    3359 1087  A2 0049 R		 		mov	ds:video_mode,al	; (0040:0049=3)
    3360 108A  89 16 0063 R		 		mov	ds:video_port,dx	; (0040:0063=3D4h)
    3361 108E  1E			 		push	ds
    3362 108F  50			 		push	ax
    3363 1090  52			 		push	dx
    3364 1091  83 C2 04			 		add	dx,4
    3365 1094  8A C3			 		mov	al,bl
    3366 1096  EE			 		out	dx,al			; port 3D8h, CGA video control
    3367 1097  5A			 		pop	dx
    3368 1098  2B C0			 		sub	ax,ax
    3369 109A  8E D8			 		mov	ds,ax
    3370 109C  C5 1E 0074		 		lds	bx,dword ptr ds:Int1Dv	; (0000:0074=0C958h) grabe table address fro
					m IVT
    3371 10A0  58			 		pop	ax
    3372 10A1  B9 0010			 		mov	cx,10h
    3373 10A4  80 FC 02			 		cmp	ah,2
    3374 10A7  72 10			 		jb	loc_195			; Jump if below
    3375 10A9  03 D9			 		add	bx,cx
    3376 10AB  80 FC 04			 		cmp	ah,4
    3377 10AE  72 09			 		jb	loc_195			; Jump if below
    3378 10B0  03 D9			 		add	bx,cx
    3379 10B2  80 FC 07			 		cmp	ah,7
    3380 10B5  72 02			 		jb	loc_195			; Jump if below
    3381 10B7  03 D9			 		add	bx,cx
    3382 10B9				loc_195:					;  xref A.10A6, 10AD, 10B4
    3383 10B9  50			 		push	ax
    3384 10BA  32 E4			 		xor	ah,ah			; Zero register
    3385				
    3386				;a.10bb
    3387 10BC				locloop_196:					;  xref A.10C6
    3388 10BC  8A C4			 		mov	al,ah
    3389 10BE  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    3390				 						;  al = 0, horiz char total
    3391 10BF  42			 		inc	dx
    3392 10C0  FE C4			 		inc	ah
    3393 10C2  8A 07			 		mov	al,[bx]
    3394 10C4  EE			 		out	dx,al			; port 3D5h, CGA/EGA indxd data
    3395 10C5  43			 		inc	bx
    3396 10C6  4A			 		dec	dx
    3397 10C7  E2 F3			 		loop	locloop_196		; Loop if cx > 0
    3398				
    3399				; this clears the screen
    3400 10C9  58			 		pop	ax
    3401 10CA  1F			 		pop	ds
    3402 10CB  33 FF			 		xor	di,di			; Zero register
    3403 10CD  89 3E 004E R		 		mov	ds:video_segment,di	; (0040:004E=0)
    3404 10D1  C6 06 0062 R 00		 		mov	byte ptr ds:video_page,0	; (0040:0062=0)
    3405 10D6  B9 2000			 		mov	cx,2000h		; 8192 words
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-63


    3406 10D9  80 FC 04			 		cmp	ah,4
    3407 10DC  72 04			 		jb	loc_197			; Jump if below
    3408 10DE  33 C0			 		xor	ax,ax			; Zero register
    3409 10E0  EB 03			 		jmp	short loc_198		; (10E4)
    3410				
    3411 10E2				loc_197:					;  xref A.10DB
    3412 10E2  B8 0720			 		mov	ax, 7*100h+' '		; Word for text fill 720h
    3413				;a.10e4
    3414 10E5				loc_198:					;  xref A.10DF
    3415 10E5  F3/ AB			 		rep	stosw			; fill the screen with spaces
    3416				
    3417 10E7  C7 06 0060 R 0067	 		mov	word ptr ds:vid_curs_mode,67h	; (0040:0060=2000h)
    3418 10ED  A0 0049 R		 		mov	al,ds:video_mode	; (0040:0049=3)
    3419 10F0  32 E4			 		xor	ah,ah			; Zero register
    3420 10F2  8B F0			 		mov	si,ax
    3421 10F4  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h) get the port
    3422 10F8  83 C2 04			 		add	dx,4
    3423				
    3424 10FB  2E: 8A 84 1071 R		 		mov	al,byte ptr cs:MODES[si]	; load data to set mode
    3425 1100  EE			 		out	dx,al			; port 3D8h, CGA video control
    3426 1101  A2 0065 R		 		mov	ds:video_mode_reg,al	; (0040:0065=29h) save active data
    3427				
    3428 1104  2E: 8A 84 1069 R		 		mov	al,byte ptr cs:MAXCOLS[si]	; (A.1068='((PP((PP')
    3429 1109  32 E4			 		xor	ah,ah			; Zero register
    3430 110B  A3 004A R		 		mov	ds:video_columns,ax	; (0040:004A=50h)
    3431 110E  81 E6 000E		 		and	si,word ptr 0Eh
    3432 1112  2E: 8B 8C 1061 R		 		mov	cx,word ptr cs:REGENL[si]	; (A.1060=800h)
    3433 1117  89 0E 004C R		 		mov	ds:video_buf_siz,cx	; (0040:004C=1000h)
    3434				; set cursor position to upper-left corner in each page
    3435 111B  B9 0008			 		mov	cx,8			; 8 pages
    3436 111E  BF 0050 R		 		mov	di,offset vid_curs_pos0	; (0040:0050=4Fh) bf 0050
    3437 1121  1E			 		push	ds
    3438 1122  07			 		pop	es
    3439 1123  33 C0			 		xor	ax,ax
    3440 1125  F3/ AB			 		rep	stosw			; set cursor position to 0
    3441				
    3442 1127  42			 		inc	dx
    3443 1128  B0 30			 		mov	al,30h			; assume NOT mode 7 
    3444 112A  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	; is it mode 7
    3445 112F  75 02			 		jne	loc_199			; no, continue
    3446 1131  B0 3F			 		mov	al,3Fh			; yes, set palette byte for 640x200 BW
    3447				
    3448 1133				loc_199:					;  xref A.112E
    3449 1133  EE			 		out	dx,al			; port 3D9h, CGA color control
    3450 1134  A2 0066 R		 		mov	ds:video_color,al	; (0040:0066=30h) save color palette
    3451				;a.1136
    3452 1137				loc_200:					;  xref A.1081, 1147, 1176, 11C0
    3453				 						;            11DC, 1252, 12F3, 1331
    3454				 						;            1350, 1361, 1380, 141C
    3455				 						;            147C, 14FC, 155C, 15E0
    3456				 						;            16A9
    3457 1137  5F			 		pop	di
    3458 1138  5E			 		pop	si
    3459 1139  5B			 		pop	bx
    3460 113A				loc_201:					;  xref A.11F7
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-64


    3461 113A  59			 		pop	cx
    3462 113B  5A			 		pop	dx
    3463 113C  1F			 		pop	ds
    3464 113D  07			 		pop	es
    3465 113E  CF			 		iret				; Interrupt return
    3466				
    3467				
    3468				;--- SET CTYPE -----------------------------------------------------------------
    3469 113F				SET_CTYPE:					;  xref A.0FD3, 101B
    3470 113F  B4 0A			 		mov	ah,0Ah
    3471 1141  89 0E 0060 R		 		mov	ds:vid_curs_mode,cx	; (0040:0060=2000h)
    3472 1145  E8 114A R		 		call	sub_33			; (1149)
    3473 1148  EB ED			 		jmp	short loc_200		; (1136)
    3474				
    3475				;===============================================================================
    3476				 ;                              SUBROUTINE
    3477				 ;
    3478				 ;         Called from:   A.1144, 1185, 11B3
    3479				;===============================================================================
    3480				;a.1149
    3481 114A				sub_33		proc	near
    3482 114A  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3483 114E  8A C4			 		mov	al,ah
    3484 1150  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    3485				 						;  al = 0Ah, cursor start, mode
    3486 1151  42			 		inc	dx
    3487 1152  8A C5			 		mov	al,ch
    3488 1154  EE			 		out	dx,al			; port 3D5h, CGA/EGA indxd data
    3489 1155  4A			 		dec	dx
    3490 1156  8A C4			 		mov	al,ah
    3491 1158  FE C0			 		inc	al
    3492 115A  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    3493				 						;  al = 0Bh, cursor end
    3494 115B  42			 		inc	dx
    3495 115C  8A C1			 		mov	al,cl
    3496 115E  EE			 		out	dx,al			; port 3D5h, CGA/EGA indxd data
    3497 115F  C3			 		retn
    3498 1160				sub_33		endp
    3499				
    3500				
    3501				;--- SET CPOS ------------------------------------------------------------------
    3502				;a.115f
    3503 1160				SET_CPOS:					;  xref A.0FD5, 101B
    3504 1160  8A CF			 		mov	cl,bh
    3505 1162  32 ED			 		xor	ch,ch			; Zero register
    3506 1164  D1 E1			 		shl	cx,1			; Shift w/zeros fill
    3507 1166  8B F1			 		mov	si,cx
    3508 1168  89 94 0050 R		 		mov	ds:vid_curs_pos0[si],dx	; (0040:0050=184Fh)
    3509 116C  38 3E 0062 R		 		cmp	ds:video_page,bh	; (0040:0062=0)
    3510 1170  75 05			 		jne	loc_204			; Jump if not equal
    3511 1172  8B C2			 		mov	ax,dx
    3512 1174  E8 1179 R		 		call	sub_34			; (1178)
    3513 1177				loc_204:					;  xref A.116F
    3514 1177  EB BE			 		jmp	short loc_200		; (1136)
    3515				
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-65


    3516				;===============================================================================
    3517				 ;                              SUBROUTINE
    3518				 ;
    3519				 ;         Called from:   A.1173, 11BD
    3520				;===============================================================================
    3521				;a.1178
    3522 1179				sub_34		proc	near
    3523 1179  E8 11FB R		 		call	sub_35			; (11FA)
    3524 117C  8B C8			 		mov	cx,ax
    3525 117E  03 0E 004E R		 		add	cx,ds:video_segment	; (0040:004E=0)
    3526 1182  D1 F9			 		sar	cx,1			; Shift w/sign fill
    3527 1184  B4 0E			 		mov	ah,0Eh
    3528 1186  E8 114A R		 		call	sub_33			; (1149)
    3529 1189  C3			 		retn
    3530 118A				sub_34		endp
    3531				
    3532				
    3533				;--- READ CURSOR ---------------------------------------------------------------
    3534				;a.1189
    3535 118A				READ_CURSOR:					;  xref A.0FD7, 101B
    3536 118A  8A DF			 		mov	bl,bh
    3537 118C  32 FF			 		xor	bh,bh			; Zero register
    3538 118E  D1 E3			 		shl	bx,1			; Shift w/zeros fill
    3539 1190  8B 97 0050 R		 		mov	dx,ds:vid_curs_pos0[bx]	; (0040:0050=184Fh)
    3540 1194  8B 0E 0060 R		 		mov	cx,ds:vid_curs_mode	; (0040:0060=2000h)
    3541 1198  5F			 		pop	di
    3542 1199  5E			 		pop	si
    3543 119A  5B			 		pop	bx
    3544 119B  58			 		pop	ax
    3545 119C  58			 		pop	ax
    3546 119D  1F			 		pop	ds
    3547 119E  07			 		pop	es
    3548 119F  CF			 		iret				; Interrupt return
    3549				
    3550				;--- ACT DISP PAGE -------------------------------------------------------------
    3551				;a.119f
    3552 11A0				ACT_DISP_PAGE:					;  xref A.0FDB, 101B
    3553 11A0  A2 0062 R		 		mov	ds:video_page,al	; (0040:0062=0)
    3554 11A3  8B 0E 004C R		 		mov	cx,ds:video_buf_siz	; (0040:004C=1000h)
    3555 11A7  98			 		cbw				; Convrt byte to word
    3556 11A8  50			 		push	ax
    3557 11A9  F7 E1			 		mul	cx			; dx:ax = reg * ax
    3558 11AB  A3 004E R		 		mov	ds:video_segment,ax	; (0040:004E=0)
    3559 11AE  8B C8			 		mov	cx,ax
    3560 11B0  D1 F9			 		sar	cx,1			; Shift w/sign fill
    3561 11B2  B4 0C			 		mov	ah,0Ch
    3562 11B4  E8 114A R		 		call	sub_33			; (1149)
    3563 11B7  5B			 		pop	bx
    3564 11B8  D1 E3			 		shl	bx,1			; Shift w/zeros fill
    3565 11BA  8B 87 0050 R		 		mov	ax,ds:vid_curs_pos0[bx]	; (0040:0050=184Fh)
    3566 11BE  E8 1179 R		 		call	sub_34			; (1178)
    3567 11C1  E9 1137 R		 		jmp	loc_200			; (1136)
    3568				
    3569				;--- SET COLOR -----------------------------------------------------------------
    3570				;a.11c3
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-66


    3571 11C4				SET_COLOR:					;  xref A.0FE7, 101B
    3572 11C4  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3573 11C8  83 C2 05			 		add	dx,5
    3574 11CB  A0 0066 R		 		mov	al,ds:video_color	; (0040:0066=30h)
    3575 11CE  0A FF			 		or	bh,bh			; Zero ?
    3576 11D0  75 0E			 		jnz	loc_209			; Jump if not zero
    3577 11D2  24 E0			 		and	al,0E0h
    3578 11D4  80 E3 1F			 		and	bl,1Fh
    3579 11D7  0A C3			 		or	al,bl
    3580 11D9				loc_208:					;  xref A.11E3, 11E7
    3581 11D9  EE			 		out	dx,al			; port 3D9h, CGA color control
    3582 11DA  A2 0066 R		 		mov	ds:video_color,al	; (0040:0066=30h)
    3583 11DD  E9 1137 R		 		jmp	loc_200			; (1136)
    3584 11E0				loc_209:					;  xref A.11CF
    3585 11E0  24 DF			 		and	al,0DFh
    3586 11E2  D0 EB			 		shr	bl,1			; Shift w/zeros fill
    3587 11E4  73 F3			 		jnc	loc_208			; Jump if carry=0
    3588 11E6  0C 20			 		or	al,20h			; ' '
    3589 11E8  EB EF			 		jmp	short loc_208		; (11D8)
    3590				
    3591				;--- VIDEO STATE ---------------------------------------------------------------
    3592				;a.11e9
    3593 11EA				VIDEO_STATE:					;  xref A.0FEF, 101B
    3594 11EA  8A 26 004A R		 		mov	ah,byte ptr ds:video_columns	; (0040:004A=50h)
    3595 11EE  A0 0049 R		 		mov	al,ds:video_mode	; (0040:0049=3)
    3596 11F1  8A 3E 0062 R		 		mov	bh,ds:video_page	; (0040:0062=0)
    3597 11F5  5F			 		pop	di
    3598 11F6  5E			 		pop	si
    3599 11F7  59			 		pop	cx
    3600 11F8  E9 113A R		 		jmp	loc_201			; (1139)
    3601				
    3602				;===============================================================================
    3603				 ;                              SUBROUTINE
    3604				 ;
    3605				 ;         Called from:   A.1178, 1259, 130C
    3606				;===============================================================================
    3607				;a.11fa
    3608 11FB				sub_35		proc	near
    3609 11FB  53			 		push	bx
    3610 11FC  8B D8			 		mov	bx,ax
    3611 11FE  8A C4			 		mov	al,ah
    3612 1200  F6 26 004A R		 		mul	byte ptr ds:video_columns	; (0040:004A=50h) ax = data * al
    3613 1204  32 FF			 		xor	bh,bh			; Zero register
    3614 1206  03 C3			 		add	ax,bx
    3615 1208  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    3616 120A  5B			 		pop	bx
    3617 120B  C3			 		retn
    3618 120C				sub_35		endp
    3619				
    3620				
    3621				;--- SCROLL UP -----------------------------------------------------------------
    3622				;a.120b
    3623 120C				SCROLL_UP:					;  xref A.0FDD, 101B
    3624 120C  8A D8			 		mov	bl,al
    3625 120E  80 FC 04			 		cmp	ah,4
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-67


    3626 1211  72 08			 		jb	loc_212			; Jump if below
    3627 1213  80 FC 07			 		cmp	ah,7
    3628 1216  74 03			 		je	loc_212			; Jump if equal
    3629 1218  E9 13CB R		 		jmp	loc_244			; (13CA)
    3630 121B				loc_212:					;  xref A.1210, 1215
    3631 121B  53			 		push	bx
    3632 121C  8B C1			 		mov	ax,cx
    3633 121E  E8 125A R		 		call	sub_36			; (1259)
    3634 1221  74 33			 		jz	loc_218			; Jump if zero
    3635 1223  03 F0			 		add	si,ax
    3636 1225  8A E6			 		mov	ah,dh
    3637 1227  2A E3			 		sub	ah,bl
    3638 1229				loc_213:					;  xref A.1231
    3639 1229  E8 1281 R		 		call	sub_37			; (1280)
    3640 122C  03 F5			 		add	si,bp
    3641 122E  03 FD			 		add	di,bp
    3642 1230  FE CC			 		dec	ah
    3643 1232  75 F5			 		jnz	loc_213			; Jump if not zero
    3644 1234				loc_214:					;  xref A.1257
    3645 1234  58			 		pop	ax
    3646 1235  B0 20			 		mov	al,20h			; ' '
    3647 1237				loc_215:					;  xref A.123D
    3648 1237  E8 128A R		 		call	sub_38			; (1289)
    3649 123A  03 FD			 		add	di,bp
    3650 123C  FE CB			 		dec	bl
    3651 123E  75 F7			 		jnz	loc_215			; Jump if not zero
    3652 1240				loc_216:					;  xref A.12C5
    3653 1240  B8 0040			 		mov	ax,40h
    3654 1243  8E D8			 		mov	ds,ax
    3655 1245  80 3E 0049 R 07		 		cmp	byte ptr ds:video_mode,7	; (0040:0049=3)
    3656 124A  74 07			 		je	loc_217			; Jump if equal
    3657 124C  A0 0065 R		 		mov	al,ds:video_mode_reg	; (0040:0065=29h)
    3658 124F  BA 03D8			 		mov	dx,3D8h
    3659 1252  EE			 		out	dx,al			; port 3D8h, CGA video control
    3660 1253				loc_217:					;  xref A.1249
    3661 1253  E9 1137 R		 		jmp	loc_200			; (1136)
    3662 1256				loc_218:					;  xref A.1220
    3663 1256  8A DE			 		mov	bl,dh
    3664 1258  EB DA			 		jmp	short loc_214		; (1233)
    3665				
    3666				;===============================================================================
    3667				 ;                              SUBROUTINE
    3668				 ;
    3669				 ;         Called from:   A.121D, 12A3
    3670				;===============================================================================
    3671				;a.1259
    3672 125A				sub_36		proc	near
    3673 125A  E8 11FB R		 		call	sub_35			; (11FA)
    3674 125D  03 06 004E R		 		add	ax,ds:video_segment	; (0040:004E=0)
    3675 1261  8B F8			 		mov	di,ax
    3676 1263  8B F0			 		mov	si,ax
    3677 1265  2B D1			 		sub	dx,cx
    3678 1267  FE C6			 		inc	dh
    3679 1269  FE C2			 		inc	dl
    3680 126B  32 ED			 		xor	ch,ch			; Zero register
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-68


    3681 126D  8B 2E 004A R		 		mov	bp,ds:video_columns	; (0040:004A=50h)
    3682 1271  03 ED			 		add	bp,bp
    3683 1273  8A C3			 		mov	al,bl
    3684 1275  F6 26 004A R		 		mul	byte ptr ds:video_columns	; (0040:004A=50h) ax = data * al
    3685 1279  03 C0			 		add	ax,ax
    3686 127B  06			 		push	es
    3687 127C  1F			 		pop	ds
    3688 127D  80 FB 00			 		cmp	bl,0
    3689 1280  C3			 		retn
    3690 1281				sub_36		endp
    3691				
    3692				
    3693				;===============================================================================
    3694				 ;                              SUBROUTINE
    3695				 ;
    3696				 ;         Called from:   A.1228, 12AE
    3697				;===============================================================================
    3698				;a.1280
    3699 1281				sub_37		proc	near
    3700 1281  8A CA			 		mov	cl,dl
    3701 1283  56			 		push	si
    3702 1284  57			 		push	di
    3703 1285  F3/ A5			 		rep	movsw			; Rep when cx >0 Mov [si] to es:[di]
    3704 1287  5F			 		pop	di
    3705 1288  5E			 		pop	si
    3706 1289  C3			 		retn
    3707 128A				sub_37		endp
    3708				
    3709				
    3710				;===============================================================================
    3711				 ;                              SUBROUTINE
    3712				 ;
    3713				 ;         Called from:   A.1236, 12BC
    3714				;===============================================================================
    3715				;a.1289
    3716 128A				sub_38		proc	near
    3717 128A  8A CA			 		mov	cl,dl
    3718 128C  57			 		push	di
    3719 128D  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
    3720 128F  5F			 		pop	di
    3721 1290  C3			 		retn
    3722 1291				sub_38		endp
    3723				
    3724				
    3725				;--- SCROLL DOWN ---------------------------------------------------------------
    3726				;a.1290
    3727 1291				SCROLL_DOWN:					;  xref A.0FDF, 101B
    3728 1291  FD			 		std				; Set direction flag
    3729 1292  8A D8			 		mov	bl,al
    3730 1294  80 FC 04			 		cmp	ah,4
    3731 1297  72 08			 		jb	loc_220			; Jump if below
    3732 1299  80 FC 07			 		cmp	ah,7
    3733 129C  74 03			 		je	loc_220			; Jump if equal
    3734 129E  E9 1424 R		 		jmp	loc_250			; (1423)
    3735 12A1				loc_220:					;  xref A.1296, 129B
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-69


    3736 12A1  53			 		push	bx
    3737 12A2  8B C2			 		mov	ax,dx
    3738 12A4  E8 125A R		 		call	sub_36			; (1259)
    3739 12A7  74 20			 		jz	loc_224			; Jump if zero
    3740 12A9  2B F0			 		sub	si,ax
    3741 12AB  8A E6			 		mov	ah,dh
    3742 12AD  2A E3			 		sub	ah,bl
    3743 12AF				loc_221:					;  xref A.12B7
    3744 12AF  E8 1281 R		 		call	sub_37			; (1280)
    3745 12B2  2B F5			 		sub	si,bp
    3746 12B4  2B FD			 		sub	di,bp
    3747 12B6  FE CC			 		dec	ah
    3748 12B8  75 F5			 		jnz	loc_221			; Jump if not zero
    3749 12BA				loc_222:					;  xref A.12CA
    3750 12BA  58			 		pop	ax
    3751 12BB  B0 20			 		mov	al,20h			; ' '
    3752 12BD				loc_223:					;  xref A.12C3
    3753 12BD  E8 128A R		 		call	sub_38			; (1289)
    3754 12C0  2B FD			 		sub	di,bp
    3755 12C2  FE CB			 		dec	bl
    3756 12C4  75 F7			 		jnz	loc_223			; Jump if not zero
    3757 12C6  E9 1240 R		 		jmp	loc_216			; (123F)
    3758 12C9				loc_224:					;  xref A.12A6
    3759 12C9  8A DE			 		mov	bl,dh
    3760 12CB  EB ED			 		jmp	short loc_222		; (12B9)
    3761				
    3762				
    3763				;--- READ AC CURRENT -----------------------------------------------------------
    3764				;a.12cc
    3765 12CD				READ_AC_CURRENT:					;  xref A.0FE1, 101B
    3766 12CD  80 FC 04			 		cmp	ah,4
    3767 12D0  72 08			 		jb	loc_226			; Jump if below
    3768 12D2  80 FC 07			 		cmp	ah,7
    3769 12D5  74 03			 		je	loc_226			; Jump if equal
    3770 12D7  E9 1560 R		 		jmp	loc_268			; (155F)
    3771 12DA				loc_226:					;  xref A.12CF, 12D4
    3772 12DA  E8 12F7 R		 		call	sub_39			; (12F6)
    3773 12DD  8B F3			 		mov	si,bx
    3774 12DF  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3775 12E3  83 C2 06			 		add	dx,6
    3776 12E6  06			 		push	es
    3777 12E7  1F			 		pop	ds
    3778 12E8				loc_227:					;  xref A.12EA
    3779 12E8  EC			 		in	al,dx			; port 3DAh, CGA/EGA vid status
    3780 12E9  A8 01			 		test	al,1
    3781 12EB  75 FB			 		jnz	loc_227			; Jump if not zero
    3782 12ED  FA			 		cli				; Disable interrupts
    3783 12EE				loc_228:					;  xref A.12F0
    3784 12EE  EC			 		in	al,dx			; port 3DAh, CGA/EGA vid status
    3785 12EF  A8 01			 		test	al,1
    3786 12F1  74 FB			 		jz	loc_228			; Jump if zero
    3787 12F3  AD			 		lodsw				; String [si] to ax
    3788 12F4  E9 1137 R		 		jmp	loc_200			; (1136)
    3789				
    3790				;===============================================================================
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-70


    3791				 ;                              SUBROUTINE
    3792				 ;
    3793				 ;         Called from:   A.12D9, 1323, 1343
    3794				;===============================================================================
    3795				;a.12f6
    3796 12F7				sub_39		proc	near
    3797 12F7  8A CF			 		mov	cl,bh
    3798 12F9  32 ED			 		xor	ch,ch			; Zero register
    3799 12FB  8B F1			 		mov	si,cx
    3800 12FD  D1 E6			 		shl	si,1			; Shift w/zeros fill
    3801 12FF  8B 84 0050 R		 		mov	ax,ds:vid_curs_pos0[si]	; (0040:0050=184Fh)
    3802 1303  33 DB			 		xor	bx,bx			; Zero register
    3803 1305  E3 06			 		jcxz	loc_230			; Jump if cx=0
    3804				
    3805 1307				locloop_229:					;  xref A.130A
    3806 1307  03 1E 004C R		 		add	bx,ds:video_buf_siz	; (0040:004C=1000h)
    3807 130B  E2 FA			 		loop	locloop_229		; Loop if cx > 0
    3808				
    3809 130D				loc_230:					;  xref A.1304
    3810 130D  E8 11FB R		 		call	sub_35			; (11FA)
    3811 1310  03 D8			 		add	bx,ax
    3812 1312  C3			 		retn
    3813 1313				sub_39		endp
    3814				
    3815				
    3816				;--- WRITE AC CURRENT ----------------------------------------------------------
    3817				;a.1312
    3818 1313				WRITE_AC_CURRENT:					;  xref A.0FE3, 101B
    3819 1313  80 FC 04			 		cmp	ah,4
    3820 1316  72 08			 		jb	loc_232			; Jump if below
    3821 1318  80 FC 07			 		cmp	ah,7
    3822 131B  74 03			 		je	loc_232			; Jump if equal
    3823 131D  E9 14AE R		 		jmp	loc_256			; (14AD)
    3824 1320				loc_232:					;  xref A.1315, 131A
    3825 1320  8A E3			 		mov	ah,bl
    3826 1322  50			 		push	ax
    3827 1323  51			 		push	cx
    3828 1324  E8 12F7 R		 		call	sub_39			; (12F6)
    3829 1327  8B FB			 		mov	di,bx
    3830 1329  59			 		pop	cx
    3831 132A  5B			 		pop	bx
    3832				
    3833 132B				locloop_233:					;  xref A.132F
    3834 132B  FA			 		cli				; Disable interrupts
    3835 132C  8B C3			 		mov	ax,bx
    3836 132E  AB			 		stosw				; Store ax to es:[di]
    3837 132F  FB			 		sti				; Enable interrupts
    3838 1330  E2 F9			 		loop	locloop_233		; Loop if cx > 0
    3839				
    3840 1332  E9 1137 R		 		jmp	loc_200			; (1136)
    3841				
    3842				;--- WRITE C CURRENT -----------------------------------------------------------
    3843				;a.1334
    3844 1335				WRITE_C_CURRENT:					;  xref A.0FE5, 101B
    3845 1335  80 FC 04			 		cmp	ah,4
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-71


    3846 1338  72 08			 		jb	loc_235			; Jump if below
    3847 133A  80 FC 07			 		cmp	ah,7
    3848 133D  74 03			 		je	loc_235			; Jump if equal
    3849 133F  E9 14AE R		 		jmp	loc_256			; (14AD)
    3850 1342				loc_235:					;  xref A.1337, 133C
    3851 1342  50			 		push	ax
    3852 1343  51			 		push	cx
    3853 1344  E8 12F7 R		 		call	sub_39			; (12F6)
    3854 1347  8B FB			 		mov	di,bx
    3855 1349  59			 		pop	cx
    3856 134A  5B			 		pop	bx
    3857				
    3858 134B				locloop_236:					;  xref A.134E
    3859 134B  8A C3			 		mov	al,bl
    3860 134D  AA			 		stosb				; Store al to es:[di]
    3861 134E  47			 		inc	di
    3862 134F  E2 FA			 		loop	locloop_236		; Loop if cx > 0
    3863				
    3864 1351  E9 1137 R		 		jmp	loc_200			; (1136)
    3865				
    3866				;--- READ DOT ------------------------------------------------------------------
    3867				;a.1353
    3868 1354				READ_DOT:					;  xref A.0FEB, 101B
    3869 1354  E8 1388 R		 		call	sub_40			; (1387)
    3870 1357  26: 8A 04		 		mov	al,es:[si]
    3871 135A  22 C4			 		and	al,ah
    3872 135C  D2 E0			 		shl	al,cl			; Shift w/zeros fill
    3873 135E  8A CE			 		mov	cl,dh
    3874 1360  D2 C0			 		rol	al,cl			; Rotate
    3875 1362  E9 1137 R		 		jmp	loc_200			; (1136)
    3876				
    3877				;--- WRITE DOT -----------------------------------------------------------------
    3878				;a.1364
    3879 1365				WRITE_DOT:					;  xref A.0FE9, 101B
    3880 1365  50			 		push	ax
    3881 1366  50			 		push	ax
    3882 1367  E8 1388 R		 		call	sub_40			; (1387)
    3883 136A  D2 E8			 		shr	al,cl			; Shift w/zeros fill
    3884 136C  22 C4			 		and	al,ah
    3885 136E  26: 8A 0C		 		mov	cl,es:[si]
    3886 1371  5B			 		pop	bx
    3887 1372  F6 C3 80			 		test	bl,80h
    3888 1375  75 0D			 		jnz	loc_240			; Jump if not zero
    3889 1377  F6 D4			 		not	ah
    3890 1379  22 CC			 		and	cl,ah
    3891 137B  0A C1			 		or	al,cl
    3892 137D				loc_239:					;  xref A.1385
    3893 137D  26: 88 04		 		mov	es:[si],al
    3894 1380  58			 		pop	ax
    3895 1381  E9 1137 R		 		jmp	loc_200			; (1136)
    3896 1384				loc_240:					;  xref A.1374
    3897 1384  32 C1			 		xor	al,cl
    3898 1386  EB F5			 		jmp	short loc_239		; (137C)
    3899				
    3900				;===============================================================================
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-72


    3901				 ;                              SUBROUTINE
    3902				 ;
    3903				 ;         Called from:   A.1353, 1366
    3904				;===============================================================================
    3905				;a.1387
    3906 1388				sub_40		proc	near
    3907 1388  53			 		push	bx
    3908 1389  50			 		push	ax
    3909 138A  B0 28			 		mov	al,28h			; '('
    3910 138C  52			 		push	dx
    3911 138D  80 E2 FE			 		and	dl,0FEh
    3912 1390  F6 E2			 		mul	dl			; ax = reg * al
    3913 1392  5A			 		pop	dx
    3914 1393  F6 C2 01			 		test	dl,1
    3915 1396  74 03			 		jz	loc_241			; Jump if zero
    3916 1398  05 2000			 		add	ax,2000h
    3917 139B				loc_241:					;  xref A.1395
    3918 139B  8B F0			 		mov	si,ax
    3919 139D  58			 		pop	ax
    3920 139E  8B D1			 		mov	dx,cx
    3921 13A0  BB 02C0			 		mov	bx,2C0h
    3922 13A3  B9 0302			 		mov	cx,302h
    3923 13A6  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	; (0040:0049=3)
    3924 13AB  72 06			 		jb	loc_242			; Jump if below
    3925 13AD  BB 0180			 		mov	bx,180h
    3926 13B0  B9 0703			 		mov	cx,703h
    3927 13B3				loc_242:					;  xref A.13AA
    3928 13B3  22 EA			 		and	ch,dl
    3929 13B5  D3 EA			 		shr	dx,cl			; Shift w/zeros fill
    3930 13B7  03 F2			 		add	si,dx
    3931 13B9  8A F7			 		mov	dh,bh
    3932 13BB  2A C9			 		sub	cl,cl
    3933 13BD				loc_243:					;  xref A.13C2
    3934 13BD  D0 C8			 		ror	al,1			; Rotate
    3935 13BF  02 CD			 		add	cl,ch
    3936 13C1  FE CF			 		dec	bh
    3937 13C3  75 F8			 		jnz	loc_243			; Jump if not zero
    3938 13C5  8A E3			 		mov	ah,bl
    3939 13C7  D2 EC			 		shr	ah,cl			; Shift w/zeros fill
    3940 13C9  5B			 		pop	bx
    3941 13CA  C3			 		retn
    3942 13CB				sub_40		endp
    3943				
    3944				;a.13ca
    3945 13CB				loc_244:					;  xref A.1217
    3946 13CB  8A D8			 		mov	bl,al
    3947 13CD  8B C1			 		mov	ax,cx
    3948 13CF  E8 163C R		 		call	sub_47			; (163B)
    3949 13D2  8B F8			 		mov	di,ax
    3950 13D4  2B D1			 		sub	dx,cx
    3951 13D6  81 C2 0101		 		add	dx,101h
    3952 13DA  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3953 13DC  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3954 13DE  80 3E 0049 R 06		 		cmp	byte ptr ds:[video_mode],6	; (A.0049=66h)
    3955 13E3  73 04			 		jae	loc_245			; Jump if above or =
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-73


    3956 13E5  D0 E2			 		shl	dl,1			; Shift w/zeros fill
    3957 13E7  D1 E7			 		shl	di,1			; Shift w/zeros fill
    3958 13E9				loc_245:					;  xref A.13E2
    3959 13E9  06			 		push	es
    3960 13EA  1F			 		pop	ds
    3961 13EB  2A ED			 		sub	ch,ch
    3962 13ED  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    3963 13EF  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    3964 13F1  74 2D			 		jz	loc_249			; Jump if zero
    3965 13F3  8A C3			 		mov	al,bl
    3966 13F5  B4 50			 		mov	ah,50h			; 'P'
    3967 13F7  F6 E4			 		mul	ah			; ax = reg * al
    3968 13F9  8B F7			 		mov	si,di
    3969 13FB  03 F0			 		add	si,ax
    3970 13FD  8A E6			 		mov	ah,dh
    3971 13FF  2A E3			 		sub	ah,bl
    3972 1401				loc_246:					;  xref A.140D
    3973 1401  E8 1484 R		 		call	sub_41			; (1483)
    3974 1404  81 EE 1FB0		 		sub	si,1FB0h
    3975 1408  81 EF 1FB0		 		sub	di,1FB0h
    3976 140C  FE CC			 		dec	ah
    3977 140E  75 F1			 		jnz	loc_246			; Jump if not zero
    3978 1410				loc_247:					;  xref A.1421
    3979 1410  8A C7			 		mov	al,bh
    3980 1412				loc_248:					;  xref A.141A
    3981 1412  E8 149D R		 		call	sub_42			; (149C)
    3982 1415  81 EF 1FB0		 		sub	di,1FB0h
    3983 1419  FE CB			 		dec	bl
    3984 141B  75 F5			 		jnz	loc_248			; Jump if not zero
    3985 141D  E9 1137 R		 		jmp	loc_200			; (1136)
    3986 1420				loc_249:					;  xref A.13F0
    3987 1420  8A DE			 		mov	bl,dh
    3988 1422  EB EC			 		jmp	short loc_247		; (140F)
    3989				;a.1423
    3990 1424				loc_250:					;  xref A.129D
    3991 1424  FD			 		std				; Set direction flag
    3992 1425  8A D8			 		mov	bl,al
    3993 1427  8B C2			 		mov	ax,dx
    3994 1429  E8 163C R		 		call	sub_47			; (163B)
    3995 142C  8B F8			 		mov	di,ax
    3996 142E  2B D1			 		sub	dx,cx
    3997 1430  81 C2 0101		 		add	dx,101h
    3998 1434  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3999 1436  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    4000 1438  80 3E 0049 R 06		 		cmp	byte ptr ds:[video_mode],6	; (A.0049=66h)
    4001 143D  73 05			 		jae	loc_251			; Jump if above or =
    4002 143F  D0 E2			 		shl	dl,1			; Shift w/zeros fill
    4003 1441  D1 E7			 		shl	di,1			; Shift w/zeros fill
    4004 1443  47			 		inc	di
    4005				;a.1443
    4006 1444				loc_251:					;  xref A.143C
    4007 1444  06			 		push	es
    4008 1445  1F			 		pop	ds
    4009 1446  2A ED			 		sub	ch,ch
    4010 1448  81 C7 00F0 R		 		add	di,offset data_79+1	; (A.00F0=46h)
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-74


    4011 144C  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    4012 144E  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    4013 1450  74 2E			 		jz	loc_255			; Jump if zero
    4014 1452  8A C3			 		mov	al,bl
    4015 1454  B4 50			 		mov	ah,50h			; 'P'
    4016 1456  F6 E4			 		mul	ah			; ax = reg * al
    4017 1458  8B F7			 		mov	si,di
    4018 145A  2B F0			 		sub	si,ax
    4019 145C  8A E6			 		mov	ah,dh
    4020 145E  2A E3			 		sub	ah,bl
    4021 1460				loc_252:					;  xref A.146C
    4022 1460  E8 1484 R		 		call	sub_41			; (1483)
    4023 1463  81 EE 2050		 		sub	si,2050h
    4024 1467  81 EF 2050		 		sub	di,2050h
    4025 146B  FE CC			 		dec	ah
    4026 146D  75 F1			 		jnz	loc_252			; Jump if not zero
    4027 146F				loc_253:					;  xref A.1481
    4028 146F  8A C7			 		mov	al,bh
    4029 1471				loc_254:					;  xref A.1479
    4030 1471  E8 149D R		 		call	sub_42			; (149C)
    4031 1474  81 EF 2050		 		sub	di,2050h
    4032 1478  FE CB			 		dec	bl
    4033 147A  75 F5			 		jnz	loc_254			; Jump if not zero
    4034 147C  FC			 		cld				; Clear direction
    4035 147D  E9 1137 R		 		jmp	loc_200			; (1136)
    4036 1480				loc_255:					;  xref A.144F
    4037 1480  8A DE			 		mov	bl,dh
    4038 1482  EB EB			 		jmp	short loc_253		; (146E)
    4039				
    4040				;===============================================================================
    4041				 ;                              SUBROUTINE
    4042				 ;
    4043				 ;         Called from:   A.1400, 145F
    4044				;===============================================================================
    4045				;a.1483
    4046 1484				sub_41		proc	near
    4047 1484  8A CA			 		mov	cl,dl
    4048 1486  56			 		push	si
    4049 1487  57			 		push	di
    4050 1488  F3/ A4			 		rep	movsb			; Rep when cx >0 Mov [si] to es:[di]
    4051 148A  5F			 		pop	di
    4052 148B  5E			 		pop	si
    4053 148C  81 C6 2000		 		add	si,2000h		;data_121e (A.2000=0)
    4054 1490  81 C7 2000		 		add	di,2000h		;data_121e (A.2000=0)
    4055 1494  56			 		push	si
    4056 1495  57			 		push	di
    4057 1496  8A CA			 		mov	cl,dl
    4058 1498  F3/ A4			 		rep	movsb			; Rep when cx >0 Mov [si] to es:[di]
    4059 149A  5F			 		pop	di
    4060 149B  5E			 		pop	si
    4061 149C  C3			 		retn
    4062 149D				sub_41		endp
    4063				
    4064				
    4065				;===============================================================================
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-75


    4066				 ;                              SUBROUTINE
    4067				 ;
    4068				 ;         Called from:   A.1411, 1470
    4069				;===============================================================================
    4070				;a.149c
    4071 149D				sub_42		proc	near
    4072 149D  8A CA			 		mov	cl,dl
    4073 149F  57			 		push	di
    4074 14A0  F3/ AA			 		rep	stosb			; Rep when cx >0 Store al to es:[di]
    4075 14A2  5F			 		pop	di
    4076 14A3  81 C7 2000		 		add	di,2000h		;data_121e (A.2000=0)
    4077 14A7  57			 		push	di
    4078 14A8  8A CA			 		mov	cl,dl
    4079 14AA  F3/ AA			 		rep	stosb			; Rep when cx >0 Store al to es:[di]
    4080 14AC  5F			 		pop	di
    4081 14AD  C3			 		retn
    4082 14AE				sub_42		endp
    4083				
    4084				;a.14ad
    4085 14AE				loc_256:					;  xref A.131C, 133E
    4086 14AE  B4 00			 		mov	ah,0
    4087 14B0  50			 		push	ax
    4088 14B1  E8 1639 R		 		call	sub_46			; (1638)
    4089 14B4  8B F8			 		mov	di,ax
    4090 14B6  58			 		pop	ax
    4091 14B7  3C 80			 		cmp	al,80h
    4092 14B9  73 06			 		jae	loc_257			; Jump if above or =
    4093 14BB  BE 176E R		 		mov	si,offset GRAFIX	; (C000:176D=0)
    4094 14BE  0E			 		push	cs
    4095 14BF  EB 0F			 		jmp	short loc_258		; (14CF)
    4096 14C1				loc_257:					;  xref A.14B8
    4097 14C1  2C 80			 		sub	al,80h
    4098 14C3  1E			 		push	ds
    4099 14C4  2B F6			 		sub	si,si
    4100 14C6  8E DE			 		mov	ds,si
    4101 14C8  C5 36 007C		 		lds	si,dword ptr ds:Int1Fv	; (0000:007C=5E9h) Load seg:offset ptr
    4102 14CC  8C DA			 		mov	dx,ds
    4103 14CE  1F			 		pop	ds
    4104 14CF  52			 		push	dx
    4105 14D0				loc_258:					;  xref A.14BE
    4106 14D0  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4107 14D2  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4108 14D4  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4109 14D6  03 F0			 		add	si,ax
    4110 14D8  80 3E 0049 R 06		 		cmp	byte ptr ds:[video_mode],6	; (A.0049=66h)
    4111 14DD  1F			 		pop	ds
    4112 14DE  72 2C			 		jc	loc_263			; Jump if carry Set
    4113				
    4114				;a.14df
    4115 14E0				locloop_259:					;  xref A.14FA
    4116 14E0  57			 		push	di
    4117 14E1  56			 		push	si
    4118 14E2  B6 04			 		mov	dh,4
    4119 14E4				loc_260:					;  xref A.14F5
    4120 14E4  AC			 		lodsb				; String [si] to al
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-76


    4121 14E5  F6 C3 80			 		test	bl,80h
    4122 14E8  75 16			 		jnz	loc_262			; Jump if not zero
    4123 14EA  AA			 		stosb				; Store al to es:[di]
    4124 14EB  AC			 		lodsb				; String [si] to al
    4125 14EC				loc_261:					;  xref A.1509
    4126 14EC  26: 88 85 1FFF R		 		mov	byte ptr es:cksumb[di],al	; (A.1FFF=0E6h)
    4127 14F1  83 C7 4F			 		add	di,4Fh
    4128 14F4  FE CE			 		dec	dh
    4129 14F6  75 EC			 		jnz	loc_260			; Jump if not zero
    4130 14F8  5E			 		pop	si
    4131 14F9  5F			 		pop	di
    4132 14FA  47			 		inc	di
    4133 14FB  E2 E3			 		loop	locloop_259		; Loop if cx > 0
    4134				
    4135 14FD  E9 1137 R		 		jmp	loc_200			; (1136)
    4136 1500				loc_262:					;  xref A.14E7
    4137 1500  26: 32 05		 		xor	al,es:[di]
    4138 1503  AA			 		stosb				; Store al to es:[di]
    4139 1504  AC			 		lodsb				; String [si] to al
    4140 1505  26: 32 85 1FFF R		 		xor	al,byte ptr es:cksumb[di]	; (A.1FFF=0E6h)
    4141 150A  EB E0			 		jmp	short loc_261		; (14EB)
    4142 150C				loc_263:					;  xref A.14DD
    4143 150C  8A D3			 		mov	dl,bl
    4144 150E  D1 E7			 		shl	di,1			; Shift w/zeros fill
    4145 1510  E8 15E4 R		 		call	sub_43			; (15E3)
    4146				
    4147				;a.1512
    4148 1513				locloop_264:					;  xref A.155A
    4149 1513  57			 		push	di
    4150 1514  56			 		push	si
    4151 1515  B6 04			 		mov	dh,4
    4152 1517				loc_265:					;  xref A.1553
    4153 1517  AC			 		lodsb				; String [si] to al
    4154 1518  E8 15F9 R		 		call	sub_44			; (15F8)
    4155 151B  23 C3			 		and	ax,bx
    4156 151D  F6 C2 80			 		test	dl,80h
    4157 1520  74 07			 		jz	loc_266			; Jump if zero
    4158 1522  26: 32 25		 		xor	ah,es:[di]
    4159 1525  26: 32 45 01		 		xor	al,es:[di+1]
    4160 1529				loc_266:					;  xref A.151F
    4161 1529  26: 88 25		 		mov	es:[di],ah
    4162 152C  26: 88 45 01		 		mov	es:[di+1],al
    4163 1530  AC			 		lodsb				; String [si] to al
    4164 1531  E8 15F9 R		 		call	sub_44			; (15F8)
    4165 1534  23 C3			 		and	ax,bx
    4166 1536  F6 C2 80			 		test	dl,80h
    4167 1539  74 0A			 		jz	loc_267			; Jump if zero
    4168 153B  26: 32 A5 2000		 		xor	ah,es:data_121e[di]	; (A.2000=0)
    4169 1540  26: 32 85 2001		 		xor	al,es:data_122e[di]	; (A.2001=0)
    4170 1545				loc_267:					;  xref A.1538
    4171 1545  26: 88 A5 2000		 		mov	es:data_121e[di],ah	; (A.2000=0)
    4172 154A  26: 88 85 2001		 		mov	es:data_122e[di],al	; (A.2001=0)
    4173 154F  83 C7 50			 		add	di,50h
    4174 1552  FE CE			 		dec	dh
    4175 1554  75 C1			 		jnz	loc_265			; Jump if not zero
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-77


    4176 1556  5E			 		pop	si
    4177 1557  5F			 		pop	di
    4178 1558  83 C7 02			 		add	di,2
    4179 155B  E2 B6			 		loop	locloop_264		; Loop if cx > 0
    4180				
    4181 155D  E9 1137 R		 		jmp	loc_200			; (1136)
    4182 1560				loc_268:					;  xref A.12D6
    4183 1560  E8 1639 R		 		call	sub_46			; (1638)
    4184 1563  8B F0			 		mov	si,ax
    4185 1565  83 EC 08			 		sub	sp,8
    4186 1568  8B EC			 		mov	bp,sp
    4187				;***
    4188 156A  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	;data_123e,6 text 80x25/40x25
    4189 156F  06			 		push	es
    4190 1570  1F			 		pop	ds
    4191 1571  72 1A			 		jc	loc_270			; Jump if carry Set
    4192 1573  B6 04			 		mov	dh,4
    4193				;a.1574
    4194 1575				loc_269:					;  xref A.1587
    4195 1575  8A 04			 		mov	al,[si]
    4196 1577  88 46 00			 		mov	[bp],al
    4197 157A  45			 		inc	bp
    4198 157B  8A 84 2000		 		mov	al,ds:data_121e[si]	; (A.2000=0)
    4199 157F  88 46 00			 		mov	[bp],al
    4200 1582  45			 		inc	bp
    4201 1583  83 C6 50			 		add	si,50h
    4202 1586  FE CE			 		dec	dh
    4203 1588  75 EB			 		jnz	loc_269			; Jump if not zero
    4204 158A  EB 17			 		jmp	short loc_272		; (15A2)
    4205 158C  90			 		db	90h
    4206 158D				loc_270:					;  xref A.1570
    4207 158D  D1 E6			 		shl	si,1			; Shift w/zeros fill
    4208 158F  B6 04			 		mov	dh,4
    4209 1591				loc_271:					;  xref A.15A0
    4210 1591  E8 161C R		 		call	sub_45			; (161B)
    4211 1594  81 C6 2000		 		add	si,2000h		; data_121e (A.2000=0)
    4212 1598  E8 161C R		 		call	sub_45			; (161B)
    4213 159B  81 EE 1FB0		 		sub	si,1FB0h
    4214 159F  FE CE			 		dec	dh
    4215 15A1  75 EE			 		jnz	loc_271			; Jump if not zero
    4216 15A3				loc_272:					;  xref A.1589
    4217 15A3  BF 176E R		 		mov	di,offset GRAFIX		; (C000:176D=0)
    4218 15A6  0E			 		push	cs
    4219 15A7  07			 		pop	es
    4220 15A8  83 ED 08			 		sub	bp,8
    4221 15AB  8B F5			 		mov	si,bp
    4222 15AD  FC			 		cld				; Clear direction
    4223 15AE  B0 00			 		mov	al,0
    4224 15B0				loc_273:					;  xref A.15DB
    4225 15B0  16			 		push	ss
    4226 15B1  1F			 		pop	ds
    4227 15B2  BA 0080			 		mov	dx,80h
    4228				;a.15b4
    4229 15B5				loc_274:					;  xref A.15C5
    4230 15B5  56			 		push	si
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-78


    4231 15B6  57			 		push	di
    4232 15B7  B9 0008			 		mov	cx,8
    4233 15BA  F3/ A6			 		repe	cmpsb			; Rep zf=1+cx >0 Cmp [si] to es:[di]
    4234 15BC  5F			 		pop	di
    4235 15BD  5E			 		pop	si
    4236 15BE  74 1E			 		jz	loc_275			; Jump if zero
    4237 15C0  FE C0			 		inc	al
    4238 15C2  83 C7 08			 		add	di,8
    4239 15C5  4A			 		dec	dx
    4240 15C6  75 ED			 		jnz	loc_274			; Jump if not zero
    4241 15C8  3C 00			 		cmp	al,0
    4242 15CA  74 12			 		je	loc_275			; Jump if equal
    4243 15CC  2B C0			 		sub	ax,ax
    4244 15CE  8E D8			 		mov	ds,ax
    4245 15D0  C4 3E 007C		 		les	di,dword ptr ds:Int1Fv	; (0000:007C=5E9h) Load seg:offset ptr
    4246 15D4  8C C0			 		mov	ax,es
    4247 15D6  0B C7			 		or	ax,di
    4248 15D8  74 04			 		jz	loc_275			; Jump if zero
    4249 15DA  B0 80			 		mov	al,80h
    4250 15DC  EB D2			 		jmp	short loc_273		; (15AF)
    4251 15DE				loc_275:					;  xref A.15BD, 15C9, 15D7
    4252 15DE  83 C4 08			 		add	sp,8
    4253 15E1  E9 1137 R		 		jmp	loc_200			; (1136)
    4254				
    4255				;===============================================================================
    4256				 ;                              SUBROUTINE
    4257				 ;
    4258				 ;         Called from:   A.150F
    4259				;===============================================================================
    4260				;a.15e3
    4261 15E4				sub_43		proc	near
    4262 15E4  80 E3 03			 		and	bl,3
    4263 15E7  8A C3			 		mov	al,bl
    4264 15E9  51			 		push	cx
    4265 15EA  B9 0003			 		mov	cx,3
    4266				
    4267 15ED				locloop_276:					;  xref A.15F2
    4268 15ED  D0 E0			 		shl	al,1			; Shift w/zeros fill
    4269 15EF  D0 E0			 		shl	al,1			; Shift w/zeros fill
    4270 15F1  0A D8			 		or	bl,al
    4271 15F3  E2 F8			 		loop	locloop_276		; Loop if cx > 0
    4272				
    4273 15F5  8A FB			 		mov	bh,bl
    4274 15F7  59			 		pop	cx
    4275 15F8  C3			 		retn
    4276 15F9				sub_43		endp
    4277				
    4278				
    4279				;===============================================================================
    4280				 ;                              SUBROUTINE
    4281				 ;
    4282				 ;         Called from:   A.1517, 1530
    4283				;===============================================================================
    4284				;a.15f8
    4285 15F9				sub_44		proc	near
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-79


    4286 15F9  52			 		push	dx
    4287 15FA  51			 		push	cx
    4288 15FB  53			 		push	bx
    4289 15FC  BA 0000			 		mov	dx,0
    4290 15FF  B9 0001			 		mov	cx,1
    4291 1602				loc_277:					;  xref A.1613
    4292 1602  8B D8			 		mov	bx,ax
    4293 1604  23 D9			 		and	bx,cx
    4294 1606  0B D3			 		or	dx,bx
    4295 1608  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4296 160A  D1 E1			 		shl	cx,1			; Shift w/zeros fill
    4297 160C  8B D8			 		mov	bx,ax
    4298 160E  23 D9			 		and	bx,cx
    4299 1610  0B D1			 		or	dx,cx
    4300 1612  D1 E1			 		shl	cx,1			; Shift w/zeros fill
    4301 1614  73 EC			 		jnc	loc_277			; Jump if carry=0
    4302 1616  8B C2			 		mov	ax,dx
    4303 1618  5B			 		pop	bx
    4304 1619  59			 		pop	cx
    4305 161A  5A			 		pop	dx
    4306 161B  C3			 		retn
    4307 161C				sub_44		endp
    4308				
    4309				
    4310				;===============================================================================
    4311				 ;                              SUBROUTINE
    4312				 ;
    4313				 ;         Called from:   A.1590, 1597
    4314				;===============================================================================
    4315				;a.161b
    4316 161C				sub_45		proc	near
    4317 161C  8A 24			 		mov	ah,[si]
    4318 161E  8A 44 01			 		mov	al,[si+1]
    4319 1621  B9 C000			 		mov	cx,0C000h
    4320 1624  B2 00			 		mov	dl,0
    4321 1626				loc_278:					;  xref A.1631
    4322 1626  85 C1			 		test	ax,cx
    4323 1628  F8			 		clc				; Clear carry flag
    4324 1629  74 01			 		jz	loc_279			; Jump if zero
    4325 162B  F9			 		stc				; Set carry flag
    4326 162C				loc_279:					;  xref A.1628
    4327 162C  D0 D2			 		rcl	dl,1			; Rotate thru carry
    4328 162E  D1 E9			 		shr	cx,1			; Shift w/zeros fill
    4329 1630  D1 E9			 		shr	cx,1			; Shift w/zeros fill
    4330 1632  73 F2			 		jnc	loc_278			; Jump if carry=0
    4331 1634  88 56 00			 		mov	[bp],dl
    4332 1637  45			 		inc	bp
    4333 1638  C3			 		retn
    4334 1639				sub_45		endp
    4335				
    4336				
    4337				;===============================================================================
    4338				 ;                              SUBROUTINE
    4339				 ;
    4340				 ;         Called from:   A.14B0, 155F
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-80


    4341				;===============================================================================
    4342				;a.1638
    4343 1639				sub_46		proc	near
    4344 1639  A1 0050 R		 		mov	ax,word ptr ds:[vid_curs_pos0]	; (A.0050=74AAh) cursor position
    4345				
    4346				; External Entry into Subroutine 
					
    4347				 ;
    4348				 ;         Called from:   A.13CE, 1428
    4349				;a.163b
    4350 163C				sub_47:
    4351 163C  53			 		push	bx
    4352 163D  8B D8			 		mov	bx,ax
    4353 163F  8A C4			 		mov	al,ah
    4354 1641  F6 26 004A R		 		mul	byte ptr ds:[video_columns]	; (A.004A=0) ax = data * al columns
    4355 1645  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4356 1647  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4357 1649  2A FF			 		sub	bh,bh
    4358 164B  03 C3			 		add	ax,bx
    4359 164D  5B			 		pop	bx
    4360 164E  C3			 		retn
    4361 164F				sub_46		endp
    4362				
    4363				;--- WRITE TTY ------------------------------------------------------------------
    4364				;a.164e
    4365 164F				WRITE_TTY:					;  xref A.0FED, 101B
    4366 164F  50			 		push	ax
    4367 1650  50			 		push	ax
    4368 1651  B4 03			 		mov	ah,3
    4369 1653  CD 10			 		int	10h			; Video display   ah=functn 03h
    4370				 						;  get cursor loc in dx, mode cx
    4371 1655  58			 		pop	ax
    4372 1656  3C 08			 		cmp	al,8
    4373 1658  74 59			 		je	loc_288			; Jump if equal
    4374 165A  3C 0D			 		cmp	al,0Dh
    4375 165C  74 5E			 		je	loc_289			; Jump if equal
    4376 165E  3C 0A			 		cmp	al,0Ah
    4377 1660  74 5E			 		je	loc_290			; Jump if equal
    4378 1662  3C 07			 		cmp	al,7
    4379 1664  74 61			 		je	loc_291			; Jump if equal
    4380 1666  8A 3E 0062 R		 		mov	bh,ds:video_page	; (0040:0062=0)
    4381 166A  B4 0A			 		mov	ah,0Ah
    4382 166C  B9 0001			 		mov	cx,1
    4383 166F  CD 10			 		int	10h			; Video display   ah=functn 0Ah
    4384				 						;  set char al at present curs
    4385				 						;   cx=# of chars to replicate
    4386 1671  FE C2			 		inc	dl
    4387 1673  3A 16 004A R		 		cmp	dl,byte ptr ds:video_columns	; (0040:004A=50h)
    4388 1677  75 36			 		jne	loc_287			; Jump if not equal
    4389 1679  B2 00			 		mov	dl,0
    4390 167B  80 FE 18			 		cmp	dh,18h
    4391 167E  75 2D			 		jne	loc_286			; Jump if not equal
    4392 1680				loc_281:					;  xref A.16C4
    4393 1680  B4 02			 		mov	ah,2
    4394 1682  B7 00			 		mov	bh,0
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-81


    4395 1684  CD 10			 		int	10h			; Video display   ah=functn 02h
    4396				 						;  set cursor location in dx
    4397 1686  A0 0049 R		 		mov	al,byte ptr ds:[video_mode]	; (A.0049=66h)
    4398 1689  3C 04			 		cmp	al,4
    4399 168B  72 06			 		jb	loc_282			; Jump if below
    4400 168D  3C 07			 		cmp	al,7
    4401 168F  B7 00			 		mov	bh,0
    4402 1691  75 06			 		jnz	loc_283			; Jump if not zero
    4403 1693				loc_282:					;  xref A.168A
    4404 1693  B4 08			 		mov	ah,8
    4405 1695  CD 10			 		int	10h			; Video display   ah=functn 08h
    4406				 						;  get char al & attrib ah @curs
    4407 1697  8A FC			 		mov	bh,ah
    4408 1699				loc_283:					;  xref A.1690
    4409 1699  B8 0601			 		mov	ax,601h
    4410 169C  B9 0000			 		mov	cx,0
    4411 169F  B6 18			 		mov	dh,18h
    4412 16A1  8A 16 004A R		 		mov	dl,byte ptr ds:[video_columns]	; (A.004A=0)
    4413 16A5  FE CA			 		dec	dl
    4414 16A7				loc_284:					;  xref A.16B0
    4415 16A7  CD 10			 		int	10h			; Video display   ah=functn 02h
    4416				 						;  set cursor location in dx
    4417				;a.16a8
    4418 16A9				loc_285:					;  xref A.16CB
    4419 16A9  58			 		pop	ax
    4420 16AA  E9 1137 R		 		jmp	loc_200			; (1136)
    4421 16AD				loc_286:					;  xref A.167D, 16C2
    4422 16AD  FE C6			 		inc	dh
    4423 16AF				loc_287:					;  xref A.1676, 16B5, 16B9, 16BD
    4424 16AF  B4 02			 		mov	ah,2
    4425 16B1  EB F4			 		jmp	short loc_284		; (16A6)
    4426 16B3				loc_288:					;  xref A.1657
    4427 16B3  80 FA 00			 		cmp	dl,0
    4428 16B6  74 F7			 		je	loc_287			; Jump if equal
    4429 16B8  FE CA			 		dec	dl
    4430 16BA  EB F3			 		jmp	short loc_287		; (16AE)
    4431 16BC				loc_289:					;  xref A.165B
    4432 16BC  B2 00			 		mov	dl,0
    4433 16BE  EB EF			 		jmp	short loc_287		; (16AE)
    4434 16C0				loc_290:					;  xref A.165F
    4435 16C0  80 FE 18			 		cmp	dh,18h
    4436 16C3  75 E8			 		jne	loc_286			; Jump if not equal
    4437 16C5  EB B9			 		jmp	short loc_281		; (167F)
    4438 16C7				loc_291:					;  xref A.1663
    4439 16C7  B3 02			 		mov	bl,2
    4440 16C9  E8 05C3 R		 		call	BEEP			; (05C3)
    4441 16CC  EB DB			 		jmp	short loc_285		; (16A8)
    4442				
    4443				;a.16cd
    4444				;Light Pen offset table
    4445 16CE  03 03 05 05 03 03	PENOFF:	db	3, 3, 5, 5, 3, 3, 3, 4		; Data table (indexed access) xref A.1704
    4446       03 04			
    4447				     		
    4448				
    4449				;--- READ LPEN -----------------------------------------------------------------
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-82


    4450				;a.16d5
    4451 16D6				READ_LPEN:					;  xref A.0FD9, 101B
    4452 16D6  B4 00			 		mov	ah,0
    4453 16D8  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    4454 16DC  83 C2 06			 		add	dx,6
    4455 16DF  EC			 		in	al,dx			; port 3DAh, CGA/EGA vid status
    4456 16E0  A8 04			 		test	al,4
    4457 16E2  75 78			 		jnz	loc_297			; Jump if not zero
    4458 16E4  A8 02			 		test	al,2
    4459 16E6  74 7E			 		jz	loc_298			; Jump if zero
    4460 16E8  B4 10			 		mov	ah,10h
    4461 16EA  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    4462 16EE  8A C4			 		mov	al,ah
    4463 16F0  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    4464				 						;  al = 10h, light pen high
    4465 16F1  42			 		inc	dx
    4466 16F2  EC			 		in	al,dx			; port 3D5h, CGA/EGA indxd data
    4467 16F3  8A E8			 		mov	ch,al
    4468 16F5  4A			 		dec	dx
    4469 16F6  FE C4			 		inc	ah
    4470 16F8  8A C4			 		mov	al,ah
    4471 16FA  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    4472				 						;  al = 11h, light pen low
    4473 16FB  42			 		inc	dx
    4474 16FC  EC			 		in	al,dx			; port 3D5h, CGA/EGA indxd data
    4475 16FD  8A E5			 		mov	ah,ch
    4476 16FF  8A 1E 0049 R		 		mov	bl,ds:video_mode	; (0040:0049=3)
    4477 1703  2A FF			 		sub	bh,bh
    4478 1705  2E: 8A 9F 16CE R		 		mov	bl,byte ptr cs:PENOFF[bx]	; (A.16CD=3)
    4479 170A  2B C3			 		sub	ax,bx
    4480 170C  2B 06 004E R		 		sub	ax,ds:video_segment	; (0040:004E=0)
    4481 1710  79 03			 		jns	loc_293			; Jump if not sign
    4482 1712  B8 0000			 		mov	ax,0
    4483				;a.1714
    4484 1715				loc_293:					;  xref A.170F
    4485 1715  B1 03			 		mov	cl,3
    4486 1717  80 3E 0049 R 04		 		cmp	byte ptr ds:video_mode,4	; (0040:0049=3)
    4487 171C  72 2A			 		jb	loc_295			; Jump if below
    4488 171E  80 3E 0049 R 07		 		cmp	byte ptr ds:video_mode,7	; (0040:0049=3)
    4489 1723  74 23			 		je	loc_295			; Jump if equal
    4490 1725  B2 28			 		mov	dl,28h			; '('
    4491 1727  F6 F2			 		div	dl			; al, ah rem = ax/reg
    4492 1729  8A E8			 		mov	ch,al
    4493 172B  02 ED			 		add	ch,ch
    4494 172D  8A DC			 		mov	bl,ah
    4495 172F  2A FF			 		sub	bh,bh
    4496 1731  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	; (0040:0049=3)
    4497 1736  75 04			 		jne	loc_294			; Jump if not equal
    4498 1738  B1 04			 		mov	cl,4
    4499 173A  D0 E4			 		shl	ah,1			; Shift w/zeros fill
    4500 173C				loc_294:					;  xref A.1735
    4501 173C  D3 E3			 		shl	bx,cl			; Shift w/zeros fill
    4502 173E  8A D4			 		mov	dl,ah
    4503 1740  8A F0			 		mov	dh,al
    4504 1742  D0 EE			 		shr	dh,1			; Shift w/zeros fill
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-83


    4505 1744  D0 EE			 		shr	dh,1			; Shift w/zeros fill
    4506 1746  EB 12			 		jmp	short loc_296		; (1759)
    4507 1748				loc_295:					;  xref A.171B, 1722
    4508 1748  F6 36 004A R		 		div	byte ptr ds:video_columns	; (0040:004A=50h) al,ah rem = ax/dat
					a
    4509 174C  8A F0			 		mov	dh,al
    4510 174E  8A D4			 		mov	dl,ah
    4511 1750  D2 E0			 		shl	al,cl			; Shift w/zeros fill
    4512 1752  8A E8			 		mov	ch,al
    4513 1754  8A DC			 		mov	bl,ah
    4514 1756  32 FF			 		xor	bh,bh			; Zero register
    4515 1758  D3 E3			 		shl	bx,cl			; Shift w/zeros fill
    4516				;a.1759
    4517 175A				loc_296:					;  xref A.1745
    4518 175A  B4 01			 		mov	ah,1
    4519 175C				loc_297:					;  xref A.16E1
    4520 175C  52			 		push	dx
    4521 175D  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    4522 1761  83 C2 07			 		add	dx,7
    4523 1764  EE			 		out	dx,al			; port 3DBh, CGA light pen clr
    4524 1765  5A			 		pop	dx
    4525 1766				loc_298:					;  xref A.16E5
    4526 1766  5F			 		pop	di
    4527 1767  5E			 		pop	si
    4528 1768  1F			 		pop	ds
    4529 1769  1F			 		pop	ds
    4530 176A  1F			 		pop	ds
    4531 176B  1F			 		pop	ds
    4532 176C  07			 		pop	es
    4533 176D  CF			 		iret				; Interrupt return
    4534				
    4535				;-----------------------------------------------------------------------
    4536				;	CHARACTER GENERATOR GRAPHICS FOR 320X200 AND 640X200 GRAPHICS
    4537				;-----------------------------------------------------------------------
    4538				;	ORG	0FA6EH
    4539				; Looks like it runs to FE6Dh (400h bytes) in the PC. Data is in 8-byte lines.
    4540				; Cut and pasted from the PCBIOS because they're grouped in 8-byte lines and
    4541				; have the character code. I edited certain ones to match CM5 (certain bytes
    4542				; don't match - most are 7Eh swapped for 73h).
    4543				
    4544				 ;a.176d
    4545 176E				GRAFIX:
    4546 176E  00 00 00 00 00 00			db	000H,000H,000H,000H,000H,000H,000H,000H ; D_00 x
    4547       00 00			
    4548 1776  73 81 A5 81 BD 99			db	073H,081H,0A5H,081H,0BDH,099H,081H,073H ; D_01 x
    4549       81 73			
    4550 177E  73 FF DB FF C3 E7			db	073H,0FFH,0DBH,0FFH,0C3H,0E7H,0FFH,07EH ; D_02 x
    4551       FF 7E			
    4552 1786  6C FE FE FE 7C 38			db	06CH,0FEH,0FEH,0FEH,07CH,038H,010H,000H ; D_03 x 
    4553       10 00			
    4554				
    4555 178E  10 38 7C FE 7C 38			db	010H,038H,07CH,0FEH,07CH,038H,010H,008H ; D_04 x
    4556       10 08			
    4557 1796  38 7C 38 FE FE 7C			db	038H,07CH,038H,0FEH,0FEH,07CH,038H,07CH ; D_05 x
    4558       38 7C			
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-84


    4559 179E  10 10 38 7C FE 7C			db	010H,010H,038H,07CH,0FEH,07CH,038H,07CH ; D_06 x
    4560       38 7C			
    4561 17A6  00 00 18 3C 3C 18			db	000H,000H,018H,03CH,03CH,018H,000H,000H ; D_07 x
    4562       00 00			
    4563				
    4564 17AE  FF FF E7 C3 C3 E7			db	0FFH,0FFH,0E7H,0C3H,0C3H,0E7H,0FFH,0FFH ; D_08 x
    4565       FF FF			
    4566 17B6  00 3C 66 42 42 66			db	000H,03CH,066H,042H,042H,066H,03CH,000H ; D_09 x
    4567       3C 00			
    4568 17BE  FF C3 99 BD B0 99			db	0FFH,0C3H,099H,0BDH,0B0H,099H,0C3H,0FFH ; D_0A x
    4569       C3 FF			
    4570 17C6  0F 07 0F 7D CC CC			db	00FH,007H,00FH,07DH,0CCH,0CCH,0CCH,078H ; D_08 x
    4571       CC 78			
    4572				
    4573 17CE  3C 66 66 66 3C 18			db	03CH,066H,066H,066H,03CH,018H,07EH,018H ; D_0C x
    4574       7E 18			
    4575 17D6  3F 3F 3F 30 30 70			db	03FH,03FH,03FH,030H,030H,070H,0F0H,0E0H ; D_0D x
    4576       F0 E0			
    4577 17DE  7F 63 7F 63 63 67			db	07FH,063H,07FH,063H,063H,067H,0E6H,0C0H ; D_0E x
    4578       E6 C0			
    4579 17E6  99 5A 3C E7 E7 3C			db	099H,05AH,03CH,0E7H,0E7H,03CH,05AH,099H ; D_0F x
    4580       5A 99			
    4581				
    4582 17EE  80 E0 F8 FE F8 E0			db	080H,0E0H,0F8H,0FEH,0F8H,0E0H,080H,000H ; D_10
    4583       80 00			
    4584 17F6  02 0E 3E FE 3E 0E			db	002H,00EH,03EH,0FEH,03EH,00EH,002H,000H ; D_11
    4585       02 00			
    4586 17FE  18 3C 7E 18 18 7E			db	018H,03CH,07EH,018H,018H,07EH,03CH,018H ; D_12
    4587       3C 18			
    4588 1806  66 66 66 66 66 00			db	066H,066H,066H,066H,066H,000H,066H,000H ; D_13
    4589       66 00			
    4590						
    4591 180E  7F DB DB 7B 1B 1B			db	07FH,0DBH,0DBH,07BH,01BH,01BH,01BH,000H ; D_14
    4592       1B 00			
    4593 1816  3E 63 38 6C 6C 38			db	03EH,063H,038H,06CH,06CH,038H,0CCH,078H ; D_15
    4594       CC 78			
    4595 181E  00 00 00 00 7E 7E			db	000H,000H,000H,000H,07EH,07EH,07EH,000H ; D_16
    4596       7E 00			
    4597 1826  18 3C 7E 18 7E 3C			db	018H,03CH,07EH,018H,07EH,03CH,018H,0FFH ; D_17
    4598       18 FF			
    4599				
    4600 182E  18 3C 7E 18 18 18			db	018H,03CH,07EH,018H,018H,018H,018H,000H ; D_18
    4601       18 00			
    4602 1836  18 18 18 18 73 3C			db	018H,018H,018H,018H,073H,03CH,018H,000H ; D_19
    4603       18 00			
    4604 183E  00 18 0C FE 0C 18			db	000H,018H,00CH,0FEH,00CH,018H,000H,000H ; D_1A
    4605       00 00			
    4606 1846  00 30 60 FE 60 30			db	000H,030H,060H,0FEH,060H,030H,000H,000H ; D_1B
    4607       00 00			
    4608				
    4609 184E  00 00 C0 C0 C0 FE			db	000H,000H,0C0H,0C0H,0C0H,0FEH,000H,000H ; D_1C
    4610       00 00			
    4611 1856  00 24 66 FF 66 24			db	000H,024H,066H,0FFH,066H,024H,000H,000H ; D_1D
    4612       00 00			
    4613 185E  00 18 3C 7E FF FF			db	000H,018H,03CH,07EH,0FFH,0FFH,000H,000H ; D_1E
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-85


    4614       00 00			
    4615 1866  00 FF FF 7E 3C 18			db	000H,0FFH,0FFH,07EH,03CH,018H,000H,000H ; D_1F
    4616       00 00			
    4617				
    4618 186E  00 00 00 00 00 00			db	000H,000H,000H,000H,000H,000H,000H,000H ; SP D_20
    4619       00 00			
    4620 1876  30 78 78 30 30 00			db	030H,078H,078H,030H,030H,000H,030H,000H ; ! D_21
    4621       30 00			
    4622 187E  6C 6C 6C 00 00 00			db	06CH,06CH,06CH,000H,000H,000H,000H,000H ; " D_22
    4623       00 00			
    4624 1886  6C 6C FE 6C FE 6C			db	06CH,06CH,0FEH,06CH,0FEH,06CH,06CH,000H ; # D_23
    4625       6C 00			
    4626				
    4627 188E  30 7C C0 78 0C F8			db	030H,07CH,0C0H,078H,00CH,0F8H,030H,000H ; $ D_24
    4628       30 00			
    4629 1896  00 C6 CC 18 30 66			db	000H,0C6H,0CCH,018H,030H,066H,0C6H,000H ; PER CENT D_25
    4630       C6 00			
    4631 189E  38 6C 38 76 DC CC			db	038H,06CH,038H,076H,0DCH,0CCH,076H,000H ; & D_26
    4632       76 00			
    4633 18A6  60 60 C0 00 00 00			db	060H,060H,0C0H,000H,000H,000H,000H,000H ; ' D_27
    4634       00 00			
    4635				
    4636 18AE  18 30 60 60 60 30			db	018H,030H,060H,060H,060H,030H,018H,000H ; ( D_28
    4637       18 00			
    4638 18B6  60 30 18 18 18 30			db	060H,030H,018H,018H,018H,030H,060H,000H ; ) D_29
    4639       60 00			
    4640 18BE  00 66 3C FF 3C 66			db	000H,066H,03CH,0FFH,03CH,066H,000H,000H ; * D_2A
    4641       00 00			
    4642 18C6  00 30 30 FC 30 30			db	000H,030H,030H,0FCH,030H,030H,000H,000H ; + D_2B
    4643       00 00			
    4644				
    4645 18CE  00 00 00 00 00 30			db	000H,000H,000H,000H,000H,030H,030H,060H ; , D_2C
    4646       30 60			
    4647 18D6  00 00 00 FC 00 00			db	000H,000H,000H,0FCH,000H,000H,000H,000H ; - D_2D
    4648       00 00			
    4649 18DE  00 00 00 00 00 30			db	000H,000H,000H,000H,000H,030H,030H,000H ; . D_2E
    4650       30 00			
    4651 18E6  06 0C 18 30 60 C0			db	006H,00CH,018H,030H,060H,0C0H,080H,000H ; / D_2F
    4652       80 00			
    4653				
    4654 18EE  7C C6 CE DE F6 E6			db	07CH,0C6H,0CEH,0DEH,0F6H,0E6H,07CH,000H ; 0 D_30
    4655       7C 00			
    4656 18F6  30 70 30 30 30 30			db	030H,070H,030H,030H,030H,030H,0FCH,000H ; 1 D_31
    4657       FC 00			
    4658 18FE  78 CC 0C 38 60 CC			db	078H,0CCH,00CH,038H,060H,0CCH,0FCH,000H ; 2 D_32
    4659       FC 00			
    4660 1906  78 CC 0C 38 0C CC			db	078H,0CCH,00CH,038H,00CH,0CCH,078H,000H ; 3 D_33
    4661       78 00			
    4662				
    4663 190E  1C 3C 6C CC FE 0C			db	01CH,03CH,06CH,0CCH,0FEH,00CH,01EH,000H ; 4 D_34
    4664       1E 00			
    4665 1916  FC C0 F8 0C 0C CC			db	0FCH,0C0H,0F8H,00CH,00CH,0CCH,078H,000H ; 5 D_35
    4666       78 00			
    4667 191E  38 60 C0 F8 CC CC			db	038H,060H,0C0H,0F8H,0CCH,0CCH,078H,000H ; 6 D_36
    4668       78 00			
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-86


    4669 1926  FC CC 0C 18 30 30			db	0FCH,0CCH,00CH,018H,030H,030H,030H,000H ; 7 D_37
    4670       30 00			
    4671				
    4672 192E  78 CC CC 78 CC CC			db	078H,0CCH,0CCH,078H,0CCH,0CCH,078H,000H ; 8 D_38
    4673       78 00			
    4674 1936  78 CC CC 7C 0C 18			db	078H,0CCH,0CCH,07CH,00CH,018H,070H,000H ; 9 D_39
    4675       70 00			
    4676 193E  00 30 30 00 00 30			db	000H,030H,030H,000H,000H,030H,030H,000H ; : D_3A
    4677       30 00			
    4678 1946  00 30 30 00 00 30			db	000H,030H,030H,000H,000H,030H,030H,060H ; ; D_3B
    4679       30 60			
    4680				
    4681 194E  18 30 60 C0 60 30			db	018H,030H,060H,0C0H,060H,030H,018H,000H ; < D_3C
    4682       18 00			
    4683 1956  00 00 FC 00 00 FC			db	000H,000H,0FCH,000H,000H,0FCH,000H,000H ; = D_3D
    4684       00 00			
    4685 195E  60 30 18 0C 18 30			db	060H,030H,018H,00CH,018H,030H,060H,000H ; > D_3E
    4686       60 00			
    4687 1966  78 CC 0C 18 30 00			db	078H,0CCH,00CH,018H,030H,000H,030H,000H ; ? D_3F
    4688       30 00			
    4689				
    4690 196E  7C C6 DE DE DE C0			db	07CH,0C6H,0DEH,0DEH,0DEH,0C0H,078H,000H ; @ D_40
    4691       78 00			
    4692 1976  30 78 CC CC FC CC			db	030H,078H,0CCH,0CCH,0FCH,0CCH,0CCH,000H ; A D_41
    4693       CC 00			
    4694 197E  FC 66 66 7C 66 66			db	0FCH,066H,066H,07CH,066H,066H,0FCH,000H ; B D_42
    4695       FC 00			
    4696 1986  3C 66 C0 C0 C0 66			db	03CH,066H,0C0H,0C0H,0C0H,066H,03CH,000H ; C D_43
    4697       3C 00			
    4698				
    4699 198E  F8 6C 66 66 66 6C			db	0F8H,06CH,066H,066H,066H,06CH,0F8H,000H ; D D_44
    4700       F8 00			
    4701 1996  FE 62 68 78 68 62			db	0FEH,062H,068H,078H,068H,062H,0FEH,000H ; E D_45
    4702       FE 00			
    4703 199E  FE 62 68 78 68 60			db	0FEH,062H,068H,078H,068H,060H,0F0H,000H ; F D_46
    4704       F0 00			
    4705 19A6  3C 66 C0 C0 CE 66			db	03CH,066H,0C0H,0C0H,0CEH,066H,03EH,000H ; G D_47
    4706       3E 00			
    4707				
    4708 19AE  CC CC CC FC CC CC			db	0CCH,0CCH,0CCH,0FCH,0CCH,0CCH,0CCH,000H ; H D_48
    4709       CC 00			
    4710 19B6  78 30 30 30 30 30			db	078H,030H,030H,030H,030H,030H,078H,000H ; I D_49
    4711       78 00			
    4712 19BE  1E 0C 0C 0C CC CC			db	01EH,00CH,00CH,00CH,0CCH,0CCH,078H,000H ; J D_4A
    4713       78 00			
    4714 19C6  E6 66 6C 78 6C 66			db	0E6H,066H,06CH,078H,06CH,066H,0E6H,000H ; K D_4B
    4715       E6 00			
    4716				
    4717 19CE  F0 60 60 60 62 66			db	0F0H,060H,060H,060H,062H,066H,0FEH,000H ; L D_4C
    4718       FE 00			
    4719 19D6  C6 EE FE FE D6 C6			db	0C6H,0EEH,0FEH,0FEH,0D6H,0C6H,0C6H,000H ; M D_4C
    4720       C6 00			
    4721 19DE  C6 E6 F6 DE CE C6			db	0C6H,0E6H,0F6H,0DEH,0CEH,0C6H,0C6H,000H ; N D_4E
    4722       C6 00			
    4723 19E6  38 6C C6 C6 C6 6C			db	038H,06CH,0C6H,0C6H,0C6H,06CH,038H,000H ; O D_4F
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-87


    4724       38 00			
    4725				
    4726 19EE  FC 66 66 7C 60 60			db	0FCH,066H,066H,07CH,060H,060H,0F0H,000H ; P D_50
    4727       F0 00			
    4728 19F6  78 CC CC CC DC 78			db	078H,0CCH,0CCH,0CCH,0DCH,078H,01CH,000H ; Q D_51
    4729       1C 00			
    4730 19FE  FC 66 66 7C 6C 66			db	0FCH,066H,066H,07CH,06CH,066H,0E6H,000H ; R D_52
    4731       E6 00			
    4732 1A06  78 CC E0 70 1C CC			db	078H,0CCH,0E0H,070H,01CH,0CCH,078H,000H ; S D_53
    4733       78 00			
    4734				
    4735 1A0E  FC B4 30 30 30 30			db	0FCH,0B4H,030H,030H,030H,030H,078H,000H ; T D_54
    4736       78 00			
    4737 1A16  CC CC CC CC CC CC			db	0CCH,0CCH,0CCH,0CCH,0CCH,0CCH,0FCH,000H ; U D_55
    4738       FC 00			
    4739 1A1E  CC CC CC CC CC 78			db	0CCH,0CCH,0CCH,0CCH,0CCH,078H,0C0H,000H ; V D_56
    4740       C0 00			
    4741 1A26  C6 C6 C6 D6 FE EE			db	0C6H,0C6H,0C6H,0D6H,0FEH,0EEH,0C6H,000H ; W D_57
    4742       C6 00			
    4743				
    4744 1A2E  C6 C6 6C 38 38 6C			db	0C6H,0C6H,06CH,038H,038H,06CH,0C6H,000H ; X D_58
    4745       C6 00			
    4746 1A36  CC CC CC 78 30 30			db	0CCH,0CCH,0CCH,078H,030H,030H,078H,000H ; Y D_59
    4747       78 00			
    4748 1A3E  FE C6 8C 18 32 66			db	0FEH,0C6H,08CH,018H,032H,066H,0FEH,000H ; Z D_5A
    4749       FE 00			
    4750 1A46  78 60 60 60 60 60			db	078H,060H,060H,060H,060H,060H,078H,000H ; [ D_5B
    4751       78 00			
    4752				
    4753 1A4E  C0 60 30 18 0C 06			db	0C0H,060H,030H,018H,00CH,006H,002H,000H ; BACKSLASH D_5C
    4754       02 00			
    4755 1A56  78 18 18 18 18 18			db	078H,018H,018H,018H,018H,018H,078H,000H ; ] D_5D
    4756       78 00			
    4757 1A5E  10 38 6C C6 00 00			db	010H,038H,06CH,0C6H,000H,000H,000H,000H ; CIRCUMFLEX D_5E
    4758       00 00			
    4759 1A66  00 00 00 00 00 00			db	000H,000H,000H,000H,000H,000H,000H,0FFH ; _ D_5F
    4760       00 FF			
    4761				
    4762 1A6E  30 30 18 00 00 00			db	030H,030H,018H,000H,000H,000H,000H,000H ;   D_60
    4763       00 00			
    4764 1A76  00 00 78 0C 7C CC			db	000H,000H,078H,00CH,07CH,0CCH,076H,000H ; LOWER CASE A D_61
    4765       76 00			
    4766 1A7E  E0 60 60 7C 66 66			db	0E0H,060H,060H,07CH,066H,066H,0DCH,000H ; L.C. B D_62
    4767       DC 00			
    4768 1A86  00 00 78 CC C0 CC			db	000H,000H,078H,0CCH,0C0H,0CCH,078H,000H ; L.C. C D_63
    4769       78 00			
    4770				
    4771 1A8E  1C 0C 0C 7C CC CC			db	01CH,00CH,00CH,07CH,0CCH,0CCH,076H,000H ; L.C. D D_64
    4772       76 00			
    4773 1A96  00 00 78 CC FC C0			db	000H,000H,078H,0CCH,0FCH,0C0H,078H,000H ; L.C. E D_65
    4774       78 00			
    4775 1A9E  38 6C 60 F0 60 60			db	038H,06CH,060H,0F0H,060H,060H,0F0H,000H ; L.C. F D_66
    4776       F0 00			
    4777 1AA6  00 00 76 CC CC 7C			db	000H,000H,076H,0CCH,0CCH,07CH,00CH,0F8H ; L.C. G D_67
    4778       0C F8			
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-88


    4779				
    4780 1AAE  E0 60 6C 76 66 66			db	0E0H,060H,06CH,076H,066H,066H,0E6H,000H ; L.C. H D_68
    4781       E6 00			
    4782 1AB6  30 00 70 30 30 30			db	030H,000H,070H,030H,030H,030H,078H,000H ; L.C. I D_69
    4783       78 00			
    4784 1ABE  0C 00 0C 0C 0C CC			db	00CH,000H,00CH,00CH,00CH,0CCH,0CCH,078H ; L.C. J D_6A
    4785       CC 78			
    4786 1AC6  E0 60 66 6C 78 6C			db	0E0H,060H,066H,06CH,078H,06CH,0E6H,000H ; L.C. K D_6B
    4787       E6 00			
    4788				
    4789 1ACE  70 30 30 30 30 30			db	070H,030H,030H,030H,030H,030H,078H,000H ; L.C. L D_6C
    4790       78 00			
    4791 1AD6  00 00 CC FE FE D6			db	000H,000H,0CCH,0FEH,0FEH,0D6H,0C6H,000H ; L.C. M D_6D
    4792       C6 00			
    4793 1ADE  00 00 F8 CC CC CC			db	000H,000H,0F8H,0CCH,0CCH,0CCH,0CCH,000H ; L.C. N D_6E
    4794       CC 00			
    4795 1AE6  00 00 78 CC CC CC			db	000H,000H,078H,0CCH,0CCH,0CCH,078H,000H ; L.C. O D_6F
    4796       78 00			
    4797				
    4798 1AEE  00 00 DC 66 66 7C			db	000H,000H,0DCH,066H,066H,07CH,060H,0F0H ; L.C. P D_70
    4799       60 F0			
    4800 1AF6  00 00 76 CC CC 7C			db	000H,000H,076H,0CCH,0CCH,07CH,00CH,01EH ; L.C. Q D_71
    4801       0C 1E			
    4802 1AFE  00 00 DC 76 66 60			db	000H,000H,0DCH,076H,066H,060H,0F0H,000H ; L.C. R D_72
    4803       F0 00			
    4804 1B06  00 00 7C C0 78 0C			db	000H,000H,07CH,0C0H,078H,00CH,0F8H,000H ; L.C. S D_73
    4805       F8 00			
    4806				
    4807 1B0E  10 30 7C 30 30 34			db	010H,030H,07CH,030H,030H,034H,018H,000H ; L.C. T D_74
    4808       18 00			
    4809 1B16  00 00 CC CC CC CC			db	000H,000H,0CCH,0CCH,0CCH,0CCH,076H,000H ; L.C. U D_75
    4810       76 00			
    4811 1B1E  00 00 CC CC CC 78			db	000H,000H,0CCH,0CCH,0CCH,078H,030H,000H ; L.C. V D_76
    4812       30 00			
    4813 1B26  00 00 C6 D6 FE FE			db	000H,000H,0C6H,0D6H,0FEH,0FEH,06CH,000H ; L.C. W D_77
    4814       6C 00			
    4815				
    4816 1B2E  00 00 C6 6C 38 6C			db	000H,000H,0C6H,06CH,038H,06CH,0C6H,000H ; L.C. X D_78
    4817       C6 00			
    4818 1B36  00 00 CC CC CC 7C			db	000H,000H,0CCH,0CCH,0CCH,07CH,00CH,0F8H ; L.C. Y D_79
    4819       0C F8			
    4820 1B3E  00 00 FC 98 30 64			db	000H,000H,0FCH,098H,030H,064H,0FCH,000H ; L.C. Z D_7A
    4821       FC 00			
    4822 1B46  1C 30 30 E0 30 30			db	01CH,030H,030H,0E0H,030H,030H,01CH,000H ; { D_7B
    4823       1C 00			
    4824				
    4825 1B4E  18 18 18 00 18 18			db	018H,018H,018H,000H,018H,018H,018H,000H ; | D_7C
    4826       18 00			
    4827 1B56  E0 30 30 1C 30 30			db	0E0H,030H,030H,01CH,030H,030H,0E0H,000H ; } D_7D
    4828       E0 00			
    4829 1B5E  76 DC 00 00 00 00			db	076H,0DCH,000H,000H,000H,000H,000H,000H ; TILDE D_7E
    4830       00 00			
    4831 1B66  00 10 38 6C C6 C6			db	000H,010H,038H,06CH,0C6H,0C6H,0FEH,000H ; DELTA D_7F
    4832       FE 00			
    4833				; This ends at a.1b70
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-89


    4834				
    4835				IF	ROMSEARCH
    4836				;***** Expansion ROM code *****
    4837				; This is called after the hardware is initialized but before
    4838				; the video is displayed. Borrowed from the Generic XT BIOS.
    4839				EXPROM: MOV     DX,0C800h                       ; ROM segment start
    4840					PUSH    DS
    4841				
    4842				FNDROM: MOV     DS,DX                           ; Load ROM segment
    4843				        XOR     BX,BX                           ;  ...ID offset
    4844				        MOV     AX,[BX]                         ; Read the ROM id
    4845				        CMP     AX,0AA55h
    4846				        JNZ     NXTROM                          ;  ...not valid ROM
    4847				        MOV     AX,40h
    4848				        MOV     ES,AX
    4849				        MOV     AH,0
    4850				        MOV     AL,[BX+2]                       ; Get ROM size (bytes * 512)
    4851				        MOV     CL,5
    4852				        SHL     AX,CL                           ; Now ROM size in segments
    4853				        ADD     DX,AX                           ;  ...add base segment
    4854				        MOV     CL,4
    4855				        SHL     AX,CL                           ; ROM address in bytes
    4856				        MOV     CX,AX                           ;  ...checksum requires CX
    4857				        CALL    CHK_01                          ; Find ROM checksum
    4858				        JNZ     BADROM                          ;  ...bad ROM
    4859				        PUSH    DX
    4860				        MOV     Word ptr ES:[gen_io_ptr],3	; 67h Offset  for ROM being setup
    4861				        MOV     ES:[gen_io_ptr+2],DS		; 69h Segment for ROM being setup
    4862				        CALL    Dword ptr ES:[gen_io_ptr]	;  ...call ROM initialization
    4863				        POP     DX
    4864				        JMP     short FND_01			; see if there are any more ROMs
    4865				
    4866				BADROM: OR      Byte ptr ES:[scratch1],ER_ROM          ; ROM present, bad checksum 15h
    4867				
    4868				NXTROM: ADD     DX,80h                          ; Segment for next ROM
    4869				
    4870				FND_01: CMP     DX,0F600h                       ; End of ROM space
    4871				        JL      FNDROM                          ;  ...no, continue
    4872					POP	DS				;  ...yes, clean up stack and return
    4873					RET
    4874				
    4875				CHKSUM: MOV     CX,2000h                        ; Bytes in 2764 eprom
    4876				CHK_01: MOV     AL,0                            ;  ...zero checksum
    4877				ADDBYT: ADD     AL,[BX]                         ; Add byte to checksum
    4878					INC     BX                              ;  ...BX --> next byte
    4879					LOOP    ADDBYT                          ;  ...loop until done
    4880					OR      AL,AL                           ; Set condition codes
    4881					RET                                     ;  ...and return
    4882				ENDIF
    4883				
    4884				; this ends at about 1BCF
    4885				;
    4886				; In Monitor v3.3, the SCSI code resides near the end of the ROM
    4887				; before some RAM test code and the 186 init. It is included as a
    4888				; library file (i.e., "scsi.lib"), which I assume is a plain text
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-90


    4889				; file.
    4890				;include "scsimon.asm"
    4891				;a.1c00
    4892 1C00					org	01c00h
    4893				include "INIT186.ASM"
    4894			     C	; CPU 186 defined in CM5.ASM
    4895			     C	; 1C00h
    4896 1C00                        C	COLDST:
    4897 1C00  8C C8                 C		mov	ax,cs
    4898 1C02  8E D8                 C		mov	ds,ax
    4899 1C04  8E C0                 C		mov	es,ax
    4900 1C06  BE 1C29 R             C		mov	si,offset inittbl	;1c29h
    4901 1C09  FC                    C		cld
    4902 1C0A                        C	loc_309:				;  xref A.1C13
    4903 1C0A  AD                    C	 	lodsw				; String [si] to ax
    4904 1C0B  85 C0                 C	 	test	ax,ax
    4905 1C0D  74 06                 C	 	jz	loc_310			; Jump if zero
    4906 1C0F  8B D0                 C	 	mov	dx,ax
    4907 1C11  AD                    C	 	lodsw				; String [si] to ax
    4908 1C12  EF                    C	 	out	dx,ax			; port 4552h ??I/O Non-standard
    4909 1C13  EB F5                 C	 	jmp	short loc_309		; (1C0A)
    4910			     C	; work on second table
    4911			     C	;1c15
    4912 1C15                        C	loc_310:				;  xref A.1C0D
    4913 1C15  BE 1C61 R             C	 	mov	si,offset inittbl2	; (A.1C5F=82h)
    4914 1C18  BA 0000               C	 	mov	dx,0
    4915 1C1B                        C	loc_311:				;  xref A.1C24
    4916 1C1B  AC                    C	 	lodsb				; String [si] to al
    4917 1C1C  84 C0                 C	 	test	al,al
    4918 1C1E  74 06                 C	 	jz	loc_312			; Jump if zero
    4919 1C20  8A D0                 C	 	mov	dl,al
    4920 1C22  AC                    C	 	lodsb				; String [si] to al
    4921 1C23  EE                    C	 	out	dx,al			; port 82h, DMA page reg ch 3
    4922 1C24  EB F5                 C	 	jmp	short loc_311		; (1C1B)
    4923			     C	
    4924 1C26                        C	loc_312:				;  xref A.1C1E
    4925 1C26  E9 001F R             C	 	jmp	COLD2			;loc_2	;*(001F)
    4926			     C	
    4927			     C	;a.1c29
    4928			     C	; Initialization table. First word is the port and
    4929			     C	; second word is the value.
    4930 1C29                        C	inittbl:
    4931			     C	;    	db	0A0h,0FFh, 38h,0FEh
    4932			     C	;	db	0A2h,0FFh, 0F8h, 3Fh
    4933			     C	;	db	0A4h,0FFh, 3Ah, 00h
    4934			     C	;    	db	0A6h,0FFh, 38h, 40h
    4935			     C	;	db	0A8h,0FFh, 38h,0A0h
    4936			     C	;	db	52h,0FFh, 06h, 00h
    4937			     C	;	db	54h,0FFh, 07h, 00h
    4938			     C	;	db	56h,0FFh, 03h,0C0h
    4939			     C	;	db	5Ah,0FFh, 06h, 00h
    4940			     C	;    	db	5Ch,0FFh, 07h, 00h
    4941			     C	;	db	5Eh,0FFh, 03h,0C0h
    4942			     C	;	db	62h,0FFh, 20h, 4Eh
    4943			     C	;   	db	66h,0FFh, 01h,0C0h
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-91


    4944 1C29  FFA0 FE38             C	    	dw	CSCR+UMCR, 0FE38h		; Upper memory: 8k block @ FE000h
    4945			     C							; to allow for a larger ROM...
    4946			     C							; 16k @ FC000h: 0FC38h
    4947			     C							; 32k @ F8000h: 0F838h 
    4948 1C2D  FFA2 3FF8             C		dw	CSCR+LMCR, 3FF8h		; Lower memory: 256k block @ 0-3FFFFh
    4949 1C31  FFA4 003A             C		dw	CSCR+PACS, 003Ah		; 2 wait states @ 0
    4950 1C35  FFA6 4038             C	    	dw	CSCR+MMCS, 4038h		; Middle block start @ 40000h, 0WS with RDY
    4951 1C39  FFA8 A038             C		dw	CSCR+MPCS, 0A038h		; 256k total block, 64k selects, 0WS with RD
					Y
    4952 1C3D  FF52 0006             C		dw	TM0CR+TMRCA, 0006h
    4953 1C41  FF54 0007             C		dw	TM0CR+TMRCB, 0007h
    4954 1C45  FF56 C003             C		dw	TM0CR+TMRCW, 0C003h
    4955 1C49  FF5A 0006             C		dw	TM1CR+TMRCA, 0006h
    4956 1C4D  FF5C 0007             C	    	dw	TM1CR+TMRCB, 0007h
    4957 1C51  FF5E C003             C		dw	TM1CR+TMRCW, 0C003h
    4958 1C55  FF62 4E20             C		dw	TM2CR+TMRCA, 4E20h
    4959 1C59  FF66 C001             C	   	dw	TM2CR+TMRCW, 0C001h
    4960 1C5D  0000 0000             C		dw	00h, 00h
    4961			     C	
    4962			     C	; Initialization table 2. DMA registers for DMA 1 and 2
    4963 1C61                        C	inittbl2:
    4964 1C61  82 00                 C	 	db	82h, 00h		; DMA1
    4965 1C63  82 00                 C		db	82h, 00h
    4966 1C65  82 00                 C		db	82h, 00h
    4967 1C67  82 40                 C		db	82h, 40h
    4968 1C69  82 CE                 C		db	82h, 0CEh
    4969 1C6B  82 37                 C		db	82h, 37h
    4970 1C6D  C2 00                 C		db	0C2h, 00h		; DMA2
    4971 1C6F  C2 00                 C		db	0C2h, 00h
    4972 1C71  C2 00                 C		db	0C2h, 00h
    4973 1C73  C2 40                 C		db	0C2h, 40h
    4974 1C75  C2 CE                 C		db	0C2h, 0CEh
    4975 1C77  C2 37                 C		db	0C2h, 37h
    4976 1C79  D6 82                 C		db	0D6h, 82h
    4977 1C7B  D4 0F                 C		db	0D4h, 0Fh
    4978 1C7D  00 00                 C		db	0,0
    4979			     C	; should end at 1C7C
    4980			     C	;
    4981			     C	; END OF INIT186.ASM
    4982				; should end at 1fefh
    4983				
    4984				;******************************************************************************
    4985				; Restart Address
    4986				;	org	01FF0h
    4987					ENTRY 	01FF0h			; this should put fill bytes before
    4988 1C7F  0371[                 1	        db      pad DUP(0) 
    4989					PUBLIC	POWER
    4990 1FF0				POWER:	jmpf	0FE00h, COLDST
    4991 1FF0  EA                    1	        db      0EAh; 
    4992 1FF1  1C00 R FE00           1	        dw      COLDST,0FE00h 
    4993				;	db	09 dup (0)
    4994				;******************************************************************************
    4995					ENTRY 	01FFEh
    4996 1FF5  0009[                 1	        db      pad DUP(0) 
    4997				; NOTE: the original ROM did not have an equipment byte.
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-92


    4998 1FFE  FB				db	0FBh			; model byte for later XT
    4999 1FFF				cksumb:
    5000 1FFF  E6				db	0E6h			; checksum byte xref A.14EB, 1504
    5001				
    5002 2000				code	ends
    5003				end 	POWER

Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-1


Macros:

		N a m e			Lines

ENTRY  . . . . . . . . . . . . .  	   8
JMPF . . . . . . . . . . . . . .  	   2

Segments and Groups:

                N a m e         	Length	 Align	Combine Class

CODE . . . . . . . . . . . . . .  	2000	PARA	NONE	
DATA . . . . . . . . . . . . . .  	0080	AT	0040	
DOSDIR . . . . . . . . . . . . .  	0200	AT	0050	

Symbols:            

                N a m e         	Type	 Value	 Attr

ACIA0BASE  . . . . . . . . . . .  	NUMBER	00C0	
ACIA1BASE  . . . . . . . . . . .  	NUMBER	0080	
ACT_DISP_PAGE  . . . . . . . . .  	L NEAR	11A0	CODE
ALT_KEY  . . . . . . . . . . . .  	NUMBER	0038	
ALT_SHIFT  . . . . . . . . . . .  	NUMBER	0008	

BANNER . . . . . . . . . . . . .  	L NEAR	0000	CODE
BEEP . . . . . . . . . . . . . .  	N PROC	05C3	CODE	Length = 0022
BEEP_1 . . . . . . . . . . . . .  	L NEAR	05DA	CODE

C58253CTL  . . . . . . . . . . .  	NUMBER	0043	
C58255CMD  . . . . . . . . . . .  	NUMBER	0063	
C58255PA . . . . . . . . . . . .  	NUMBER	0060	
C58255PB . . . . . . . . . . . .  	NUMBER	0061	
C58255PC . . . . . . . . . . . .  	NUMBER	0062	
C5TIMER0 . . . . . . . . . . . .  	NUMBER	0040	
C5TIMER1 . . . . . . . . . . . .  	NUMBER	0041	
C5TIMER2 . . . . . . . . . . . .  	NUMBER	0042	
CAPS_KEY . . . . . . . . . . . .  	NUMBER	003A	
CAPS_SHIFT . . . . . . . . . . .  	NUMBER	0040	
CAPS_STATE . . . . . . . . . . .  	NUMBER	0040	
CDRAM  . . . . . . . . . . . . .  	NUMBER	FFE2	
CGACOLOR . . . . . . . . . . . .  	NUMBER	03D9	
CGAMODE  . . . . . . . . . . . .  	NUMBER	03D8	
CGASTAT  . . . . . . . . . . . .  	NUMBER	03DA	
CIA  . . . . . . . . . . . . . .  	ALIAS	 CIA_HDO		
CIA_HDO  . . . . . . . . . . . .  	ALIAS	 FALSE		
CKSUMB . . . . . . . . . . . . .  	L NEAR	1FFF	CODE
CMDDISKFMT . . . . . . . . . . .  	L NEAR	06CE	CODE
CMDDISKRD  . . . . . . . . . . .  	L NEAR	06C0	CODE
CMDDISKSTAT  . . . . . . . . . .  	L NEAR	06BC	CODE
CMDDISKVER . . . . . . . . . . .  	L NEAR	06C7	CODE
CMDDISKWRT . . . . . . . . . . .  	L NEAR	0714	CODE
CMDKBDCHK  . . . . . . . . . . .  	L NEAR	0B57	CODE
CMDKBDCHRIN  . . . . . . . . . .  	L NEAR	0B3E	CODE
CMDKBDSHIFT  . . . . . . . . . .  	L NEAR	0B68	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-2


CMDRESETDISK . . . . . . . . . .  	L NEAR	068F	CODE
COLD2  . . . . . . . . . . . . .  	L NEAR	001F	CODE
COLDST . . . . . . . . . . . . .  	L NEAR	1C00	CODE
COMTO  . . . . . . . . . . . . .  	L BYTE	007C	DATA	Length = 0004
CR . . . . . . . . . . . . . . .  	NUMBER	000D	
CSCR . . . . . . . . . . . . . .  	NUMBER	FFA0	
CTL_KEY  . . . . . . . . . . . .  	NUMBER	001D	
CTL_SHIFT  . . . . . . . . . . .  	NUMBER	0004	
CTRLP  . . . . . . . . . . . . .  	NUMBER	0002	

D0CR . . . . . . . . . . . . . .  	NUMBER	0014	
D1CR . . . . . . . . . . . . . .  	NUMBER	0016	
DATAP  . . . . . . . . . . . . .  	NUMBER	0000	
DATA_121E  . . . . . . . . . . .  	NUMBER	2000	
DATA_122E  . . . . . . . . . . .  	NUMBER	2001	
DATA_49E . . . . . . . . . . . .  	NUMBER	0000	
DATA_50E . . . . . . . . . . . .  	NUMBER	03FE	
DATA_79  . . . . . . . . . . . .  	L NEAR	00EF	CODE
DATA_81  . . . . . . . . . . . .  	L NEAR	038B	CODE
DATA_82  . . . . . . . . . . . .  	L NEAR	050A	CODE
DATA_84  . . . . . . . . . . . .  	L NEAR	0BE0	CODE
DATA_85  . . . . . . . . . . . .  	L NEAR	0BE8	CODE
DATA_86  . . . . . . . . . . . .  	L NEAR	0C43	CODE
DATA_88  . . . . . . . . . . . .  	L NEAR	0DF3	CODE
DEBUGF . . . . . . . . . . . . .  	ALIAS	 TRUE		
DEFIRET  . . . . . . . . . . . .  	L NEAR	0596	CODE
DEL_KEY  . . . . . . . . . . . .  	NUMBER	0053	
DFINTS . . . . . . . . . . . . .  	NUMBER	0094	
DMA0 . . . . . . . . . . . . . .  	NUMBER	FFC0	
DMA1 . . . . . . . . . . . . . .  	NUMBER	FFD0	
DMACW  . . . . . . . . . . . . .  	NUMBER	000A	
DMADP  . . . . . . . . . . . . .  	NUMBER	0004	
DMADP1 . . . . . . . . . . . . .  	NUMBER	0006	
DMASP  . . . . . . . . . . . . .  	NUMBER	0000	
DMASP1 . . . . . . . . . . . . .  	NUMBER	0002	
DMATC  . . . . . . . . . . . . .  	NUMBER	0008	
DOCHECKSUM . . . . . . . . . . .  	N PROC	0140	CODE	Length = 0011
DSK_MOTOR_STAT . . . . . . . . .  	L BYTE	003F	DATA
DSK_MOTOR_TMR  . . . . . . . . .  	L BYTE	0040	DATA
DSK_RECAL_STAT . . . . . . . . .  	L BYTE	003E	DATA
DSK_RET_CODE . . . . . . . . . .  	L BYTE	0041	DATA
DYNHALT  . . . . . . . . . . . .  	L NEAR	0597	CODE

EDRAM  . . . . . . . . . . . . .  	NUMBER	FFE4	
EOIREG . . . . . . . . . . . . .  	NUMBER	0002	
EQUIP_BITS . . . . . . . . . . .  	L WORD	0010	DATA
ER_BIOS  . . . . . . . . . . . .  	NUMBER	0001	
ER_CRT . . . . . . . . . . . . .  	NUMBER	0004	
ER_MEM . . . . . . . . . . . . .  	NUMBER	0010	
ER_RAM . . . . . . . . . . . . .  	NUMBER	0002	
ER_ROM . . . . . . . . . . . . .  	NUMBER	0020	

FALSE  . . . . . . . . . . . . .  	NUMBER	0000	
FDCBASE  . . . . . . . . . . . .  	NUMBER	0090	
FDCD . . . . . . . . . . . . . .  	NUMBER	03F1	
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-3


FDCDMA . . . . . . . . . . . . .  	NUMBER	00A0	
FDCS . . . . . . . . . . . . . .  	ALIAS	 FDPORT		
FDDATA . . . . . . . . . . . . .  	NUMBER	0092	
FDDMA  . . . . . . . . . . . . .  	NUMBER	0094	
FDMA . . . . . . . . . . . . . .  	NUMBER	03F2	
FDPORT . . . . . . . . . . . . .  	NUMBER	03F0	
FDSTAT . . . . . . . . . . . . .  	ALIAS	 FDCBASE		

GEN_INT_OCCURED  . . . . . . . .  	L BYTE	006B	DATA
GEN_IO_PTR . . . . . . . . . . .  	L WORD	0067	DATA
GETPDPB  . . . . . . . . . . . .  	N PROC	0834	CODE	Length = 0011
GRAFIX . . . . . . . . . . . . .  	L NEAR	176E	CODE

HD . . . . . . . . . . . . . . .  	L BYTE	0074	DATA	Length = 0004
HDO  . . . . . . . . . . . . . .  	ALIAS	 FALSE		
HOLD_STATE . . . . . . . . . . .  	NUMBER	0008	

I14_1  . . . . . . . . . . . . .  	L NEAR	0304	CODE
I14_2  . . . . . . . . . . . . .  	L NEAR	030B	CODE
I14_EXIT . . . . . . . . . . . .  	L NEAR	0312	CODE
ICR  . . . . . . . . . . . . . .  	NUMBER	FF20	
INITEQUIPLIST  . . . . . . . . .  	N PROC	0473	CODE	Length = 0042
INITFLOPPY . . . . . . . . . . .  	N PROC	05F6	CODE	Length = 0025
INITKBDCTRLR . . . . . . . . . .  	N PROC	0B6E	CODE	Length = 004C
INITKEYBOARD . . . . . . . . . .  	N PROC	0AD4	CODE	Length = 0053
INITPRINTER  . . . . . . . . . .  	N PROC	0224	CODE	Length = 0020
INITSERIALPORTS  . . . . . . . .  	N PROC	02BC	CODE	Length = 0026
INITSERPORTS . . . . . . . . . .  	L NEAR	0319	CODE
INITTBL  . . . . . . . . . . . .  	L NEAR	1C29	CODE
INITTBL2 . . . . . . . . . . . .  	L NEAR	1C61	CODE
INITTIMERS . . . . . . . . . . .  	N PROC	04B5	CODE	Length = 0055
INS_KEY  . . . . . . . . . . . .  	NUMBER	0052	
INS_SHIFT  . . . . . . . . . . .  	NUMBER	0080	
INS_STATE  . . . . . . . . . . .  	NUMBER	0080	
INT00HANDLER . . . . . . . . . .  	L NEAR	0113	CODE
INT00V . . . . . . . . . . . . .  	NUMBER	0000	
INT01V . . . . . . . . . . . . .  	NUMBER	0004	
INT06HANDLER . . . . . . . . . .  	L NEAR	00E0	CODE
INT06V . . . . . . . . . . . . .  	NUMBER	0018	
INT08HANDLER . . . . . . . . . .  	L NEAR	0521	CODE
INT08V . . . . . . . . . . . . .  	NUMBER	0020	
INT09HANDLER . . . . . . . . . .  	L NEAR	0CF3	CODE
INT09V . . . . . . . . . . . . .  	NUMBER	0024	
INT0BHANDLER . . . . . . . . . .  	L NEAR	07E9	CODE
INT0BV . . . . . . . . . . . . .  	NUMBER	002C	
INT0CHANDLER . . . . . . . . . .  	L NEAR	0511	CODE
INT0CR . . . . . . . . . . . . .  	NUMBER	0018	
INT0CV . . . . . . . . . . . . .  	NUMBER	0030	
INT0DHANDLER . . . . . . . . . .  	L NEAR	0CE5	CODE
INT0DV . . . . . . . . . . . . .  	NUMBER	0034	
INT10HANDLER . . . . . . . . . .  	L NEAR	0FF2	CODE
INT10V . . . . . . . . . . . . .  	NUMBER	0040	
INT11HANDLER . . . . . . . . . .  	L NEAR	01B4	CODE
INT11V . . . . . . . . . . . . .  	NUMBER	0044	
INT12HANDLER . . . . . . . . . .  	L NEAR	01A9	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-4


INT12V . . . . . . . . . . . . .  	NUMBER	0048	
INT13HANDLER . . . . . . . . . .  	L NEAR	061B	CODE
INT13V . . . . . . . . . . . . .  	NUMBER	004C	
INT14HANDLER . . . . . . . . . .  	L NEAR	02E2	CODE
INT14V . . . . . . . . . . . . .  	NUMBER	0050	
INT15V . . . . . . . . . . . . .  	NUMBER	0054	
INT16HANDLER . . . . . . . . . .  	L NEAR	0B27	CODE
INT16V . . . . . . . . . . . . .  	NUMBER	0058	
INT17HANDLER . . . . . . . . . .  	L NEAR	0244	CODE
INT17V . . . . . . . . . . . . .  	NUMBER	005C	
INT17_EXIT . . . . . . . . . . .  	L NEAR	025B	CODE
INT18V . . . . . . . . . . . . .  	NUMBER	0060	
INT19V . . . . . . . . . . . . .  	NUMBER	0064	
INT1AHANDLER . . . . . . . . . .  	L NEAR	0562	CODE
INT1AV . . . . . . . . . . . . .  	NUMBER	0068	
INT1BV . . . . . . . . . . . . .  	NUMBER	006C	
INT1CR . . . . . . . . . . . . .  	NUMBER	001A	
INT1CV . . . . . . . . . . . . .  	NUMBER	0070	
INT1DV . . . . . . . . . . . . .  	NUMBER	0074	
INT1EV . . . . . . . . . . . . .  	NUMBER	0078	
INT1FV . . . . . . . . . . . . .  	NUMBER	007C	
INT2CR . . . . . . . . . . . . .  	NUMBER	001C	
INT3CR . . . . . . . . . . . . .  	NUMBER	001E	
INTS . . . . . . . . . . . . . .  	NUMBER	03F2	
INT_1D . . . . . . . . . . . . .  	L NEAR	1021	CODE
INT_1E . . . . . . . . . . . . .  	L NEAR	0AC9	CODE
IPLLOC . . . . . . . . . . . . .  	NUMBER	7C00	
IRR  . . . . . . . . . . . . . .  	NUMBER	000E	
ISR  . . . . . . . . . . . . . .  	NUMBER	0010	
ISVR . . . . . . . . . . . . . .  	NUMBER	000C	
IVR  . . . . . . . . . . . . . .  	ALIAS	 ICR		

KEYBD_ALT_NUM  . . . . . . . . .  	L BYTE	0019	DATA
KEYBD_BUFF . . . . . . . . . . .  	L WORD	001E	DATA	Length = 0010
KEYBD_FLAGS_1  . . . . . . . . .  	L BYTE	0017	DATA
KEYBD_FLAGS_2  . . . . . . . . .  	L BYTE	0018	DATA
KEYBD_Q_HEAD . . . . . . . . . .  	L WORD	001A	DATA
KEYBD_Q_TAIL . . . . . . . . . .  	L WORD	001C	DATA

LEFT_KEY . . . . . . . . . . . .  	NUMBER	002A	
LEFT_SHIFT . . . . . . . . . . .  	NUMBER	0002	
LF . . . . . . . . . . . . . . .  	NUMBER	000A	
LMCR . . . . . . . . . . . . . .  	NUMBER	0002	
LOCLOOP_100  . . . . . . . . . .  	L NEAR	088F	CODE
LOCLOOP_103  . . . . . . . . . .  	L NEAR	089D	CODE
LOCLOOP_105  . . . . . . . . . .  	L NEAR	08C7	CODE
LOCLOOP_106  . . . . . . . . . .  	L NEAR	08D5	CODE
LOCLOOP_114  . . . . . . . . . .  	L NEAR	09D3	CODE
LOCLOOP_118  . . . . . . . . . .  	L NEAR	0A16	CODE
LOCLOOP_123  . . . . . . . . . .  	L NEAR	0A38	CODE
LOCLOOP_125  . . . . . . . . . .  	L NEAR	0A61	CODE
LOCLOOP_137  . . . . . . . . . .  	L NEAR	0B78	CODE
LOCLOOP_138  . . . . . . . . . .  	L NEAR	0B89	CODE
LOCLOOP_14 . . . . . . . . . . .  	L NEAR	0202	CODE
LOCLOOP_17 . . . . . . . . . . .  	L NEAR	0268	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-5


LOCLOOP_190  . . . . . . . . . .  	L NEAR	0F9D	CODE
LOCLOOP_191  . . . . . . . . . .  	L NEAR	0FA6	CODE
LOCLOOP_196  . . . . . . . . . .  	L NEAR	10BC	CODE
LOCLOOP_229  . . . . . . . . . .  	L NEAR	1307	CODE
LOCLOOP_233  . . . . . . . . . .  	L NEAR	132B	CODE
LOCLOOP_236  . . . . . . . . . .  	L NEAR	134B	CODE
LOCLOOP_259  . . . . . . . . . .  	L NEAR	14E0	CODE
LOCLOOP_264  . . . . . . . . . .  	L NEAR	1513	CODE
LOCLOOP_27 . . . . . . . . . . .  	L NEAR	0341	CODE
LOCLOOP_276  . . . . . . . . . .  	L NEAR	15ED	CODE
LOCLOOP_31 . . . . . . . . . . .  	L NEAR	03B6	CODE
LOCLOOP_33 . . . . . . . . . . .  	L NEAR	03CC	CODE
LOCLOOP_36 . . . . . . . . . . .  	L NEAR	03F5	CODE
LOCLOOP_50 . . . . . . . . . . .  	L NEAR	046C	CODE
LOCLOOP_52 . . . . . . . . . . .  	L NEAR	04F3	CODE
LOCLOOP_61 . . . . . . . . . . .  	L NEAR	05AB	CODE
LOCLOOP_63 . . . . . . . . . . .  	L NEAR	05B6	CODE
LOCLOOP_64 . . . . . . . . . . .  	L NEAR	05BC	CODE
LOCLOOP_65 . . . . . . . . . . .  	L NEAR	05BE	CODE
LOCLOOP_7  . . . . . . . . . . .  	L NEAR	0148	CODE
LOCLOOP_9  . . . . . . . . . . .  	L NEAR	015E	CODE
LOCLOOP_93 . . . . . . . . . . .  	L NEAR	080F	CODE
LOCLOOP_96 . . . . . . . . . . .  	L NEAR	0821	CODE
LOC_10 . . . . . . . . . . . . .  	L NEAR	0168	CODE
LOC_101  . . . . . . . . . . . .  	L NEAR	0895	CODE
LOC_104  . . . . . . . . . . . .  	L NEAR	08BC	CODE
LOC_107  . . . . . . . . . . . .  	L NEAR	08E0	CODE
LOC_108  . . . . . . . . . . . .  	L NEAR	0906	CODE
LOC_109  . . . . . . . . . . . .  	L NEAR	0929	CODE
LOC_11 . . . . . . . . . . . . .  	L NEAR	0180	CODE
LOC_110  . . . . . . . . . . . .  	L NEAR	094C	CODE
LOC_111  . . . . . . . . . . . .  	L NEAR	096A	CODE
LOC_112  . . . . . . . . . . . .  	L NEAR	098C	CODE
LOC_113  . . . . . . . . . . . .  	L NEAR	09A6	CODE
LOC_115  . . . . . . . . . . . .  	L NEAR	09F9	CODE
LOC_116  . . . . . . . . . . . .  	L NEAR	0A02	CODE
LOC_117  . . . . . . . . . . . .  	L NEAR	0A11	CODE
LOC_119  . . . . . . . . . . . .  	L NEAR	0A1D	CODE
LOC_12 . . . . . . . . . . . . .  	L NEAR	01D9	CODE
LOC_120  . . . . . . . . . . . .  	L NEAR	0A22	CODE
LOC_121  . . . . . . . . . . . .  	L NEAR	0A27	CODE
LOC_122  . . . . . . . . . . . .  	L NEAR	0A2E	CODE
LOC_124  . . . . . . . . . . . .  	L NEAR	0A48	CODE
LOC_126  . . . . . . . . . . . .  	L NEAR	0A81	CODE
LOC_127  . . . . . . . . . . . .  	L NEAR	0A82	CODE
LOC_128  . . . . . . . . . . . .  	L NEAR	0A8B	CODE
LOC_129  . . . . . . . . . . . .  	L NEAR	0A9B	CODE
LOC_13 . . . . . . . . . . . . .  	L NEAR	01F4	CODE
LOC_130  . . . . . . . . . . . .  	L NEAR	0A9F	CODE
LOC_131  . . . . . . . . . . . .  	L NEAR	0AB0	CODE
LOC_132  . . . . . . . . . . . .  	L NEAR	0AC6	CODE
LOC_139  . . . . . . . . . . . .  	L NEAR	0BA6	CODE
LOC_141  . . . . . . . . . . . .  	L NEAR	0D1D	CODE
LOC_142  . . . . . . . . . . . .  	L NEAR	0D30	CODE
LOC_144  . . . . . . . . . . . .  	L NEAR	0D49	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-6


LOC_145  . . . . . . . . . . . .  	L NEAR	0D5E	CODE
LOC_146  . . . . . . . . . . . .  	L NEAR	0D6C	CODE
LOC_147  . . . . . . . . . . . .  	L NEAR	0D72	CODE
LOC_148  . . . . . . . . . . . .  	L NEAR	0D79	CODE
LOC_149  . . . . . . . . . . . .  	L NEAR	0D91	CODE
LOC_150  . . . . . . . . . . . .  	L NEAR	0DB0	CODE
LOC_151  . . . . . . . . . . . .  	L NEAR	0DB8	CODE
LOC_152  . . . . . . . . . . . .  	L NEAR	0DCC	CODE
LOC_153  . . . . . . . . . . . .  	L NEAR	0DD5	CODE
LOC_154  . . . . . . . . . . . .  	L NEAR	0DDF	CODE
LOC_155  . . . . . . . . . . . .  	L NEAR	0E17	CODE
LOC_156  . . . . . . . . . . . .  	L NEAR	0E20	CODE
LOC_157  . . . . . . . . . . . .  	L NEAR	0E3C	CODE
LOC_158  . . . . . . . . . . . .  	L NEAR	0E4D	CODE
LOC_159  . . . . . . . . . . . .  	L NEAR	0E5D	CODE
LOC_16 . . . . . . . . . . . . .  	L NEAR	0261	CODE
LOC_160  . . . . . . . . . . . .  	L NEAR	0E61	CODE
LOC_161  . . . . . . . . . . . .  	L NEAR	0E64	CODE
LOC_162  . . . . . . . . . . . .  	L NEAR	0E6E	CODE
LOC_163  . . . . . . . . . . . .  	L NEAR	0E91	CODE
LOC_164  . . . . . . . . . . . .  	L NEAR	0EA2	CODE
LOC_165  . . . . . . . . . . . .  	L NEAR	0EAC	CODE
LOC_166  . . . . . . . . . . . .  	L NEAR	0EB6	CODE
LOC_167  . . . . . . . . . . . .  	L NEAR	0EC0	CODE
LOC_168  . . . . . . . . . . . .  	L NEAR	0EC6	CODE
LOC_169  . . . . . . . . . . . .  	L NEAR	0EDB	CODE
LOC_170  . . . . . . . . . . . .  	L NEAR	0EE2	CODE
LOC_171  . . . . . . . . . . . .  	L NEAR	0EEC	CODE
LOC_172  . . . . . . . . . . . .  	L NEAR	0EF1	CODE
LOC_173  . . . . . . . . . . . .  	L NEAR	0EFF	CODE
LOC_174  . . . . . . . . . . . .  	L NEAR	0F0E	CODE
LOC_175  . . . . . . . . . . . .  	L NEAR	0F13	CODE
LOC_176  . . . . . . . . . . . .  	L NEAR	0F18	CODE
LOC_177  . . . . . . . . . . . .  	L NEAR	0F1F	CODE
LOC_178  . . . . . . . . . . . .  	L NEAR	0F26	CODE
LOC_179  . . . . . . . . . . . .  	L NEAR	0F2E	CODE
LOC_18 . . . . . . . . . . . . .  	L NEAR	0279	CODE
LOC_180  . . . . . . . . . . . .  	L NEAR	0F31	CODE
LOC_181  . . . . . . . . . . . .  	L NEAR	0F35	CODE
LOC_182  . . . . . . . . . . . .  	L NEAR	0F3E	CODE
LOC_183  . . . . . . . . . . . .  	L NEAR	0F58	CODE
LOC_184  . . . . . . . . . . . .  	L NEAR	0F5B	CODE
LOC_185  . . . . . . . . . . . .  	L NEAR	0F65	CODE
LOC_186  . . . . . . . . . . . .  	L NEAR	0F7D	CODE
LOC_187  . . . . . . . . . . . .  	L NEAR	0F83	CODE
LOC_188  . . . . . . . . . . . .  	L NEAR	0F85	CODE
LOC_189  . . . . . . . . . . . .  	L NEAR	0F96	CODE
LOC_19 . . . . . . . . . . . . .  	L NEAR	028C	CODE
LOC_192  . . . . . . . . . . . .  	L NEAR	100D	CODE
LOC_194  . . . . . . . . . . . .  	L NEAR	1085	CODE
LOC_195  . . . . . . . . . . . .  	L NEAR	10B9	CODE
LOC_197  . . . . . . . . . . . .  	L NEAR	10E2	CODE
LOC_198  . . . . . . . . . . . .  	L NEAR	10E5	CODE
LOC_199  . . . . . . . . . . . .  	L NEAR	1133	CODE
LOC_20 . . . . . . . . . . . . .  	L NEAR	02AB	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-7


LOC_200  . . . . . . . . . . . .  	L NEAR	1137	CODE
LOC_201  . . . . . . . . . . . .  	L NEAR	113A	CODE
LOC_204  . . . . . . . . . . . .  	L NEAR	1177	CODE
LOC_208  . . . . . . . . . . . .  	L NEAR	11D9	CODE
LOC_209  . . . . . . . . . . . .  	L NEAR	11E0	CODE
LOC_21 . . . . . . . . . . . . .  	L NEAR	02B7	CODE
LOC_212  . . . . . . . . . . . .  	L NEAR	121B	CODE
LOC_213  . . . . . . . . . . . .  	L NEAR	1229	CODE
LOC_214  . . . . . . . . . . . .  	L NEAR	1234	CODE
LOC_215  . . . . . . . . . . . .  	L NEAR	1237	CODE
LOC_216  . . . . . . . . . . . .  	L NEAR	1240	CODE
LOC_217  . . . . . . . . . . . .  	L NEAR	1253	CODE
LOC_218  . . . . . . . . . . . .  	L NEAR	1256	CODE
LOC_220  . . . . . . . . . . . .  	L NEAR	12A1	CODE
LOC_221  . . . . . . . . . . . .  	L NEAR	12AF	CODE
LOC_222  . . . . . . . . . . . .  	L NEAR	12BA	CODE
LOC_223  . . . . . . . . . . . .  	L NEAR	12BD	CODE
LOC_224  . . . . . . . . . . . .  	L NEAR	12C9	CODE
LOC_226  . . . . . . . . . . . .  	L NEAR	12DA	CODE
LOC_227  . . . . . . . . . . . .  	L NEAR	12E8	CODE
LOC_228  . . . . . . . . . . . .  	L NEAR	12EE	CODE
LOC_230  . . . . . . . . . . . .  	L NEAR	130D	CODE
LOC_232  . . . . . . . . . . . .  	L NEAR	1320	CODE
LOC_235  . . . . . . . . . . . .  	L NEAR	1342	CODE
LOC_239  . . . . . . . . . . . .  	L NEAR	137D	CODE
LOC_240  . . . . . . . . . . . .  	L NEAR	1384	CODE
LOC_241  . . . . . . . . . . . .  	L NEAR	139B	CODE
LOC_242  . . . . . . . . . . . .  	L NEAR	13B3	CODE
LOC_243  . . . . . . . . . . . .  	L NEAR	13BD	CODE
LOC_244  . . . . . . . . . . . .  	L NEAR	13CB	CODE
LOC_245  . . . . . . . . . . . .  	L NEAR	13E9	CODE
LOC_246  . . . . . . . . . . . .  	L NEAR	1401	CODE
LOC_247  . . . . . . . . . . . .  	L NEAR	1410	CODE
LOC_248  . . . . . . . . . . . .  	L NEAR	1412	CODE
LOC_249  . . . . . . . . . . . .  	L NEAR	1420	CODE
LOC_250  . . . . . . . . . . . .  	L NEAR	1424	CODE
LOC_251  . . . . . . . . . . . .  	L NEAR	1444	CODE
LOC_252  . . . . . . . . . . . .  	L NEAR	1460	CODE
LOC_253  . . . . . . . . . . . .  	L NEAR	146F	CODE
LOC_254  . . . . . . . . . . . .  	L NEAR	1471	CODE
LOC_255  . . . . . . . . . . . .  	L NEAR	1480	CODE
LOC_256  . . . . . . . . . . . .  	L NEAR	14AE	CODE
LOC_257  . . . . . . . . . . . .  	L NEAR	14C1	CODE
LOC_258  . . . . . . . . . . . .  	L NEAR	14D0	CODE
LOC_26 . . . . . . . . . . . . .  	L NEAR	0326	CODE
LOC_260  . . . . . . . . . . . .  	L NEAR	14E4	CODE
LOC_261  . . . . . . . . . . . .  	L NEAR	14EC	CODE
LOC_262  . . . . . . . . . . . .  	L NEAR	1500	CODE
LOC_263  . . . . . . . . . . . .  	L NEAR	150C	CODE
LOC_265  . . . . . . . . . . . .  	L NEAR	1517	CODE
LOC_266  . . . . . . . . . . . .  	L NEAR	1529	CODE
LOC_267  . . . . . . . . . . . .  	L NEAR	1545	CODE
LOC_268  . . . . . . . . . . . .  	L NEAR	1560	CODE
LOC_269  . . . . . . . . . . . .  	L NEAR	1575	CODE
LOC_270  . . . . . . . . . . . .  	L NEAR	158D	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-8


LOC_271  . . . . . . . . . . . .  	L NEAR	1591	CODE
LOC_272  . . . . . . . . . . . .  	L NEAR	15A3	CODE
LOC_273  . . . . . . . . . . . .  	L NEAR	15B0	CODE
LOC_274  . . . . . . . . . . . .  	L NEAR	15B5	CODE
LOC_275  . . . . . . . . . . . .  	L NEAR	15DE	CODE
LOC_277  . . . . . . . . . . . .  	L NEAR	1602	CODE
LOC_278  . . . . . . . . . . . .  	L NEAR	1626	CODE
LOC_279  . . . . . . . . . . . .  	L NEAR	162C	CODE
LOC_28 . . . . . . . . . . . . .  	L NEAR	0365	CODE
LOC_281  . . . . . . . . . . . .  	L NEAR	1680	CODE
LOC_282  . . . . . . . . . . . .  	L NEAR	1693	CODE
LOC_283  . . . . . . . . . . . .  	L NEAR	1699	CODE
LOC_284  . . . . . . . . . . . .  	L NEAR	16A7	CODE
LOC_285  . . . . . . . . . . . .  	L NEAR	16A9	CODE
LOC_286  . . . . . . . . . . . .  	L NEAR	16AD	CODE
LOC_287  . . . . . . . . . . . .  	L NEAR	16AF	CODE
LOC_288  . . . . . . . . . . . .  	L NEAR	16B3	CODE
LOC_289  . . . . . . . . . . . .  	L NEAR	16BC	CODE
LOC_29 . . . . . . . . . . . . .  	L NEAR	0368	CODE
LOC_290  . . . . . . . . . . . .  	L NEAR	16C0	CODE
LOC_291  . . . . . . . . . . . .  	L NEAR	16C7	CODE
LOC_293  . . . . . . . . . . . .  	L NEAR	1715	CODE
LOC_294  . . . . . . . . . . . .  	L NEAR	173C	CODE
LOC_295  . . . . . . . . . . . .  	L NEAR	1748	CODE
LOC_296  . . . . . . . . . . . .  	L NEAR	175A	CODE
LOC_297  . . . . . . . . . . . .  	L NEAR	175C	CODE
LOC_298  . . . . . . . . . . . .  	L NEAR	1766	CODE
LOC_3  . . . . . . . . . . . . .  	L NEAR	0038	CODE
LOC_30 . . . . . . . . . . . . .  	L NEAR	03AB	CODE
LOC_309  . . . . . . . . . . . .  	L NEAR	1C0A	CODE
LOC_310  . . . . . . . . . . . .  	L NEAR	1C15	CODE
LOC_311  . . . . . . . . . . . .  	L NEAR	1C1B	CODE
LOC_312  . . . . . . . . . . . .  	L NEAR	1C26	CODE
LOC_32 . . . . . . . . . . . . .  	L NEAR	03C8	CODE
LOC_34 . . . . . . . . . . . . .  	L NEAR	03DE	CODE
LOC_35 . . . . . . . . . . . . .  	L NEAR	03E6	CODE
LOC_37 . . . . . . . . . . . . .  	L NEAR	0400	CODE
LOC_38 . . . . . . . . . . . . .  	L NEAR	0405	CODE
LOC_39 . . . . . . . . . . . . .  	L NEAR	0413	CODE
LOC_4  . . . . . . . . . . . . .  	L NEAR	004E	CODE
LOC_40 . . . . . . . . . . . . .  	L NEAR	0429	CODE
LOC_41 . . . . . . . . . . . . .  	L NEAR	0430	CODE
LOC_42 . . . . . . . . . . . . .  	L NEAR	0437	CODE
LOC_43 . . . . . . . . . . . . .  	L NEAR	043E	CODE
LOC_44 . . . . . . . . . . . . .  	L NEAR	0445	CODE
LOC_45 . . . . . . . . . . . . .  	L NEAR	044C	CODE
LOC_47 . . . . . . . . . . . . .  	L NEAR	0454	CODE
LOC_48 . . . . . . . . . . . . .  	L NEAR	0465	CODE
LOC_49 . . . . . . . . . . . . .  	L NEAR	0468	CODE
LOC_5  . . . . . . . . . . . . .  	L NEAR	0058	CODE
LOC_51 . . . . . . . . . . . . .  	L NEAR	04B8	CODE
LOC_53 . . . . . . . . . . . . .  	L NEAR	0533	CODE
LOC_54 . . . . . . . . . . . . .  	L NEAR	0553	CODE
LOC_55 . . . . . . . . . . . . .  	L NEAR	055C	CODE
LOC_56 . . . . . . . . . . . . .  	L NEAR	0573	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-9


LOC_57 . . . . . . . . . . . . .  	L NEAR	0575	CODE
LOC_58 . . . . . . . . . . . . .  	L NEAR	0587	CODE
LOC_59 . . . . . . . . . . . . .  	L NEAR	059A	CODE
LOC_6  . . . . . . . . . . . . .  	L NEAR	0098	CODE
LOC_60 . . . . . . . . . . . . .  	L NEAR	05A6	CODE
LOC_62 . . . . . . . . . . . . .  	L NEAR	05B1	CODE
LOC_67 . . . . . . . . . . . . .  	L NEAR	05E5	CODE
LOC_79 . . . . . . . . . . . . .  	L NEAR	06F2	CODE
LOC_81 . . . . . . . . . . . . .  	L NEAR	071E	CODE
LOC_82 . . . . . . . . . . . . .  	L NEAR	0728	CODE
LOC_83 . . . . . . . . . . . . .  	L NEAR	073C	CODE
LOC_84 . . . . . . . . . . . . .  	L NEAR	075E	CODE
LOC_85 . . . . . . . . . . . . .  	L NEAR	078F	CODE
LOC_86 . . . . . . . . . . . . .  	L NEAR	0792	CODE
LOC_87 . . . . . . . . . . . . .  	L NEAR	07CF	CODE
LOC_88 . . . . . . . . . . . . .  	L NEAR	07D1	CODE
LOC_90 . . . . . . . . . . . . .  	L NEAR	07D9	CODE
LOC_91 . . . . . . . . . . . . .  	L NEAR	07E3	CODE
LOC_92 . . . . . . . . . . . . .  	L NEAR	0808	CODE
LOC_94 . . . . . . . . . . . . .  	L NEAR	0816	CODE
LOC_95 . . . . . . . . . . . . .  	L NEAR	081F	CODE
LOC_97 . . . . . . . . . . . . .  	L NEAR	082A	CODE
LOC_98 . . . . . . . . . . . . .  	L NEAR	086A	CODE
LOC_99 . . . . . . . . . . . . .  	L NEAR	0888	CODE
LOC_RET_102  . . . . . . . . . .  	L NEAR	0897	CODE
LOC_RET_112  . . . . . . . . . .  	L NEAR	09A5	CODE
LOC_RET_140  . . . . . . . . . .  	L NEAR	0BDF	CODE
LOC_RET_46 . . . . . . . . . . .  	L NEAR	0453	CODE
LOC_RET_68 . . . . . . . . . . .  	L NEAR	05F5	CODE
LOC_RET_89 . . . . . . . . . . .  	L NEAR	07D8	CODE
LPENCLR  . . . . . . . . . . . .  	NUMBER	03DB	
LPENSET  . . . . . . . . . . . .  	NUMBER	03DC	
LPTTO  . . . . . . . . . . . . .  	L BYTE	0078	DATA	Length = 0004

MAIN_RAM_SIZE  . . . . . . . . .  	L WORD	0013	DATA
MASKR  . . . . . . . . . . . . .  	NUMBER	0008	
MAXCOLS  . . . . . . . . . . . .  	L NEAR	1069	CODE
MC6845R0 . . . . . . . . . . . .  	NUMBER	03D0	
MC6845R1 . . . . . . . . . . . .  	NUMBER	03D1	
MC6845R2 . . . . . . . . . . . .  	NUMBER	03D2	
MC6845R3 . . . . . . . . . . . .  	NUMBER	03D3	
MC6845R4 . . . . . . . . . . . .  	NUMBER	03D4	
MC6845R5 . . . . . . . . . . . .  	NUMBER	03D5	
MC6845R6 . . . . . . . . . . . .  	NUMBER	03D6	
MC6845R7 . . . . . . . . . . . .  	NUMBER	03D7	
MDRAM  . . . . . . . . . . . . .  	NUMBER	FFE0	
MFG_TEST . . . . . . . . . . . .  	L BYTE	0012	DATA
MMCS . . . . . . . . . . . . . .  	NUMBER	0006	
MODES  . . . . . . . . . . . . .  	L NEAR	1071	CODE
MPCS . . . . . . . . . . . . . .  	NUMBER	0008	
MSG1 . . . . . . . . . . . . . .  	L NEAR	00C9	CODE
MSG2 . . . . . . . . . . . . . .  	L NEAR	00FA	CODE
MSG3 . . . . . . . . . . . . . .  	L NEAR	0126	CODE
MSG4 . . . . . . . . . . . . . .  	L NEAR	0185	CODE
MSG5 . . . . . . . . . . . . . .  	L NEAR	0BBA	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-10



NEC_STAT . . . . . . . . . . . .  	L BYTE	0042	DATA	Length = 0007
NUM_KEY  . . . . . . . . . . . .  	NUMBER	0045	
NUM_SHIFT  . . . . . . . . . . .  	NUMBER	0020	
NUM_STATE  . . . . . . . . . . .  	NUMBER	0020	

PACS . . . . . . . . . . . . . .  	NUMBER	0004	
PAD  . . . . . . . . . . . . . .  	NUMBER	0009	
PCRBASE  . . . . . . . . . . . .  	NUMBER	FF00	
PDCOM  . . . . . . . . . . . . .  	NUMBER	FFF0	
PENOFF . . . . . . . . . . . . .  	L NEAR	16CE	CODE
PMR  . . . . . . . . . . . . . .  	NUMBER	000A	
POLLR  . . . . . . . . . . . . .  	NUMBER	0004	
POLLS  . . . . . . . . . . . . .  	NUMBER	0006	
POWER  . . . . . . . . . . . . .  	L NEAR	1FF0	CODE	Global
PPIBASE  . . . . . . . . . . . .  	NUMBER	00D0	
PPI_B  . . . . . . . . . . . . .  	NUMBER	00D2	
PPI_C  . . . . . . . . . . . . .  	NUMBER	00D4	
PPI_CR . . . . . . . . . . . . .  	NUMBER	00D6	
PRINTER_PORT . . . . . . . . . .  	NUMBER	00D0	
PRN_PORT_1 . . . . . . . . . . .  	L WORD	0008	DATA	Length = 0004
PROCCMD1 . . . . . . . . . . . .  	L NEAR	0663	CODE
PROCCMD2 . . . . . . . . . . . .  	L NEAR	0674	CODE
PROCCMD3 . . . . . . . . . . . .  	L NEAR	067B	CODE
PROCCMD4 . . . . . . . . . . . .  	L NEAR	0682	CODE
PROCCMD5 . . . . . . . . . . . .  	L NEAR	0689	CODE
PROCDISKCMD  . . . . . . . . . .  	N PROC	0649	CODE	Length = 01A0
PRTZSTR  . . . . . . . . . . . .  	N PROC	05E5	CODE	Length = 0011

RAMTEST  . . . . . . . . . . . .  	N PROC	01BF	CODE	Length = 0065
READ_AC_CURRENT  . . . . . . . .  	L NEAR	12CD	CODE
READ_CURSOR  . . . . . . . . . .  	L NEAR	118A	CODE
READ_DOT . . . . . . . . . . . .  	L NEAR	1354	CODE
READ_LPEN  . . . . . . . . . . .  	L NEAR	16D6	CODE
REGENL . . . . . . . . . . . . .  	L NEAR	1061	CODE
RIGHT_KEY  . . . . . . . . . . .  	NUMBER	0036	
RIGHT_SHIFT  . . . . . . . . . .  	NUMBER	0001	
ROMSEARCH  . . . . . . . . . . .  	ALIAS	 FALSE		
RR . . . . . . . . . . . . . . .  	NUMBER	FFFE	
RS232_PORT_1 . . . . . . . . . .  	L WORD	0000	DATA	Length = 0004

SCRATCH1 . . . . . . . . . . . .  	L BYTE	0015	DATA
SCROLL_DOWN  . . . . . . . . . .  	L NEAR	1291	CODE
SCROLL_KEY . . . . . . . . . . .  	NUMBER	0046	
SCROLL_SHIFT . . . . . . . . . .  	NUMBER	0010	
SCROLL_STATE . . . . . . . . . .  	NUMBER	0010	
SCROLL_UP  . . . . . . . . . . .  	L NEAR	120C	CODE
SCSI . . . . . . . . . . . . . .  	ALIAS	 FALSE		
SCSI_OPTIONS . . . . . . . . . .  	NUMBER	0000	
SETSERERRFL  . . . . . . . . . .  	N PROC	0420	CODE	Length = 0034
SET_COLOR  . . . . . . . . . . .  	L NEAR	11C4	CODE
SET_CPOS . . . . . . . . . . . .  	L NEAR	1160	CODE
SET_CTYPE  . . . . . . . . . . .  	L NEAR	113F	CODE
SET_MODE . . . . . . . . . . . .  	L NEAR	1079	CODE
SIGNBIT  . . . . . . . . . . . .  	L BYTE	0071	DATA
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-11


SUB_13 . . . . . . . . . . . . .  	N PROC	0808	CODE	Length = 002C
SUB_15 . . . . . . . . . . . . .  	N PROC	0845	CODE	Length = 0053
SUB_16 . . . . . . . . . . . . .  	N PROC	0898	CODE	Length = 002B
SUB_17 . . . . . . . . . . . . .  	N PROC	08C3	CODE	Length = 000A
SUB_18 . . . . . . . . . . . . .  	N PROC	08E7	CODE	Length = 00A5
SUB_19 . . . . . . . . . . . . .  	N PROC	09AD	CODE	Length = 0009
SUB_20 . . . . . . . . . . . . .  	N PROC	09B6	CODE	Length = 0009
SUB_21 . . . . . . . . . . . . .  	N PROC	09BF	CODE	Length = 0049
SUB_22 . . . . . . . . . . . . .  	N PROC	0A08	CODE	Length = 0044
SUB_23 . . . . . . . . . . . . .  	N PROC	0A4C	CODE	Length = 000D
SUB_24 . . . . . . . . . . . . .  	N PROC	0A59	CODE	Length = 002E
SUB_25 . . . . . . . . . . . . .  	N PROC	0A87	CODE	Length = 0017
SUB_26 . . . . . . . . . . . . .  	N PROC	0A9E	CODE	Length = 0014
SUB_27 . . . . . . . . . . . . .  	N PROC	0AB2	CODE	Length = 0017
SUB_30 . . . . . . . . . . . . .  	N PROC	0BD3	CODE	Length = 000D
SUB_31 . . . . . . . . . . . . .  	N PROC	0F8D	CODE	Length = 0025
SUB_32 . . . . . . . . . . . . .  	N PROC	0FB2	CODE	Length = 0020
SUB_33 . . . . . . . . . . . . .  	N PROC	114A	CODE	Length = 0016
SUB_34 . . . . . . . . . . . . .  	N PROC	1179	CODE	Length = 0011
SUB_35 . . . . . . . . . . . . .  	N PROC	11FB	CODE	Length = 0011
SUB_36 . . . . . . . . . . . . .  	N PROC	125A	CODE	Length = 0027
SUB_37 . . . . . . . . . . . . .  	N PROC	1281	CODE	Length = 0009
SUB_38 . . . . . . . . . . . . .  	N PROC	128A	CODE	Length = 0007
SUB_39 . . . . . . . . . . . . .  	N PROC	12F7	CODE	Length = 001C
SUB_40 . . . . . . . . . . . . .  	N PROC	1388	CODE	Length = 0043
SUB_41 . . . . . . . . . . . . .  	N PROC	1484	CODE	Length = 0019
SUB_42 . . . . . . . . . . . . .  	N PROC	149D	CODE	Length = 0011
SUB_43 . . . . . . . . . . . . .  	N PROC	15E4	CODE	Length = 0015
SUB_44 . . . . . . . . . . . . .  	N PROC	15F9	CODE	Length = 0023
SUB_45 . . . . . . . . . . . . .  	N PROC	161C	CODE	Length = 001D
SUB_46 . . . . . . . . . . . . .  	N PROC	1639	CODE	Length = 0016
SUB_47 . . . . . . . . . . . . .  	L NEAR	163C	CODE
SUB_6  . . . . . . . . . . . . .  	N PROC	0468	CODE	Length = 000B
SYSBOOT  . . . . . . . . . . . .  	L NEAR	0151	CODE

T0CR . . . . . . . . . . . . . .  	NUMBER	0012	
TIMER_HI . . . . . . . . . . . .  	L WORD	006E	DATA
TIMER_LOW  . . . . . . . . . . .  	L WORD	006C	DATA
TIMER_ROLLED . . . . . . . . . .  	L BYTE	0070	DATA
TM0CR  . . . . . . . . . . . . .  	NUMBER	FF50	
TM1CR  . . . . . . . . . . . . .  	NUMBER	FF58	
TM2CR  . . . . . . . . . . . . .  	NUMBER	FF60	
TMRCA  . . . . . . . . . . . . .  	NUMBER	0002	
TMRCB  . . . . . . . . . . . . .  	NUMBER	0004	
TMRCR  . . . . . . . . . . . . .  	NUMBER	0000	
TMRCW  . . . . . . . . . . . . .  	NUMBER	0006	
TRUE . . . . . . . . . . . . . .  	NUMBER	00FF	

UMCR . . . . . . . . . . . . . .  	NUMBER	0000	

VIDEO_BUF_SIZ  . . . . . . . . .  	L WORD	004C	DATA
VIDEO_COLOR  . . . . . . . . . .  	L BYTE	0066	DATA
VIDEO_COLUMNS  . . . . . . . . .  	L WORD	004A	DATA
VIDEO_MODE . . . . . . . . . . .  	L BYTE	0049	DATA
VIDEO_MODE_REG . . . . . . . . .  	L BYTE	0065	DATA
Microsoft (R) Macro Assembler Version 5.10A                 6/7/25 06:29:42

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-12


VIDEO_PAGE . . . . . . . . . . .  	L BYTE	0062	DATA
VIDEO_PORT . . . . . . . . . . .  	L WORD	0063	DATA
VIDEO_SEGMENT  . . . . . . . . .  	L WORD	004E	DATA
VIDEO_STATE  . . . . . . . . . .  	L NEAR	11EA	CODE
VID_CURS_MODE  . . . . . . . . .  	L WORD	0060	DATA
VID_CURS_POS0  . . . . . . . . .  	L WORD	0050	DATA	Length = 0008
V_TABLE  . . . . . . . . . . . .  	L NEAR	0FD2	CODE

WARMBOOT . . . . . . . . . . . .  	L WORD	0072	DATA
WD100X . . . . . . . . . . . . .  	ALIAS	 FALSE		
WRITE_AC_CURRENT . . . . . . . .  	L NEAR	1313	CODE
WRITE_C_CURRENT  . . . . . . . .  	L NEAR	1335	CODE
WRITE_DOT  . . . . . . . . . . .  	L NEAR	1365	CODE
WRITE_TTY  . . . . . . . . . . .  	L NEAR	164F	CODE

XEROX  . . . . . . . . . . . . .  	L BYTE	0000	DOSDIR

@CPU . . . . . . . . . . . . . .  	TEXT  259		
@FILENAME  . . . . . . . . . . .  	TEXT  cm5		
@VERSION . . . . . . . . . . . .  	TEXT  510		


   4799 Source  Lines
   4819 Total   Lines
    592 Symbols

  45834 + 385265 Bytes symbol space free

      0 Warning Errors
      0 Severe  Errors
