Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-1


       1				TITLE LDP THUNDER REV 1.0 10/21/85 Colo
					r Magic ROM
       2				PAGE  59,132
       3				
       4				;option M510	; Assume MASM 5.1 if using MASM 6.11
       5				
       6				;
       7				; This is an IBM/PC-compatible BIOS ROM for installation in 
       8				; the Thunder 186 single-board computer when used with the
       9				; Color Magic CGA video board. By default, the Thunder 186
      10				; comes with a conventional monitor ROM -- I would guess that
      11				; this ROM was included with the purchase of the Color Magic,
      12				; possibly as an extra-cost option since the Color Magic
      13				; could be used in any other PC-capable S100 setup.
      14				;
      15				
      16				; NOTE: The Ampro LittleBoard 186 can boot from the SCSI channel
      17				;	so this might be an option... 
      18				; SCSI IRQ 3, port 310h, D8000h
      19				;
      20				; There is a system equates file referenced from the monitor and
      21				; several hardware-specific files for initializing the 80186 and
      22				; as the includes for the storage hardware. These have been 
      23				; re-created.
      24				;
      25				; general items:
      26				;	tmr0 = serial 0 clock
      27				;	tmr1 = serial 1 clock
      28				;	UCS = ROM @ FE000
      29				;	LCS = 256k RAM
      30				;	DRQ0 = bus DMA0
      31				;	DRQ1 = floppy DRQ and bus DMA1
      32				;	INT0 = bus VI0			} need to verify
      33				;	INT1 = bus VI2/VI3		}
      34				;	INT2 = bus VI4			}
      35				;	INT3 = bus VI6/VI7 and RX1/RX2	}
      36				;	NMI = parity fail (unused with SRAM) and bus NMI
      37				;
      38				;               masm cm5;              ( Assemble source code)
      39				;               link cm5;              ( Link the object code)
      40				;               debug cm5.EXE          ( Exe2bin  binary code)
      41				;               -ncm5.BIN              ( Name of the output binary)
      42				;;              -rBX                   ( Opens hi order byte count)
      43				;;              :0                     (  ... must be 0 bytes long)
      44				;;              -rCX                   ( Opens lo order byte count)
      45				;;              :2000                  (  ... ROM is  2000 bytes long)
      46				;;              -wCS:0	               ( Output to CM5.BIN file)
      47				;;		-q
      48				;
      49				; I compiled a small program called chksum.exe using Visual C/C++ 1.52 running on
      50				; Windows 3.1, based on an example I found on-line. It's a simple two's-compliment
      51				; checksum. You need to run this on the CM5.BIN file otherwise it will checksum
      52				; the MZ header as well. You can use a file/hex editor to patch it. If unaltered, 
      53				; the checksum byte should be:
      54				;
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-2


      55				;	NORMAL: 	EDh
      56				;	ROMSEARCH:	??h
      57				;
      58				; It seems that the code does test the checksum byte, but proceeds even if the
      59				; checksum is bad, unlike the PC which will halt on a bad checksum.
      60				;
      61				;===============================================================================
      62				
      63 = 0000				FALSE		equ	0
      64 = 00FF				TRUE		equ	0ffh
      65 = 000A				LF		equ	0Ah
      66 = 000D				CR		equ	0Dh
      67				
      68				; System compilation options
      69 =				DEBUGF		equ	TRUE		; allows marco expansion
      70 =				ROMSEARCH	equ	FALSE		; set true to include expansion ROM search
      71 =				SCSI		equ	FALSE		; SCSI configuration enabled
      72				
      73				ELSE
      74 = 0000					scsi_options	equ	00000000b	;indicate no SCSI is present
      75				ENDIF
      76				
      77				entry   macro   x
      78				        pad     =BANNER - $ + x	; - 0E000h
      79				        if pad LT 0
      80				        .err
      81				        %out    'No room for ENTRY point'
      82				        endif
      83				        if pad GT 0
      84				        db      pad DUP(0)
      85				        endif
      86				endm
      87				
      88				jmpf    macro   x,y
      89				        db      0EAh;
      90				        dw      y,x
      91				endm
      92				
      93				;===============================================================================
      94				;  Constants
      95				include "T186.ASM"		; system equates
      96			     C	; Lomas Thunder 186 specific code
      97			     C	;
      98			     C	
      99			     C	;
     100			     C	; Board-specific Registers.
     101			     C	;
     102			     C	; These blocks are decoded with a 74LS138. Blocks B0h,
     103			     C	; E0h, and F0h are unused.
     104			     C	;
     105			     C	; i8255 PPI. Note that the four registers are addresses
     106			     C	; using A1/A2 rather than A0/A1, meaning the ports are
     107			     C	; on the even bytes.
     108 = 00D0                      C	PPIBASE		equ	0D0h
     109 = 00D0                      C	printer_port	equ	PPIBASE+0	; port A
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-3


     110 = 00D2                      C	PPI_B		equ	PPIBASE+2	; port B
     111 = 00D4                      C	PPI_C		equ	PPIBASE+4	; port C
     112 = 00D6                      C	PPI_CR		equ	PPIBASE+6	; control register
     113			     C	
     114			     C	; 8251A, ports 0 and 1. Similar to the PPI, A1 is used to
     115			     C	; select the register.
     116 = 00C0                      C	ACIA0BASE	equ	0C0h		; J2 = COM2
     117 = 0080                      C	ACIA1BASE	equ	080h		; J1 = COM1
     118 = 0000                      C	DATAP		equ	0
     119 = 0002                      C	CTRLP		equ	2
     120			     C	
     121			     C	; Floppy
     122 = 0090                      C	FDCBASE		equ	090h
     123 = 00A0                      C	FDCDMA		equ	0A0h
     124 =                           C	FDSTAT		EQU	FDCBASE		;STATUS REGISTER
     125 = 0092                      C	FDDATA		EQU	FDCBASE+2	;DATA REGISTER
     126 = 0094                      C	FDDMA		EQU	FDCBASE+4	;DMA ADDRESS (WHEN WRITE)
     127 = 0094                      C	DFINTS		EQU	FDCBASE+4	;STATUS REGISTER (WHEN READ)
     128			     C	
     129			     C	; 80186 Peripheral Control Registers
     130			     C	; At reset, this block starts at 0FF00h in I/O space
     131 = FF00                      C	PCRBASE	equ	0ff00h
     132			     C	; Interrupts
     133 = FF20                      C	ICR	equ	PCRBASE+020h
     134 =                           C	IVR	equ	ICR
     135 = 0002                      C	EOIREG	equ	2	; specific EOI register
     136 = 0004                      C	POLLR	equ	4	; poll register
     137 = 0006                      C	POLLS	equ	6	; poll status register
     138 = 0008                      C	MASKR	equ	8	; mask register
     139 = 000A                      C	PMR	equ	0ah	; priority-level mask register
     140 = 000C                      C	ISVR	equ	0ch	; in-service register
     141 = 000E                      C	IRR	equ	0eh	; interrupt request register
     142 = 0010                      C	ISR	equ	010h	; interrupt status register
     143 = 0012                      C	T0CR	equ	012h	; timer 0 control register
     144 = 0014                      C	D0CR	equ	014h	; DMA0 control register
     145 = 0016                      C	D1CR	equ	016h	; DMA1 control register
     146 = 0018                      C	INT0CR	equ	018h	; INT0 control register
     147 = 001A                      C	INT1CR	equ	01ah	; INT1 control register
     148 = 001C                      C	INT2CR	equ	01ch	; INT2 control register
     149 = 001E                      C	INT3CR	equ	01eh	; INT3 control register
     150			     C	; Timers
     151 = FF50                      C	TM0CR	equ	PCRBASE+050h
     152 = FF58                      C	TM1CR	equ	PCRBASE+058h
     153 = FF60                      C	TM2CR	equ	PCRBASE+060h
     154			     C	; offsets in timer control block
     155 = 0000                      C	TMRCR	equ	0	; control register
     156 = 0002                      C	TMRCA	equ	2	; count register A
     157 = 0004                      C	TMRCB	equ	4	; count register B
     158 = 0006                      C	TMRCW	equ	6	; mode/control word
     159			     C	; memory control
     160 = FFA0                      C	CSCR	equ	PCRBASE+0a0h
     161 = 0000                      C	UMCR	equ	0
     162 = 0002                      C	LMCR	equ	2
     163 = 0004                      C	PACS	equ	4
     164 = 0006                      C	MMCS	equ	6
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-4


     165 = 0008                      C	MPCS	equ	8
     166			     C	; DMA
     167 = FFC0                      C	DMA0	equ	PCRBASE+0C0h
     168 = FFD0                      C	DMA1	equ	PCRBASE+0d0h
     169			     C	; offsets in DMA control block
     170 = 0000                      C	DMASP	equ	0	; source pointer
     171 = 0002                      C	DMASP1	equ	2	; source pointer high 4 bits
     172 = 0004                      C	DMADP	equ	4	; destination pointer
     173 = 0006                      C	DMADP1	equ	6	; destination pointer high 4 bits
     174 = 0008                      C	DMATC	equ	8	; transfer count
     175 = 000A                      C	DMACW	equ	0ah	; control word
     176			     C	; other registers
     177 = FFE0                      C	MDRAM	equ	PCRBASE+0e0h
     178 = FFE2                      C	CDRAM	equ	PCRBASE+0e2h
     179 = FFE4                      C	EDRAM	equ	PCRBASE+0e4h
     180 = FFF0                      C	PDCOM	equ	PCRBASE+0f0h
     181			     C	; Relocation Register
     182 = FFFE                      C	RR	equ	PCRBASE+0feh
     183				include "CM5D.ASM"		; ColorMagic-specific ports/data
     184			     C	; Lomas Color Magic specific equates. These are the
     185			     C	; IBM/PC-compatible port addresses.
     186			     C	;
     187 = 0040                      C	C5TIMER0	equ	40h
     188 = 0041                      C	C5TIMER1	equ	41h
     189 = 0042                      C	C5TIMER2	equ	42h
     190 = 0043                      C	C58253CTL	equ	43h
     191 = 0060                      C	C58255PA	equ	60h 
     192 = 0061                      C	C58255PB	equ	61h 
     193 = 0062                      C	C58255PC	equ	62h
     194 = 0063                      C	C58255CMD	equ	63h
     195 = 03D0                      C	MC6845R0	equ	03D0h
     196 = 03D1                      C	MC6845R1	equ	03D1h
     197 = 03D2                      C	MC6845R2	equ	03D2h
     198 = 03D3                      C	MC6845R3	equ	03D3h
     199 = 03D4                      C	MC6845R4	equ	03D4h
     200 = 03D5                      C	MC6845R5	equ	03D5h
     201 = 03D6                      C	MC6845R6	equ	03D6h
     202 = 03D7                      C	MC6845R7	equ	03D7h
     203 = 03D8                      C	CGAMODE		equ	03D8h
     204 = 03D9                      C	CGACOLOR	equ	03D9h
     205 = 03DA                      C	CGASTAT		equ	03DAh
     206 = 03DB                      C	LPENCLR		equ	03DBh
     207 = 03DC                      C	LPENSET		equ	03DCh
     208			     C	; 8272 layout, which differs from NEC D765
     209 = 03F0                      C	FDPORT		EQU	03F0H		;BASE PORT ADDRESS FOR CONTROLLER (F0-F7)
     210 =                           C	FDCS		EQU	FDPORT		;STATUS REGISTER
     211 = 03F1                      C	FDCD		EQU	FDPORT+1	;DATA REGISTER
     212 = 03F2                      C	FDMA		EQU	FDPORT+2	;DMA ADDRESS (WHEN WRITE)
     213 = 03F2                      C	INTS		EQU	FDPORT+2	;STATUS REGISTER (WHEN READ)
     214			     C	; D765 Layout
     215			     C	;FDCP		EQU	FDPORT+2	;Control Port
     216			     C	;INTS		EQU	FDPORT+4	;Main Status Register
     217			     C	;FDCD		EQU	FDPORT+5	;Data Register
     218			     C	
     219			     C	
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-5


     220				
     221 = 0000				Int00v		equ	0			; (0000:0000=0CA60h)  0 DIV/0
     222 = 0004				Int01v		equ	4			; (0000:0004=0F4h)    1 SST
     223 = 0018				Int06v		equ	18h			; (0000:0018=0CA60h)  6 invalid opcode
     224 = 0020				Int08v		equ	20h			; (0000:0020=0FEA5h)  8 Timer hardware IRQ
     225 = 0024				Int09v		equ	24h			; (0000:0024=0E987h)  9 Keyboard IRQ
     226 = 002C				Int0Bv		equ	2Ch			; (0000:002C=0CE80h) 0B serial 2 IRQ
     227 = 0030				Int0Cv		equ	30h			; (0000:0030=0CE80h) 0C serial 1 IRQ
     228 = 0034				Int0Dv		equ	34h			; (0000:0034=3ADBh)  0D hard disk IRQ
     229 = 0040				Int10v		equ	40h			; (0000:0040=0EEh)   10 video
     230 = 0044				Int11v		equ	44h			; (0000:0044=0CB20h) 11 equipment
     231 = 0048				Int12v		equ	48h			; (0000:0048=0CB40h) 12 memory size
     232 = 004C				Int13v		equ	4Ch			; (0000:004C=0CF60h) 13 diskette/HD I/O
     233 = 0050				Int14v		equ	50h			; (0000:0050=0CB80h) 14 serial
     234 = 0054				Int15v		equ	54h			; (0000:0054=0CBA0h) 15 system services
     235 = 0058				Int16v		equ	58h			; (0000:0058=0CFC0h) 16 keyboard
     236 = 005C				Int17v		equ	5Ch			; (0000:005C=0CBC0h) 17 printer
     237 = 0060				Int18v		equ	60h			; (0000:0060=0CD00h) 18 Basic ROM
     238 = 0064				Int19v		equ	64h			; (0000:0064=0CC60h) 19 IPL
     239 = 0068				Int1Av		equ	68h			; (0000:0068=0CBE0h) 1A TOD
     240 = 006C				Int1Bv		equ	6Ch			; (0000:006C=0D1C0h) 1B Keyboard BREAK addr
     241 = 0070				Int1Cv		equ	70h			; (0000:0070=0CC00h) 1C user timer
     242 = 0074				Int1Dv		equ	74h			; (0000:0074=0C958h) 1D 6845 video init
     243 = 0078				Int1Ev		equ	78h			; (0000:0078=0CA60h) 1E DPB
     244 = 007C				Int1Fv		equ	7Ch			; (0000:007C=5E9h)   1F video graphic table
     245				
     246 = 7C00				IPLLOC		equ	7C00h			;*(0000:7C00=0)	boot location
     247 = 0000				data_49e	equ	0			;*(1000:0000=75h)
     248 = 03FE				data_50e	equ	3FEh			;*(1040:03FE=3)	COM1 block? Count?
     249				; Outside of ROM address; likely just 8K address increments
     250 = 2000				data_121e	equ	2000h			;*(A.2000=0)
     251 = 2001				data_122e	equ	2001h			;*(A.2001=0)
     252				
     253				; The Lomas BIOS doesn't produce error codes, but these might be useful.
     254 = 0001				ER_BIOS equ     01h             ; Bad ROM bios checksum, patch last byte
     255 = 0002				ER_RAM  equ     02h             ; Bad RAM in main memory, replace
     256 = 0004				ER_CRT  equ     04h             ; Bad RAM in video card, replace
     257 = 0010				ER_MEM  equ     10h             ; Bad RAM in vector area, replace
     258 = 0020				ER_ROM  equ     20h             ; Bad ROM in expansion area, bad checksum
     259				
     260				
     261				;===============================================================================
     262				;  Compiler directives
     263				;
     264				.LFCOND                                         ; List False Conditionals
     265				.186
     266				ASSUME  DS:data, SS:code, CS:code, ES:code
     267				
     268				
     269				;===============================================================================
     270				;  Data segment - BIOS Data Segment
     271				;
     272 0000				data	segment at 40H				; IBM compatible data structures
     273 0000  0004[			rs232_port_1	dw	4 dup (?)		; (0040:0000=3F8h)
     274	   ????			
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-6


     275			 ]	
     276				
     277 0008  0004[			prn_port_1	dw	4 dup (?)		; (0040:0008=378h)
     278	   ????			
     279			 ]	
     280				
     281 0010  0000			equip_bits	dw	?			; (0040:0010=4467h)
     282 0012  00			mfg_test	db	?			; 0012
     283 0013  0000			main_ram_size	dw	?			; (0040:0013=280h)
     284 0015  00			scratch1	db	? 			; scratch pad
     285 0016  00					db	?
     286				;---------------[Keyboard data area]------------;
     287 0017  00			keybd_flags_1	db	?			; (0040:0017=0)
     288				;------ SHIFT FLAG EQUATES WITHIN KB_FLAG
     289 = 0080				INS_STATE	EQU	80H			; INSERT STATE IS ACTIVE
     290 = 0040				CAPS_STATE	EQU	40H			; CAPS LOCK STATE HAS BEEN TOGGLED
     291 = 0020				NUM_STATE	EQU	20H			; NUM LOCK STATE HAS BEEN TOGGLED
     292 = 0010				SCROLL_STATE	EQU	10H			; SCROLL LOCK STATE HAS BEEN TOGGLED
     293 = 0008				ALT_SHIFT	EQU	08H			; ALTERNATE SHIFT KEY DEPRESSED
     294 = 0004				CTL_SHIFT	EQU	04H			; CONTROL SHIFT KEY DEPRESSED
     295 = 0002				LEFT_SHIFT	EQU	02H			; LEFT SHIFT KEY DEPRESSED
     296 = 0001				RIGHT_SHIFT	EQU	01H			; RIGHT SHIFT KEY DEPRESSED
     297 0018  00			keybd_flags_2	db	?			; (0040:0018=0)
     298 = 0080				INS_SHIFT	EQU	80H			; INSERT KEY IS DEPRESSED
     299 = 0040				CAPS_SHIFT	EQU	40H			; CAPS LOCK KEY IS DEPRESSED
     300 = 0020				NUM_SHIFT	EQU	20H			; NUM LOCK KEY IS DEPRESSED
     301 = 0010				SCROLL_SHIFT	EQU	10H			; SCROLL LOCK KEY IS DEPRESSED
     302 = 0008				HOLD_STATE	EQU	08H			; SUSPEND KEY HAS BEEN TOGGLED
     303 0019  00			keybd_alt_num	db	?			; (0040:0019=0)
     304 001A  0000			keybd_q_head	dw	?			; (0040:001A=30h)
     305 001C  0000			keybd_q_tail	dw	?			; (0040:001C=30h)
     306 001E  0010[			keybd_buff	dw	16 dup (?)		; 001E
     307	   ????			
     308			 ]	
     309				
     310				;------ HEAD = TAIL INDICATES THAT THE BUFFER IS EMPTY
     311 = 0045				NUM_KEY 	EQU	69			; SCAN CODE FOR NUMBER LOCK
     312 = 0046				SCROLL_KEY	EQU	70			; SCROLL LOCK KEY
     313 = 0038				ALT_KEY 	EQU	56			; ALTERNATE SHIFT KEY SCAN CODE
     314 = 001D				CTL_KEY 	EQU	29			; SCAN CODE FOR CONTROL KEY
     315 = 003A				CAPS_KEY	EQU	58			; SCAN CODE FOR SHIFT LOCK
     316 = 002A				LEFT_KEY	EQU	42			; SCAN CODE FOR LEFT SHIFT
     317 = 0036				RIGHT_KEY	EQU	54			; SCAN CODE FOR RIGHT SHIFT
     318 = 0052				INS_KEY 	EQU	82			; SCAN CODE FOR INSERT KEY
     319 = 0053				DEL_KEY 	EQU	83			; SCAN CODE FOR DELETE KEY
     320				;---------------[Diskette data area]------------;
     321 003E  00			dsk_recal_stat	db	?			; (0040:003E=0)
     322 003F  00			dsk_motor_stat	db	?			; (0040:003F=0)
     323 0040  00			dsk_motor_tmr	db	?			; (0040:0040=0)
     324 0041  00			dsk_ret_code	db	?			; (0040:0041=0)
     325 0042  0007[			nec_stat	db	7 dup (?)		; (0040:0042=0)	NEC status 7 bytes
     326	   ??			
     327			 ]	
     328				
     329				;---------------[Video display area]------------;
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-7


     330 0049  00			video_mode	db	?			; (0040:0049=3)
     331										;  0 = 40 x 25 text (no color)
     332										;  1 = 40 x 25 text (16 color)
     333										;  2 = 80 x 25 text (no color)
     334										;  3 = 80 x 25 text (16 color)
     335										;  4 = 320 x 200 grafix 4 color
     336										;  5 = 320 x 200 grafix 0 color
     337										;  6 = 640 x 200 grafix 0 color
     338										;  7 = 80 x 25 text (mono card)
     339 004A  0000			video_columns	dw	?			; (0040:004A=50h)
     340 004C  0000			video_buf_siz	dw	?			; (0040:004C=1000h)
     341 004E  0000			video_segment	dw	?			; (0040:004E=0)
     342 0050  0008[			vid_curs_pos0	dw	8 dup (?)		; (0040:0050=184Fh)
     343	   ????			
     344			 ]	
     345				
     346 0060  0000			vid_curs_mode	dw	?			; (0040:0060=2000h)
     347 0062  00			video_page	db	?			; (0040:0062=0)
     348				; normal BIOS does not store the base address
     349 0063  0000			video_port	dw	?			; (0040:0063=3D4h) 
     350				;video_base	dw	?			; PC has card base address at 63h
     351 0065  00			video_mode_reg	db	?			; (0040:0065=29h) 6845 mode setting
     352 0066  00			video_color	db	?			; (0040:0066=30h)
     353				;---------------[Used to setup ROM]-------------;
     354 0067  0000 0000		gen_io_ptr	dw	?,?			; (0040:0067=0) ; Eprom base Offset,Segment
     355 006B  00			gen_int_occured	db	?			; (0040:006B=0) ; Last spurious interrupt IR
					Q
     356				;---------------[Timer data area]---------------;
     357 006C  0000			timer_low	dw	?			; (0040:006C=696Fh)
     358 006E  0000			timer_hi	dw	?			; (0040:006E=16h)
     359 0070  00			timer_rolled	db	?			; (0040:0070=0)
     360				;---------------[System data area]--------------;
     361 0071  00			signbit		db      ?		; 40:71 ; Sign bit set if break
     362 0072  0000			warmboot	dw      ?		; 40:72 ; Warm boot if 1234h value
     363				;---------------[Hard disk scratchpad]----------;
     364 0074  0004[			HD		db	4 dup (0)  	; 40:74 ; scratch pad area
     365	   00			
     366			 ]	
     367				
     368				;---------------[Timout areas/PRT/LPT]----------;
     369 0078  0004[			lptto		db      4 dup(?)        ; 40:78 ; Ticks for LPT 1-4 timeouts
     370	   ??			
     371			 ]	
     372				
     373 007C  0004[			comto 		db      4 dup(?)        ; 40:7C ; Ticks for COM 1-4 timeouts
     374	   ??			
     375			 ]	
     376				
     377				;---------------[Keyboard buf start/nd]---------;
     378 0080  0000					dw      ?               ; 40:80 ; Contains 1Eh, buffer start
     379 0082  0000					dw      ?               ; 40:82 ; Contains 3Eh, buffer end
     380				;
     381				; SCSI -- might not be needed if using card with option ROM because work space
     382				; would be allocated from there. This table is 25 bytes (19h) long and based
     383				; on some code I found in BYTE or TCJ.
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-8


     384				IF	SCSI
     385					COMMAND_TABLE	dw	?		;command offset pointer
     386					CMND_PTR	dw	?		;segment of commands
     387					CMND_SEG	dw	?		;segment of commands
     388					TRANS_CNT	dw	?		;will read 512 bytes
     389					SDMA_OFF	dw	?		;buffer pointer
     390					SDMA_SEG	dw	?		;segment of buffer pointer
     391					SCSI_STATUS_IN	db	?		;status in
     392					SCSI_STATUS_OUT	db	?		;status out
     393					SCSI_MSG_IN	db	?		;received message
     394					SCSI_MSG_OUT	db	?		;send message
     395					SCSI_MSG_FLAG	db	?		;send message flag
     396				
     397					READ_WRITE_BLOCK	db	?	;read command for 8425
     398					SCSI_CMND_CNT		db	?	;number of byte in the command
     399					SCSI_CMND		db	?	;read command
     400					BLOCK_HIGH		db	?	;msb of 21 bit block address, low 5 bits of 
					byte
     401					BLOCK_MIDDLE		db	?	;middle bbyte of address
     402					BLOCK_LOW		db	?	;low byte of address
     403					SCOUNT			db	?	;number of blocks to read, 0 =256
     404					CONTROL_BYTE		db	?	;control byte is always 0
     405				ENDIF
     406				
     407 0084				data	ends
     408				
     409				;===============================================================================
     410				;  D O S   D A T A   S E G M E N T
     411				;===============================================================================
     412				; probably not needed for the Lomas but might be used for hard disk
     413				; sector data.
     414 0000				dosdir  SEGMENT at 50h                          ; Boot disk directory from IPL
     415 0000				xerox   label   byte                            ;  0 if Print Screen idle
     416				                                                ;  1 if PrtSc xeroxing screen
     417				                                                ;255 if PrtSc error in xerox
     418				                                                ;  ...non-grafix PrtSc in bios
     419 0000  0200[			        db      200h dup(?)                     ; PC-DOS bootstrap procedure
     420	   ??			
     421			 ]	
     422				
     423				                                                ;  ...IO.SYS buffers the
     424				                                                ;  ...directory of the boot
     425				                                                ;  ...device here at IPL time
     426				                                                ;  ...when locating the guts
     427				                                                ;  ...of the operating system
     428				                                                ;  ...filename "MSDOS.SYS"
     429 0200				dosdir  ends
     430				
     431				
     432				;===============================================================================
     433				;  I O . S Y S   D A T A   S E G M E N T  (IO.SYS initial load segment)
     434				;===============================================================================
     435				;dosseg  SEGMENT at 70H 
     436				
     437				;IO.SYS driver/bootstrap code loaded by the boot block to       CONTIGUOUS<---
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-9


     438				;	70:0 Usually loads the first 3 sectors of IO.SYS.		     |
     439				;MSDOS.SYS operating system kernel immediately follows IO.SYS and            |
     440				;	doesn`t have to be contiguous. The DOS operating system		     |
     441				;	binary image is loaded by transient code in IO.SYS.	             |
     442				;dosseg  ends                                    ;                            |
     443				
     444				
     445				;===============================================================================
     446				;  I P L   D A T A   S E G M E N T  (loaded with bootstrap code from MBR)
     447				;===============================================================================
     448				;iplseg  SEGMENT at 0h                           ; Segment for boot block      |
     449				;The following boot block is loaded with 512 bytes on the first sector of     |
     450				;the bootable device by code resident in the ROM-resident bios.  Control is   |
     451				;then transferred to the first word 0000:7C00 of the disk-resident bootstrap  |
     452				;	ORG     07C00h                          ;  ..offset for boot block    |
     453				;boot	db      200h dup(?)                     ;  ..start disk resident boot--
     454				;iplseg 	ends
     455				
     456				
     457				;===============================================================================
     458				;  C O D E   S E G M E N T  (BIOS code segment)
     459				;===============================================================================
     460 0000				code    SEGMENT
     461				
     462				; this code sits at F:E000
     463 0000					org	0		; zero-start ROM
     464				
     465				; For the ENTRY macro to work, banner must be the first label in the segment
     466 0000  4C 44 50 20 54 48	banner: 	db	"LDP THUNDER REV 1.0 10/21/85"
     467       55 4E 44 45 52 20	
     468       52 45 56 20 31 2E	
     469       30 20 31 30 2F 32	
     470       31 2F 38 35		
     471					IF	SCSI
     472						db	"-S"
     473					ENDIF
     474 001C  0A 0D 00					db	0ah, 0dh, 0
     475				
     476				; Continues from CPU initialization code at 1C00h that initializes the 80186
     477				; internal registers. The expansion ROM call has to occur after the hardware
     478				; initializes but before video.
     479 001F				COLD2:
     480 001F  FA			        	cli
     481 0020  B8 8000			 		mov	ax,8000h 		; send EOI twice
     482 0023  BA FF22			 		mov	dx,0FF22h		; PCRBASE+ICR+EOIREG
     483 0026  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     484 0027  B8 8000			 		mov	ax,8000h
     485 002A  BA FF22			 		mov	dx,0FF22h		; PCRBASE+ICR+EOIREG
     486 002D  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     487				
     488				; test first 64k of RAM
     489 002E  FC			 		cld				; Clear direction
     490 002F  33 DB			 		xor	bx,bx			; Zero register
     491 0031  8E DB			 		mov	ds,bx
     492 0033  8E C3			 		mov	es,bx
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-10


     493 0035  B8 5555			 		mov	ax,5555h
     494 0038				loc_3:						;  xref A.0056
     495 0038  B9 8000			 		mov	cx,8000h
     496 003B  8B F3			 		mov	si,bx
     497 003D  8B FB			 		mov	di,bx
     498 003F  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
     499 0041  B9 8000			 		mov	cx,8000h
     500 0044  F3/ AF			 		repe	scasw			; Rep zf=1+cx >0 Scan es:[di] for ax
     501 0046  E3 06			 		jcxz	loc_4			; Jump if cx=0
     502 0048  BA 0066			 		mov	dx,66h
     503 004B  E9 0597 R		 		jmp	DynHalt			; (0597) memory test error?
     504				
     505 004E				loc_4:						;  xref A.0046
     506 004E  3D AAAA					cmp	ax,0AAAAh
     507 0051  74 05			 		je	loc_5			; Jump if equal
     508 0053  B8 AAAA			 		mov	ax,0AAAAh
     509 0056  EB E0			 		jmp	short loc_3		; (0038)
     510				
     511				; this clears 64k of RAM.
     512 0058				loc_5:						;  xref A.0051
     513 0058  B8 0000			 		mov	ax,0
     514 005B  B9 8000			 		mov	cx,8000h
     515 005E  8B F8			 		mov	di,ax
     516 0060  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
     517				
     518				; grab DIV/0 and SST vectors
     519 0062  B8 0113 R		 		mov	ax,offset INT00HANDLER	;113h
     520 0065  A3 0000			 		mov	ds:Int00v,ax		; (0000:0000=0CA60h)
     521 0068  8C 0E 0002		 		mov	ds:Int00v+2,cs		; (0000:0002=0F000h)
     522 006C  BE 0000			 		mov	si,Int00v		; (0000:0000=60h)
     523 006F  BF 0004			 		mov	di,Int01v		; (0000:0004=0F4h)
     524				
     525				;fill interrupt table with default vector pointing to INT00
     526 0072  B9 01FE			 		mov	cx,1FEh			; 7F * 4
     527 0075  F3/ A5			 		rep	movsw			; Rep when cx >0 Mov [si] to es:[di]
     528				
     529				; set invalid opcode handler
     530 0077  B8 00E0 R		 		mov	ax,offset INT06HANDLER	;0E0h
     531 007A  A3 0018			 		mov	ds:Int06v,ax		; (0000:0018=0CA60h)
     532 007D  8C 0E 001A		 		mov	ds:Int06v+2,cs		; (0000:001A=0F000h)
     533				
     534				; do main ROM checksum. It's odd that if the checksum fails, it
     535				; continues booting anyway. In the IBM PC, the PC halts.
     536 0081  FA			 		cli				; Disable interrupts
     537 0082  B8 0030			 		mov	ax,30h
     538 0085  8E D0			 		mov	ss,ax
     539 0087  BC 0100			 		mov	sp,100h
     540 008A  E8 0FB1 R		 		call	sub_32			; (0FB1)
     541 008D  E8 0140 R		 		call	DoChecksum		; (0140)
     542 0090  74 06			 		jz	loc_6			; Jump if zero
     543 0092  BE 00C9 R		 		mov	si,offset msg1		; (A.00C9='ROM checksum fai')
     544 0095  E8 05E5 R		 		call	prtzstr			; (05E5)
     545				; display boot message and assign key vectors. In the IBM PC,
     546				; the video sign-on is the last thing done after it passes
     547				; all hardware tests and all subsystems are initialized. In the Lomas
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-11


     548				; the sign-on message is printed before much of that is done, and
     549				; no hardware tests, other than memory, are performed.
     550 0098				loc_6:						;  xref A.0090
     551 0098  BE 0000 R		 		mov	si,offset banner	; (A.0000=4Ch)
     552 009B  E8 05E5 R		 		call	prtzstr			; (05E5)
     553 009E  E8 0473 R		 		call	InitEquipList		; (0473) vectors 18, 19, 15, 1B, 11 and 1C
     554 00A1  E8 04B5 R		 		call	InitTimers		; (04B5) vectors 0C, 08, 1A and timers
     555 00A4  E8 01BF R		 		call	RamTest			; (01BF) ram sizing and vactor 12
     556 00A7  E8 0AD4 R		 		call	InitKeyboard		; (0AD4) vectors 16, 0D, 09 keyboard
     557 00AA  E8 05F6 R				call	InitFloppy		; (05F6) vectos 13, 0B, 1E
     558 00AD  B4 00			 		mov	ah,0			; reset floppy disk
     559 00AF  CD 13			 		int	13h			; call diskette services
     560 00B1  E8 02BC R		 		call	InitSerialPorts		; (02BC) vector 14 serial 0
     561 00B4  E8 0224 R		 		call	InitPrinter		; (0224) vector 17 printer
     562				;*****
     563				; This might be a good place to put the expansion ROM code after all hardware is
     564				; initialized. Only DS is preserved.
     565				IF ROMSEARCH
     566						call	EXPROM
     567				ENDIF
     568				; re-send EOIs
     569 00B7  B8 8000			 		mov	ax,8000h
     570 00BA  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
     571 00BD  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     572 00BE  B8 8000			 		mov	ax,8000h
     573 00C1  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
     574 00C4  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     575 00C5  FB			 		sti				; Enable interrupts
     576 00C6  E9 0151 R		 		jmp	SysBoot			; (0151) boot the floppy drive
     577				
     578 00C9  52 4F 4D 20 63 68	msg1:		db	'ROM checksum failure', 0Ah, 0Dh, 0
     579       65 63 6B 73 75 6D	
     580       20 66 61 69 6C 75	
     581       72 65 0A 0D 00		
     582				
     583				;===============================================================================
     584				;a.00e0
     585				; INT 06 - Invalid opcode handler. Just prints a message and increments to the 
     586				; next instruction.
     587 00E0				INT06HANDLER:
     588 00E0  55			 		push	bp
     589 00E1  8B EC			 		mov	bp,sp
     590 00E3  50			 		push	ax
     591 00E4  53			 		push	bx
     592 00E5  51			 		push	cx
     593 00E6  52			 		push	dx
     594 00E7  56			 		push	si
     595 00E8  57			 		push	di
     596 00E9  BE 00FA R		 		mov	si,offset msg2
     597 00EC  E8 05E5 R		 		call	prtzstr
     598 00EF				data_79:
     599 00EF  FF 46 02			 		inc	word ptr [bp+2]
     600 00F2  5F			 		pop	di
     601 00F3  5E			 		pop	si
     602 00F4  5A			 		pop	dx
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-12


     603 00F5  59			 		pop	cx
     604 00F6  5B			 		pop	bx
     605 00F7  58			 		pop	AX
     606 00F8  5D					pop	bp
     607 00F9  CF			 		iret
     608				
     609 00FA  42 61 64 20 6F 70	msg2:		db	'Bad opcode encountered', 0Ah, 0Dh,0
     610       63 6F 64 65 20 65	
     611       6E 63 6F 75 6E 74	
     612       65 72 65 64 0A 0D	
     613       00			
     614				
     615				
     616				;===============================================================================
     617				;a.0113
     618				; INT 00 - Invalid interrupt handler. Just prints a message.
     619 0113				INT00HANDLER:
     620 0113  50			 		push	ax
     621 0114  53			 		push	bx
     622 0115  51			 		push	cx
     623 0116  52			 		push	dx
     624 0117  56			 		push	si
     625 0118  57			 		push	di
     626 0119  BE 0126 R		 		mov	si,offset msg3
     627 011C  E8 05E5 R		 		call	prtzstr
     628 011F  5F			 		pop	di
     629 0120  5E			 		pop	si
     630 0121  5A			 		pop	dx
     631 0122  59			 		pop	cx
     632 0123  5B			 		pop	bx
     633 0124  58			 		pop	AX
     634 0125  CF			 		iret
     635				;a.0126
     636 0126  42 61 64 20 69 6E	msg3:		db	'Bad interrupt received.', 0Ah, 0Dh,0
     637       74 65 72 72 75 70	
     638       74 20 72 65 63 65	
     639       69 76 65 64 2E 0A	
     640       0D 00			
     641				
     642				
     643				
     644				;===============================================================================
     645				;                              SUBROUTINE
     646				;
     647				;         Called from:   A.008D
     648				;===============================================================================
     649				;a.0140
     650 0140				DoChecksum	proc	near
     651 0140  BB 0000			 		mov	bx,0			; (A.0000=4Ch)
     652 0143  B0 00			 		mov	al,0
     653 0145  B9 2000			 		mov	cx,2000h
     654				
     655 0148				locloop_7:					;  xref A.014C
     656 0148  2E: 02 07		 		add	al,cs:[bx]
     657 014B  43			 		inc	bx
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-13


     658 014C  E2 FA			 		loop	locloop_7		; Loop if cx > 0
     659				
     660 014E  84 C0			 		test	al,al
     661 0150  C3			 		retn
     662 0151				DoChecksum	endp
     663				
     664				;===============================================================================
     665				;  Boot the Diskette
     666				;===============================================================================
     667				;a.0151
     668 0151				SysBoot:					;  xref A.00C6, 017E
     669 0151  BE 0185 R		 		mov	si,offset msg4		;185h	; (A.0185='Attempting to ')
     670 0154  E8 05E5 R		 		call	prtzstr			; (05E5)
     671 0157  33 C0			 		xor	ax,ax			; Zero register
     672 0159  8E C0			 		mov	es,ax
     673 015B  B9 0004			 		mov	cx,4			; 4 retries
     674				
     675 015E				locloop_9:					;  xref A.0166
     676 015E  51			 		push	cx
     677 015F  B4 00			 		mov	ah,0
     678 0161  CD 13			 		int	13h			; Disk  dl=drive a  ah=func 00h
     679				 						;  reset disk, al=return status
     680 0163  59			 		pop	cx
     681 0164  73 02			 		jnc	loc_10			; Jump if carry=0
     682 0166  E2 F6			 		loop	locloop_9		; Loop if cx > 0
     683				
     684 0168				loc_10:						;  xref A.0164
     685 0168  BB 7C00			 		mov	bx,IPLLOC		; 07c00h (0000:7C00=0)
     686 016B  8B D0			 		mov	dx,ax			; head 0, drive a
     687 016D  B9 0001			 		mov	cx,1			; cyl 0, sector 1
     688 0170  B0 08			 		mov	al,8			; 8 sectors
     689 0172  B4 02			 		mov	ah,2			; func 2
     690 0174  CD 13			 		int	13h			; Disk  dl=drive a  ah=func 02h
     691				 						;  read sectors to memory es:bx
     692				 						;   al=#,ch=cyl,cl=sectr,dh=head
     693 0176  73 08			 		jnc	loc_11			; all good, jump to boot code
     694 0178  B9 0019			 		mov	cx,19h
     695 017B  E8 0468 R		 		call	sub_6			; (0468) delay
     696 017E  EB D1			 		jmp	short SysBoot		; (0151)
     697				
     698				; Jump to the loaded boot sector
     699 0180				loc_11:						;  xref A.0176
     700						jmpf	0,IPLLOC
     701 0180  EA                    1	        db      0EAh; 
     702 0181  7C00 0000             1	        dw      IPLLOC,0 
     703				;		db	0EAh
     704				; 		dw	7C00h, 0
     705				
     706 0185  41 74 74 65 6D 70	msg4:		db	'Attempting to boot from diskette.', 0Dh, 0Ah, 0
     707       74 69 6E 67 20 74	
     708       6F 20 62 6F 6F 74	
     709       20 66 72 6F 6D 20	
     710       64 69 73 6B 65 74	
     711       74 65 2E 0D 0A 00	
     712				
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-14


     713				
     714				;===============================================================================
     715				;a.01a9
     716				; INT 12 - Memory Size AX
     717 01A9				INT12HANDLER:
     718 01A9  1E			        push   ds
     719 01AA  B8 0040			        mov    ax,40h
     720 01AD  8E D8			        mov    ds,ax
     721 01AF  A1 0013 R		        mov    ax,ds:main_ram_size	; 40:13 memory size in kbytes (INT 12h)
     722 01B2  1F			        pop    ds
     723 01B3  CF			        iret
     724				
     725				;===============================================================================
     726				;a.01b4
     727				; INT 11 - Equipment List
     728 01B4				INT11HANDLER:
     729 01B4  1E			        push   ds
     730 01B5  B8 0040			        mov    ax,40h
     731 01B8  8E D8			        mov    ds,ax
     732 01BA  A1 0010 R		        mov    ax,ds:equip_bits		; 40:10 equip list (INT 11h)
     733 01BD  1F			        pop    ds
     734 01BE  CF			        iret
     735				
     736				
     737				;===============================================================================
     738				 ;                              SUBROUTINE
     739				 ;
     740				 ;         Called from:   A.00A4
     741				;===============================================================================
     742				;a.1bf 
     743				; this tests all RAM
     744 01BF				RamTest		proc	near
     745 01BF  FC			 		cld				; Clear direction
     746 01C0  1E			 		push	ds
     747 01C1  06			 		push	es
     748 01C2  B8 0040			 		mov	ax,40h
     749 01C5  8E D8			 		mov	ds,ax
     750 01C7  BB 1000			 		mov	bx,1000h
     751				; the first 64k was already tested so set main RAM size at 64k to start
     752 01CA  C7 06 0013 R 0040	 		mov	word ptr ds:main_ram_size,40h	; (0040:0013=280h)
     753 01D0  B8 55AA			 		mov	ax,55AAh
     754 01D3  BA AA55			 		mov	dx,0AA55h
     755 01D6  BF 03FE			 		mov	di,data_50e		; (1040:03FE=3)
     756 01D9				loc_12:						;  xref A.01F2
     757 01D9  8E C3			 		mov	es,bx
     758 01DB  26: 89 05		 		mov	es:[di],ax
     759 01DE  52			 		push	dx
     760 01DF  5A			 		pop	dx
     761 01E0  26: 39 05		 		cmp	es:[di],ax
     762 01E3  75 0F			 		jne	loc_13			; Jump if not equal
     763 01E5  FF 06 0013 R		 		inc	word ptr ds:main_ram_size	; (0040:0013=280h)
     764 01E9  83 C3 40			 		add	bx,40h
     765 01EC  81 FB B7FF		 		cmp	bx,0B7FFh
     766 01F0  73 02			 		jae	loc_13			; Jump if above or =
     767 01F2  EB E5			 		jmp	short loc_12		; (01D9)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-15


     768 01F4				loc_13:						;  xref A.01E3, 01F0
     769 01F4  A1 0013 R		 		mov	ax,ds:main_ram_size	; (0040:0013=280h)
     770 01F7  2D 0040			 		sub	ax,40h
     771 01FA  8B C8			 		mov	cx,ax
     772 01FC  BB 1000			 		mov	bx,1000h
     773 01FF  B8 0000			 		mov	ax,0
     774				
     775 0202				locloop_14:					;  xref A.0211
     776 0202  BF 0000			 		mov	di,data_49e		; (1000:0000=75h)
     777 0205  8E C3			 		mov	es,bx
     778 0207  51			 		push	cx
     779 0208  B9 0200			 		mov	cx,200h
     780 020B  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
     781 020D  59			 		pop	cx
     782 020E  83 C3 40			 		add	bx,40h
     783 0211  E2 EF			 		loop	locloop_14		; Loop if cx > 0
     784				
     785 0213  33 C0			 		xor	ax,ax			; Zero register
     786 0215  8E D8			 		mov	ds,ax
     787 0217  B8 01A9 R		 		mov	ax,offset INT12HANDLER	;1A9h
     788 021A  A3 0048			 		mov	ds:Int12v,ax		; (0000:0048=0CB40h)
     789 021D  8C 0E 004A		 		mov	ds:Int12v+2,cs		; (0000:004A=0F000h)
     790 0221  07			 		pop	es
     791 0222  1F			 		pop	ds
     792 0223  C3			 		retn
     793 0224				RamTest		endp
     794				
     795				
     796				;===============================================================================
     797				 ;                              SUBROUTINE
     798				 ;
     799				 ;         Called from:   A.00B4
     800				;===============================================================================
     801				;a.0224 
     802				; Grab INT17 (printer) vector
     803 0224				InitPrinter	proc	near
     804 0224  1E			 		push	ds
     805 0225  33 C0			 		xor	ax,ax			; Zero register
     806 0227  8E D8			 		mov	ds,ax
     807 0229  B8 0244 R		 		mov	ax,offset INT17HANDLER	;244h
     808 022C  A3 005C			 		mov	ds:Int17v,ax		; (0000:005C=0CBC0h)
     809 022F  8C 0E 005E		 		mov	ds:Int17v+2,cs		; (0000:005E=0F000h)
     810 0233  B8 0040			 		mov	ax,40h
     811 0236  8E D8			 		mov	ds,ax
     812 0238  C7 06 0008 R 00D0	 		mov	word ptr ds:prn_port_1,printer_port	;0D0h (0040:0008=378h)
     813 023E  1F			 		pop	ds
     814 023F  B4 01			 		mov	ah,1
     815 0241  CD 17			 		int	17h			; Printer  dx=prn?, ah=func 01h
     816				 						;  initialize, ah=return status
     817 0243  C3			 		retn
     818 0244				InitPrinter	endp
     819				
     820				;===============================================================================
     821				;a.0244
     822				; INT 17 - Printer Services
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-16


     823 0244				INT17HANDLER:
     824 0244  FB			 		sti				; Enable interrupts
     825 0245  1E			 		push	ds
     826 0246  52			 		push	dx
     827 0247  51			 		push	cx
     828 0248  53			 		push	bx
     829 0249  56			 		push	si
     830 024A  BB 0040			 		mov	bx,40h
     831 024D  8E DB			 		mov	ds,bx
     832				; jump to functions
     833 024F  84 E4			 		test	ah,ah			; AH=2 read status to AH
     834 0251  74 0E			 		jz	loc_16	
     835				
     836 0253  FE CC			 		dec	ah			; AX=1 initialize 
     837 0255  74 35			 		jz	loc_19	
     838				
     839 0257  FE CC			 		dec	ah			; AX-0 print character in AL
     840 0259  74 50			 		jz	loc_20	
     841 025B				int17_exit:					;  xref A.0277, 02BA
     842 025B  5E			 		pop	si
     843 025C  5B			 		pop	bx
     844 025D  59			 		pop	cx
     845 025E  5A			 		pop	dx
     846 025F  1F			 		pop	ds
     847 0260  CF			 		iret				; Interrupt return
     848				
     849				; Read printer status.
     850 0261				loc_16:						;  xref A.0251
     851 0261  50			 		push	ax
     852 0262  B3 32			 		mov	bl,32h			; '2'
     853 0264  33 C9			 		xor	cx,cx
     854 0266  E6 D0			 		out	printer_port,al			; port 0D0h printer_port
     855				
     856 0268				locloop_17:					;  xref A.026E, 0272
     857 0268  E4 D2			 		in	al,PPI_B			; port 0D2h PPI_B
     858 026A  A8 20			 		test	al,20h			; ' '
     859 026C  74 0B			 		jz	loc_18			; Jump if zero
     860 026E  E2 F8			 		loop	locloop_17		; Loop if cx > 0
     861				
     862 0270  FE CB			 		dec	bl
     863 0272  75 F4			 		jnz	locloop_17		; Jump if not zero
     864 0274  80 CC 01			 		or	ah,1
     865 0277  EB E2			 		jmp	short int17_exit		; (025B)
     866				;a.0279		
     867 0279				loc_18:						;  xref A.026C
     868 0279  B0 01			 		mov	al,1
     869 027B  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
     870 027D  50			 		push	ax
     871 027E  58			 		pop	ax
     872 027F  B0 00			 		mov	al,0
     873 0281  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
     874 0283  50			 		push	ax
     875 0284  58			 		pop	ax
     876 0285  B0 01			 		mov	al,1
     877 0287  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-17


     878 0289  58			 		pop	ax
     879 028A  EB 1F			 		jmp	short loc_20		; (02AB)
     880				
     881				; Initialize printer
     882				;a.028c
     883 028C				loc_19:						;  xref A.0255
     884 028C  50			 		push	ax
     885 028D  B0 01			 		mov	al,1
     886 028F  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
     887 0291  50			 		push	ax
     888 0292  58			 		pop	ax
     889 0293  B0 03			 		mov	al,3
     890 0295  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
     891 0297  50			 		push	ax
     892 0298  58			 		pop	ax
     893 0299  B0 06			 		mov	al,6
     894 029B  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
     895 029D  50			 		push	ax
     896 029E  58			 		pop	ax
     897 029F  B0 04			 		mov	al,4
     898 02A1  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
     899 02A3  E8 08C3 R		 		call	sub_17			; (08C3)
     900 02A6  B0 05			 		mov	al,5
     901 02A8  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
     902 02AA  58			 		pop	ax
     903				
     904				
     905				;a.02ab		
     906 02AB				loc_20:						;  xref A.0259, 028A
     907 02AB  50			 		push	ax
     908 02AC  E4 D2			 		in	al,PPI_B			; PPI_B
     909 02AE  B3 10			 		mov	bl,10h
     910 02B0  A8 20			 		test	al,20h			; ' '
     911 02B2  74 03			 		jz	loc_21			; Jump if zero
     912 02B4  80 CB 80			 		or	bl,80h
     913 02B7				loc_21:						;  xref A.02B2
     914 02B7  58			 		pop	ax
     915 02B8  8A E3			 		mov	ah,bl
     916 02BA  EB 9F			 		jmp	short int17_exit		; (025B)
     917				
     918				;===============================================================================
     919				 ;                              SUBROUTINE
     920				 ;
     921				 ;         Called from:   A.00B1
     922				;===============================================================================
     923				;a.02bc
     924				; Grab INT14 serial vector
     925 02BC				InitSerialPorts		proc	near
     926 02BC  1E			 		push	ds
     927 02BD  33 C0			 		xor	ax,ax	
     928 02BF  8E D8			 		mov	ds,ax
     929 02C1  B8 02E2 R		 		mov	ax,offset INT14HANDLER	;2E2h
     930 02C4  A3 0050			 		mov	ds:Int14v,ax		; (0000:0050=0CB80h)
     931 02C7  8C 0E 0052		 		mov	ds:Int14v+2,cs		; (0000:0052=0F000h)
     932 02CB  B8 0040			 		mov	ax,40h
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-18


     933 02CE  8E D8			 		mov	ds,ax
     934				; should code bb 00 00
     935 02D0  BB 0000 R		 		mov	bx,offset rs232_port_1		; (0040:0000=0F8h)
     936				; sets serial ports to port 80h (com1) and 0c0h (com2)
     937 02D3  B8 0080			 		mov	ax,ACIA1BASE		; 80h COM1
     938 02D6  89 07			 		mov	[bx],ax
     939 02D8  B8 00C0			 		mov	ax,ACIA0BASE		; 0C0h COM2
     940 02DB  83 C3 02			 		add	bx,2
     941 02DE  89 07			 		mov	[bx],ax
     942 02E0  1F			 		pop	ds
     943 02E1  C3			 		retn
     944 02E2				InitSerialPorts		endp
     945				
     946				;===============================================================================
     947				; a.02e2
     948				; INT 14 - Serial Communications
     949 02E2				INT14HANDLER:
     950 02E2  1E			 		push	ds
     951 02E3  52			 		push	dx
     952 02E4  56			 		push	si
     953 02E5  57			 		push	di
     954 02E6  53			 		push	bx
     955 02E7  51			 		push	cx
     956 02E8  8B F2			 		mov	si,dx			; DX= port ID 0/1
     957 02EA  D1 E6			 		shl	si,1	
     958 02EC  BA 0040			 		mov	dx,40h
     959 02EF  8E DA			 		mov	ds,dx
     960 02F1  8B 94 0000 R		 		mov	dx,ds:rs232_port_1[si]	; (0040:0000=3F8h)
     961 02F5  0B D2			 		or	dx,dx			; dx= address of port
     962 02F7  74 19			 		jz	I14_exit		; no port available? Exit
     963				
     964				; function dispatch
     965				; AH=0 init	AH=1 send	AH=2 receive	AH=3 status
     966 02F9  0A E4			 		or	ah,ah			; AX=0 initialize
     967 02FB  74 1C			 		jz	InitSerPorts	
     968				
     969 02FD  FE CC			 		dec	ah
     970 02FF  75 03			 		jnz	I14_1
     971 0301  E9 03AB R		 		jmp	loc_30			; (03AB) send
     972				
     973 0304				I14_1:						;  xref A.02FF
     974 0304  FE CC			 		dec	ah
     975 0306  75 03			 		jnz	I14_2
     976 0308  E9 03E6 R		 		jmp	loc_35			; (03E6) receive
     977				
     978 030B				I14_2:						;  xref A.0306
     979 030B  FE CC			 		dec	ah
     980 030D  75 03			 		jnz	I14_exit
     981 030F  E9 0454 R		 		jmp	loc_47			; (0454) status
     982				
     983 0312				I14_exit:					;  xref A.02F7, 030D, 03C5, 03DB
     984				 						;            03E3, 0402, 041D, 0465
     985 0312  59			 		pop	cx
     986 0313  5B			 		pop	bx
     987 0314  5F			 		pop	di
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-19


     988 0315  5E			 		pop	si
     989 0316  5A			 		pop	dx
     990 0317  1F			 		pop	ds
     991 0318  CF			 		iret	
     992				
     993				
     994 0319				InitSerPorts:					;  xref A.02FB
     995 0319  50			 		push	ax
     996 031A  B4 42			 		mov	ah,42h			; 'B'
     997 031C  8A D8			 		mov	bl,al
     998 031E  F6 C3 04			 		test	bl,4
     999 0321  74 03			 		jz	loc_26			; Jump if zero
    1000 0323  80 CC C0			 		or	ah,0C0h
    1001 0326				loc_26:						;  xref A.0321
    1002 0326  80 CC 40			 		or	ah,40h			; '@'
    1003 0329  D0 C3			 		rol	bl,1			; Rotate
    1004 032B  B0 30			 		mov	al,30h			; '0'
    1005 032D  22 C3			 		and	al,bl
    1006 032F  0A E0			 		or	ah,al
    1007 0331  D0 C3			 		rol	bl,1			; Rotate
    1008 0333  B0 0C			 		mov	al,0Ch
    1009 0335  22 C3			 		and	al,bl
    1010 0337  0A E0			 		or	ah,al
    1011 0339  83 C2 02			 		add	dx,2
    1012 033C  B0 00			 		mov	al,0
    1013 033E  B9 0003			 		mov	cx,3
    1014				
    1015				;a.0341
    1016 0341				locloop_27:					;  xref A.0345
    1017 0341  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1018 0342  E8 08C3 R		 		call	sub_17			; (08C3)
    1019 0345  E2 FA			 		loop	locloop_27		; Loop if cx > 0
    1020				
    1021 0347  B0 40			 		mov	al,40h			; '@'
    1022 0349  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1023 034A  E8 08C3 R		 		call	sub_17			; (08C3)
    1024 034D  8A C4			 		mov	al,ah
    1025 034F  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1026 0350  58			 		pop	ax
    1027 0351  D0 C0			 		rol	al,1			; Rotate
    1028 0353  D0 C0			 		rol	al,1			; Rotate
    1029 0355  D0 C0			 		rol	al,1			; Rotate
    1030 0357  24 07			 		and	al,7
    1031 0359  52			 		push	dx
    1032 035A  81 FA 0082		 		cmp	dx,82h
    1033 035E  77 05			 		ja	loc_28			; Jump if above
    1034				
    1035				; set timer register for right UART
    1036 0360  BA FF5A			 		mov	dx,TM1CR+TMRCA		;0FF5Ah		;T1CR+TMRCA
    1037 0363  EB 03			 		jmp	short loc_29		; (0368)
    1038 0365				loc_28:						;  xref A.035E
    1039 0365  BA FF52			 		mov	dx,TM0CR+TMRCA		;0FF52h		;T0CR+TMRCA
    1040 0368				loc_29:						;  xref A.0363
    1041 0368  B4 00			 		mov	ah,0
    1042 036A  D1 E0			 		shl	ax,1			; Shift w/zeros fill
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-20


    1043 036C  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    1044 036E  BB 038B R		 		mov	bx,offset data_81	; (A.038B=38h)
    1045 0371  03 D8			 		add	bx,ax
    1046 0373  2E: 8B 07		 		mov	ax,cs:[bx]
    1047 0376  EF			 		out	dx,ax			; port 0FF52h T0CR+TMRCA
    1048 0377  83 C2 02			 		add	dx,2			; go to count register B
    1049 037A  83 C3 02			 		add	bx,2
    1050 037D  2E: 8B 07		 		mov	ax,cs:[bx]
    1051 0380  E8 08C3 R		 		call	sub_17			; (08C3)
    1052 0383  EF			 		out	dx,ax			; port 0FF54h
    1053 0384  5A			 		pop	dx			; T0CR+TMRCB
    1054 0385  83 EA 02			 		sub	dx,2			; back to CRA?
    1055 0388  E9 0454 R		 		jmp	loc_47			; (0454)
    1056				
    1057				; parameters to program internal timers? Read as words.
    1058				;a.038b
    1059 038B				data_81:						; xref A.036E
    1060				;     		db	 38h, 02h, 38h, 02h,0A1h, 01h,0A1h
    1061				;     		db	 01h,0D0h, 00h,0D1h, 00h, 68h
    1062				;     		db	 00h, 68h, 00h, 34h, 00h, 34h
    1063				;     		db	 00h, 1Ah, 00h, 1Ah, 00h, 0Dh
    1064				;     		db	 00h, 0Dh, 00h, 06h, 00h, 07h
    1065				; 		db	 00h
    1066 038B  0238 0238 01A1 01A1			dw	0238h, 0238h, 01a1h, 01a1h
    1067 0393  00D0 00D1 0068 0068			dw	00d0h, 00d1h, 0068h, 0068h
    1068 039B  0034 0034 001A 001A			dw	0034h, 0034h, 001ah, 001ah
    1069 03A3  000D 000D 0006 0007			dw	000dh, 000dh, 0006h, 0007h
    1070				
    1071				; Serial send
    1072 03AB				loc_30:						;  xref A.0301
    1073 03AB  50			 		push	ax
    1074 03AC  83 C2 02			 		add	dx,2
    1075 03AF  B0 37			 		mov	al,37h			; '7'
    1076 03B1  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1077 03B2  33 C9			 		xor	cx,cx	
    1078 03B4  B3 04			 		mov	bl,4
    1079				
    1080 03B6				locloop_31:					;  xref A.03BB, 03BF
    1081 03B6  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1082 03B7  A8 80			 		test	al,80h
    1083 03B9  75 0D			 		jnz	loc_32	
    1084 03BB  E2 F9			 		loop	locloop_31		; Loop if cx > 0
    1085				
    1086 03BD  FE CB			 		dec	bl
    1087 03BF  75 F5			 		jnz	locloop_31
    1088 03C1  58			 		pop	ax
    1089 03C2  80 CC 80			 		or	ah,80h
    1090 03C5  E9 0312 R		 		jmp	I14_exit		; (0312)
    1091 03C8				loc_32:						;  xref A.03B9
    1092 03C8  33 C9			 		xor	cx,cx	
    1093 03CA  B3 02			 		mov	bl,2
    1094				
    1095 03CC				locloop_33:					;  xref A.03D1, 03D5
    1096 03CC  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1097 03CD  A8 01			 		test	al,1
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-21


    1098 03CF  75 0D			 		jnz	loc_34
    1099 03D1  E2 F9			 		loop	locloop_33		; Loop if cx > 0
    1100				
    1101 03D3  FE CB			 		dec	bl
    1102 03D5  75 F5			 		jnz	locloop_33
    1103 03D7  58			 		pop	ax
    1104 03D8  80 CC 80			 		or	ah,80h
    1105 03DB  E9 0312 R		 		jmp	I14_exit		; (0312)
    1106 03DE				loc_34:						;  xref A.03CF
    1107 03DE  83 EA 02			 		sub	dx,2
    1108 03E1  58			 		pop	ax
    1109 03E2  EE			 		out	dx,al			; port 0, DMA-1 bas&add ch 0
    1110 03E3  E9 0312 R		 		jmp	I14_exit		; (0312)
    1111				
    1112				; Receive
    1113 03E6				loc_35:						;  xref A.0308
    1114				; 		and	byte ptr ds:[71h],7Fh	; (A.0071=0) signbit
    1115 03E6  80 26 0071 R 7F				and	byte ptr ds:[signbit],7Fh
    1116 03EB  83 C2 02			 		add	dx,2
    1117 03EE  B0 37			 		mov	al,37h			; '7'
    1118 03F0  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1119 03F1  33 C9			 		xor	cx,cx
    1120 03F3  B3 04			 		mov	bl,4
    1121				
    1122				;a.03f5
    1123 03F5				locloop_36:					;  xref A.03FA, 03FE
    1124 03F5  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1125 03F6  A8 80			 		test	al,80h
    1126 03F8  75 0B			 		jnz	loc_38	
    1127 03FA  E2 F9			 		loop	locloop_36		; Loop if cx > 0
    1128				
    1129 03FC  FE CB			 		dec	bl
    1130 03FE  75 F5			 		jnz	locloop_36
    1131 0400				loc_37:						;  xref A.0411
    1132 0400  B4 80			 		mov	ah,80h
    1133 0402  E9 0312 R		 		jmp	I14_exit			; (0312)
    1134				
    1135 0405				loc_38:						;  xref A.03F8, 040F
    1136 0405  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1137 0406  A8 02			 		test	al,2
    1138 0408  75 09			 		jnz	loc_39	
    1139				; 		test	byte ptr ds:[71h],80h	; (A.0071=0)
    1140 040A  F6 06 0071 R 80				test	byte ptr ds:[signbit],80h
    1141 040F  74 F4			 		jz	loc_38	
    1142 0411  EB ED			 		jmp	short loc_37		; (0400)
    1143				
    1144				; checks for receive errors
    1145 0413				loc_39:						;  xref A.0408
    1146 0413  E8 0420 R		 		call	SetSerErrFl			; (0420)
    1147 0416  80 E4 1E			 		and	ah,00011110b		;1Eh
    1148 0419  83 EA 02			 		sub	dx,2
    1149 041C  EC			 		in	al,dx			; port 0, DMA-1 bas&add ch 0
    1150 041D  E9 0312 R		 		jmp	I14_exit			; (0312)
    1151				
    1152				;===============================================================================
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-22


    1153				 ;                              SUBROUTINE
    1154				 ;
    1155				 ;         Called from:   A.0413, 0458
    1156				;===============================================================================
    1157				; Tests some variable for bit flags. Maybe serial errors? AL= line status reg
    1158				; actual error bits are 7 (time out), 4 (BRK), 3 (FE), 2 (PE), 1 (OR). 
    1159				; AH !=0 on error
    1160				; Entry AL = status bits from the 8251
    1161				;a.0420
    1162 0420				SetSerErrFl		proc	near
    1163 0420  B4 00			 		mov	ah,0
    1164 0422  A8 01			 		test	al,1
    1165 0424  74 03			 		jz	loc_40
    1166 0426  80 CC 20			 		or	ah,20h			; THRE
    1167 0429				loc_40:						;  xref A.0424
    1168 0429  A8 02			 		test	al,2
    1169 042B  74 03			 		jz	loc_41	
    1170 042D  80 CC 01			 		or	ah,1			; DR
    1171 0430				loc_41:						;  xref A.042B
    1172 0430  A8 04			 		test	al,4
    1173 0432  74 03			 		jz	loc_42	
    1174 0434  80 CC 40			 		or	ah,40h			; TSRE
    1175 0437				loc_42:						;  xref A.0432
    1176 0437  A8 08			 		test	al,8
    1177 0439  74 03			 		jz	loc_43	
    1178 043B  80 CC 04			 		or	ah,4			; PE
    1179 043E				loc_43:						;  xref A.0439
    1180 043E  A8 10			 		test	al,10h
    1181 0440  74 03			 		jz	loc_44	
    1182 0442  80 CC 02			 		or	ah,2			; OR
    1183 0445				loc_44:						;  xref A.0440
    1184 0445  A8 20			 		test	al,20h	
    1185 0447  74 03			 		jz	loc_45
    1186 0449  80 CC 08			 		or	ah,8			; FE
    1187 044C				loc_45:						;  xref A.0447
    1188 044C  A8 40			 		test	al,40h	
    1189 044E  74 03			 		jz	loc_ret_46
    1190 0450  80 CC 10			 		or	ah,10h			; BRK
    1191				
    1192 0453				loc_ret_46:					;  xref A.044E
    1193 0453  C3			 		retn
    1194 0454				SetSerErrFl		endp
    1195				
    1196				; Serial Status
    1197 0454				loc_47:						;  xref A.030F, 0388
    1198 0454  83 C2 02			 		add	dx,2
    1199 0457  EC			 		in	al,dx			; port 4, DMA-1 bas&add ch 2
    1200 0458  E8 0420 R		 		call	SetSerErrFl		; (0420)
    1201 045B  24 80			 		and	al,80h			; timeout bit
    1202 045D  84 C0			 		test	al,al
    1203 045F  B0 F0			 		mov	al,0F0h
    1204 0461  75 02			 		jnz	loc_48			; Jump if not zero
    1205 0463  B0 00			 		mov	al,0			; set MSR=0
    1206 0465				loc_48:						;  xref A.0461
    1207 0465  E9 0312 R		 		jmp	I14_exit		; (0312)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-23


    1208				
    1209				;===============================================================================
    1210				 ;                              SUBROUTINE
    1211				 ;
    1212				 ;         Called from:   A.017B
    1213				;===============================================================================
    1214				;a.0468
    1215				; delay loop CX=# of msec?
    1216 0468				sub_6		proc	near
    1217 0468				loc_49:						;  xref A.0470
    1218 0468  FB			 		sti				; Enable interrupts
    1219 0469  51			 		push	cx
    1220 046A  33 C9			 		xor	cx,cx			; Zero register
    1221 046C				locloop_50:					;  xref A.046C
    1222 046C  E2 FE			 		loop	locloop_50		; Loop if cx > 0
    1223 046E  59			 		pop	cx
    1224 046F  49			 		dec	cx
    1225 0470  75 F6			 		jnz	loc_49			; Jump if not zero
    1226 0472  C3			 		retn
    1227 0473				sub_6		endp
    1228				
    1229				
    1230				;===============================================================================
    1231				 ;                              SUBROUTINE
    1232				 ;
    1233				 ;         Called from:   A.009E
    1234				;===============================================================================
    1235				; setup certain handlers to default to IRET and set equipment bits
    1236				;a.0473
    1237 0473				InitEquipList	proc	near
    1238 0473  1E			 		push	ds
    1239 0474  33 C0			 		xor	ax,ax			; Zero register
    1240 0476  8E D8			 		mov	ds,ax
    1241 0478  B8 0596 R		 		mov	ax,offset DefIRET	; default IRET 596h
    1242 047B  A3 0060			 		mov	ds:Int18v,ax		; (0000:0060=0CD00h)
    1243 047E  A3 0064			 		mov	ds:Int19v,ax		; (0000:0064=0CC60h)
    1244 0481  8C 0E 0062		 		mov	ds:Int18v+2,cs		; (0000:0062=0F000h)
    1245 0485  8C 0E 0066		 		mov	ds:Int19v+2,cs		; (0000:0066=0F000h)
    1246 0489  A3 0054			 		mov	ds:Int15v,ax		; (0000:0054=0CBA0h)
    1247 048C  8C 0E 0056		 		mov	ds:Int15v+2,cs		; (0000:0056=0F000h)
    1248 0490  A3 006C			 		mov	ds:Int1Bv,ax		; (0000:006C=0D1C0h)
    1249 0493  8C 0E 006E		 		mov	ds:Int1Bv+2,cs		; (0000:006E=0F000h)
    1250 0497  A3 0070			 		mov	ds:Int1Cv,ax		; (0000:0070=0CC00h)
    1251 049A  8C 0E 0072		 		mov	ds:Int1Cv+2,cs		; (0000:0072=0F000h)
    1252				
    1253 049E  B8 01B4 R		 		mov	ax,offset INT11HANDLER	; equip list 1B4h
    1254 04A1  A3 0044			 		mov	ds:Int11v,ax		; (0000:0044=0CB20h)
    1255 04A4  8C 0E 0046		 		mov	ds:Int11v+2,cs		; (0000:0046=0F000h)
    1256 04A8  B8 0040			 		mov	ax,40h
    1257 04AB  8E D8			 		mov	ds,ax
    1258				; equipment list - assumes:
    1259				;	01 0 0 010 0 01 10 11 0 1 = 446Dh
    1260				;	LP X G SER X FD VM KM X B
    1261				;
    1262				;	BIT 15,14 = NUMBER OF PRINTERS ATTACHED
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-24


    1263				;	BIT 13 NOT USED
    1264				;	BIT 12 = GAME I/O ATTACHED
    1265				;	BIT 11,10,9 = NUMBER OF RS232 CARDS ATTACHED
    1266				;	BIT 8 UNUSED
    1267				;	BIT 7,6 = NUMBER OF DISKETTE DRIVES
    1268				;		00=1, 01=2, 10=3, 11=4 ONLY IF BIT 0 = 1
    1269				;	BIT 5,4 = INITIAL VIDEO MODE
    1270				;			00 - UNUSED
    1271				;			01 - 40X25 BW USING COLOR CARD
    1272				;			10 - 80X25 BW USING COLOR CARD
    1273				;			11 - 80X25 BW USING BW CARD
    1274				;	BIT 3,2 = PLANAR RAM SIZE (00=16K,01=32K,10=48K,11=64K)
    1275				;	BIT 1 NOT USED
    1276				;	BIT 0 = IPL FROM DISKETTE -- THIS BIT INDICATES THAT THERE ARE DISKETTE
    1277				;		DRIVES ON THE SYSTEM
    1278 04AD  B8 446D			 		mov	ax,0100010001101101b	;446Dh		; 01000100 / 01101101
    1279 04B0  A3 0010 R		 		mov	ds:equip_bits,ax	; (0040:0010=4467h)
    1280 04B3  1F			 		pop	ds
    1281 04B4  C3			 		retn
    1282 04B5				InitEquipList	endp
    1283				
    1284				
    1285				;===============================================================================
    1286				 ;                              SUBROUTINE
    1287				 ;
    1288				 ;         Called from:   A.00A1
    1289				;===============================================================================
    1290				; setup default handlers 08h, 0ch, and 1ah.
    1291				;a.04b5
    1292 04B5				InitTimers	proc	near
    1293 04B5  1E			 		push	ds
    1294 04B6  9C			 		pushf				; Push flags
    1295 04B7  FA			 		cli				; Disable interrupts
    1296 04B8				loc_51:
    1297 04B8  33 C0			 		xor	ax,ax			; Zero register
    1298 04BA  8E D8			 		mov	ds,ax
    1299				;***** Note: the following codes as B8 0511 while the original
    1300				;***** codes as B8 0513.
    1301 04BC  B8 0511 R		 		mov	ax,offset INT0CHANDLER	;513h
    1302				;*****
    1303 04BF  A3 0030			 		mov	ds:Int0Cv,ax		; (0000:0030=0CE80h)
    1304 04C2  8C 0E 0032		 		mov	ds:Int0Cv+2,cs		; (0000:0032=0F000h)
    1305 04C6  B8 0521 R		 		mov	ax,offset INT08HANDLER	;521h
    1306 04C9  A3 0020			 		mov	ds:Int08v,ax		; (0000:0020=0FEA5h)
    1307 04CC  8C 0E 0022		 		mov	ds:Int08v+2,cs		; (0000:0022=0F000h)
    1308 04D0  B8 0562 R		 		mov	ax,offset INT1AHANDLER	;562h
    1309 04D3  A3 0068			 		mov	ds:Int1Av,ax		; (0000:0068=0CBE0h)
    1310 04D6  8C 0E 006A		 		mov	ds:Int1Av+2,cs		; (0000:006A=0F000h)
    1311 04DA  B8 0040			 		mov	ax,40h
    1312 04DD  8E D8			 		mov	ds,ax
    1313 04DF  33 C0			 		xor	ax,ax			; Zero register
    1314 04E1  A3 006C R		 		mov	ds:timer_low,ax		; (0040:006C=6980h)
    1315 04E4  A3 006E R		 		mov	ds:timer_hi,ax		; (0040:006E=16h)
    1316 04E7  A2 0070 R		 		mov	ds:timer_rolled,al	; (0040:0070=0)
    1317 04EA  BE 050A R		 		mov	si,offset data_82	; (A.050A=36h)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-25


    1318 04ED  B9 0003			 		mov	cx,3
    1319 04F0  BA 0040			 		mov	dx,40h
    1320				
    1321 04F3				locloop_52:					;  xref A.04FE
    1322 04F3  2E: AC			 		lods	byte ptr cs:[si]	; String [si] to al
    1323 04F5  E6 43			 		out	43h,al			; port 43h, 8253 timer control C58253CTL
    1324 04F7  2E: AC			 		lods	byte ptr cs:[si]	; String [si] to al
    1325 04F9  EE			 		out	dx,al			; port 40h, 8253 timer 0 clock
    1326 04FA  2E: AC			 		lods	byte ptr cs:[si]	; String [si] to al
    1327 04FC  EE			 		out	dx,al			; port 40h, 8253 timer 0 clock
    1328 04FD  42			 		inc	dx
    1329 04FE  E2 F3			 		loop	locloop_52		; Loop if cx > 0
    1330				
    1331 0500  BA FF38			 		mov	dx,0FF38h		;PCRBASE+ICR+INT0CR
    1332 0503  B8 0000			 		mov	ax,0
    1333 0506  EF			 		out	dx,ax			; port 0FF38h ??I/O Non-standard
    1334 0507  9D			 		popf				; Pop flags
    1335 0508  1F			 		pop	ds
    1336 0509  C3			 		retn
    1337 050A				InitTimers	endp
    1338				
    1339				; 80186 timer 0 configuration bytes
    1340				;a.050a
    1341 050A  36 00 00 76 A9 04	data_82:	db	36h, 00h, 00h, 76h,0A9h, 04h,0B6h
    1342       B6			
    1343				
    1344				;===============================================================================
    1345				; a.0511
    1346				; (80186 INT1 Handler)
    1347 0511				INT0CHANDLER:
    1348 0511  A9 5004			 		test	ax,5004h		; 01100000-00000100
    1349 0514  52			 		push	dx
    1350 0515  B8 8000			 		mov	ax,8000h		; 10000000-00000000
    1351 0518  BA FF22			 		mov	dx,ICR+EOIREG		;FF22h		;ICR+EOIREG
    1352 051B  EF			 		out	dx,ax
    1353 051C  5A			 		pop	dx
    1354 051D  58			 		pop	ax
    1355 051E  CD 08			 		INT	08h 
    1356 0520  CF			 		iret
    1357				
    1358				;===============================================================================
    1359				;a.0521
    1360				; INT 08 - Hardware Timer Tick
    1361 0521				INT08HANDLER:
    1362 0521  50			 		push	ax
    1363 0522  52			 		push	dx
    1364 0523  1E			 		push	ds
    1365 0524  B8 0040			 		mov	ax,40h
    1366 0527  8E D8			 		mov	ds,ax
    1367 0529  FF 06 006C R		 		inc	word ptr ds:[timer_low]
    1368 052D  75 04			 		jnz	loc_53
    1369 052F  FF 06 006E R		 		inc	word ptr ds:[timer_hi]
    1370 0533				loc_53:
    1371 0533  83 3E 006E R 18		 		cmp	word ptr ds:[timer_hi],18h	; (A.006E=0BF00h)
    1372 0538  75 19			 		jne	loc_54				; Jump if not equal
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-26


    1373 053A  81 3E 006C R 00B0	 		cmp	word ptr ds:[timer_low],0B0h	; (A.006C=0BEh)
    1374 0540  75 11			 		jne	loc_54				; Jump if not equal
    1375 0542  C7 06 006E R 0000	 		mov	word ptr ds:[timer_hi],0	; (A.006E=0BF00h)
    1376 0548  C7 06 006C R 0000	 		mov	word ptr ds:[timer_low],0	; (A.006C=0BEh)
    1377 054E  C6 06 0070 R 01		 		mov	byte ptr ds:[timer_rolled],1	; (A.0070=4)
    1378 0553				loc_54:							;  xref A.0538, 0540
    1379 0553  FE 0E 0040 R		 		dec	byte ptr ds:[dsk_motor_tmr]	; (A.0040=0ABh)
    1380 0557  75 03			 		jnz	loc_55				; Jump if not zero
    1381 0559  E8 09AD R		 		call	sub_19				; (09AD)
    1382 055C				loc_55:							;  xref A.0557
    1383 055C  CD 1C			 		int	1Ch				; Timer break (call each 18.2ms)
    1384 055E  1F			 		pop	ds
    1385 055F  5A			 		pop	dx
    1386 0560  58			 		pop	ax
    1387 0561  CF			 		iret				; Interrupt return
    1388				
    1389				;===============================================================================
    1390				;a.0562
    1391				; INT 1A - Time-of-Day/RTC
    1392 0562				INT1AHANDLER:
    1393 0562  1E			 		push	ds
    1394 0563  FA			 		cli				; Disable interrupts
    1395 0564  50			 		push	ax
    1396 0565  B8 0040			 		mov	ax,40h
    1397 0568  8E D8			 		mov	ds,ax
    1398 056A  58			 		pop	ax
    1399 056B  0A E4			 		or	ah,ah			; Zero ?
    1400 056D  74 06			 		jz	loc_57			; Jump if zero
    1401 056F  FE CC			 		dec	ah
    1402 0571  74 14			 		jz	loc_58			; Jump if zero
    1403 0573				loc_56:						;  xref A.0585, 0594
    1404 0573  1F			 		pop	ds
    1405 0574  CF			 		iret				; Interrupt return
    1406				
    1407 0575				loc_57:							;  xref A.056D
    1408 0575  A0 0070 R		 		mov	al,byte ptr ds:[timer_rolled]	; (A.0070=4)
    1409 0578  C6 06 0070 R 00		 		mov	byte ptr ds:[timer_rolled],0	; (A.0070=4)
    1410 057D  8B 0E 006E R		 		mov	cx,word ptr ds:[timer_hi]	; (A.006E=0BF00h)
    1411 0581  8B 16 006C R		 		mov	dx,word ptr ds:[timer_low]	; (A.006C=0BEh)
    1412 0585  EB EC			 		jmp	short loc_56			; (0573)
    1413 0587				loc_58:							;  xref A.0571
    1414 0587  89 16 006C R		 		mov	word ptr ds:[timer_low],dx	; (A.006C=0BEh)
    1415 058B  89 0E 006E R		 		mov	word ptr ds:[timer_hi],cx	; (A.006E=0BF00h)
    1416 058F  C6 06 0070 R 00		 		mov	byte ptr ds:[timer_rolled],0	; (A.0070=4)
    1417 0594  EB DD			 		jmp	short loc_56			; (0573)
    1418 0596  CF			 DefIRET:	iret	
    1419				
    1420				;===============================================================================
    1421				; Dynamic Halt
    1422 0597				 DynHalt:					;  xref A.004B, 0598
    1423 0597  FA			 		cli				; Disable interrupts
    1424 0598  EB FD			 		jmp	short DynHalt		; (0597)
    1425				
    1426				;===============================================================================
    1427				;a.059a
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-27


    1428				;* No entry point to code
    1429				; Doesn't seem to have an absolute reference anywhere
    1430 059A				loc_59:
    1431 059A  9C			 		pushf				; Push flags
    1432 059B  FA			 		cli				; Disable interrupts
    1433 059C  1E			 		push	ds
    1434 059D  B8 0040			 		mov	ax,40h
    1435 05A0  8E D8			 		mov	ds,ax
    1436 05A2  0A F6			 		or	dh,dh			; Zero ?
    1437 05A4  74 0B			 		jz	loc_62			; Jump if zero
    1438 05A6				loc_60:						;  xref A.05AF
    1439 05A6  B3 06			 		mov	bl,6
    1440 05A8  E8 05C3 R		 		call	BEEP			; (05C3)
    1441				
    1442 05AB				locloop_61:					;  xref A.05AB
    1443 05AB  E2 FE			 		loop	locloop_61		; Loop if cx > 0
    1444				
    1445 05AD  FE CE			 		dec	dh
    1446 05AF  75 F5			 		jnz	loc_60			; Jump if not zero
    1447 05B1				loc_62:						;  xref A.05A4, 05BA
    1448 05B1  B3 01			 		mov	bl,1
    1449 05B3  E8 05C3 R		 		call	BEEP			; (05C3)
    1450				
    1451 05B6				locloop_63:					;  xref A.05B6
    1452 05B6  E2 FE			 		loop	locloop_63		; Loop if cx > 0
    1453				
    1454 05B8  FE CA			 		dec	dl
    1455 05BA  75 F5			 		jnz	loc_62			; Jump if not zero
    1456				
    1457 05BC				locloop_64:					;  xref A.05BC
    1458 05BC  E2 FE			 		loop	locloop_64		; Loop if cx > 0
    1459				
    1460				
    1461 05BE				locloop_65:					;  xref A.05BE
    1462 05BE  E2 FE			 		loop	locloop_65		; Loop if cx > 0
    1463				
    1464 05C0  1F			 		pop	ds
    1465 05C1  9D			 		popf				; Pop flags
    1466 05C2  C3			 		retn
    1467				
    1468				;===============================================================================
    1469				 ;                              SUBROUTINE
    1470				 ;
    1471				 ;         Called from:   A.05A8, 05B3, 16C8
    1472				;===============================================================================
    1473				;a.05c3
    1474				; should ax,cx be preserved?
    1475 05C3				BEEP		proc	near
    1476 05C3  B0 B6			 		mov	al,0B6h
    1477 05C5  E6 43			 		out	C58253CTL,al		; port 43h, 8253 timer control C58253CTL
    1478 05C7  B8 0533			 		mov	ax,533h
    1479 05CA  E6 42			 		out	C5TIMER2,al		; port 42h, 8253 timer 2 spkr C5TIMER2
    1480 05CC  8A C4			 		mov	al,ah
    1481 05CE  E6 42			 		out	C5TIMER2,al		; port 42h, 8253 timer 2 spkr C5TIMER2
    1482 05D0  E4 61			 		in	al,C58255PB		; port 61h, 8255 port B, read C58255PB
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-28


    1483 05D2  8A E0			 		mov	ah,al
    1484 05D4  0C 03			 		or	al,3
    1485 05D6  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc C58255PB
    1486 05D8  2B C9			 		sub	cx,cx
    1487				
    1488 05DA				BEEP_1:						;  xref A.05DA, 05DE
    1489 05DA  E2 FE			 		loop	BEEP_1			; Loop if cx > 0
    1490 05DC  FE CB			 		dec	bl
    1491 05DE  75 FA			 		jnz	BEEP_1			; Jump if not zero
    1492 05E0  8A C4			 		mov	al,ah
    1493 05E2  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc C58255PB
    1494 05E4  C3			 		retn
    1495 05E5				BEEP		endp
    1496				
    1497				
    1498				;===============================================================================
    1499				 ;                              SUBROUTINE
    1500				 ;
    1501				 ;         Called from:   A.0095, 009B, 0154, 0BA9
    1502				;===============================================================================
    1503				;a.05e5
    1504 05E5				prtzstr		proc	near
    1505 05E5				loc_67:						;  xref A.05F3
    1506 05E5  2E: 8A 04		 		mov	al,cs:[si]
    1507 05E8  46			 		inc	si
    1508 05E9  84 C0			 		test	al,al
    1509 05EB  74 08			 		jz	loc_ret_68		; Jump if zero
    1510 05ED  B7 00			 		mov	bh,0
    1511 05EF  B4 0E			 		mov	ah,0Eh
    1512 05F1  CD 10			 		int	10h			; Video display   ah=functn 0Eh
    1513				 						;  write char al, teletype mode
    1514 05F3  EB F0			 		jmp	short loc_67		; (05E5)
    1515				
    1516 05F5				loc_ret_68:					;  xref A.05EB
    1517 05F5  C3			 		retn
    1518 05F6				 prtzstr	endp
    1519				
    1520				
    1521				;===============================================================================
    1522				 ;                              SUBROUTINE
    1523				 ;
    1524				 ;         Called from:   A.00AA
    1525				;===============================================================================
    1526				;a.05f6
    1527				; grab disk vectors and second serial hardware IRQ
    1528 05F6				InitFloppy	proc	near
    1529 05F6  1E			 		push	ds
    1530 05F7  33 C0			 		xor	ax,ax			; Zero register
    1531 05F9  8E D8			 		mov	ds,ax
    1532 05FB  B8 061B R		 		mov	ax,offset INT13HANDLER	;61Bh
    1533 05FE  A3 004C			 		mov	ds:Int13v,ax		; (0000:004C=0CF60h)
    1534 0601  8C 0E 004E		 		mov	ds:Int13v+2,cs		; (0000:004E=0F000h)
    1535 0605  B8 07E9 R		 		mov	ax,offset INT0BHANDLER	;7E9h
    1536 0608  A3 002C			 		mov	ds:Int0Bv,ax		; (0000:002C=0CE80h)
    1537 060B  8C 0E 002E		 		mov	ds:Int0Bv+2,cs		; (0000:002E=0F000h)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-29


    1538 060F  B8 0AC9 R		 		mov	ax,offset INT_1E	;0AC9h
    1539 0612  A3 0078			 		mov	ds:Int1Ev,ax		; (0000:0078=0CA60h)
    1540 0615  8C 0E 007A		 		mov	word ptr ds:Int1Ev+2,cs	; (0000:007A=0F000h)
    1541 0619  1F			 		pop	ds
    1542 061A  C3			 		retn
    1543 061B				InitFloppy	endp
    1544				
    1545				;===============================================================================
    1546				;a.061b
    1547				; INT 13 - Diskette Services
    1548 061B				INT13HANDLER:
    1549 061B  FB			 		sti				; Enable interrupts
    1550 061C  53			 		push	bx
    1551 061D  51			 		push	cx
    1552 061E  1E			 		push	ds
    1553 061F  56			 		push	si
    1554 0620  57			 		push	di
    1555 0621  55			 		push	bp
    1556 0622  52			 		push	dx
    1557 0623  8B EC			 		mov	bp,sp
    1558 0625  BE 0040			 		mov	si,40h
    1559 0628  8E DE			 		mov	ds,si
    1560 062A  E8 0649 R		 		call	ProcDiskCmd		; (0649)
    1561 062D  BB 0004			 		mov	bx,4
    1562 0630  E8 0834 R		 		call	GetpDPB			; (0834)
    1563 0633  88 26 0040 R		 		mov	ds:dsk_motor_tmr,ah	; (0040:0040=0)
    1564 0637  8A 26 0041 R		 		mov	ah,ds:dsk_ret_code	; (0040:0041=0)
    1565 063B  80 FC 01			 		cmp	ah,1
    1566 063E  F5			 		cmc				; Complement carry
    1567 063F  5A			 		pop	dx
    1568 0640  5D			 		pop	bp
    1569 0641  5F			 		pop	di
    1570 0642  5E			 		pop	si
    1571 0643  1F			 		pop	ds
    1572 0644  59			 		pop	cx
    1573 0645  5B			 		pop	bx
    1574 0646  CA 0002			 		retf	2			; Return far
    1575				
    1576				;===============================================================================
    1577				;                               SUBROUTINE
    1578				;
    1579				;         Called from:   A.062A
    1580				;===============================================================================
    1581				;a.0649
    1582 0649				ProcDiskCmd	proc	near
    1583 0649  8A F0			 		mov	dh,al
    1584 064B  A2 006B R		 		mov	ds:gen_int_occured,al	; (0040:006B=0)
    1585 064E  80 26 003F R 3F		 		and	byte ptr ds:dsk_motor_stat,3Fh	; (0040:003F=0) '?'
    1586 0653  B0 FF			 		mov	al,0FFh
    1587 0655  A2 0040 R		 		mov	ds:dsk_motor_tmr,al	; (0040:0040=0)
    1588				
    1589				; function dispatch
    1590				; AH=0 reset AH=1 read status AH=2 read sectors AH=3 write AH=4 verify AH=5 format
    1591 0658  0A E4			 		or	ah,ah			; reset?
    1592 065A  74 33			 		jz	cmdResetDisk		; reset the disk system
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-30


    1593				
    1594 065C  FE CC			 		dec	ah
    1595 065E  75 03			 		jnz	proccmd1		; AH=2-5
    1596 0660  EB 5A			 		jmp	short cmdDiskStat	; (06BC) read disk status
    1597 0662  90			 		db	90h
    1598				
    1599 0663				proccmd1:					;  xref A.065E
    1600 0663  C6 06 0041 R 00		 		mov	byte ptr ds:dsk_ret_code,0	; (0040:0041=0)
    1601 0668  80 FA 04			 		cmp	dl,4			; only 4 drives allowed
    1602 066B  73 1C			 		jae	proccmd5		; Jump if above or =
    1603				
    1604 066D  FE CC			 		dec	ah			;
    1605 066F  75 03			 		jnz	proccmd2
    1606 0671  EB 4D			 		jmp	short cmdDiskRD		; (06C0) read sectors
    1607 0673  90			 		db	90h
    1608				
    1609 0674				proccmd2:					;  xref A.066F
    1610 0674  FE CC			 		dec	ah
    1611 0676  75 03			 		jnz	proccmd3
    1612 0678  E9 0714 R		 		jmp	cmdDiskWrt		; (0714) write
    1613				
    1614 067B				proccmd3:					;  xref A.0676
    1615 067B  FE CC			 		dec	ah
    1616 067D  75 03			 		jnz	proccmd4
    1617 067F  EB 46			 		jmp	short cmdDiskVer	; (06C7) verify
    1618 0681  90			 		db	90h
    1619				
    1620 0682				proccmd4:					;  xref A.067D
    1621 0682  FE CC			 		dec	ah
    1622 0684  75 03			 		jnz	proccmd5
    1623 0686  EB 46			 		jmp	short cmdDiskFmt	; (06CE) format
    1624 0688  90			 		db	90h
    1625				
    1626 0689				proccmd5:					;  xref A.066B, 0684
    1627 0689  C6 06 0041 R 01		 		mov	byte ptr ds:dsk_ret_code,1	; (0040:0041=0)
    1628 068E  C3			 		retn
    1629				
    1630				;===============================================================================
    1631				; AH=0 reset the disk
    1632 068F				cmdResetDisk:					;  xref A.065A
    1633 068F  E8 0A4C R		 		call	sub_23			; (0A4C)
    1634 0692  E8 0A9E R		 		call	sub_26			; (0A9E)
    1635 0695  B4 03			 		mov	ah,3
    1636 0697  E8 0808 R		 		call	sub_13			; (0808)
    1637 069A  BB 0001			 		mov	bx,1
    1638 069D  E8 0834 R		 		call	GetpDPB			; (0834)
    1639 06A0  BB 0003			 		mov	bx,3
    1640 06A3  E8 0834 R		 		call	GetpDPB			; (0834)
    1641 06A6  C6 06 0041 R 00		 		mov	byte ptr ds:[dsk_ret_code],0	; (A.0041=0B9h)
    1642 06AB  C6 06 003E R 00		 		mov	byte ptr ds:[dsk_recal_stat],0	; (A.003E=0FBh)
    1643 06B0  C6 06 003F R 00		 		mov	byte ptr ds:[dsk_motor_stat],0	; (A.003F=0F3h)
    1644 06B5  E8 0A9E R		 		call	sub_26			; (0A9E)
    1645 06B8  E8 09AD R		 		call	sub_19			; (09AD)
    1646 06BB  C3			 		retn
    1647				
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-31


    1648				;===============================================================================
    1649				; AH=1 get disk status
    1650 06BC				cmdDiskStat:					;  xref A.0660
    1651 06BC  A0 0041 R		 		mov	al,byte ptr ds:[dsk_ret_code]	; (A.0041=0B9h)
    1652 06BF  C3			 		retn
    1653				
    1654				;===============================================================================
    1655				; AH=2 read sectors
    1656				;a.06c0
    1657 06C0				cmdDiskRD:					;  xref A.0671, 06CC
    1658 06C0  E8 08E7 R		 		call	sub_18			; (08E7)
    1659 06C3  B4 66			 		mov	ah,66h			; 'f'
    1660 06C5  EB 57			 		jmp	short loc_81		; (071E)
    1661				
    1662				;===============================================================================
    1663				; AH=4 verify sectors
    1664 06C7				cmdDiskVer:					;  xref A.067F
    1665 06C7  80 0E 003F R 40		 		or	byte ptr ds:dsk_motor_stat,40h	; (0040:003F=0) '@'
    1666 06CC  EB F2			 		jmp	short cmdDiskRD		; (06C0)
    1667				
    1668				;===============================================================================
    1669				; AH=5 format sectors
    1670 06CE				cmdDiskFmt:					;  xref A.0686
    1671 06CE  80 0E 003F R 80		 		or	byte ptr ds:dsk_motor_stat,80h	; (0040:003F=0)
    1672 06D3  E8 08E7 R		 		call	sub_18			; (08E7)
    1673 06D6  B4 4D			 		mov	ah,4Dh			; 'M'
    1674 06D8  50			 		push	ax
    1675 06D9  53			 		push	bx
    1676 06DA  52			 		push	dx
    1677 06DB  BB 0008			 		mov	bx,8
    1678 06DE  E8 0834 R		 		call	GetpDPB			; (0834)
    1679 06E1  8A C4			 		mov	al,ah
    1680 06E3  32 E4			 		xor	ah,ah			; Zero register
    1681 06E5  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    1682 06E7  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    1683 06E9  BA FFD8			 		mov	dx,DMA1+DMATC		;0FFD8h		;DMA1+DMATC
    1684 06EC  EF			 		out	dx,ax			; port 0FFD8h ??I/O Non-standard
    1685 06ED  5A			 		pop	dx
    1686 06EE  5B			 		pop	bx
    1687 06EF  58			 		pop	ax
    1688 06F0  EB 2C			 		jmp	short loc_81		; (071E)
    1689 06F2				loc_79:						;  xref A.075C
    1690 06F2  BB 0007			 		mov	bx,7
    1691 06F5  E8 0834 R		 		call	GetpDPB			; (0834)
    1692 06F8  BB 0009			 		mov	bx,9
    1693 06FB  E8 0834 R		 		call	GetpDPB			; (0834)
    1694 06FE  BB 000F			 		mov	bx,0Fh
    1695 0701  E8 0834 R		 		call	GetpDPB			; (0834)
    1696 0704  A1 0067 R		 		mov	ax,word ptr ds:[gen_io_ptr]	; (A.0067=8C00h)
    1697 0707  BA FFDA			 		mov	dx,DMA1+DMACW		;0FFDAh		;DMA1+DMACW
    1698 070A  EF			 		out	dx,ax			; port 0FFDAh ??I/O Non-standard
    1699 070B  BB 0011			 		mov	bx,11h
    1700 070E  E8 0834 R		 		call	GetpDPB			; (0834)
    1701 0711  EB 7C			 		jmp	short loc_85		; (078F)
    1702 0713  90			 		db	90h
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-32


    1703				
    1704				;===============================================================================
    1705				; AH=3 write sectors
    1706				;a.0714
    1707 0714				cmdDiskWrt:						;  xref A.0678
    1708 0714  80 0E 003F R 80		 		or	byte ptr ds:[dsk_motor_stat],80h	; (A.003F=0F3h)
    1709 0719  E8 08E7 R		 		call	sub_18			; (08E7)
    1710 071C  B4 45			 		mov	ah,45h			; 'E'
    1711 071E				loc_81:						;  xref A.06C5, 06F0
    1712 071E  73 08			 		jnc	loc_82			; Jump if carry=0
    1713 0720  C6 06 0041 R 09		 		mov	byte ptr ds:[dsk_ret_code],9	; (A.0041=0B9h)
    1714 0725  B0 00			 		mov	al,0
    1715 0727  C3			 		retn
    1716 0728				loc_82:						;  xref A.071E
    1717 0728  E8 0A9E R		 		call	sub_26			; (0A9E)
    1718 072B  80 26 003E R 7F		 		and	byte ptr ds:[dsk_recal_stat],7Fh	; (A.003E=0FBh)
    1719 0730  50			 		push	ax
    1720 0731  E8 09B6 R		 		call	sub_20			; (09B6)
    1721 0734  E8 0A59 R		 		call	sub_24			; (0A59)
    1722 0737  72 03			 		jc	loc_83			; Jump if carry Set
    1723 0739  E8 0845 R		 		call	sub_15			; (0845)
    1724				;a.073c
    1725 073C				loc_83:						;  xref A.0737
    1726 073C  58			 		pop	ax
    1727 073D  8A FC			 		mov	bh,ah
    1728 073F  72 51			 		jc	loc_86			; Jump if carry Set
    1729 0741  E8 0A9E R		 		call	sub_26			; (0A9E)
    1730 0744  E8 0808 R		 		call	sub_13			; (0808)
    1731 0747  8A 66 01			 		mov	ah,[bp+1]
    1732 074A  D0 E4			 		shl	ah,1			; Shift w/zeros fill
    1733 074C  D0 E4			 		shl	ah,1			; Shift w/zeros fill
    1734 074E  80 E4 04			 		and	ah,4
    1735 0751  0A 66 00			 		or	ah,[bp]
    1736 0754  E8 0808 R		 		call	sub_13			; (0808)
    1737 0757  80 FF 4D			 		cmp	bh,4Dh			; 'M'
    1738 075A  75 02			 		jne	loc_84			; Jump if not equal
    1739 075C  EB 94			 		jmp	short loc_79		; (06F2)
    1740				;a.075e
    1741 075E				loc_84:						;  xref A.075A
    1742 075E  8A E5			 		mov	ah,ch
    1743 0760  E8 0808 R		 		call	sub_13			; (0808)
    1744 0763  8A 66 01			 		mov	ah,[bp+1]
    1745 0766  E8 0808 R		 		call	sub_13			; (0808)
    1746 0769  8A E1			 		mov	ah,cl
    1747 076B  E8 0808 R		 		call	sub_13			; (0808)
    1748 076E  BB 0007			 		mov	bx,7
    1749 0771  E8 0834 R		 		call	GetpDPB			; (0834)
    1750 0774  8A E1			 		mov	ah,cl
    1751 0776  BB 0009			 		mov	bx,9
    1752 0779  E8 0834 R		 		call	GetpDPB			; (0834)
    1753 077C  BB 000B			 		mov	bx,0Bh
    1754 077F  E8 0834 R		 		call	GetpDPB			; (0834)
    1755 0782  A1 0067 R		 		mov	ax,word ptr ds:[gen_io_ptr]	; (A.0067=8C00h)
    1756 0785  BA FFDA			 		mov	dx,DMA1+DMACW		;0FFDAh		;DMA1+DMACW
    1757 0788  EF			 		out	dx,ax			; port 0FFDAh ??I/O Non-standard
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-33


    1758 0789  BB 000D			 		mov	bx,0Dh
    1759 078C  E8 0834 R		 		call	GetpDPB			; (0834)
    1760				;a.078f
    1761 078F				loc_85:						;  xref A.0711
    1762 078F  E8 09BF R		 		call	sub_21			; (09BF)
    1763 0792				loc_86:						;  xref A.073F
    1764 0792  72 45			 		jc	loc_90			; Jump if carry Set
    1765 0794  E8 0A08 R		 		call	sub_22			; (0A08)
    1766 0797  72 3F			 		jc	loc_ret_89		; Jump if carry Set
    1767 0799  FC			 		cld				; Clear direction
    1768 079A  BE 0042 R		 		mov	si,offset nec_stat		; (0040:0042=0)
    1769 079D  AC			 		lodsb				; String [si] to al
    1770 079E  24 C0			 		and	al,0C0h
    1771 07A0  74 41			 		jz	loc_91			; Jump if zero
    1772 07A2  3C 40			 		cmp	al,40h			; '@'
    1773 07A4  75 29			 		jne	loc_87			; Jump if not equal
    1774 07A6  AC			 		lodsb				; String [si] to al
    1775 07A7  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1776 07A9  B4 04			 		mov	ah,4
    1777 07AB  72 24			 		jc	loc_88			; Jump if carry Set
    1778 07AD  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1779 07AF  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1780 07B1  B4 10			 		mov	ah,10h
    1781 07B3  72 1C			 		jc	loc_88			; Jump if carry Set
    1782 07B5  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1783 07B7  B4 08			 		mov	ah,8
    1784 07B9  72 16			 		jc	loc_88			; Jump if carry Set
    1785 07BB  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1786 07BD  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1787 07BF  B4 04			 		mov	ah,4
    1788 07C1  72 0E			 		jc	loc_88			; Jump if carry Set
    1789 07C3  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1790 07C5  B4 03			 		mov	ah,3
    1791 07C7  72 08			 		jc	loc_88			; Jump if carry Set
    1792 07C9  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1793 07CB  B4 02			 		mov	ah,2
    1794 07CD  72 02			 		jc	loc_88			; Jump if carry Set
    1795 07CF				loc_87:						;  xref A.07A4
    1796 07CF  B4 20			 		mov	ah,20h			; ' '
    1797 07D1				loc_88:						;  xref A.07AB, 07B3, 07B9, 07C1
    1798				 						;            07C7, 07CD
    1799 07D1  08 26 0041 R		 		or	byte ptr ds:[dsk_ret_code],ah	; (A.0041=0B9h)
    1800 07D5  E8 0AB2 R		 		call	sub_27			; (0AB2)
    1801				
    1802 07D8				loc_ret_89:					;  xref A.0797
    1803 07D8  C3			 		retn
    1804				
    1805				;a.07d9
    1806 07D9				loc_90:						;  xref A.0792
    1807 07D9  E8 0A4C R		 		call	sub_23			; (0A4C)
    1808 07DC  E8 0A08 R		 		call	sub_22			; (0A08)
    1809 07DF  E8 0A9E R		 		call	sub_26			; (0A9E)
    1810 07E2  C3			 		retn
    1811 07E3				loc_91:						;  xref A.07A0
    1812 07E3  E8 0AB2 R		 		call	sub_27			; (0AB2)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-34


    1813 07E6  32 E4			 		xor	ah,ah			; Zero register
    1814 07E8  C3			 		retn
    1815 07E9				ProcDiskCmd	endp
    1816				
    1817				;===============================================================================
    1818				;a.07e9
    1819				; INT 0B - 80186 DMA1 Handler
    1820 07E9				INT0BHANDLER:				
    1821 07E9  50			 		push	ax
    1822 07EA  53			 		push	bx
    1823 07EB  51			 		push	cx
    1824 07EC  52			 		push	dx
    1825 07ED  1E			 		push	ds
    1826 07EE  E8 0A4C R		 		call	sub_23			; (0A4C)
    1827 07F1  B8 0040			 		mov	ax,40h
    1828 07F4  8E D8			 		mov	ds,ax
    1829 07F6  80 0E 003E R 80		 		or	byte ptr ds:dsk_recal_stat,80h	; (0040:003E=0)
    1830 07FB  B8 8000			 		mov	ax,8000h
    1831 07FE  BA FF22			 		mov	dx,ICR+EOIREG		;0FF22h		;ICR+EOIREG
    1832 0801  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
    1833 0802  1F			 		pop	ds
    1834 0803  5A			 		pop	dx
    1835 0804  59			 		pop	cx
    1836 0805  5B			 		pop	bx
    1837 0806  58			 		pop	ax
    1838 0807  CF			 		iret				; Interrupt return
    1839				
    1840				;===============================================================================
    1841				 ;                              SUBROUTINE
    1842				 ;
    1843				 ;         Called from:   A.0697, 0744, 0754, 0760, 0766, 076B, 0859
    1844				 ;                             085F, 086C, 0872, 0877, 08A2, 0993, 0A63
    1845				 ;                             0A69, 0AA1
    1846				;===============================================================================
    1847				;a.0808
    1848 0808				sub_13		proc	near
    1849 0808				loc_92:						;  xref A.0842
    1850 0808  52			 		push	dx
    1851 0809  51			 		push	cx
    1852 080A  BA 0090			 		mov	dx,90h
    1853 080D  33 C9			 		xor	cx,cx			; Zero register
    1854				
    1855 080F				locloop_93:					;  xref A.0814
    1856 080F  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    1857 0810  A8 40			 		test	al,40h			; '@'
    1858 0812  74 0B			 		jz	loc_95			; Jump if zero
    1859 0814  E2 F9			 		loop	locloop_93		; Loop if cx > 0
    1860				
    1861 0816				loc_94:						;  xref A.0828
    1862 0816  80 0E 0041 R 80		 		or	byte ptr ds:[dsk_ret_code],80h	; (A.0041=0B9h)
    1863 081B  59			 		pop	cx
    1864 081C  5A			 		pop	dx
    1865 081D  F9			 		stc				; Set carry flag
    1866 081E  C3			 		retn
    1867 081F				loc_95:						;  xref A.0812
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-35


    1868 081F  33 C9			 		xor	cx,cx			; Zero register
    1869				
    1870 0821				locloop_96:					;  xref A.0826
    1871 0821  EC			 		in	al,dx			; port 0, DMA-1 bas&add ch 0
    1872 0822  A8 80			 		test	al,80h
    1873 0824  75 04			 		jnz	loc_97			; Jump if not zero
    1874 0826  E2 F9			 		loop	locloop_96		; Loop if cx > 0
    1875				
    1876 0828  EB EC			 		jmp	short loc_94		; (0816)
    1877 082A				loc_97:						;  xref A.0824
    1878 082A  8A C4			 		mov	al,ah
    1879 082C  BA 0092			 		mov	dx,92h
    1880 082F  EE			 		out	dx,al			; port 92h ??I/O Non-standard
    1881 0830  59			 		pop	cx
    1882 0831  5A			 		pop	dx
    1883 0832  F8			 		clc				; Clear carry flag
    1884 0833  C3			 		retn
    1885 0834				sub_13		endp
    1886				
    1887				
    1888				;===============================================================================
    1889				 ;                              SUBROUTINE
    1890				 ;
    1891				 ;         Called from:   A.0630, 069D, 06A3, 06DE, 06F5, 06FB, 0701
    1892				 ;                             070E, 0771, 0779, 077F, 078C, 0884, 0979
    1893				 ;                             0ABF
    1894				;===============================================================================
    1895				; Get disk parameter table
    1896				;a.0834
    1897 0834				GetpDPB		proc	near
    1898 0834  1E			 		push	ds
    1899 0835  2B C0			 		sub	ax,ax
    1900 0837  8E D8			 		mov	ds,ax
    1901 0839  C5 36 0078		 		lds	si,dword ptr ds:Int1Ev	; (0000:0078=0CA60h) Load seg:offset p
    1902 083D  D1 EB			 		shr	bx,1			; Shift w/zeros fill
    1903 083F  8A 20			 		mov	ah,[bx+si]
    1904 0841  1F			 		pop	ds
    1905 0842  72 C4			 		jc	loc_92			; Jump if carry Set
    1906 0844  C3			 		retn
    1907 0845				GetpDPB		endp
    1908				
    1909				
    1910				;===============================================================================
    1911				 ;                              SUBROUTINE
    1912				 ;
    1913				 ;         Called from:   A.0739
    1914				;===============================================================================
    1915				;a.0845
    1916 0845				sub_15		proc	near
    1917 0845  51			 		push	cx
    1918 0846  B0 01			 		mov	al,1
    1919 0848  8A CA			 		mov	cl,dl
    1920 084A  D2 C0			 		rol	al,cl			; Rotate
    1921 084C  59			 		pop	cx
    1922 084D  84 06 003E R		 		test	al,byte ptr ds:[dsk_recal_stat]	; (A.003E=0FBh)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-36


    1923 0851  75 17			 		jnz	loc_98			; Jump if not zero
    1924 0853  08 06 003E R		 		or	byte ptr ds:[dsk_recal_stat],al	; (A.003E=0FBh)
    1925 0857  B4 07			 		mov	ah,7
    1926 0859  E8 0808 R		 		call	sub_13			; (0808)
    1927 085C  8A 66 00			 		mov	ah,[bp]
    1928 085F  E8 0808 R		 		call	sub_13			; (0808)
    1929 0862  E8 0898 R		 		call	sub_16			; (0898)
    1930 0865  72 30			 		jc	loc_ret_102		; Jump if carry Set
    1931 0867  E8 0A9E R		 		call	sub_26			; (0A9E)
    1932 086A				loc_98:						;  xref A.0851
    1933 086A  B4 0F			 		mov	ah,0Fh
    1934 086C  E8 0808 R		 		call	sub_13			; (0808)
    1935 086F  8A 66 00			 		mov	ah,[bp]
    1936 0872  E8 0808 R		 		call	sub_13			; (0808)
    1937 0875  8A E5			 		mov	ah,ch
    1938 0877  E8 0808 R		 		call	sub_13			; (0808)
    1939 087A  E8 0898 R		 		call	sub_16			; (0898)
    1940 087D  9C			 		pushf				; Push flags
    1941 087E  E8 0A9E R		 		call	sub_26			; (0A9E)
    1942 0881  BB 0012			 		mov	bx,12h
    1943 0884  E8 0834 R		 		call	GetpDPB			; (0834)
    1944 0887  51			 		push	cx
    1945 0888				loc_99:						;  xref A.0893
    1946 0888  B9 044C			 		mov	cx,44Ch
    1947 088B  0A E4			 		or	ah,ah			; Zero ?
    1948 088D  74 06			 		jz	loc_101			; Jump if zero
    1949				
    1950 088F				locloop_100:					;  xref A.088F
    1951 088F  E2 FE			 		loop	locloop_100		; Loop if cx > 0
    1952				
    1953 0891  FE CC			 		dec	ah
    1954 0893  EB F3			 		jmp	short loc_99		; (0888)
    1955 0895				loc_101:					;  xref A.088D
    1956 0895  59			 		pop	cx
    1957 0896  9D			 		popf				; Pop flags
    1958				
    1959 0897				loc_ret_102:					;  xref A.0865
    1960 0897  C3			 		retn
    1961 0898				sub_15		endp
    1962				
    1963				
    1964				;===============================================================================
    1965				 ;                              SUBROUTINE
    1966				 ;
    1967				 ;         Called from:   A.0862, 087A
    1968				;===============================================================================
    1969				;a.0898
    1970 0898				sub_16		proc	near
    1971 0898  50			 		push	ax
    1972 0899  51			 		push	cx
    1973 089A  B9 4000			 		mov	cx,4000h
    1974				
    1975 089D				locloop_103:					;  xref A.08AE, 08B3
    1976 089D  E8 08C3 R		 		call	sub_17			; (08C3)
    1977 08A0  B4 08			 		mov	ah,8
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-37


    1978 08A2  E8 0808 R		 		call	sub_13			; (0808)
    1979 08A5  E8 0A87 R		 		call	sub_25			; (0A87)
    1980 08A8  A8 20			 		test	al,20h			; ' '
    1981 08AA  75 10			 		jnz	loc_104			; Jump if not zero
    1982 08AC  3C 80			 		cmp	al,80h
    1983 08AE  E1 ED			 		loopz	locloop_103		; Loop if zf=1, cx>0
    1984				
    1985 08B0  E8 0A87 R		 		call	sub_25			; (0A87)
    1986 08B3  E2 E8			 		loop	locloop_103		; Loop if cx > 0
    1987				
    1988 08B5  E8 0A87 R		 		call	sub_25			; (0A87)
    1989 08B8  F9			 		stc				; Set carry flag
    1990 08B9  59			 		pop	cx
    1991 08BA  58			 		pop	ax
    1992 08BB  C3			 		retn
    1993 08BC				loc_104:					;  xref A.08AA
    1994 08BC  E8 0A87 R		 		call	sub_25			; (0A87)
    1995 08BF  F8			 		clc				; Clear carry flag
    1996 08C0  59			 		pop	cx
    1997 08C1  58			 		pop	ax
    1998 08C2  C3			 		retn
    1999 08C3				sub_16		endp
    2000				
    2001				
    2002				;===============================================================================
    2003				 ;                              SUBROUTINE
    2004				 ;
    2005				 ;         Called from:   A.02A3, 0342, 034A, 0380, 089D
    2006				;===============================================================================
    2007				;a.08c3
    2008 08C3				sub_17		proc	near
    2009 08C3  51			 		push	cx
    2010 08C4  B9 0100			 		mov	cx,100h
    2011				
    2012 08C7				locloop_105:					;  xref A.08C9
    2013 08C7  50			 		push	ax
    2014 08C8  58			 		pop	ax
    2015 08C9  E2 FC			 		loop	locloop_105		; Loop if cx > 0
    2016				
    2017 08CB  59			 		pop	cx
    2018 08CC  C3			 		retn
    2019 08CD				sub_17		endp
    2020				
    2021				 			                        ;* No entry point to code
    2022 08CD  50			 		push	ax
    2023 08CE  53			 		push	bx
    2024 08CF  51			 		push	cx
    2025 08D0  33 C9			 		xor	cx,cx			; Zero register
    2026 08D2  BB 0014			 		mov	bx,14h
    2027				
    2028 08D5				locloop_106:					;  xref A.08D9, 08DE
    2029 08D5  E4 90			 		in	al,90h			; port 90h ??I/O Non-standard
    2030 08D7  A8 80			 		test	al,80h
    2031 08D9  E1 FA			 		loopz	locloop_106		; Loop if zf=1, cx>0
    2032				
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-38


    2033 08DB  74 03			 		jz	loc_107			; Jump if zero
    2034 08DD  4B			 		dec	bx
    2035 08DE  75 F5			 		jnz	locloop_106		; Jump if not zero
    2036 08E0				loc_107:					;  xref A.08DB
    2037 08E0  E8 0A4C R		 		call	sub_23			; (0A4C)
    2038 08E3  59			 		pop	cx
    2039 08E4  5B			 		pop	bx
    2040 08E5  58			 		pop	ax
    2041 08E6  C3			 		retn
    2042				
    2043				;===============================================================================
    2044				 ;                              SUBROUTINE
    2045				 ;
    2046				 ;         Called from:   A.06C0, 06D3, 0719
    2047				;===============================================================================
    2048				;a.08e7
    2049 08E7				sub_18		proc	near
    2050 08E7  50			 		push	ax
    2051 08E8  53			 		push	bx
    2052 08E9  51			 		push	cx
    2053 08EA  52			 		push	dx
    2054 08EB  56			 		push	si
    2055 08EC  52			 		push	dx
    2056 08ED  8C C0			 		mov	ax,es
    2057 08EF  8B CB			 		mov	cx,bx
    2058 08F1  D1 C0			 		rol	ax,1			; Rotate
    2059 08F3  D1 C0			 		rol	ax,1			; Rotate
    2060 08F5  D1 C0			 		rol	ax,1			; Rotate
    2061 08F7  D1 C0			 		rol	ax,1			; Rotate
    2062 08F9  BB 000F			 		mov	bx,0Fh
    2063 08FC  23 D8			 		and	bx,ax
    2064 08FE  25 FFF0			 		and	ax,0FFF0h
    2065 0901  03 C1			 		add	ax,cx
    2066 0903  73 01			 		jnc	loc_108			; Jump if carry=0
    2067 0905  43			 		inc	bx
    2068				
    2069				 ; DMA1 transaction setup
    2070				 ;a.0906
    2071 0906				loc_108:					;  xref A.0903
    2072 0906  F6 06 003F R 80		 		test	byte ptr ds:dsk_motor_stat,80h	; (0040:003F=0)
    2073 090B  74 1C			 		jz	loc_109			; Jump if zero
    2074 090D  BA FFD0			 		mov	dx,DMA1+DMASP		;0FFD0h		;DMA1+DMASP
    2075 0910  EF			 		out	dx,ax			; port 0FFD0h ??I/O Non-standard
    2076 0911  BA FFD2			 		mov	dx,DMA1+DMASP1		;0FFD2h		;DMA1+DMASP1
    2077 0914  8B C3			 		mov	ax,bx
    2078 0916  EF			 		out	dx,ax			; port 0FFD2h ??I/O Non-standard
    2079 0917  33 C0			 		xor	ax,ax			; Zero register
    2080 0919  BA FFD6			 		mov	dx,DMA1+DMADP1		;0FFD6h		;DMA1+DMADP1
    2081 091C  EF			 		out	dx,ax			; port 0FFD6h ??I/O Non-standard
    2082 091D  BA FFD4			 		mov	dx,DMA1+DMADP		;0FFD4h		;DMA1+DMADP
    2083 0920  B8 00A0			 		mov	ax,0A0h
    2084 0923  EF			 		out	dx,ax			; port 0FFD4h ??I/O Non-standard
    2085 0924  BE 1786			 		mov	si,1786h
    2086 0927  EB 41			 		jmp	short loc_111		; (096A)
    2087 0929				loc_109:					;  xref A.090B
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-39


    2088 0929  F6 06 003F R 40		 		test	byte ptr ds:dsk_motor_stat,40h	; (0040:003F=0) '@'
    2089 092E  75 1C			 		jnz	loc_110		; Jump if not zero
    2090 0930  BA FFD4			 		mov	dx,DMA1+DMADP		;0FFD4h		;DMA1+DMADP
    2091 0933  EF			 		out	dx,ax			; port 0FFD4h ??I/O Non-standard
    2092 0934  BA FFD6			 		mov	dx,DMA1+DMADP1		;0FFD6h		;DMA1+DMADP1
    2093 0937  8B C3			 		mov	ax,bx
    2094 0939  EF			 		out	dx,ax			; port 0FFD6h ??I/O Non-standard
    2095 093A  33 C0			 		xor	ax,ax			; Zero register
    2096 093C  BA FFD2			 		mov	dx,DMA1+DMASP1		;0FFD2h		;DMA1+DMASP1
    2097 093F  EF			 		out	dx,ax			; port 0FFD2h ??I/O Non-standard
    2098 0940  BA FFD0			 		mov	dx,DMA1+DMASP		;0FFD0h		;DMA1+DMASP
    2099 0943  B8 00A0			 		mov	ax,0A0h
    2100 0946  EF			 		out	dx,ax			; port 0FFD0h ??I/O Non-standard
    2101 0947  BE A346			 		mov	si,0A346h
    2102 094A  EB 1E			 		jmp	short loc_111		; (096A)
    2103				;a.094c
    2104 094C				loc_110:					;  xref A.092E
    2105 094C  B8 E000			 		mov	ax,0E000h
    2106 094F  BA FFD4			 		mov	dx,DMA1+DMADP		;0FFD4h		;DMA1+DMADP
    2107 0952  EF			 		out	dx,ax			; port 0FFD4h ??I/O Non-standard
    2108 0953  BA FFD6			 		mov	dx,DMA1+DMADP1		;0FFD6h		;DMA1+DMADP1
    2109 0956  B8 000F			 		mov	ax,0Fh
    2110 0959  EF			 		out	dx,ax			; port 0FFD6h ??I/O Non-standard
    2111 095A  33 C0			 		xor	ax,ax			; Zero register
    2112 095C  BA FFD2			 		mov	dx,DMA1+DMASP1		;0FFD2h		;DMA1+DMASP1
    2113 095F  EF			 		out	dx,ax			; port 0FFD2h ??I/O Non-standard
    2114 0960  BA FFD0			 		mov	dx,DMA1+DMASP		;0FFD0h		;DMA1+DMASP
    2115 0963  B8 00A0			 		mov	ax,0A0h
    2116 0966  EF			 		out	dx,ax			; port 0FFD0h ??I/O Non-standard
    2117 0967  BE 8346			 		mov	si,8346h
    2118				;a.096a
    2119 096A				loc_111:					;  xref A.0927, 094A
    2120 096A  89 36 0067 R		 		mov	ds:gen_io_ptr,si	; (0040:0067=0)
    2121 096E  5A			 		pop	dx
    2122 096F  8A E6			 		mov	ah,dh
    2123 0971  2A C0			 		sub	al,al
    2124 0973  D1 E8			 		shr	ax,1			; Shift w/zeros fill
    2125 0975  50			 		push	ax
    2126 0976  BB 0006			 		mov	bx,6
    2127 0979  E8 0834 R		 		call	GetpDPB			; (0834)
    2128 097C  8A CC			 		mov	cl,ah
    2129 097E  58			 		pop	ax
    2130 097F  D3 E0			 		shl	ax,cl			; Shift w/zeros fill
    2131 0981  BA FFD8			 		mov	dx,DMA1+DMATC		;0FFD8h		;DMA1+DMATC
    2132 0984  EF			 		out	dx,ax			; port 0FFD8h ??I/O Non-standard
    2133 0985  F8			 		clc				; Clear carry flag
    2134 0986  5E			 		pop	si
    2135 0987  5A			 		pop	dx
    2136 0988  59			 		pop	cx
    2137 0989  5B			 		pop	bx
    2138 098A  58			 		pop	ax
    2139 098B  C3			 		retn
    2140 098C				sub_18		endp
    2141				
    2142				;a.098c
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-40


    2143				; used in setting up DMA transactions
    2144 098C				loc_112:
    2145				 			                        ;* No entry point to code
    2146 098C  E8 09BF R		 		call	sub_21			; (09BF)
    2147 098F  72 14			 		jc	loc_ret_112		; Jump if carry Set
    2148 0991  B4 08			 		mov	ah,8
    2149 0993  E8 0808 R		 		call	sub_13			; (0808)
    2150 0996  E8 0A08 R		 		call	sub_22			; (0A08)
    2151 0999  72 0A			 		jc	loc_ret_112		; Jump if carry Set
    2152 099B  A0 0042 R		 		mov	al,byte ptr ds:[nec_stat]	; (A.0042=0)
    2153 099E  24 60			 		and	al,60h			; '`'
    2154 09A0  3C 60			 		cmp	al,60h			; '`'
    2155 09A2  74 02			 		je	loc_113			; Jump if equal
    2156 09A4  F8			 		clc				; Clear carry flag
    2157				
    2158 09A5				loc_ret_112:					;  xref A.098F, 0999
    2159 09A5  C3			 		retn
    2160 09A6				loc_113:					;  xref A.09A2
    2161 09A6  80 0E 0041 R 40		 		or	byte ptr ds:[dsk_ret_code],40h	; (A.0041=0B9h) '@'
    2162 09AB  F9			 		stc				; Set carry flag
    2163 09AC  C3			 		retn
    2164				
    2165				
    2166				;===============================================================================
    2167				 ;                              SUBROUTINE
    2168				 ;
    2169				 ;         Called from:   A.0559, 06B8
    2170				;===============================================================================
    2171				;a.09ad
    2172				; PPI Control Word. Bit7=0 for bit-set-reset mode. D6-D4 is do not care.
    2173				;	D3-D1 is 3-to-8 encoded for which bit of port C. Bit 0 is 0=reset 1=set
    2174				; 	7  6  5  4  3  2  1  0
    2175				;	MD -portA-  -portBC- S/R
    2176 09AD				sub_19		proc	near
    2177 09AD  50			 		push	ax
    2178 09AE  52			 		push	dx
    2179 09AF  B0 05			 		mov	al,00000101b		;5 PC2 set LP_INIT=H
    2180 09B1  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
    2181 09B3  5A			 		pop	dx
    2182 09B4  58			 		pop	ax
    2183 09B5  C3			 		retn
    2184 09B6				sub_19		endp
    2185				
    2186				
    2187				;===============================================================================
    2188				 ;                              SUBROUTINE
    2189				 ;
    2190				 ;         Called from:   A.0731
    2191				;===============================================================================
    2192				;a.09b6
    2193				; See notes on sub_19
    2194 09B6				sub_20		proc	near
    2195 09B6  50			 		push	ax
    2196 09B7  52			 		push	dx
    2197 09B8  B0 04			 		mov	al,00000100b		;4 PC2 reset LP_INIT=L
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-41


    2198 09BA  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
    2199 09BC  5A			 		pop	dx
    2200 09BD  58			 		pop	ax
    2201 09BE  C3			 		retn
    2202 09BF				sub_20		endp
    2203				
    2204				
    2205				;===============================================================================
    2206				 ;                              SUBROUTINE
    2207				 ;
    2208				 ;         Called from:   A.078F, 098C
    2209				;===============================================================================
    2210				; Configure DMA1
    2211				;a.09ad-09bf
    2212 09BF				sub_21		proc	near
    2213 09BF  50			 		push	ax
    2214 09C0  53			 		push	bx
    2215 09C1  51			 		push	cx
    2216 09C2  52			 		push	dx
    2217 09C3  FA			 		cli				; Disable interrupts
    2218 09C4  B8 0000			 		mov	ax,0
    2219 09C7  BA FF36			 		mov	dx,ICR+D1CR		;0FF36h		;ICR+D1CR
    2220 09CA  EF			 		out	dx,ax			; port 0FF36h ??I/O Non-standard
    2221 09CB  FB			 		sti				; Enable interrupts
    2222 09CC  BA 0090			 		mov	dx,90h
    2223 09CF  B3 C0			 		mov	bl,0C0h
    2224 09D1  33 C9			 		xor	cx,cx			; Zero register
    2225				
    2226 09D3				locloop_114:					;  xref A.09DA, 09DE
    2227 09D3  F6 06 003E R 80		 		test	byte ptr ds:[dsk_recal_stat],80h	; (A.003E=0FBh)
    2228 09D8  75 1F			 		jnz	loc_115			; Jump if not zero
    2229 09DA  E2 F7			 		loop	locloop_114		; Loop if cx > 0
    2230				
    2231 09DC  FE CB			 		dec	bl
    2232 09DE  75 F3			 		jnz	locloop_114		; Jump if not zero
    2233 09E0  FA			 		cli				; Disable interrupts
    2234 09E1  E8 0A4C R		 		call	sub_23			; (0A4C)
    2235 09E4  80 0E 0041 R 80		 		or	byte ptr ds:[dsk_ret_code],80h	; (A.0041=0B9h)
    2236 09E9  80 26 003E R 7F		 		and	byte ptr ds:[dsk_recal_stat],7Fh	; (A.003E=0FBh)
    2237 09EE  B8 0008			 		mov	ax,8
    2238 09F1  BA FF36			 		mov	dx,ICR+D1CR		;0FF36h		;PCRBASE+ICR+D1CR
    2239 09F4  EF			 		out	dx,ax			; port 0FF36h ??I/O Non-standard
    2240 09F5  FB			 		sti				; Enable interrupts
    2241 09F6  F9			 		stc				; Set carry flag
    2242 09F7  EB 09			 		jmp	short loc_116		; (0A02)
    2243 09F9				loc_115:					;  xref A.09D8
    2244 09F9  FA			 		cli				; Disable interrupts
    2245 09FA  B8 0008			 		mov	ax,8
    2246 09FD  BA FF36			 		mov	dx,ICR+D1CR		;0FF36h		;PCRBASE+ICR+D1CR
    2247 0A00  EF			 		out	dx,ax			; port 0FF36h ??I/O Non-standard
    2248 0A01  F8			 		clc				; Clear carry flag
    2249 0A02				loc_116:					;  xref A.09F7
    2250 0A02  FB			 		sti				; Enable interrupts
    2251 0A03  5A			 		pop	dx
    2252 0A04  59			 		pop	cx
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-42


    2253 0A05  5B			 		pop	bx
    2254 0A06  58			 		pop	ax
    2255 0A07  C3			 		retn
    2256 0A08				sub_21		endp
    2257				
    2258				
    2259				;===============================================================================
    2260				 ;                              SUBROUTINE
    2261				 ;
    2262				 ;         Called from:   A.0794, 07DC, 0996
    2263				;===============================================================================
    2264				; Port 90h is the base address of the floppy
    2265				;a.0a08
    2266 0A08				sub_22		proc	near
    2267 0A08  FC			 		cld				; Clear direction
    2268 0A09  BF 0042			 		mov	di,42h			; (A.0042=0)
    2269 0A0C  51			 		push	cx
    2270 0A0D  52			 		push	dx
    2271 0A0E  53			 		push	bx
    2272 0A0F  B3 07			 		mov	bl,7
    2273 0A11				loc_117:					;  xref A.0A44
    2274 0A11  33 C9			 		xor	cx,cx			; Zero register
    2275 0A13  BA 0090			 		mov	dx,90h
    2276				
    2277 0A16				locloop_118:					;  xref A.0A1B
    2278 0A16  EC			 		in	al,dx			; port 90h FDCBASE
    2279 0A17  A8 80			 		test	al,80h
    2280 0A19  75 07			 		jnz	loc_120			; Jump if not zero
    2281 0A1B  E2 F9			 		loop	locloop_118		; Loop if cx > 0
    2282				
    2283 0A1D				loc_119:					;  xref A.0A2C
    2284 0A1D  F9			 		stc				; Set carry flag
    2285 0A1E  5B			 		pop	bx
    2286 0A1F  5A			 		pop	dx
    2287 0A20  59			 		pop	cx
    2288 0A21  C3			 		retn
    2289 0A22				loc_120:					;  xref A.0A19
    2290 0A22  EC			 		in	al,dx			; port 0FFDAh ??I/O Non-standard
    2291 0A23  A8 40			 		test	al,40h			; '@'
    2292 0A25  75 07			 		jnz	loc_122			; Jump if not zero
    2293 0A27				loc_121:					;  xref A.0A46
    2294 0A27  80 0E 0041 R 20		 		or	byte ptr ds:[dsk_ret_code],20h	; (A.0041=0B9h) ' '
    2295 0A2C  EB EF			 		jmp	short loc_119		; (0A1D)
    2296 0A2E				loc_122:					;  xref A.0A25
    2297 0A2E  BA 0092			 		mov	dx,92h
    2298 0A31  EC			 		in	al,dx			; port 92h ??I/O Non-standard
    2299 0A32  88 05			 		mov	[di],al
    2300 0A34  47			 		inc	di
    2301 0A35  B9 0028			 		mov	cx,28h
    2302				
    2303				;a.0a38
    2304 0A38				locloop_123:					;  xref A.0A38
    2305 0A38  E2 FE			 		loop	locloop_123		; Loop if cx > 0
    2306				
    2307 0A3A  BA 0090			 		mov	dx,90h
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-43


    2308 0A3D  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    2309 0A3E  A8 10			 		test	al,10h
    2310 0A40  74 06			 		jz	loc_124			; Jump if zero
    2311 0A42  FE CB			 		dec	bl
    2312 0A44  75 CB			 		jnz	loc_117			; Jump if not zero
    2313 0A46  EB DF			 		jmp	short loc_121		; (0A27)
    2314 0A48				loc_124:					;  xref A.0A40
    2315 0A48  5B			 		pop	bx
    2316 0A49  5A			 		pop	dx
    2317 0A4A  59			 		pop	cx
    2318 0A4B  C3			 		retn
    2319 0A4C				sub_22		endp
    2320				
    2321				
    2322				;===============================================================================
    2323				 ;                              SUBROUTINE
    2324				 ;
    2325				 ;         Called from:   A.068F, 07D9, 07EE, 08E0, 09E1
    2326				;===============================================================================
    2327				; bit set/reset on PPI port C PC7 goes to floppy write clock circuit
    2328				;a.0a4c
    2329 0A4C				sub_23		proc	near
    2330 0A4C  50			 		push	ax
    2331 0A4D  B0 0D			 		mov	al,00001101b		;0Dh PC7 set
    2332 0A4F  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
    2333 0A51  50			 		push	ax
    2334 0A52  58			 		pop	ax
    2335 0A53  B0 0C			 		mov	al,0Ch
    2336 0A55  E6 D6			 		out	PPI_CR,al			; port 0D6h PPI_CR
    2337 0A57  58			 		pop	ax
    2338 0A58  C3			 		retn
    2339 0A59				sub_23		endp
    2340				
    2341				
    2342				;===============================================================================
    2343				 ;                              SUBROUTINE
    2344				 ;
    2345				 ;         Called from:   A.0734
    2346				;===============================================================================
    2347				;a.0a59
    2348 0A59				sub_24		proc	near
    2349 0A59  50			 		push	ax
    2350 0A5A  53			 		push	bx
    2351 0A5B  51			 		push	cx
    2352 0A5C  52			 		push	dx
    2353 0A5D  B3 04			 		mov	bl,4
    2354 0A5F  33 C9			 		xor	cx,cx			; Zero register
    2355				
    2356 0A61				locloop_125:					;  xref A.0A73, 0A77
    2357 0A61  B4 04			 		mov	ah,4
    2358 0A63  E8 0808 R		 		call	sub_13			; (0808)
    2359 0A66  8A 66 00			 		mov	ah,[bp]
    2360 0A69  E8 0808 R		 		call	sub_13			; (0808)
    2361 0A6C  E8 0A87 R		 		call	sub_25			; (0A87)
    2362 0A6F  A8 20			 		test	al,20h			; ' '
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-44


    2363 0A71  75 0E			 		jnz	loc_126			; Jump if not zero
    2364 0A73  E2 EC			 		loop	locloop_125		; Loop if cx > 0
    2365				
    2366 0A75  FE CB			 		dec	bl
    2367 0A77  75 E8			 		jnz	locloop_125		; Jump if not zero
    2368 0A79  80 0E 0041 R 80		 		or	byte ptr ds:[dsk_ret_code],80h	; (A.0041=0B9h)
    2369 0A7E  F9			 		stc				; Set carry flag
    2370 0A7F  EB 01			 		jmp	short loc_127		; (0A82)
    2371 0A81				loc_126:					;  xref A.0A71
    2372 0A81  F8			 		clc				; Clear carry flag
    2373 0A82				loc_127:					;  xref A.0A7F
    2374 0A82  5A			 		pop	dx
    2375 0A83  59			 		pop	cx
    2376 0A84  5B			 		pop	bx
    2377 0A85  58			 		pop	ax
    2378 0A86  C3			 		retn
    2379 0A87				sub_24		endp
    2380				
    2381				
    2382				;===============================================================================
    2383				 ;                              SUBROUTINE
    2384				 ;
    2385				 ;         Called from:   A.08A5, 08B0, 08B5, 08BC, 0A6C, 0AA4, 0AAB
    2386				;===============================================================================
    2387				;a.0a87
    2388 0A87				sub_25		proc	near
    2389 0A87  52			 		push	dx
    2390 0A88  BA 0090			 		mov	dx,90h
    2391 0A8B				loc_128:					;  xref A.0A8E
    2392 0A8B  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    2393 0A8C  A8 80			 		test	al,80h
    2394 0A8E  74 FB			 		jz	loc_128			; Jump if zero
    2395 0A90  A8 40			 		test	al,40h			; '@'
    2396 0A92  74 07			 		jz	loc_129			; Jump if zero
    2397 0A94  BA 0092			 		mov	dx,92h
    2398 0A97  EC			 		in	al,dx			; port 92h ??I/O Non-standard
    2399 0A98  5A			 		pop	dx
    2400 0A99  F8			 		clc				; Clear carry flag
    2401 0A9A  C3			 		retn
    2402 0A9B				loc_129:					;  xref A.0A92
    2403 0A9B  5A			 		pop	dx
    2404 0A9C  F9			 		stc				; Set carry flag
    2405 0A9D  C3			 		retn
    2406 0A9E				sub_25		endp
    2407				
    2408				
    2409				;===============================================================================
    2410				 ;                              SUBROUTINE
    2411				 ;
    2412				 ;         Called from:   A.0692, 06B5, 0728, 0741, 07DF, 0867, 087E
    2413				;===============================================================================
    2414				;a.0a9e
    2415 0A9E				sub_26		proc	near
    2416 0A9E  50			 		push	ax
    2417 0A9F				loc_130:					;  xref A.0AAE
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-45


    2418 0A9F  B4 08			 		mov	ah,8
    2419 0AA1  E8 0808 R		 		call	sub_13			; (0808)
    2420 0AA4  E8 0A87 R		 		call	sub_25			; (0A87)
    2421 0AA7  3C 80			 		cmp	al,80h
    2422 0AA9  74 05			 		je	loc_131			; Jump if equal
    2423 0AAB  E8 0A87 R		 		call	sub_25			; (0A87)
    2424 0AAE  EB EF			 		jmp	short loc_130		; (0A9F)
    2425 0AB0				loc_131:					;  xref A.0AA9
    2426 0AB0  58			 		pop	ax
    2427 0AB1  C3			 		retn
    2428 0AB2				sub_26		endp
    2429				
    2430				
    2431				;===============================================================================
    2432				 ;                              SUBROUTINE
    2433				 ;
    2434				 ;         Called from:   A.07D5, 07E3
    2435				;===============================================================================
    2436				;a.0ab2
    2437 0AB2				sub_27		proc	near
    2438 0AB2  A0 0045 R		 		mov	al,byte ptr ds:[nec_stat+3]	; (A.0045=0AFh) part of NEC status b
					ytes
    2439 0AB5  3A C5			 		cmp	al,ch
    2440 0AB7  A0 0047 R		 		mov	al,byte ptr ds:[nec_stat+5]	; (A.0047=6)
    2441 0ABA  74 0A			 		jz	loc_132			; Jump if zero
    2442 0ABC  BB 0008			 		mov	bx,8
    2443 0ABF  E8 0834 R		 		call	GetpDPB			; (0834)
    2444 0AC2  8A C4			 		mov	al,ah
    2445 0AC4  FE C0			 		inc	al
    2446 0AC6				loc_132:					;  xref A.0ABA
    2447 0AC6  2A C1			 		sub	al,cl
    2448 0AC8  C3			 		retn
    2449 0AC9				sub_27		endp
    2450				
    2451				
    2452				;===============================================================================
    2453				;a.0ac9
    2454				; INT 1E - Diskette parameter table
    2455 0AC9				INT_1E:
    2456 0AC9  DF				db      11011111b	; specify byte 1: step rate (ms), head unload time (ms)
    2457								; 7:4 step 0E = 4ms
    2458								; 3:0 HUT  0F = 240ms
    2459 0ACA  02				db      2		; specify byte 2: head load time, non-DMA mode
    2460								; 7:1 HLT 01=4ms
    2461								; 0: non-DMA mode (always 0)
    2462 0ACB  80				db      80h		; motor turn-off delay (ticks)
    2463 0ACC  02				db      2		; bytes per sector (2=512)
    2464 0ACD  08				db      8		; sectors per track
    2465 0ACE  2A				db      2Ah		; gap length (2A=5.25"; 1B=3.5")
    2466 0ACF  FF				db      0FFh		; data length (ignored if BPS !=0)
    2467 0AD0  50				db      50h		; gap length (50=5.25"; 6C=3.5")
    2468 0AD1  F6				db      0F6h		; format fill byte
    2469 0AD2  19				db      19h		; head settle time (ms)
    2470 0AD3  04				db      4		; motor start time (in 1/8 seconds)
    2471				
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-46


    2472				
    2473				;===============================================================================
    2474				 ;                              SUBROUTINE
    2475				 ;
    2476				 ;         Called from:   A.00A7
    2477				;===============================================================================
    2478				; grab keyboard vectors
    2479				;a.0ad4
    2480 0AD4				InitKeyboard	proc	near
    2481 0AD4  1E			 		push	ds
    2482 0AD5  9C			 		pushf				; Push flags
    2483 0AD6  FA			 		cli				; Disable interrupts
    2484 0AD7  33 C0			 		xor	ax,ax			; Zero register
    2485 0AD9  8E D8			 		mov	ds,ax
    2486 0ADB  B8 0B27 R		 		mov	ax,offset INT16HANDLER	;0B27h
    2487 0ADE  A3 0058			 		mov	ds:Int16v,ax		; (0000:0058=0CFC0h)
    2488 0AE1  8C 0E 005A		 		mov	ds:Int16v+2,cs		; (0000:005A=0F000h)
    2489 0AE5  B8 0CE4 R		 		mov	ax,offset INT0DHANDLER	;0CE4h
    2490 0AE8  A3 0034			 		mov	ds:Int0Dv,ax		; (0000:0034=3ADBh)
    2491 0AEB  8C 0E 0036		 		mov	ds:Int0Dv+2,cs		; (0000:0036=17B0h)
    2492 0AEF  B8 0CF2 R		 		mov	ax,offset INT09HANDLER	;0CF2h
    2493 0AF2  A3 0024			 		mov	ds:Int09v,ax		; (0000:0024=0E987h)
    2494 0AF5  8C 0E 0026		 		mov	ds:Int09v+2,cs		; (0000:0026=0F000h)
    2495				
    2496 0AF9  B8 0040			 		mov	ax,40h
    2497 0AFC  8E D8			 		mov	ds,ax
    2498 0AFE  B8 001E			 		mov	ax,1Eh			; keyboard queue
    2499 0B01  A3 001A R		 		mov	ds:keybd_q_head,ax	; (0040:001A=30h)
    2500 0B04  A3 001C R		 		mov	ds:keybd_q_tail,ax	; (0040:001C=30h)
    2501				
    2502 0B07  33 C0			 		xor	ax,ax			; Zero register
    2503 0B09  A2 0017 R		 		mov	ds:keybd_flags_1,al	; (0040:0017=0)
    2504 0B0C  A2 0018 R		 		mov	ds:keybd_flags_2,al	; (0040:0018=0)
    2505 0B0F  A2 0019 R		 		mov	ds:keybd_alt_num,al	; (0040:0019=0)
    2506				
    2507 0B12  BA FF3A			 		mov	dx,ICR+INT1CR		;0FF3Ah		;ICR+INT1CR
    2508 0B15  B8 0001			 		mov	ax,1
    2509 0B18  EF			 		out	dx,ax			; port 0FF3Ah ??I/O Non-standard
    2510 0B19  B0 98			 		mov	al,98h
    2511 0B1B  E6 63			 		out	C58255CMD,al		; port 63h, 8255 mode reg
    2512 0B1D  B0 C0			 		mov	al,0C0h
    2513 0B1F  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    2514 0B21  E8 0B6E R		 		call	InitKbdCtrlr		; (0B6E)	reset kbd
    2515 0B24  9D			 		popf				; Pop flags
    2516 0B25  1F			 		pop	ds
    2517 0B26  C3			 		retn
    2518 0B27				InitKeyboard	endp
    2519				
    2520				
    2521				;===============================================================================
    2522				;a.0b27
    2523				; INT 16 - Keyboard Services
    2524 0B27				INT16HANDLER:
    2525 0B27  FB			 		sti				; Enable interrupts
    2526 0B28  1E			 		push	ds
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-47


    2527 0B29  53			 		push	bx
    2528 0B2A  BB 0040			 		mov	bx,40h
    2529 0B2D  8E DB			 		mov	ds,bx
    2530				
    2531				; dispatcher
    2532				; AH=0 read char AH=1 check AH=2 shift
    2533 0B2F  0A E4			 		or	ah,ah			; Zero - read character
    2534 0B31  74 0B			 		jz	cmdKbdChrIn	
    2535				
    2536 0B33  FE CC			 		dec	ah			; check for character
    2537 0B35  74 20			 		jz	cmdKbdChk	
    2538				
    2539 0B37  FE CC			 		dec	ah			; shift state
    2540 0B39  74 2D			 		jz	cmdKbdShift	
    2541				
    2542 0B3B  5B			 		pop	bx
    2543 0B3C  1F			 		pop	ds
    2544 0B3D  CF			 		iret				; Interrupt return
    2545				
    2546				; read character
    2547 0B3E				cmdKbdChrIn:					;  xref A.0B31, 0B49
    2548 0B3E  FB			 		sti				; Enable interrupts
    2549 0B3F  90			 		nop
    2550 0B40  FA			 		cli				; Disable interrupts
    2551 0B41  8B 1E 001A R		 		mov	bx,word ptr ds:[keybd_q_head]	; (A.001A=3538h)
    2552 0B45  3B 1E 001C R		 		cmp	bx,word ptr ds:[keybd_q_tail]	; (A.001C=0D0Ah)
    2553 0B49  74 F3			 		je	cmdKbdChrIn	
    2554 0B4B  8B 07			 		mov	ax,[bx]
    2555 0B4D  E8 0BD3 R		 		call	sub_30			; (0BD3)
    2556 0B50  89 1E 001A R		 		mov	word ptr ds:[keybd_q_head],bx	; (A.001A=3538h)
    2557 0B54  5B			 		pop	bx
    2558 0B55  1F			 		pop	ds
    2559 0B56  CF			 		iret				; Interrupt return
    2560				
    2561				; check for available char
    2562 0B57				cmdKbdChk:					;  xref A.0B35
    2563 0B57  FA			 		cli				; Disable interrupts
    2564 0B58  8B 1E 001A R		 		mov	bx,word ptr ds:[keybd_q_head]	; (A.001A=3538h)
    2565 0B5C  3B 1E 001C R		 		cmp	bx,word ptr ds:[keybd_q_tail]	; (A.001C=0D0Ah)
    2566 0B60  8B 07			 		mov	ax,[bx]
    2567 0B62  FB			 		sti				; Enable interrupts
    2568 0B63  5B			 		pop	bx
    2569 0B64  1F			 		pop	ds
    2570 0B65  CA 0002			 		retf	2			; Return far
    2571				
    2572				; get shift state
    2573 0B68				cmdKbdShift:					;  xref A.0B39
    2574 0B68  A0 0017 R		 		mov	al,byte ptr ds:[keybd_flags_1]	; (A.0017=32h)
    2575 0B6B  5B			 		pop	bx
    2576 0B6C  1F			 		pop	ds
    2577 0B6D  CF			 		iret				; Interrupt return
    2578				
    2579				
    2580				;===============================================================================
    2581				 ;                              SUBROUTINE
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-48


    2582				 ;
    2583				 ;         Called from:   A.0B21
    2584				;===============================================================================
    2585				;a.0b6e
    2586				; Looks like this initialzies the keyboard controller in the keyboard itself.
    2587 0B6E				InitKbdCtrlr		proc	near
    2588 0B6E  FA			 		cli				; Disable interrupts
    2589 0B6F  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2590 0B71  24 3F			 		and	al,3Fh			; '?'
    2591 0B73  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2592				 						;  al = 0, speaker off
    2593 0B75  B9 A558			 		mov	cx,0A558h
    2594				
    2595 0B78				locloop_137:					;  xref A.0B78
    2596 0B78  E2 FE			 		loop	locloop_137		; Loop if cx > 0
    2597				
    2598 0B7A  E4 61			 		in	al,C58255PB		; port 61h, 8255 port B, read
    2599 0B7C  0C C0			 		or	al,0C0h
    2600 0B7E  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    2601 0B80  24 3F			 		and	al,3Fh			; '?'
    2602 0B82  0C 40			 		or	al,40h			; '@'
    2603 0B84  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    2604 0B86  33 C9			 		xor	cx,cx			; Zero register
    2605 0B88  FA			 		cli				; Disable interrupts
    2606				
    2607 0B89				locloop_138:					;  xref A.0B8D
    2608 0B89  E4 62			 		in	al,62h			; port 62h, 8255 C - sw2, etc.
    2609 0B8B  A8 10			 		test	al,10h
    2610 0B8D  E1 FA			 		loopz	locloop_138		; Loop if zf=1, cx>0
    2611				
    2612 0B8F  E3 15			 		jcxz	loc_139			; Jump if cx=0
    2613 0B91  E4 60			 		in	al,60h			; port 60h, keybd scan or sw1
    2614 0B93  50			 		push	ax
    2615 0B94  E4 61			 		in	al,C58255PB		; port 61h, 8255 port B, read
    2616 0B96  8A E0			 		mov	ah,al
    2617 0B98  0C 80			 		or	al,80h
    2618 0B9A  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    2619 0B9C  8A C4			 		mov	al,ah
    2620 0B9E  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    2621 0BA0  58			 		pop	ax
    2622 0BA1  3C AA			 		cmp	al,0AAh
    2623 0BA3  75 01			 		jne	loc_139			; Jump if not equal
    2624 0BA5  C3			 		retn
    2625 0BA6				loc_139:					;  xref A.0B8F, 0BA3
    2626 0BA6  BE 0BBA R		 		mov	si,offset msg5		; (A.0BBA='Keyboard reset f')
    2627 0BA9  E8 05E5 R		 		call	prtzstr			; (05E5)
    2628 0BAC  E4 61			 		in	al,C58255PB		; port 61h, 8255 port B, read
    2629 0BAE  8A E0			 		mov	ah,al
    2630 0BB0  0C 80			 		or	al,80h
    2631 0BB2  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    2632 0BB4  8A C4			 		mov	al,ah
    2633 0BB6  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    2634 0BB8  F9			 		stc				; Set carry flag
    2635 0BB9  C3			 		retn
    2636 0BBA				InitKbdCtrlr		endp
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-49


    2637				
    2638 0BBA  4B 65 79 62 6F 61	msg5:		db	'Keyboard reset failure', 0Ah, 0Dh,0
    2639       72 64 20 72 65 73	
    2640       65 74 20 66 61 69	
    2641       6C 75 72 65 0A 0D	
    2642       00			
    2643				
    2644				
    2645				;===============================================================================
    2646				 ;                              SUBROUTINE
    2647				 ;
    2648				 ;         Called from:   A.0B4D, 0F6A
    2649				;===============================================================================
    2650				;a.0bd3
    2651 0BD3				sub_30		proc	near
    2652 0BD3  83 C3 02			 		add	bx,2
    2653 0BD6  81 FB 003E		 		cmp	bx,word ptr 3Eh		; 81 fb 3e 00
    2654 0BDA  75 03			 		jne	loc_ret_140		; Jump if not equal
    2655 0BDC  BB 001E			 		mov	bx,1Eh
    2656				
    2657 0BDF				loc_ret_140:					;  xref A.0BDA
    2658 0BDF  C3			 		retn
    2659 0BE0				sub_30		endp
    2660				
    2661				
    2662				;a.0be0 - could be scan codes for modifier keys. Note lack of DEL key
    2663				; modifier.
    2664				; xref A.0D20
    2665				;K6
    2666 0BE0				data_84:	;db	52h, 3Ah, 45h, 46h
    2667 0BE0  52 3A 45 46				db	INS_KEY, CAPS_KEY, NUM_KEY, SCROLL_KEY
    2668				;		db	38h, 1Dh, 2Ah, 36h
    2669 0BE4  38 1D 2A 36				db	ALT_KEY, CTL_KEY, LEFT_KEY, RIGHT_KEY
    2670				
    2671				; Shift mask table
    2672				;a.0be9
    2673				;K7
    2674 0BE8				data_85:	;db	80h, 40h, 20h, 10h		;  xref A.0D33
    2675 0BE8  80 40 20 10				db	INS_SHIFT, CAPS_SHIFT, NUM_SHIFT, SCROLL_SHIFT
    2676				;     		db	08h, 04h, 02h, 01h	
    2677 0BEC  08 04 02 01				db	ALT_SHIFT ,CTL_SHIFT, LEFT_SHIFT, RIGHT_SHIFT
    2678					
    2679				; Scan Code Tables
    2680				;a.0bf0
    2681				;K8
    2682 0BF0  1B FF 00 FF FF				db	1Bh,0FFh, 00h,0FFh,0FFh
    2683 0BF5  FF 1E FF FF FF FF	     		db	0FFh, 1Eh,0FFh,0FFh,0FFh,0FFh
    2684 0BFB  1F FF 7F FF 11 17	     		db	1Fh,0FFh, 7Fh,0FFh, 11h, 17h
    2685 0C01  05 12 14 19 15 09	     		db	05h, 12h, 14h, 19h, 15h, 09h
    2686 0C07  0F 10 1B 1D 0A FF	     		db	0Fh, 10h, 1Bh, 1Dh, 0Ah,0FFh
    2687 0C0D  01 13 04 06 07 08	     		db	01h, 13h, 04h, 06h, 07h, 08h
    2688 0C13  0A 0B 0C FF FF FF	     		db	0Ah, 0Bh, 0Ch,0FFh,0FFh,0FFh
    2689 0C19  FF 1C 1A 18 03 16	     		db	0FFh, 1Ch, 1Ah, 18h, 03h, 16h
    2690 0C1F  02 0E 0D FF FF FF	     		db	02h, 0Eh, 0Dh,0FFh,0FFh,0FFh
    2691 0C25  FF FF FF 20 FF		 		db	0FFh,0FFh,0FFh, 20h,0FFh
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-50


    2692				
    2693				; Control Table Scan
    2694				;a.0c2a
    2695				;K9		
    2696 0C2A  5E 5F 60 61 62 63	     		db	'^_`abcdefg'
    2697       64 65 66 67		
    2698 0C34  FF FF 77 FF 84 FF	     		db	0FFh,0FFh, 77h,0FFh, 84h,0FFh
    2699 0C3A  73 FF 74 FF 75 FF	     		db	 73h,0FFh, 74h,0FFh, 75h,0FFh
    2700 0C40  76 FF FF			 		db	 76h,0FFh,0FFh
    2701				
    2702				; LC Table
    2703				;a.0c43
    2704				;K10
    2705 0C43  1B 31 32 33 34 35	data_86:	db	1Bh, '1234567890-=', 8, 9, 'qwert'	;  xref A.0F2D
    2706       36 37 38 39 30 2D	
    2707       3D 08 09 71 77 65	
    2708       72 74			
    2709 0C57  79 75 69 6F 70 5B	     		db	'yuiop[]', 0Dh, 0FFh
    2710       5D 0D FF			
    2711 0C60  61 73 64 66 67 68	     		db	'asdfghjkl',3bh,27h,60h, 0FFh
    2712       6A 6B 6C 3B 27 60	
    2713       FF			
    2714 0C6D  5C 7A 78 63 76 62	     		db	'\zxcvbnm,./'
    2715       6E 6D 2C 2E 2F		
    2716 0C78  FF 2A FF 20 FF		 		db	0FFh, 2Ah,0FFh, 20h,0FFh
    2717				
    2718				; UC Table
    2719				;a.0c7d
    2720				;K11
    2721 0C7D  1B 21 40 23 24		 		db	1Bh, '!@#$'
    2722 0C82  25 5E 26 2A 28 29	     		db	'%^&*()_+', 8, 0
    2723       5F 2B 08 00		
    2724 0C8C  51 57 45 52 54 59	     		db	'QWERTYUIOP{}', 0Dh, 0FFh
    2725       55 49 4F 50 7B 7D	
    2726       0D FF			
    2727 0C9A  41 53 44 46 47 48	     		db	'ASDFGHJKL:"~', 0FFh
    2728       4A 4B 4C 3A 22 7E	
    2729       FF			
    2730 0CA7  7C 5A 58 43 56 42	     		db	'|ZXCVBNM<>?'
    2731       4E 4D 3C 3E 3F		
    2732 0CB2  FF 00 FF 20 FF		     		db	0FFh, 00h,0FFh, 20h,0FFh
    2733				
    2734				; UC Table Scan
    2735				;a.0cb7
    2736				;K12
    2737				;		db	54h, 55h, 'VWXYZ[\]'
    2738 0CB7  54 55 56 57 58 59			db	84,85,86,87,88,89,90
    2739       5A			
    2740 0CBE  5B 5C 5D					db	91,92,93
    2741				
    2742				; Alt Table Scan
    2743				;K13
    2744				;a.0cc1
    2745				;		db	'hiklmnopq'		; note that "j" is missing in the table
    2746 0CC1  68 69 6B 6C				db	104,105,107,108
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-51


    2747 0CC5  6D 6E 6F 70 71				db	109,110,111,112,113
    2748				
    2749				; Num State Table
    2750				;a.0cca
    2751				;K14
    2752 0CCA  37 38 39 2D 34 35			db	'789-456+1230.'
    2753       36 2B 31 32 33 30	
    2754       2E			
    2755				
    2756				;a.0cd7
    2757				;K15
    2758				;		db	'GHI', 0FFh, 4Bh,0FFh, 4Dh,0FFh, 4Fh
    2759				;		db	50h, 51h, 52h, 53h 
    2760 0CD7  47 48 49 FF 4B FF			db	71,72,73,-1,75,-1,77
    2761       4D			
    2762 0CDE  FF 4F 50 51 52 53			db	-1,79,80,81,82,83
    2763				 
    2764				;===============================================================================
    2765				;a.0ce4
    2766				; INT 0D - 80186 INT1 Handler
    2767 0CE4				INT0DHANDLER:
    2768				; 	db	 50h, 52h
    2769				;    	db	0B8h, 00h, 80h,0BAh, 22h,0FFh
    2770				;     	db	0EFh, 5Ah, 58h,0CDh, 09h,0CFh
    2771 0CE4  50			 		push	ax
    2772 0CE5  52			 		push	dx
    2773 0CE6  B8 8000			 		mov	ax,8000h		; do EOI
    2774 0CE9  BA FF22			 		mov	dx,ICR+EOIREG		;0FF22h		;ICR+EOIREG
    2775 0CEC  EF			 		out	dx,ax
    2776 0CED  5A			 		pop	dx
    2777 0CEE  58			 		pop	ax
    2778 0CEF  CD 09			 		int	09
    2779 0CF1  CF			 		iret
    2780				
    2781				
    2782				;===============================================================================
    2783				;a.0cf2
    2784				; INT 09 - Reserved
    2785 0CF2				INT09HANDLER:
    2786				;     	db	 50h, 53h, 51h, 52h, 56h, 57h
    2787				;     	db	 1Eh, 06h,0FCh,0B8h, 40h, 00h
    2788				;     	db	 8Eh,0D8h,0E4h, 60h,0A2h, 7Bh
    2789				;     	db	 00h, 50h,0E4h, 61h, 8Ah,0E0h
    2790				;     	db	 0Ch, 80h,0E6h, 61h, 86h,0E0h
    2791				;     	db	0E6h, 61h, 58h, 8Ah,0E0h, 3Ch
    2792				;     	db	0FFh, 75h, 03h,0E9h, 60h, 02h
    2793					;	sti
    2794 0CF2  50			 		push	ax
    2795 0CF3  53			 		push	bx
    2796 0CF4  51			 		push	cx
    2797 0CF5  52			 		push	dx
    2798 0CF6  56			 		push	si
    2799 0CF7  57			 		push	di
    2800 0CF8  1E			 		push	ds
    2801 0CF9  06			 		push	es
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-52


    2802 0CFA  FC			 		cld
    2803 0CFB  B8 0040			 		mov	ax,40h
    2804 0CFE  8E D8			 		mov	ds,ax
    2805 0D00  E4 60			 		in	al,60h 
    2806 0D02  A2 007B R		 		mov	ds:[lptto+3],al		;7b
    2807 0D05  50			 		push	ax
    2808 0D06  E4 61			 		in	al,61h 
    2809 0D08  8A E0			 		mov	ah,al
    2810 0D0A  0C 80			 		or	al,80h 
    2811 0D0C  E6 61			 		out	61h,al
    2812 0D0E  86 E0			 		xchg	ah,al
    2813 0D10  E6 61			 		out	61h,al
    2814 0D12  58			 		pop	ax
    2815 0D13  8A E0			 		mov	ah,al
    2816 0D15  3C FF			 		cmp	al,0FFh
    2817 0D17  75 03			 		jnz	loc_141
    2818 0D19  E9 0F7C R		 		jmp	loc_186			;0F7C
    2819				;a.0d1c
    2820 0D1C				loc_141:
    2821 0D1C  24 7F			 		and	al,7Fh
    2822 0D1E  0E			 		push	cs
    2823 0D1F  07			 		pop	es
    2824 0D20  BF 0BE0 R		 		mov	di,offset data_84	; (A.0BE0=52h)
    2825 0D23  B9 0008			 		mov	cx,8
    2826 0D26  F2/ AE			 		repne	scasb			; Rep zf=0+cx >0 Scan es:[di] for al
    2827 0D28  8A C4			 		mov	al,ah
    2828 0D2A  74 03			 		jz	loc_142			; Jump if zero
    2829 0D2C  E9 0DB7 R		 		jmp	loc_151			; (0DB7)
    2830 0D2F				loc_142:					;  xref A.0D2A
    2831 0D2F  81 EF 0BE1		 		sub	di,0BE1h
    2832 0D33  2E: 8A A5 0BE8 R		 		mov	ah,byte ptr cs:data_85[di]	; (A.0BE8=80h)
    2833 0D38  A8 80			 		test	al,80h
    2834 0D3A  75 54			 		jnz	loc_149			; Jump if not zero
    2835 0D3C  80 FC 10			 		cmp	ah,10h
    2836 0D3F  73 07			 		jae	loc_144			; Jump if above or =
    2837 0D41  08 26 0017 R		 		or	byte ptr ds:[keybd_flags_1],ah	; (A.0017=32h)
    2838 0D45  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    2839 0D48				loc_144:					;  xref A.0D3F
    2840 0D48  F6 06 0017 R 04		 		test	byte ptr ds:[keybd_flags_1],4	; (A.0017=32h)
    2841 0D4D  75 68			 		jnz	loc_151			; Jump if not zero
    2842 0D4F  3C 52			 		cmp	al,52h			; 'R'
    2843 0D51  75 25			 		jne	loc_148			; Jump if not equal
    2844 0D53  F6 06 0017 R 08		 		test	byte ptr ds:[keybd_flags_1],8	; (A.0017=32h)
    2845 0D58  74 03			 		jz	loc_145			; Jump if zero
    2846 0D5A  EB 5B			 		jmp	short loc_151		; (0DB7)
    2847 0D5C  90			 		db	90h
    2848				;a.0d5d
    2849 0D5D				loc_145:					;  xref A.0D58
    2850 0D5D  F6 06 0017 R 20		 		test	byte ptr ds:[keybd_flags_1],20h	; (A.0017=32h) ' '
    2851 0D62  75 0D			 		jnz	loc_147			; Jump if not zero
    2852 0D64  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    2853 0D69  74 0D			 		jz	loc_148			; Jump if zero
    2854 0D6B				loc_146:					;  xref A.0D76
    2855 0D6B  B8 5230			 		mov	ax,5230h
    2856 0D6E  E9 0F34 R		 		jmp	loc_181			; (0F34)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-53


    2857 0D71				loc_147:					;  xref A.0D62
    2858 0D71  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    2859 0D76  74 F3			 		jz	loc_146			; Jump if zero
    2860 0D78				loc_148:					;  xref A.0D51, 0D69
    2861 0D78  84 26 0018 R		 		test	ah,byte ptr ds:[keybd_flags_2]	; (A.0018=31h)
    2862 0D7C  75 4D			 		jnz	loc_152			; Jump if not zero
    2863 0D7E  08 26 0018 R		 		or	byte ptr ds:[keybd_flags_2],ah	; (A.0018=31h)
    2864 0D82  30 26 0017 R		 		xor	byte ptr ds:[keybd_flags_1],ah	; (A.0017=32h)
    2865 0D86  3C 52			 		cmp	al,52h			; 'R'
    2866 0D88  75 41			 		jne	loc_152			; Jump if not equal
    2867 0D8A  B8 5200			 		mov	ax,5200h
    2868 0D8D  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2869 0D90				loc_149:					;  xref A.0D3A
    2870 0D90  80 FC 10			 		cmp	ah,10h
    2871 0D93  73 1A			 		jae	loc_150			; Jump if above or =
    2872 0D95  F6 D4			 		not	ah
    2873 0D97  20 26 0017 R		 		and	byte ptr ds:[keybd_flags_1],ah	; (A.0017=32h)
    2874 0D9B  3C B8			 		cmp	al,0B8h
    2875 0D9D  75 2C			 		jne	loc_152			; Jump if not equal
    2876 0D9F  A0 0019			 		mov	al,byte ptr ds:[19h]	; (A.0019=2Fh)
    2877 0DA2  B4 00			 		mov	ah,0
    2878 0DA4  88 26 0019		 		mov	byte ptr ds:[19h],ah	; (A.0019=2Fh)
    2879 0DA8  3C 00			 		cmp	al,0
    2880 0DAA  74 1F			 		je	loc_152			; Jump if equal
    2881 0DAC  E9 0F3D R		 		jmp	loc_182			; (0F3D)
    2882				;a.0daf
    2883 0DAF				loc_150:					;  xref A.0D93
    2884 0DAF  F6 D4			 		not	ah
    2885 0DB1  20 26 0018 R		 		and	byte ptr ds:[keybd_flags_2],ah	; (A.0018=31h)
    2886 0DB5  EB 14			 		jmp	short loc_152		; (0DCB)
    2887 0DB7				loc_151:					;  xref A.0D2C, 0D4D, 0D5A
    2888 0DB7  3C 80			 		cmp	al,80h
    2889 0DB9  73 10			 		jae	loc_152			; Jump if above or =
    2890 0DBB  F6 06 0018 R 08		 		test	byte ptr ds:[keybd_flags_2],8	; (A.0018=31h)
    2891 0DC0  74 12			 		jz	loc_153			; Jump if zero
    2892 0DC2  3C 45			 		cmp	al,45h			; 'E'
    2893 0DC4  74 05			 		je	loc_152			; Jump if equal
    2894 0DC6  80 26 0018 R F7		 		and	byte ptr ds:[keybd_flags_2],0F7h	; (A.0018=31h)
    2895 0DCB				loc_152:					;  xref A.0D45, 0D7C, 0D88, 0D9D
    2896				 						;            0DAA, 0DB5, 0DB9, 0DC4
    2897				 						;            0E39, 0E60, 0EA8, 0EDE
    2898				 						;            0F57, 0F79, 0F7F
    2899 0DCB  07			 		pop	es
    2900 0DCC  1F			 		pop	ds
    2901 0DCD  5F			 		pop	di
    2902 0DCE  5E			 		pop	si
    2903 0DCF  5A			 		pop	dx
    2904 0DD0  59			 		pop	cx
    2905 0DD1  5B			 		pop	bx
    2906 0DD2  58			 		pop	ax
    2907 0DD3  CF			 		iret				; Interrupt return
    2908				
    2909				;===============================================================================
    2910				;a.0dd4
    2911				; Process warm boot keyboard combination Ctrl-Alt-Del
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-54


    2912				;
    2913 0DD4				loc_153:					;  xref A.0DC0
    2914 0DD4  F6 06 0017 R 08		 		test	byte ptr ds:[keybd_flags_1],8	; (A.0017=32h)
    2915 0DD9  75 03			 		jnz	loc_154			; Jump if not zero
    2916 0DDB  E9 0E6D R		 		jmp	loc_162			; (0E6D)
    2917 0DDE				loc_154:					;  xref A.0DD9
    2918 0DDE  F6 06 0017 R 04		 		test	byte ptr ds:[keybd_flags_1],4	; (A.0017=32h)
    2919 0DE3  74 31			 		jz	loc_155			; Jump if zero
    2920 0DE5  3C 53			 		cmp	al,53h			; 'S'
    2921 0DE7  75 2D			 		jne	loc_155			; Jump if not equal
    2922 0DE9  C7 06 0072 1234		 		mov	word ptr ds:[72h],1234h	; (A.0072=0FEB9h)
    2923 0DEF  E9 001F R				jmp	COLD2			;*(001F) go to cold restart
    2924				; 		db	0E9h, 2Dh,0F2h
    2925				
    2926				
    2927				;a.0df2
    2928 0DF2  52 4F 50 51 4B 4C	data_88:	db	'ROPQKLMGHI'		;  xref A.0E1F
    2929       4D 47 48 49		
    2930 0DFC  10 11 12 13 14 15	     		db	 10h, 11h, 12h, 13h, 14h, 15h
    2931 0E02  16 17 18 19 1E 1F	     		db	 16h, 17h, 18h, 19h, 1Eh, 1Fh
    2932 0E08  20 21 22 23 24		 		db	' !"#$'
    2933 0E0D  25 26 2C 2D 2E 2F	     		db	'%&,-./012'
    2934       30 31 32			
    2935				;a.0e16
    2936 0E16				loc_155:					;  xref A.0DE3, 0DE7
    2937 0E16  3C 39			 		cmp	al,39h			; '9'
    2938 0E18  75 05			 		jne	loc_156			; Jump if not equal
    2939 0E1A  B0 20			 		mov	al,20h			; ' '
    2940 0E1C  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2941 0E1F				loc_156:					;  xref A.0E18
    2942 0E1F  BF 0DF2 R		 		mov	di,offset data_88	; (A.0DF2='ROPQKLMGHI')
    2943 0E22  B9 000A			 		mov	cx,0Ah
    2944 0E25  F2/ AE			 		repne	scasb			; Rep zf=0+cx >0 Scan es:[di] for al
    2945 0E27  75 12			 		jnz	loc_157			; Jump if not zero
    2946 0E29  81 EF 0DF3		 		sub	di,0DF3h
    2947 0E2D  A0 0019			 		mov	al,byte ptr ds:[19h]	; (A.0019=2Fh)
    2948 0E30  B4 0A			 		mov	ah,0Ah
    2949 0E32  F6 E4			 		mul	ah			; ax = reg * al
    2950 0E34  03 C7			 		add	ax,di
    2951 0E36  A2 0019			 		mov	byte ptr ds:[19h],al	; (A.0019=2Fh)
    2952 0E39  EB 90			 		jmp	short loc_152		; (0DCB)
    2953 0E3B				loc_157:					;  xref A.0E27
    2954 0E3B  C6 06 0019 00		 		mov	byte ptr ds:[19h],0	; (A.0019=2Fh)
    2955 0E40  B9 001A			 		mov	cx,1Ah
    2956 0E43  F2/ AE			 		repne	scasb			; Rep zf=0+cx >0 Scan es:[di] for al
    2957 0E45  75 05			 		jnz	loc_158			; Jump if not zero
    2958 0E47  B0 00			 		mov	al,0
    2959 0E49  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2960 0E4C				loc_158:					;  xref A.0E45
    2961 0E4C  3C 02			 		cmp	al,2
    2962 0E4E  72 0C			 		jb	loc_159			; Jump if below
    2963 0E50  3C 0E			 		cmp	al,0Eh
    2964 0E52  73 08			 		jae	loc_159			; Jump if above or =
    2965 0E54  80 C4 76			 		add	ah,76h			; 'v'
    2966 0E57  B0 00			 		mov	al,0
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-55


    2967 0E59  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2968 0E5C				loc_159:					;  xref A.0E4E, 0E52
    2969 0E5C  3C 3B			 		cmp	al,3Bh			; ';'
    2970 0E5E  73 03			 		jae	loc_161			; Jump if above or =
    2971				;a.0e60
    2972 0E60				loc_160:					;  xref A.0E65
    2973 0E60  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    2974 0E63				loc_161:					;  xref A.0E5E
    2975 0E63  3C 47			 		cmp	al,47h			; 'G'
    2976 0E65  73 F9			 		jae	loc_160			; Jump if above or =
    2977 0E67  BB 0CC1			 		mov	bx,0CC1h
    2978 0E6A  E9 0F82 R		 		jmp	loc_187			; (0F82)
    2979 0E6D				loc_162:					;  xref A.0DDB
    2980 0E6D  F6 06 0017 R 04		 		test	byte ptr ds:[keybd_flags_1],4	; (A.0017=32h)
    2981 0E72  74 51			 		jz	loc_168			; Jump if zero
    2982 0E74  3C 46			 		cmp	al,46h			; 'F'
    2983 0E76  75 18			 		jne	loc_163			; Jump if not equal
    2984 0E78  BB 001E			 		mov	bx,1Eh
    2985 0E7B  89 1E 001A R		 		mov	word ptr ds:[keybd_q_head],bx	; (A.001A=3538h)
    2986 0E7F  89 1E 001C R		 		mov	word ptr ds:[keybd_q_tail],bx	; (A.001C=0D0Ah)
    2987 0E83  C6 06 0071 80		 		mov	byte ptr ds:[71h],80h	; (A.0071=0)
    2988 0E88  CD 1B			 		int	1Bh			; Keyboard break (cntrl-break)
    2989 0E8A  B8 0000			 		mov	ax,0
    2990 0E8D  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2991 0E90				loc_163:					;  xref A.0E76
    2992 0E90  3C 45			 		cmp	al,45h			; 'E'
    2993 0E92  75 17			 		jne	loc_165			; Jump if not equal
    2994 0E94  80 0E 0018 R 08		 		or	byte ptr ds:[keybd_flags_2],8	; (A.0018=31h)
    2995 0E99  BA 03D8			 		mov	dx,3D8h
    2996 0E9C  A0 0065			 		mov	al,byte ptr ds:[65h]	; (A.0065=0A3h)
    2997 0E9F  EE			 		out	dx,al			; port 3D8h, CGA video control
    2998 0EA0  FB			 		sti				; Enable interrupts
    2999 0EA1				loc_164:					;  xref A.0EA6
    3000 0EA1  F6 06 0018 R 08		 		test	byte ptr ds:[keybd_flags_2],8	; (A.0018=31h)
    3001 0EA6  75 F9			 		jnz	loc_164			; Jump if not zero
    3002 0EA8  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    3003				;a.0eab
    3004 0EAB				loc_165:					;  xref A.0E92
    3005 0EAB  3C 37			 		cmp	al,37h			; '7'
    3006 0EAD  75 06			 		jne	loc_166			; Jump if not equal
    3007 0EAF  B8 7200			 		mov	ax,7200h
    3008 0EB2  E9 0F34 R		 		jmp	loc_181			; (0F34)
    3009 0EB5				loc_166:					;  xref A.0EAD
    3010 0EB5  BB 0BF0			 		mov	bx,0BF0h
    3011 0EB8  3C 3B			 		cmp	al,3Bh			; ';'
    3012 0EBA  73 03			 		jae	loc_167			; Jump if above or =
    3013 0EBC  EB 72			 		jmp	short loc_180		; (0F30)
    3014 0EBE  90			 		db	90h
    3015 0EBF				loc_167:					;  xref A.0EBA
    3016 0EBF  BB 0C2A			 		mov	bx,0C2Ah
    3017 0EC2  E9 0F82 R		 		jmp	loc_187			; (0F82)
    3018 0EC5				loc_168:					;  xref A.0E72
    3019 0EC5  3C 47			 		cmp	al,47h			; 'G'
    3020 0EC7  73 27			 		jae	loc_172			; Jump if above or =
    3021 0EC9  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-56


    3022 0ECE  74 55			 		jz	loc_178			; Jump if zero
    3023 0ED0  3C 0F			 		cmp	al,0Fh
    3024 0ED2  75 06			 		jne	loc_169			; Jump if not equal
    3025 0ED4  B8 0F00			 		mov	ax,0F00h
    3026 0ED7  EB 5B			 		jmp	short loc_181		; (0F34)
    3027 0ED9  90			 		db	90h
    3028 0EDA				loc_169:					;  xref A.0ED2
    3029 0EDA  3C 37			 		cmp	al,37h			; '7'
    3030 0EDC  75 03			 		jne	loc_170			; Jump if not equal
    3031 0EDE  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    3032				;a.0ee1
    3033 0EE1				loc_170:					;  xref A.0EDC
    3034 0EE1  3C 3B			 		cmp	al,3Bh			; ';'
    3035 0EE3  72 06			 		jb	loc_171			; Jump if below
    3036 0EE5  BB 0CB7			 		mov	bx,0CB7h
    3037 0EE8  E9 0F82 R		 		jmp	loc_187			; (0F82)
    3038 0EEB				loc_171:					;  xref A.0EE3
    3039 0EEB  BB 0C7D			 		mov	bx,0C7Dh
    3040 0EEE  EB 40			 		jmp	short loc_180		; (0F30)
    3041 0EF0				loc_172:					;  xref A.0EC7
    3042 0EF0  F6 06 0017 R 20		 		test	byte ptr ds:[keybd_flags_1],20h	; (A.0017=32h) ' '
    3043 0EF5  75 20			 		jnz	loc_176			; Jump if not zero
    3044 0EF7  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    3045 0EFC  75 20			 		jnz	loc_177			; Jump if not zero
    3046 0EFE				loc_173:					;  xref A.0F1C
    3047 0EFE  3C 4A			 		cmp	al,4Ah			; 'J'
    3048 0F00  74 0B			 		je	loc_174			; Jump if equal
    3049 0F02  3C 4E			 		cmp	al,4Eh			; 'N'
    3050 0F04  74 0C			 		je	loc_175			; Jump if equal
    3051 0F06  2C 47			 		sub	al,47h			; 'G'
    3052 0F08  BB 0CD7			 		mov	bx,0CD7h
    3053 0F0B  EB 77			 		jmp	short loc_188		; (0F84)
    3054 0F0D				loc_174:					;  xref A.0F00
    3055 0F0D  B8 4A2D			 		mov	ax,4A2Dh
    3056 0F10  EB 22			 		jmp	short loc_181		; (0F34)
    3057				;a.0f12
    3058 0F12				loc_175:					;  xref A.0F04
    3059 0F12  B8 4E2B			 		mov	ax,4E2Bh
    3060 0F15  EB 1D			 		jmp	short loc_181		; (0F34)
    3061 0F17				loc_176:					;  xref A.0EF5
    3062 0F17  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    3063 0F1C  75 E0			 		jnz	loc_173			; Jump if not zero
    3064 0F1E				loc_177:					;  xref A.0EFC
    3065 0F1E  2C 46			 		sub	al,46h			; 'F'
    3066 0F20  BB 0CCA			 		mov	bx,0CCAh
    3067 0F23  EB 0B			 		jmp	short loc_180		; (0F30)
    3068 0F25				loc_178:					;  xref A.0ECE
    3069 0F25  3C 3B			 		cmp	al,3Bh			; ';'
    3070 0F27  72 04			 		jb	loc_179			; Jump if below
    3071 0F29  B0 00			 		mov	al,0
    3072 0F2B  EB 07			 		jmp	short loc_181		; (0F34)
    3073 0F2D				loc_179:					;  xref A.0F27
    3074 0F2D  BB 0C43 R		 		mov	bx,offset data_86	; (A.0C43=' 1234567890-=  q')
    3075				;a.0f30
    3076 0F30				loc_180:					;  xref A.0EBC, 0EEE, 0F23
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-57


    3077 0F30  FE C8			 		dec	al
    3078 0F32  2E: D7			 		xlat	cs:[bx]			; al=[al+[bx]] table
    3079 0F34				loc_181:					;  xref A.0D6E, 0D8D, 0E1C, 0E49
    3080				 						;            0E59, 0E8D, 0EB2, 0ED7
    3081				 						;            0F10, 0F15, 0F2B, 0F8A
    3082 0F34  3C FF			 		cmp	al,0FFh
    3083 0F36  74 1F			 		je	loc_183			; Jump if equal
    3084 0F38  80 FC FF			 		cmp	ah,0FFh
    3085 0F3B  74 1A			 		je	loc_183			; Jump if equal
    3086 0F3D				loc_182:					;  xref A.0DAC
    3087 0F3D  F6 06 0017 R 40		 		test	byte ptr ds:[keybd_flags_1],40h	; (A.0017=32h) '@'
    3088 0F42  74 20			 		jz	loc_185			; Jump if zero
    3089 0F44  F6 06 0017 R 03		 		test	byte ptr ds:[keybd_flags_1],3	; (A.0017=32h)
    3090 0F49  74 0F			 		jz	loc_184			; Jump if zero
    3091 0F4B  3C 41			 		cmp	al,41h			; 'A'
    3092 0F4D  72 15			 		jb	loc_185			; Jump if below
    3093 0F4F  3C 5A			 		cmp	al,5Ah			; 'Z'
    3094 0F51  77 11			 		ja	loc_185			; Jump if above
    3095 0F53  04 20			 		add	al,20h			; ' '
    3096 0F55  EB 0D			 		jmp	short loc_185		; (0F64)
    3097 0F57				loc_183:					;  xref A.0F36, 0F3B
    3098 0F57  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    3099 0F5A				loc_184:					;  xref A.0F49
    3100 0F5A  3C 61			 		cmp	al,61h			; 'a'
    3101 0F5C  72 06			 		jb	loc_185			; Jump if below
    3102 0F5E  3C 7A			 		cmp	al,7Ah			; 'z'
    3103 0F60  77 02			 		ja	loc_185			; Jump if above
    3104 0F62  2C 20			 		sub	al,20h			; ' '
    3105				;a.0f64
    3106 0F64				loc_185:					;  xref A.0F42, 0F4D, 0F51, 0F55
    3107				 						;            0F5C, 0F60
    3108 0F64  8B 1E 001C R		 		mov	bx,word ptr ds:[keybd_q_tail]	; (A.001C=0D0Ah)
    3109 0F68  8B F3			 		mov	si,bx
    3110 0F6A  E8 0BD3 R		 		call	sub_30			; (0BD3)
    3111 0F6D  3B 1E 001A R		 		cmp	bx,word ptr ds:[keybd_q_head]	; (A.001A=3538h)
    3112 0F71  74 09			 		je	loc_186			; Jump if equal
    3113 0F73  89 04			 		mov	[si],ax
    3114 0F75  89 1E 001C R		 		mov	word ptr ds:[keybd_q_tail],bx	; (A.001C=0D0Ah)
    3115 0F79  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    3116 0F7C				loc_186:					;  xref A.0F71
    3117 0F7C  E8 0F8C R		 		call	sub_31			; (0F8C)
    3118 0F7F  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    3119 0F82				loc_187:					;  xref A.0E6A, 0EC2, 0EE8
    3120 0F82  2C 3B			 		sub	al,3Bh			; ';'
    3121 0F84				loc_188:					;  xref A.0F0B
    3122 0F84  2E: D7			 		xlat	cs:[bx]			; al=[al+[bx]] table
    3123 0F86  8A E0			 		mov	ah,al
    3124 0F88  B0 00			 		mov	al,0
    3125 0F8A  EB A8			 		jmp	short loc_181		; (0F34)
    3126				
    3127				
    3128				;===============================================================================
    3129				 ;                              SUBROUTINE
    3130				 ;
    3131				 ;         Called from:   A.0F7C
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-58


    3132				;===============================================================================
    3133				;a.0f8c
    3134 0F8C				sub_31		proc	near
    3135 0F8C  50			 		push	ax
    3136 0F8D  53			 		push	bx
    3137 0F8E  51			 		push	cx
    3138 0F8F  BB 00C0			 		mov	bx,0C0h
    3139 0F92  E4 61			 		in	al,C58255PB		; port 61h, 8255 port B, read
    3140 0F94  50			 		push	ax
    3141 0F95				loc_189:					;  xref A.0FA8
    3142 0F95  24 FC			 		and	al,0FCh
    3143 0F97  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    3144				 						;  al = 0, speaker off
    3145 0F99  B9 0048			 		mov	cx,48h
    3146				
    3147 0F9C				locloop_190:					;  xref A.0F9C
    3148 0F9C  E2 FE			 		loop	locloop_190		; Loop if cx > 0
    3149				
    3150 0F9E  0C 02			 		or	al,2
    3151 0FA0  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    3152 0FA2  B9 0048			 		mov	cx,48h
    3153				
    3154 0FA5				locloop_191:					;  xref A.0FA5
    3155 0FA5  E2 FE			 		loop	locloop_191		; Loop if cx > 0
    3156				
    3157 0FA7  4B			 		dec	bx
    3158 0FA8  75 EB			 		jnz	loc_189			; Jump if not zero
    3159 0FAA  58			 		pop	ax
    3160 0FAB  E6 61			 		out	C58255PB,al		; port 61h, 8255 B - spkr, etc
    3161				 						;  al = 0, speaker off
    3162 0FAD  59			 		pop	cx
    3163 0FAE  5B			 		pop	bx
    3164 0FAF  58			 		pop	ax
    3165 0FB0  C3			 		retn
    3166 0FB1				sub_31		endp
    3167				
    3168				
    3169				;===============================================================================
    3170				 ;                              SUBROUTINE
    3171				 ;
    3172				 ;         Called from:   A.008A
    3173				;===============================================================================
    3174				; Grab INT10/1D video
    3175				;a.0fb1
    3176 0FB1				sub_32		proc	near
    3177 0FB1  1E			 		push	ds
    3178 0FB2  33 C0			 		xor	ax,ax				; Zero register
    3179 0FB4  8E D8			 		mov	ds,ax
    3180 0FB6  B8 0FF1 R		 		mov	ax,offset INT10HANDLER		;0FF1h
    3181 0FB9  A3 0040			 		mov	ds:Int10v,ax			; (0000:0040=0EEh)
    3182 0FBC  8C 0E 0042		 		mov	ds:Int10v+2,cs			; (0000:0042=0C000h)
    3183 0FC0  B8 1020 R		 		mov	ax,offset INT_1D		;1020h
    3184 0FC3  A3 0074			 		mov	ds:Int1Dv,ax			; (0000:0074=0C958h)
    3185 0FC6  8C 0E 0076		 		mov	word ptr ds:Int1Dv+2,cs		; (0000:0076=0F000h)
    3186 0FCA  1F			 		pop	ds
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-59


    3187 0FCB  B8 0003			 		mov	ax,3
    3188 0FCE  CD 10			 		int	10h				; Video display   ah=functn 00h
    3189				 							;  set display mode in al
    3190 0FD0  C3			 		retn
    3191 0FD1				sub_32		endp
    3192				
    3193				;===============================================================================
    3194				;	ENTRY   0F045h                          ; IBM entry point for table
    3195				;a.0fd1
    3196				; INT 10 - Video Dispatch table
    3197				
    3198				;M1	LABEL	WORD	; TABLE OF ROUTINES WITHIN VIDEO I/O
    3199 0FD1  1078 R			V_TABLE:	dw	offset SET_MODE			;  xref A.101B
    3200 0FD3  113E R					dw	offset SET_CTYPE		;  xref A.101B
    3201 0FD5  115F R					dw	offset SET_CPOS			;  xref A.101B
    3202 0FD7  1189 R					dw	offset READ_CURSOR		;  xref A.101B
    3203 0FD9  16D5 R					dw	offset READ_LPEN		;  xref A.101B
    3204 0FDB  119F R					dw	offset ACT_DISP_PAGE		;  xref A.101B
    3205 0FDD  120B R					dw	offset SCROLL_UP		;  xref A.101B
    3206 0FDF  1290 R					dw	offset SCROLL_DOWN		;  xref A.101B
    3207 0FE1  12CC R					dw	offset READ_AC_CURRENT		;  xref A.101B
    3208 0FE3  1312 R					dw	offset WRITE_AC_CURRENT		;  xref A.101B
    3209 0FE5  1334 R					dw	offset WRITE_C_CURRENT		;  xref A.101B
    3210 0FE7  11C3 R					dw	offset SET_COLOR		;  xref A.101B
    3211 0FE9  1364 R					dw	offset WRITE_DOT		;  xref A.101B
    3212 0FEB  1353 R					dw	offset READ_DOT			;  xref A.101B
    3213 0FED  164E R					dw	offset WRITE_TTY		;  xref A.101B
    3214 0FEF  11E9 R					dw	offset VIDEO_STATE		;  xref A.101B
    3215				
    3216				
    3217				;===============================================================================
    3218				;  INT 10h  -  B I O S   V I D E O   S E R V I C E S
    3219				;
    3220				;	Purpose:  INT 10h BIOS video services.
    3221				;	Entry  :	Registers	Function
    3222				;			AH=		Major function code
    3223				;			AL=		Sub-function
    3224				;	Exit   :
    3225				;
    3226				;===============================================================================
    3227				;	ENTRY   0F065h                          ; IBM entry, video bios service
    3228				;a.0ff1
    3229 0FF1				INT10HANDLER:
    3230				;     	db	0FBh,0FCh, 06h, 1Eh, 52h, 51h
    3231				;     	db	 53h, 56h, 57h, 50h, 8Ah,0C4h
    3232				;     	db	 32h,0E4h,0D1h,0E0h, 8Bh,0F0h
    3233				;     	db	 3Dh, 20h, 00h, 72h, 04h, 58h
    3234				; 	db	0E9h, 2Ah, 01h
    3235 0FF1  FB					sti
    3236 0FF2  FC					cld
    3237 0FF3  06					push	es
    3238 0FF4  1E					push	ds
    3239 0FF5  52					push	dx
    3240 0FF6  51					push	cx
    3241 0FF7  53					push	bx
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-60


    3242 0FF8  56					push	si
    3243 0FF9  57					push	di
    3244 0FFA  50					push	ax
    3245 0FFB  8A C4					mov	al,ah
    3246 0FFD  32 E4					xor	ah,ah
    3247 0FFF  D1 E0					shl	ax,1
    3248 1001  8B F0					mov	si,ax			; convert function code to table offset
    3249 1003  3D 0020					cmp	ax,20h			; max function code * 2 
    3250 1006  72 04					jb	loc_192			;100C valid function, continue
    3251 1008  58					pop	ax
    3252 1009  E9 1136 R				jmp	loc_200			;1136 restore AX and exit
    3253				
    3254 100C				loc_192:
    3255 100C  B8 0040			 		mov	ax,40h
    3256 100F  8E D8			 		mov	ds,ax
    3257 1011  B8 B800			 		mov	ax,0B800h		; CGA memory
    3258 1014  8E C0			 		mov	es,ax
    3259 1016  58			 		pop	ax
    3260 1017  8A 26 0049 R		 		mov	ah,ds:video_mode	; (0040:0049=3)
    3261 101B  2E: FF A4 0FD1 R		 		jmp	word ptr cs:V_TABLE[si]	;*(A.0FD1=1078h)     16 entries
    3262				
    3263				
    3264				;===============================================================================
    3265				;  INT 1Dh  -  V I D E O   M O D E S
    3266				;
    3267				;	Purpose:  INT 1Dh BIOS video modes.
    3268				;	Entry  :	Registers	Function
    3269				;
    3270				;
    3271				;	Exit   :
    3272				;
    3273				;===============================================================================
    3274				;	ENTRY   0F0A4h                          ; IBM entry, SET_MODE tables
    3275				;a.1020
    3276				; Video Parameter Table
    3277				;00h 16 BYTEs   6845 register values for modes 00h and 01h
    3278				;10h 16 BYTEs   6845 register values for modes 02h and 03h
    3279				;20h 16 BYTEs   6845 register values for modes 04h and 05h
    3280				;30h 16 BYTEs   6845 register values for modes 06h and 07h
    3281				;40h    WORD    bytes in video buffer for modes 00h and 01h (0800h)
    3282				;42h    WORD    bytes in video buffer for modes 02h and 03h (1000h)
    3283				;44h    WORD    bytes in video buffer for modes 04h and 05h (4000h)
    3284				;46h    WORD    bytes in video buffer for mode 06h (4000h)
    3285				;48h  8 BYTEs   columns on screen for each of modes 00h through 07h
    3286				;50h  8 BYTEs   CRT controller mode bytes for each of modes 00h through 07h
    3287 1020				INT_1D:
    3288 1020  38 28 2D 0A 1F 06			db	38h, 28h, 2Dh, 0Ah, 1Fh, 06h	; Init string for 40 x 25
    3289 1026  19 1C 02 07 06 07			db	19h, 1Ch, 02h, 07h, 06h, 07h
    3290 102C  00 00 00 00				db	0, 0, 0, 0
    3291				
    3292 1030  71 50 5A 0A 1F 06			db	71h, 50h, 5Ah, 0Ah, 1Fh, 06h	; Init string for 80 x 25 col
    3293 1036  19 1C 02 07 06 07			db	19h, 1Ch, 02h, 07h, 06h, 07h
    3294 103C  00 00 00 00				db	0, 0, 0, 0
    3295				
    3296 1040  38 28 2D 0A 7F 06			db	38h, 28h, 2Dh, 0Ah, 7Fh, 06h	; Init string for GRAPHIX
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-61


    3297 1046  64 70 02 01 06 07			db	64h, 70h, 02h, 01h, 06h, 07h
    3298 104C  00 00 00 00				db	0, 0, 0, 0
    3299				
    3300 1050  61 50 52 0F 19 06			db	61h, 50h, 52h, 0Fh, 19h, 06h	; Init string for 80 x 25 b/w
    3301 1056  19 19 02 0D 0B 0C			db	19h, 19h, 02h, 0Dh, 0Bh, 0Ch
    3302 105C  00 00 00 00				db	0, 0, 0, 0
    3303				
    3304				;a.1060	Regen lengths
    3305 1060  0800			REGENL:		dw	2048			; xref A.1111 40x25
    3306 1062  1000			     		dw	4096			; 80x25
    3307 1064  4000					dw	16384			; graphics
    3308 1066  4000					dw	16384
    3309				;a.1068 Column lengths				; Data table (indexed access) xref A.1103
    3310 1068  28 28 50 50 28 28	MAXCOLS:	db	28h, 28h, 50h, 50h, 28h, 28h, 50h, 50h
    3311       50 50			
    3312				
    3313				;a;1070 table of mode sets			; Data table (indexed access) xref A.10FA
    3314 1070  2C 28 2D 29 2A 2E	MODES:		db	2Ch, 28h, 2Dh, 29h, 2Ah, 2Eh, 1Eh, 29h
    3315       1E 29			
    3316				
    3317				
    3318				;===============================================================================
    3319				;  Individual routines within the INT 10H Video Services
    3320				;
    3321				;	Entry  :	Registers	Function
    3322				;			AH		Video mode (0-7) from BDA 40:49
    3323				;			AL		Parameter
    3324				;			DS		BIOS data area (40h)
    3325				;			ES		video memory area (B800h)
    3326				;
    3327				;	Exit   :
    3328				;
    3329				;===============================================================================
    3330				;--- SET MODE ------------------------------------------------------------------
    3331				;
    3332				;	AL=	desired video mode 0-7
    3333				;	3D4h= 6845 index register
    3334				;	3D5h= 6845 data register
    3335				;	3D8h= master display mode latch control register
    3336				;	3D9h= background color latch select register
    3337				;	3DAh= status/feature register
    3338				;	3DB/3DC = light pen
    3339				;a.1078
    3340 1078				SET_MODE:					;  xref A.0FD1, 101B
    3341 1078  BA 03D4			 		mov	dx,3D4h			; index register
    3342 107B  B3 00			 		mov	bl,0
    3343 107D  3C 07			 		cmp	al,7			; max video mode
    3344 107F  72 03			 		jb	loc_194			; Allowed mode?
    3345 1081  E9 1136 R		 		jmp	loc_200			; no...exit (1136)
    3346				
    3347 1084				loc_194:
    3348 1084  8A E0			 		mov	ah,al
    3349 1086  A2 0049 R		 		mov	ds:video_mode,al	; (0040:0049=3)
    3350 1089  89 16 0063 R		 		mov	ds:video_port,dx	; (0040:0063=3D4h)
    3351 108D  1E			 		push	ds
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-62


    3352 108E  50			 		push	ax
    3353 108F  52			 		push	dx
    3354 1090  83 C2 04			 		add	dx,4
    3355 1093  8A C3			 		mov	al,bl
    3356 1095  EE			 		out	dx,al			; port 3D8h, CGA video control
    3357 1096  5A			 		pop	dx
    3358 1097  2B C0			 		sub	ax,ax
    3359 1099  8E D8			 		mov	ds,ax
    3360 109B  C5 1E 0074		 		lds	bx,dword ptr ds:Int1Dv	; (0000:0074=0C958h) grabe table address fro
					m IVT
    3361 109F  58			 		pop	ax
    3362 10A0  B9 0010			 		mov	cx,10h
    3363 10A3  80 FC 02			 		cmp	ah,2
    3364 10A6  72 10			 		jb	loc_195			; Jump if below
    3365 10A8  03 D9			 		add	bx,cx
    3366 10AA  80 FC 04			 		cmp	ah,4
    3367 10AD  72 09			 		jb	loc_195			; Jump if below
    3368 10AF  03 D9			 		add	bx,cx
    3369 10B1  80 FC 07			 		cmp	ah,7
    3370 10B4  72 02			 		jb	loc_195			; Jump if below
    3371 10B6  03 D9			 		add	bx,cx
    3372 10B8				loc_195:					;  xref A.10A6, 10AD, 10B4
    3373 10B8  50			 		push	ax
    3374 10B9  32 E4			 		xor	ah,ah			; Zero register
    3375				
    3376				;a.10bb
    3377 10BB				locloop_196:					;  xref A.10C6
    3378 10BB  8A C4			 		mov	al,ah
    3379 10BD  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    3380				 						;  al = 0, horiz char total
    3381 10BE  42			 		inc	dx
    3382 10BF  FE C4			 		inc	ah
    3383 10C1  8A 07			 		mov	al,[bx]
    3384 10C3  EE			 		out	dx,al			; port 3D5h, CGA/EGA indxd data
    3385 10C4  43			 		inc	bx
    3386 10C5  4A			 		dec	dx
    3387 10C6  E2 F3			 		loop	locloop_196		; Loop if cx > 0
    3388				
    3389				; this clears the screen
    3390 10C8  58			 		pop	ax
    3391 10C9  1F			 		pop	ds
    3392 10CA  33 FF			 		xor	di,di			; Zero register
    3393 10CC  89 3E 004E R		 		mov	ds:video_segment,di	; (0040:004E=0)
    3394 10D0  C6 06 0062 R 00		 		mov	byte ptr ds:video_page,0	; (0040:0062=0)
    3395 10D5  B9 2000			 		mov	cx,2000h		; 8192 words
    3396 10D8  80 FC 04			 		cmp	ah,4
    3397 10DB  72 04			 		jb	loc_197			; Jump if below
    3398 10DD  33 C0			 		xor	ax,ax			; Zero register
    3399 10DF  EB 03			 		jmp	short loc_198		; (10E4)
    3400				
    3401 10E1				loc_197:					;  xref A.10DB
    3402 10E1  B8 0720			 		mov	ax, 7*100h+' '		; Word for text fill 720h
    3403				;a.10e4
    3404 10E4				loc_198:					;  xref A.10DF
    3405 10E4  F3/ AB			 		rep	stosw			; fill the screen with spaces
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-63


    3406				
    3407 10E6  C7 06 0060 R 0067	 		mov	word ptr ds:vid_curs_mode,67h	; (0040:0060=2000h)
    3408 10EC  A0 0049 R		 		mov	al,ds:video_mode	; (0040:0049=3)
    3409 10EF  32 E4			 		xor	ah,ah			; Zero register
    3410 10F1  8B F0			 		mov	si,ax
    3411 10F3  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h) get the port
    3412 10F7  83 C2 04			 		add	dx,4
    3413				
    3414 10FA  2E: 8A 84 1070 R		 		mov	al,byte ptr cs:MODES[si]	; load data to set mode
    3415 10FF  EE			 		out	dx,al			; port 3D8h, CGA video control
    3416 1100  A2 0065 R		 		mov	ds:video_mode_reg,al	; (0040:0065=29h) save active data
    3417				
    3418 1103  2E: 8A 84 1068 R		 		mov	al,byte ptr cs:MAXCOLS[si]	; (A.1068='((PP((PP')
    3419 1108  32 E4			 		xor	ah,ah			; Zero register
    3420 110A  A3 004A R		 		mov	ds:video_columns,ax	; (0040:004A=50h)
    3421 110D  81 E6 000E		 		and	si,word ptr 0Eh
    3422 1111  2E: 8B 8C 1060 R		 		mov	cx,word ptr cs:REGENL[si]	; (A.1060=800h)
    3423 1116  89 0E 004C R		 		mov	ds:video_buf_siz,cx	; (0040:004C=1000h)
    3424				; set cursor position to upper-left corner in each page
    3425 111A  B9 0008			 		mov	cx,8			; 8 pages
    3426 111D  BF 0050 R		 		mov	di,offset vid_curs_pos0	; (0040:0050=4Fh) bf 0050
    3427 1120  1E			 		push	ds
    3428 1121  07			 		pop	es
    3429 1122  33 C0			 		xor	ax,ax
    3430 1124  F3/ AB			 		rep	stosw			; set cursor position to 0
    3431				
    3432 1126  42			 		inc	dx
    3433 1127  B0 30			 		mov	al,30h			; assume NOT mode 7 
    3434 1129  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	; is it mode 7
    3435 112E  75 02			 		jne	loc_199			; no, continue
    3436 1130  B0 3F			 		mov	al,3Fh			; yes, set palette byte for 640x200 BW
    3437				
    3438 1132				loc_199:					;  xref A.112E
    3439 1132  EE			 		out	dx,al			; port 3D9h, CGA color control
    3440 1133  A2 0066 R		 		mov	ds:video_color,al	; (0040:0066=30h) save color palette
    3441				;a.1136
    3442 1136				loc_200:					;  xref A.1081, 1147, 1176, 11C0
    3443				 						;            11DC, 1252, 12F3, 1331
    3444				 						;            1350, 1361, 1380, 141C
    3445				 						;            147C, 14FC, 155C, 15E0
    3446				 						;            16A9
    3447 1136  5F			 		pop	di
    3448 1137  5E			 		pop	si
    3449 1138  5B			 		pop	bx
    3450 1139				loc_201:					;  xref A.11F7
    3451 1139  59			 		pop	cx
    3452 113A  5A			 		pop	dx
    3453 113B  1F			 		pop	ds
    3454 113C  07			 		pop	es
    3455 113D  CF			 		iret				; Interrupt return
    3456				
    3457				
    3458				;--- SET CTYPE -----------------------------------------------------------------
    3459 113E				SET_CTYPE:					;  xref A.0FD3, 101B
    3460 113E  B4 0A			 		mov	ah,0Ah
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-64


    3461 1140  89 0E 0060 R		 		mov	ds:vid_curs_mode,cx	; (0040:0060=2000h)
    3462 1144  E8 1149 R		 		call	sub_33			; (1149)
    3463 1147  EB ED			 		jmp	short loc_200		; (1136)
    3464				
    3465				;===============================================================================
    3466				 ;                              SUBROUTINE
    3467				 ;
    3468				 ;         Called from:   A.1144, 1185, 11B3
    3469				;===============================================================================
    3470				;a.1149
    3471 1149				sub_33		proc	near
    3472 1149  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3473 114D  8A C4			 		mov	al,ah
    3474 114F  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    3475				 						;  al = 0Ah, cursor start, mode
    3476 1150  42			 		inc	dx
    3477 1151  8A C5			 		mov	al,ch
    3478 1153  EE			 		out	dx,al			; port 3D5h, CGA/EGA indxd data
    3479 1154  4A			 		dec	dx
    3480 1155  8A C4			 		mov	al,ah
    3481 1157  FE C0			 		inc	al
    3482 1159  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    3483				 						;  al = 0Bh, cursor end
    3484 115A  42			 		inc	dx
    3485 115B  8A C1			 		mov	al,cl
    3486 115D  EE			 		out	dx,al			; port 3D5h, CGA/EGA indxd data
    3487 115E  C3			 		retn
    3488 115F				sub_33		endp
    3489				
    3490				
    3491				;--- SET CPOS ------------------------------------------------------------------
    3492				;a.115f
    3493 115F				SET_CPOS:					;  xref A.0FD5, 101B
    3494 115F  8A CF			 		mov	cl,bh
    3495 1161  32 ED			 		xor	ch,ch			; Zero register
    3496 1163  D1 E1			 		shl	cx,1			; Shift w/zeros fill
    3497 1165  8B F1			 		mov	si,cx
    3498 1167  89 94 0050 R		 		mov	ds:vid_curs_pos0[si],dx	; (0040:0050=184Fh)
    3499 116B  38 3E 0062 R		 		cmp	ds:video_page,bh	; (0040:0062=0)
    3500 116F  75 05			 		jne	loc_204			; Jump if not equal
    3501 1171  8B C2			 		mov	ax,dx
    3502 1173  E8 1178 R		 		call	sub_34			; (1178)
    3503 1176				loc_204:					;  xref A.116F
    3504 1176  EB BE			 		jmp	short loc_200		; (1136)
    3505				
    3506				;===============================================================================
    3507				 ;                              SUBROUTINE
    3508				 ;
    3509				 ;         Called from:   A.1173, 11BD
    3510				;===============================================================================
    3511				;a.1178
    3512 1178				sub_34		proc	near
    3513 1178  E8 11FA R		 		call	sub_35			; (11FA)
    3514 117B  8B C8			 		mov	cx,ax
    3515 117D  03 0E 004E R		 		add	cx,ds:video_segment	; (0040:004E=0)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-65


    3516 1181  D1 F9			 		sar	cx,1			; Shift w/sign fill
    3517 1183  B4 0E			 		mov	ah,0Eh
    3518 1185  E8 1149 R		 		call	sub_33			; (1149)
    3519 1188  C3			 		retn
    3520 1189				sub_34		endp
    3521				
    3522				
    3523				;--- READ CURSOR ---------------------------------------------------------------
    3524				;a.1189
    3525 1189				READ_CURSOR:					;  xref A.0FD7, 101B
    3526 1189  8A DF			 		mov	bl,bh
    3527 118B  32 FF			 		xor	bh,bh			; Zero register
    3528 118D  D1 E3			 		shl	bx,1			; Shift w/zeros fill
    3529 118F  8B 97 0050 R		 		mov	dx,ds:vid_curs_pos0[bx]	; (0040:0050=184Fh)
    3530 1193  8B 0E 0060 R		 		mov	cx,ds:vid_curs_mode	; (0040:0060=2000h)
    3531 1197  5F			 		pop	di
    3532 1198  5E			 		pop	si
    3533 1199  5B			 		pop	bx
    3534 119A  58			 		pop	ax
    3535 119B  58			 		pop	ax
    3536 119C  1F			 		pop	ds
    3537 119D  07			 		pop	es
    3538 119E  CF			 		iret				; Interrupt return
    3539				
    3540				;--- ACT DISP PAGE -------------------------------------------------------------
    3541				;a.119f
    3542 119F				ACT_DISP_PAGE:					;  xref A.0FDB, 101B
    3543 119F  A2 0062 R		 		mov	ds:video_page,al	; (0040:0062=0)
    3544 11A2  8B 0E 004C R		 		mov	cx,ds:video_buf_siz	; (0040:004C=1000h)
    3545 11A6  98			 		cbw				; Convrt byte to word
    3546 11A7  50			 		push	ax
    3547 11A8  F7 E1			 		mul	cx			; dx:ax = reg * ax
    3548 11AA  A3 004E R		 		mov	ds:video_segment,ax	; (0040:004E=0)
    3549 11AD  8B C8			 		mov	cx,ax
    3550 11AF  D1 F9			 		sar	cx,1			; Shift w/sign fill
    3551 11B1  B4 0C			 		mov	ah,0Ch
    3552 11B3  E8 1149 R		 		call	sub_33			; (1149)
    3553 11B6  5B			 		pop	bx
    3554 11B7  D1 E3			 		shl	bx,1			; Shift w/zeros fill
    3555 11B9  8B 87 0050 R		 		mov	ax,ds:vid_curs_pos0[bx]	; (0040:0050=184Fh)
    3556 11BD  E8 1178 R		 		call	sub_34			; (1178)
    3557 11C0  E9 1136 R		 		jmp	loc_200			; (1136)
    3558				
    3559				;--- SET COLOR -----------------------------------------------------------------
    3560				;a.11c3
    3561 11C3				SET_COLOR:					;  xref A.0FE7, 101B
    3562 11C3  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3563 11C7  83 C2 05			 		add	dx,5
    3564 11CA  A0 0066 R		 		mov	al,ds:video_color	; (0040:0066=30h)
    3565 11CD  0A FF			 		or	bh,bh			; Zero ?
    3566 11CF  75 0E			 		jnz	loc_209			; Jump if not zero
    3567 11D1  24 E0			 		and	al,0E0h
    3568 11D3  80 E3 1F			 		and	bl,1Fh
    3569 11D6  0A C3			 		or	al,bl
    3570 11D8				loc_208:					;  xref A.11E3, 11E7
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-66


    3571 11D8  EE			 		out	dx,al			; port 3D9h, CGA color control
    3572 11D9  A2 0066 R		 		mov	ds:video_color,al	; (0040:0066=30h)
    3573 11DC  E9 1136 R		 		jmp	loc_200			; (1136)
    3574 11DF				loc_209:					;  xref A.11CF
    3575 11DF  24 DF			 		and	al,0DFh
    3576 11E1  D0 EB			 		shr	bl,1			; Shift w/zeros fill
    3577 11E3  73 F3			 		jnc	loc_208			; Jump if carry=0
    3578 11E5  0C 20			 		or	al,20h			; ' '
    3579 11E7  EB EF			 		jmp	short loc_208		; (11D8)
    3580				
    3581				;--- VIDEO STATE ---------------------------------------------------------------
    3582				;a.11e9
    3583 11E9				VIDEO_STATE:					;  xref A.0FEF, 101B
    3584 11E9  8A 26 004A R		 		mov	ah,byte ptr ds:video_columns	; (0040:004A=50h)
    3585 11ED  A0 0049 R		 		mov	al,ds:video_mode	; (0040:0049=3)
    3586 11F0  8A 3E 0062 R		 		mov	bh,ds:video_page	; (0040:0062=0)
    3587 11F4  5F			 		pop	di
    3588 11F5  5E			 		pop	si
    3589 11F6  59			 		pop	cx
    3590 11F7  E9 1139 R		 		jmp	loc_201			; (1139)
    3591				
    3592				;===============================================================================
    3593				 ;                              SUBROUTINE
    3594				 ;
    3595				 ;         Called from:   A.1178, 1259, 130C
    3596				;===============================================================================
    3597				;a.11fa
    3598 11FA				sub_35		proc	near
    3599 11FA  53			 		push	bx
    3600 11FB  8B D8			 		mov	bx,ax
    3601 11FD  8A C4			 		mov	al,ah
    3602 11FF  F6 26 004A R		 		mul	byte ptr ds:video_columns	; (0040:004A=50h) ax = data * al
    3603 1203  32 FF			 		xor	bh,bh			; Zero register
    3604 1205  03 C3			 		add	ax,bx
    3605 1207  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    3606 1209  5B			 		pop	bx
    3607 120A  C3			 		retn
    3608 120B				sub_35		endp
    3609				
    3610				
    3611				;--- SCROLL UP -----------------------------------------------------------------
    3612				;a.120b
    3613 120B				SCROLL_UP:					;  xref A.0FDD, 101B
    3614 120B  8A D8			 		mov	bl,al
    3615 120D  80 FC 04			 		cmp	ah,4
    3616 1210  72 08			 		jb	loc_212			; Jump if below
    3617 1212  80 FC 07			 		cmp	ah,7
    3618 1215  74 03			 		je	loc_212			; Jump if equal
    3619 1217  E9 13CA R		 		jmp	loc_244			; (13CA)
    3620 121A				loc_212:					;  xref A.1210, 1215
    3621 121A  53			 		push	bx
    3622 121B  8B C1			 		mov	ax,cx
    3623 121D  E8 1259 R		 		call	sub_36			; (1259)
    3624 1220  74 33			 		jz	loc_218			; Jump if zero
    3625 1222  03 F0			 		add	si,ax
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-67


    3626 1224  8A E6			 		mov	ah,dh
    3627 1226  2A E3			 		sub	ah,bl
    3628 1228				loc_213:					;  xref A.1231
    3629 1228  E8 1280 R		 		call	sub_37			; (1280)
    3630 122B  03 F5			 		add	si,bp
    3631 122D  03 FD			 		add	di,bp
    3632 122F  FE CC			 		dec	ah
    3633 1231  75 F5			 		jnz	loc_213			; Jump if not zero
    3634 1233				loc_214:					;  xref A.1257
    3635 1233  58			 		pop	ax
    3636 1234  B0 20			 		mov	al,20h			; ' '
    3637 1236				loc_215:					;  xref A.123D
    3638 1236  E8 1289 R		 		call	sub_38			; (1289)
    3639 1239  03 FD			 		add	di,bp
    3640 123B  FE CB			 		dec	bl
    3641 123D  75 F7			 		jnz	loc_215			; Jump if not zero
    3642 123F				loc_216:					;  xref A.12C5
    3643 123F  B8 0040			 		mov	ax,40h
    3644 1242  8E D8			 		mov	ds,ax
    3645 1244  80 3E 0049 R 07		 		cmp	byte ptr ds:video_mode,7	; (0040:0049=3)
    3646 1249  74 07			 		je	loc_217			; Jump if equal
    3647 124B  A0 0065 R		 		mov	al,ds:video_mode_reg	; (0040:0065=29h)
    3648 124E  BA 03D8			 		mov	dx,3D8h
    3649 1251  EE			 		out	dx,al			; port 3D8h, CGA video control
    3650 1252				loc_217:					;  xref A.1249
    3651 1252  E9 1136 R		 		jmp	loc_200			; (1136)
    3652 1255				loc_218:					;  xref A.1220
    3653 1255  8A DE			 		mov	bl,dh
    3654 1257  EB DA			 		jmp	short loc_214		; (1233)
    3655				
    3656				;===============================================================================
    3657				 ;                              SUBROUTINE
    3658				 ;
    3659				 ;         Called from:   A.121D, 12A3
    3660				;===============================================================================
    3661				;a.1259
    3662 1259				sub_36		proc	near
    3663 1259  E8 11FA R		 		call	sub_35			; (11FA)
    3664 125C  03 06 004E R		 		add	ax,ds:video_segment	; (0040:004E=0)
    3665 1260  8B F8			 		mov	di,ax
    3666 1262  8B F0			 		mov	si,ax
    3667 1264  2B D1			 		sub	dx,cx
    3668 1266  FE C6			 		inc	dh
    3669 1268  FE C2			 		inc	dl
    3670 126A  32 ED			 		xor	ch,ch			; Zero register
    3671 126C  8B 2E 004A R		 		mov	bp,ds:video_columns	; (0040:004A=50h)
    3672 1270  03 ED			 		add	bp,bp
    3673 1272  8A C3			 		mov	al,bl
    3674 1274  F6 26 004A R		 		mul	byte ptr ds:video_columns	; (0040:004A=50h) ax = data * al
    3675 1278  03 C0			 		add	ax,ax
    3676 127A  06			 		push	es
    3677 127B  1F			 		pop	ds
    3678 127C  80 FB 00			 		cmp	bl,0
    3679 127F  C3			 		retn
    3680 1280				sub_36		endp
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-68


    3681				
    3682				
    3683				;===============================================================================
    3684				 ;                              SUBROUTINE
    3685				 ;
    3686				 ;         Called from:   A.1228, 12AE
    3687				;===============================================================================
    3688				;a.1280
    3689 1280				sub_37		proc	near
    3690 1280  8A CA			 		mov	cl,dl
    3691 1282  56			 		push	si
    3692 1283  57			 		push	di
    3693 1284  F3/ A5			 		rep	movsw			; Rep when cx >0 Mov [si] to es:[di]
    3694 1286  5F			 		pop	di
    3695 1287  5E			 		pop	si
    3696 1288  C3			 		retn
    3697 1289				sub_37		endp
    3698				
    3699				
    3700				;===============================================================================
    3701				 ;                              SUBROUTINE
    3702				 ;
    3703				 ;         Called from:   A.1236, 12BC
    3704				;===============================================================================
    3705				;a.1289
    3706 1289				sub_38		proc	near
    3707 1289  8A CA			 		mov	cl,dl
    3708 128B  57			 		push	di
    3709 128C  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
    3710 128E  5F			 		pop	di
    3711 128F  C3			 		retn
    3712 1290				sub_38		endp
    3713				
    3714				
    3715				;--- SCROLL DOWN ---------------------------------------------------------------
    3716				;a.1290
    3717 1290				SCROLL_DOWN:					;  xref A.0FDF, 101B
    3718 1290  FD			 		std				; Set direction flag
    3719 1291  8A D8			 		mov	bl,al
    3720 1293  80 FC 04			 		cmp	ah,4
    3721 1296  72 08			 		jb	loc_220			; Jump if below
    3722 1298  80 FC 07			 		cmp	ah,7
    3723 129B  74 03			 		je	loc_220			; Jump if equal
    3724 129D  E9 1423 R		 		jmp	loc_250			; (1423)
    3725 12A0				loc_220:					;  xref A.1296, 129B
    3726 12A0  53			 		push	bx
    3727 12A1  8B C2			 		mov	ax,dx
    3728 12A3  E8 1259 R		 		call	sub_36			; (1259)
    3729 12A6  74 20			 		jz	loc_224			; Jump if zero
    3730 12A8  2B F0			 		sub	si,ax
    3731 12AA  8A E6			 		mov	ah,dh
    3732 12AC  2A E3			 		sub	ah,bl
    3733 12AE				loc_221:					;  xref A.12B7
    3734 12AE  E8 1280 R		 		call	sub_37			; (1280)
    3735 12B1  2B F5			 		sub	si,bp
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-69


    3736 12B3  2B FD			 		sub	di,bp
    3737 12B5  FE CC			 		dec	ah
    3738 12B7  75 F5			 		jnz	loc_221			; Jump if not zero
    3739 12B9				loc_222:					;  xref A.12CA
    3740 12B9  58			 		pop	ax
    3741 12BA  B0 20			 		mov	al,20h			; ' '
    3742 12BC				loc_223:					;  xref A.12C3
    3743 12BC  E8 1289 R		 		call	sub_38			; (1289)
    3744 12BF  2B FD			 		sub	di,bp
    3745 12C1  FE CB			 		dec	bl
    3746 12C3  75 F7			 		jnz	loc_223			; Jump if not zero
    3747 12C5  E9 123F R		 		jmp	loc_216			; (123F)
    3748 12C8				loc_224:					;  xref A.12A6
    3749 12C8  8A DE			 		mov	bl,dh
    3750 12CA  EB ED			 		jmp	short loc_222		; (12B9)
    3751				
    3752				
    3753				;--- READ AC CURRENT -----------------------------------------------------------
    3754				;a.12cc
    3755 12CC				READ_AC_CURRENT:					;  xref A.0FE1, 101B
    3756 12CC  80 FC 04			 		cmp	ah,4
    3757 12CF  72 08			 		jb	loc_226			; Jump if below
    3758 12D1  80 FC 07			 		cmp	ah,7
    3759 12D4  74 03			 		je	loc_226			; Jump if equal
    3760 12D6  E9 155F R		 		jmp	loc_268			; (155F)
    3761 12D9				loc_226:					;  xref A.12CF, 12D4
    3762 12D9  E8 12F6 R		 		call	sub_39			; (12F6)
    3763 12DC  8B F3			 		mov	si,bx
    3764 12DE  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3765 12E2  83 C2 06			 		add	dx,6
    3766 12E5  06			 		push	es
    3767 12E6  1F			 		pop	ds
    3768 12E7				loc_227:					;  xref A.12EA
    3769 12E7  EC			 		in	al,dx			; port 3DAh, CGA/EGA vid status
    3770 12E8  A8 01			 		test	al,1
    3771 12EA  75 FB			 		jnz	loc_227			; Jump if not zero
    3772 12EC  FA			 		cli				; Disable interrupts
    3773 12ED				loc_228:					;  xref A.12F0
    3774 12ED  EC			 		in	al,dx			; port 3DAh, CGA/EGA vid status
    3775 12EE  A8 01			 		test	al,1
    3776 12F0  74 FB			 		jz	loc_228			; Jump if zero
    3777 12F2  AD			 		lodsw				; String [si] to ax
    3778 12F3  E9 1136 R		 		jmp	loc_200			; (1136)
    3779				
    3780				;===============================================================================
    3781				 ;                              SUBROUTINE
    3782				 ;
    3783				 ;         Called from:   A.12D9, 1323, 1343
    3784				;===============================================================================
    3785				;a.12f6
    3786 12F6				sub_39		proc	near
    3787 12F6  8A CF			 		mov	cl,bh
    3788 12F8  32 ED			 		xor	ch,ch			; Zero register
    3789 12FA  8B F1			 		mov	si,cx
    3790 12FC  D1 E6			 		shl	si,1			; Shift w/zeros fill
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-70


    3791 12FE  8B 84 0050 R		 		mov	ax,ds:vid_curs_pos0[si]	; (0040:0050=184Fh)
    3792 1302  33 DB			 		xor	bx,bx			; Zero register
    3793 1304  E3 06			 		jcxz	loc_230			; Jump if cx=0
    3794				
    3795 1306				locloop_229:					;  xref A.130A
    3796 1306  03 1E 004C R		 		add	bx,ds:video_buf_siz	; (0040:004C=1000h)
    3797 130A  E2 FA			 		loop	locloop_229		; Loop if cx > 0
    3798				
    3799 130C				loc_230:					;  xref A.1304
    3800 130C  E8 11FA R		 		call	sub_35			; (11FA)
    3801 130F  03 D8			 		add	bx,ax
    3802 1311  C3			 		retn
    3803 1312				sub_39		endp
    3804				
    3805				
    3806				;--- WRITE AC CURRENT ----------------------------------------------------------
    3807				;a.1312
    3808 1312				WRITE_AC_CURRENT:					;  xref A.0FE3, 101B
    3809 1312  80 FC 04			 		cmp	ah,4
    3810 1315  72 08			 		jb	loc_232			; Jump if below
    3811 1317  80 FC 07			 		cmp	ah,7
    3812 131A  74 03			 		je	loc_232			; Jump if equal
    3813 131C  E9 14AD R		 		jmp	loc_256			; (14AD)
    3814 131F				loc_232:					;  xref A.1315, 131A
    3815 131F  8A E3			 		mov	ah,bl
    3816 1321  50			 		push	ax
    3817 1322  51			 		push	cx
    3818 1323  E8 12F6 R		 		call	sub_39			; (12F6)
    3819 1326  8B FB			 		mov	di,bx
    3820 1328  59			 		pop	cx
    3821 1329  5B			 		pop	bx
    3822				
    3823 132A				locloop_233:					;  xref A.132F
    3824 132A  FA			 		cli				; Disable interrupts
    3825 132B  8B C3			 		mov	ax,bx
    3826 132D  AB			 		stosw				; Store ax to es:[di]
    3827 132E  FB			 		sti				; Enable interrupts
    3828 132F  E2 F9			 		loop	locloop_233		; Loop if cx > 0
    3829				
    3830 1331  E9 1136 R		 		jmp	loc_200			; (1136)
    3831				
    3832				;--- WRITE C CURRENT -----------------------------------------------------------
    3833				;a.1334
    3834 1334				WRITE_C_CURRENT:					;  xref A.0FE5, 101B
    3835 1334  80 FC 04			 		cmp	ah,4
    3836 1337  72 08			 		jb	loc_235			; Jump if below
    3837 1339  80 FC 07			 		cmp	ah,7
    3838 133C  74 03			 		je	loc_235			; Jump if equal
    3839 133E  E9 14AD R		 		jmp	loc_256			; (14AD)
    3840 1341				loc_235:					;  xref A.1337, 133C
    3841 1341  50			 		push	ax
    3842 1342  51			 		push	cx
    3843 1343  E8 12F6 R		 		call	sub_39			; (12F6)
    3844 1346  8B FB			 		mov	di,bx
    3845 1348  59			 		pop	cx
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-71


    3846 1349  5B			 		pop	bx
    3847				
    3848 134A				locloop_236:					;  xref A.134E
    3849 134A  8A C3			 		mov	al,bl
    3850 134C  AA			 		stosb				; Store al to es:[di]
    3851 134D  47			 		inc	di
    3852 134E  E2 FA			 		loop	locloop_236		; Loop if cx > 0
    3853				
    3854 1350  E9 1136 R		 		jmp	loc_200			; (1136)
    3855				
    3856				;--- READ DOT ------------------------------------------------------------------
    3857				;a.1353
    3858 1353				READ_DOT:					;  xref A.0FEB, 101B
    3859 1353  E8 1387 R		 		call	sub_40			; (1387)
    3860 1356  26: 8A 04		 		mov	al,es:[si]
    3861 1359  22 C4			 		and	al,ah
    3862 135B  D2 E0			 		shl	al,cl			; Shift w/zeros fill
    3863 135D  8A CE			 		mov	cl,dh
    3864 135F  D2 C0			 		rol	al,cl			; Rotate
    3865 1361  E9 1136 R		 		jmp	loc_200			; (1136)
    3866				
    3867				;--- WRITE DOT -----------------------------------------------------------------
    3868				;a.1364
    3869 1364				WRITE_DOT:					;  xref A.0FE9, 101B
    3870 1364  50			 		push	ax
    3871 1365  50			 		push	ax
    3872 1366  E8 1387 R		 		call	sub_40			; (1387)
    3873 1369  D2 E8			 		shr	al,cl			; Shift w/zeros fill
    3874 136B  22 C4			 		and	al,ah
    3875 136D  26: 8A 0C		 		mov	cl,es:[si]
    3876 1370  5B			 		pop	bx
    3877 1371  F6 C3 80			 		test	bl,80h
    3878 1374  75 0D			 		jnz	loc_240			; Jump if not zero
    3879 1376  F6 D4			 		not	ah
    3880 1378  22 CC			 		and	cl,ah
    3881 137A  0A C1			 		or	al,cl
    3882 137C				loc_239:					;  xref A.1385
    3883 137C  26: 88 04		 		mov	es:[si],al
    3884 137F  58			 		pop	ax
    3885 1380  E9 1136 R		 		jmp	loc_200			; (1136)
    3886 1383				loc_240:					;  xref A.1374
    3887 1383  32 C1			 		xor	al,cl
    3888 1385  EB F5			 		jmp	short loc_239		; (137C)
    3889				
    3890				;===============================================================================
    3891				 ;                              SUBROUTINE
    3892				 ;
    3893				 ;         Called from:   A.1353, 1366
    3894				;===============================================================================
    3895				;a.1387
    3896 1387				sub_40		proc	near
    3897 1387  53			 		push	bx
    3898 1388  50			 		push	ax
    3899 1389  B0 28			 		mov	al,28h			; '('
    3900 138B  52			 		push	dx
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-72


    3901 138C  80 E2 FE			 		and	dl,0FEh
    3902 138F  F6 E2			 		mul	dl			; ax = reg * al
    3903 1391  5A			 		pop	dx
    3904 1392  F6 C2 01			 		test	dl,1
    3905 1395  74 03			 		jz	loc_241			; Jump if zero
    3906 1397  05 2000			 		add	ax,2000h
    3907 139A				loc_241:					;  xref A.1395
    3908 139A  8B F0			 		mov	si,ax
    3909 139C  58			 		pop	ax
    3910 139D  8B D1			 		mov	dx,cx
    3911 139F  BB 02C0			 		mov	bx,2C0h
    3912 13A2  B9 0302			 		mov	cx,302h
    3913 13A5  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	; (0040:0049=3)
    3914 13AA  72 06			 		jb	loc_242			; Jump if below
    3915 13AC  BB 0180			 		mov	bx,180h
    3916 13AF  B9 0703			 		mov	cx,703h
    3917 13B2				loc_242:					;  xref A.13AA
    3918 13B2  22 EA			 		and	ch,dl
    3919 13B4  D3 EA			 		shr	dx,cl			; Shift w/zeros fill
    3920 13B6  03 F2			 		add	si,dx
    3921 13B8  8A F7			 		mov	dh,bh
    3922 13BA  2A C9			 		sub	cl,cl
    3923 13BC				loc_243:					;  xref A.13C2
    3924 13BC  D0 C8			 		ror	al,1			; Rotate
    3925 13BE  02 CD			 		add	cl,ch
    3926 13C0  FE CF			 		dec	bh
    3927 13C2  75 F8			 		jnz	loc_243			; Jump if not zero
    3928 13C4  8A E3			 		mov	ah,bl
    3929 13C6  D2 EC			 		shr	ah,cl			; Shift w/zeros fill
    3930 13C8  5B			 		pop	bx
    3931 13C9  C3			 		retn
    3932 13CA				sub_40		endp
    3933				
    3934				;a.13ca
    3935 13CA				loc_244:					;  xref A.1217
    3936 13CA  8A D8			 		mov	bl,al
    3937 13CC  8B C1			 		mov	ax,cx
    3938 13CE  E8 163B R		 		call	sub_47			; (163B)
    3939 13D1  8B F8			 		mov	di,ax
    3940 13D3  2B D1			 		sub	dx,cx
    3941 13D5  81 C2 0101		 		add	dx,101h
    3942 13D9  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3943 13DB  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3944 13DD  80 3E 0049 R 06		 		cmp	byte ptr ds:[video_mode],6	; (A.0049=66h)
    3945 13E2  73 04			 		jae	loc_245			; Jump if above or =
    3946 13E4  D0 E2			 		shl	dl,1			; Shift w/zeros fill
    3947 13E6  D1 E7			 		shl	di,1			; Shift w/zeros fill
    3948 13E8				loc_245:					;  xref A.13E2
    3949 13E8  06			 		push	es
    3950 13E9  1F			 		pop	ds
    3951 13EA  2A ED			 		sub	ch,ch
    3952 13EC  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    3953 13EE  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    3954 13F0  74 2D			 		jz	loc_249			; Jump if zero
    3955 13F2  8A C3			 		mov	al,bl
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-73


    3956 13F4  B4 50			 		mov	ah,50h			; 'P'
    3957 13F6  F6 E4			 		mul	ah			; ax = reg * al
    3958 13F8  8B F7			 		mov	si,di
    3959 13FA  03 F0			 		add	si,ax
    3960 13FC  8A E6			 		mov	ah,dh
    3961 13FE  2A E3			 		sub	ah,bl
    3962 1400				loc_246:					;  xref A.140D
    3963 1400  E8 1483 R		 		call	sub_41			; (1483)
    3964 1403  81 EE 1FB0		 		sub	si,1FB0h
    3965 1407  81 EF 1FB0		 		sub	di,1FB0h
    3966 140B  FE CC			 		dec	ah
    3967 140D  75 F1			 		jnz	loc_246			; Jump if not zero
    3968 140F				loc_247:					;  xref A.1421
    3969 140F  8A C7			 		mov	al,bh
    3970 1411				loc_248:					;  xref A.141A
    3971 1411  E8 149C R		 		call	sub_42			; (149C)
    3972 1414  81 EF 1FB0		 		sub	di,1FB0h
    3973 1418  FE CB			 		dec	bl
    3974 141A  75 F5			 		jnz	loc_248			; Jump if not zero
    3975 141C  E9 1136 R		 		jmp	loc_200			; (1136)
    3976 141F				loc_249:					;  xref A.13F0
    3977 141F  8A DE			 		mov	bl,dh
    3978 1421  EB EC			 		jmp	short loc_247		; (140F)
    3979				;a.1423
    3980 1423				loc_250:					;  xref A.129D
    3981 1423  FD			 		std				; Set direction flag
    3982 1424  8A D8			 		mov	bl,al
    3983 1426  8B C2			 		mov	ax,dx
    3984 1428  E8 163B R		 		call	sub_47			; (163B)
    3985 142B  8B F8			 		mov	di,ax
    3986 142D  2B D1			 		sub	dx,cx
    3987 142F  81 C2 0101		 		add	dx,101h
    3988 1433  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3989 1435  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3990 1437  80 3E 0049 R 06		 		cmp	byte ptr ds:[video_mode],6	; (A.0049=66h)
    3991 143C  73 05			 		jae	loc_251			; Jump if above or =
    3992 143E  D0 E2			 		shl	dl,1			; Shift w/zeros fill
    3993 1440  D1 E7			 		shl	di,1			; Shift w/zeros fill
    3994 1442  47			 		inc	di
    3995				;a.1443
    3996 1443				loc_251:					;  xref A.143C
    3997 1443  06			 		push	es
    3998 1444  1F			 		pop	ds
    3999 1445  2A ED			 		sub	ch,ch
    4000 1447  81 C7 00F0 R		 		add	di,offset data_79+1	; (A.00F0=46h)
    4001 144B  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    4002 144D  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    4003 144F  74 2E			 		jz	loc_255			; Jump if zero
    4004 1451  8A C3			 		mov	al,bl
    4005 1453  B4 50			 		mov	ah,50h			; 'P'
    4006 1455  F6 E4			 		mul	ah			; ax = reg * al
    4007 1457  8B F7			 		mov	si,di
    4008 1459  2B F0			 		sub	si,ax
    4009 145B  8A E6			 		mov	ah,dh
    4010 145D  2A E3			 		sub	ah,bl
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-74


    4011 145F				loc_252:					;  xref A.146C
    4012 145F  E8 1483 R		 		call	sub_41			; (1483)
    4013 1462  81 EE 2050		 		sub	si,2050h
    4014 1466  81 EF 2050		 		sub	di,2050h
    4015 146A  FE CC			 		dec	ah
    4016 146C  75 F1			 		jnz	loc_252			; Jump if not zero
    4017 146E				loc_253:					;  xref A.1481
    4018 146E  8A C7			 		mov	al,bh
    4019 1470				loc_254:					;  xref A.1479
    4020 1470  E8 149C R		 		call	sub_42			; (149C)
    4021 1473  81 EF 2050		 		sub	di,2050h
    4022 1477  FE CB			 		dec	bl
    4023 1479  75 F5			 		jnz	loc_254			; Jump if not zero
    4024 147B  FC			 		cld				; Clear direction
    4025 147C  E9 1136 R		 		jmp	loc_200			; (1136)
    4026 147F				loc_255:					;  xref A.144F
    4027 147F  8A DE			 		mov	bl,dh
    4028 1481  EB EB			 		jmp	short loc_253		; (146E)
    4029				
    4030				;===============================================================================
    4031				 ;                              SUBROUTINE
    4032				 ;
    4033				 ;         Called from:   A.1400, 145F
    4034				;===============================================================================
    4035				;a.1483
    4036 1483				sub_41		proc	near
    4037 1483  8A CA			 		mov	cl,dl
    4038 1485  56			 		push	si
    4039 1486  57			 		push	di
    4040 1487  F3/ A4			 		rep	movsb			; Rep when cx >0 Mov [si] to es:[di]
    4041 1489  5F			 		pop	di
    4042 148A  5E			 		pop	si
    4043 148B  81 C6 2000		 		add	si,2000h		;data_121e (A.2000=0)
    4044 148F  81 C7 2000		 		add	di,2000h		;data_121e (A.2000=0)
    4045 1493  56			 		push	si
    4046 1494  57			 		push	di
    4047 1495  8A CA			 		mov	cl,dl
    4048 1497  F3/ A4			 		rep	movsb			; Rep when cx >0 Mov [si] to es:[di]
    4049 1499  5F			 		pop	di
    4050 149A  5E			 		pop	si
    4051 149B  C3			 		retn
    4052 149C				sub_41		endp
    4053				
    4054				
    4055				;===============================================================================
    4056				 ;                              SUBROUTINE
    4057				 ;
    4058				 ;         Called from:   A.1411, 1470
    4059				;===============================================================================
    4060				;a.149c
    4061 149C				sub_42		proc	near
    4062 149C  8A CA			 		mov	cl,dl
    4063 149E  57			 		push	di
    4064 149F  F3/ AA			 		rep	stosb			; Rep when cx >0 Store al to es:[di]
    4065 14A1  5F			 		pop	di
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-75


    4066 14A2  81 C7 2000		 		add	di,2000h		;data_121e (A.2000=0)
    4067 14A6  57			 		push	di
    4068 14A7  8A CA			 		mov	cl,dl
    4069 14A9  F3/ AA			 		rep	stosb			; Rep when cx >0 Store al to es:[di]
    4070 14AB  5F			 		pop	di
    4071 14AC  C3			 		retn
    4072 14AD				sub_42		endp
    4073				
    4074				;a.14ad
    4075 14AD				loc_256:					;  xref A.131C, 133E
    4076 14AD  B4 00			 		mov	ah,0
    4077 14AF  50			 		push	ax
    4078 14B0  E8 1638 R		 		call	sub_46			; (1638)
    4079 14B3  8B F8			 		mov	di,ax
    4080 14B5  58			 		pop	ax
    4081 14B6  3C 80			 		cmp	al,80h
    4082 14B8  73 06			 		jae	loc_257			; Jump if above or =
    4083 14BA  BE 176D R		 		mov	si,offset GRAFIX	; (C000:176D=0)
    4084 14BD  0E			 		push	cs
    4085 14BE  EB 0F			 		jmp	short loc_258		; (14CF)
    4086 14C0				loc_257:					;  xref A.14B8
    4087 14C0  2C 80			 		sub	al,80h
    4088 14C2  1E			 		push	ds
    4089 14C3  2B F6			 		sub	si,si
    4090 14C5  8E DE			 		mov	ds,si
    4091 14C7  C5 36 007C		 		lds	si,dword ptr ds:Int1Fv	; (0000:007C=5E9h) Load seg:offset ptr
    4092 14CB  8C DA			 		mov	dx,ds
    4093 14CD  1F			 		pop	ds
    4094 14CE  52			 		push	dx
    4095 14CF				loc_258:					;  xref A.14BE
    4096 14CF  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4097 14D1  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4098 14D3  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4099 14D5  03 F0			 		add	si,ax
    4100 14D7  80 3E 0049 R 06		 		cmp	byte ptr ds:[video_mode],6	; (A.0049=66h)
    4101 14DC  1F			 		pop	ds
    4102 14DD  72 2C			 		jc	loc_263			; Jump if carry Set
    4103				
    4104				;a.14df
    4105 14DF				locloop_259:					;  xref A.14FA
    4106 14DF  57			 		push	di
    4107 14E0  56			 		push	si
    4108 14E1  B6 04			 		mov	dh,4
    4109 14E3				loc_260:					;  xref A.14F5
    4110 14E3  AC			 		lodsb				; String [si] to al
    4111 14E4  F6 C3 80			 		test	bl,80h
    4112 14E7  75 16			 		jnz	loc_262			; Jump if not zero
    4113 14E9  AA			 		stosb				; Store al to es:[di]
    4114 14EA  AC			 		lodsb				; String [si] to al
    4115				
    4116				; this is in ROM so storing to the checksum byte shouldn't work
    4117 14EB				loc_261:					;  xref A.1509
    4118 14EB  26: 88 85 1FFF R		 		mov	byte ptr es:cksumb[di],al	; (A.1FFF=0E6h)
    4119 14F0  83 C7 4F			 		add	di,4Fh
    4120 14F3  FE CE			 		dec	dh
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-76


    4121 14F5  75 EC			 		jnz	loc_260			; Jump if not zero
    4122 14F7  5E			 		pop	si
    4123 14F8  5F			 		pop	di
    4124 14F9  47			 		inc	di
    4125 14FA  E2 E3			 		loop	locloop_259		; Loop if cx > 0
    4126				
    4127 14FC  E9 1136 R		 		jmp	loc_200			; (1136)
    4128 14FF				loc_262:					;  xref A.14E7
    4129 14FF  26: 32 05		 		xor	al,es:[di]
    4130 1502  AA			 		stosb				; Store al to es:[di]
    4131 1503  AC			 		lodsb				; String [si] to al
    4132 1504  26: 32 85 1FFF R		 		xor	al,byte ptr es:cksumb[di]	; (A.1FFF=0E6h)
    4133 1509  EB E0			 		jmp	short loc_261		; (14EB)
    4134 150B				loc_263:					;  xref A.14DD
    4135 150B  8A D3			 		mov	dl,bl
    4136 150D  D1 E7			 		shl	di,1			; Shift w/zeros fill
    4137 150F  E8 15E3 R		 		call	sub_43			; (15E3)
    4138				
    4139				;a.1512
    4140 1512				locloop_264:					;  xref A.155A
    4141 1512  57			 		push	di
    4142 1513  56			 		push	si
    4143 1514  B6 04			 		mov	dh,4
    4144 1516				loc_265:					;  xref A.1553
    4145 1516  AC			 		lodsb				; String [si] to al
    4146 1517  E8 15F8 R		 		call	sub_44			; (15F8)
    4147 151A  23 C3			 		and	ax,bx
    4148 151C  F6 C2 80			 		test	dl,80h
    4149 151F  74 07			 		jz	loc_266			; Jump if zero
    4150 1521  26: 32 25		 		xor	ah,es:[di]
    4151 1524  26: 32 45 01		 		xor	al,es:[di+1]
    4152 1528				loc_266:					;  xref A.151F
    4153 1528  26: 88 25		 		mov	es:[di],ah
    4154 152B  26: 88 45 01		 		mov	es:[di+1],al
    4155 152F  AC			 		lodsb				; String [si] to al
    4156 1530  E8 15F8 R		 		call	sub_44			; (15F8)
    4157 1533  23 C3			 		and	ax,bx
    4158 1535  F6 C2 80			 		test	dl,80h
    4159 1538  74 0A			 		jz	loc_267			; Jump if zero
    4160 153A  26: 32 A5 2000		 		xor	ah,es:data_121e[di]	; (A.2000=0)
    4161 153F  26: 32 85 2001		 		xor	al,es:data_122e[di]	; (A.2001=0)
    4162 1544				loc_267:					;  xref A.1538
    4163 1544  26: 88 A5 2000		 		mov	es:data_121e[di],ah	; (A.2000=0)
    4164 1549  26: 88 85 2001		 		mov	es:data_122e[di],al	; (A.2001=0)
    4165 154E  83 C7 50			 		add	di,50h
    4166 1551  FE CE			 		dec	dh
    4167 1553  75 C1			 		jnz	loc_265			; Jump if not zero
    4168 1555  5E			 		pop	si
    4169 1556  5F			 		pop	di
    4170 1557  83 C7 02			 		add	di,2
    4171 155A  E2 B6			 		loop	locloop_264		; Loop if cx > 0
    4172				
    4173 155C  E9 1136 R		 		jmp	loc_200			; (1136)
    4174 155F				loc_268:					;  xref A.12D6
    4175 155F  E8 1638 R		 		call	sub_46			; (1638)
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-77


    4176 1562  8B F0			 		mov	si,ax
    4177 1564  83 EC 08			 		sub	sp,8
    4178 1567  8B EC			 		mov	bp,sp
    4179				;***
    4180 1569  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	;data_123e,6 text 80x25/40x25
    4181 156E  06			 		push	es
    4182 156F  1F			 		pop	ds
    4183 1570  72 1A			 		jc	loc_270			; Jump if carry Set
    4184 1572  B6 04			 		mov	dh,4
    4185				;a.1574
    4186 1574				loc_269:					;  xref A.1587
    4187 1574  8A 04			 		mov	al,[si]
    4188 1576  88 46 00			 		mov	[bp],al
    4189 1579  45			 		inc	bp
    4190 157A  8A 84 2000		 		mov	al,ds:data_121e[si]	; (A.2000=0)
    4191 157E  88 46 00			 		mov	[bp],al
    4192 1581  45			 		inc	bp
    4193 1582  83 C6 50			 		add	si,50h
    4194 1585  FE CE			 		dec	dh
    4195 1587  75 EB			 		jnz	loc_269			; Jump if not zero
    4196 1589  EB 17			 		jmp	short loc_272		; (15A2)
    4197 158B  90			 		db	90h
    4198 158C				loc_270:					;  xref A.1570
    4199 158C  D1 E6			 		shl	si,1			; Shift w/zeros fill
    4200 158E  B6 04			 		mov	dh,4
    4201 1590				loc_271:					;  xref A.15A0
    4202 1590  E8 161B R		 		call	sub_45			; (161B)
    4203 1593  81 C6 2000		 		add	si,2000h		; data_121e (A.2000=0)
    4204 1597  E8 161B R		 		call	sub_45			; (161B)
    4205 159A  81 EE 1FB0		 		sub	si,1FB0h
    4206 159E  FE CE			 		dec	dh
    4207 15A0  75 EE			 		jnz	loc_271			; Jump if not zero
    4208 15A2				loc_272:					;  xref A.1589
    4209 15A2  BF 176D R		 		mov	di,offset GRAFIX		; (C000:176D=0)
    4210 15A5  0E			 		push	cs
    4211 15A6  07			 		pop	es
    4212 15A7  83 ED 08			 		sub	bp,8
    4213 15AA  8B F5			 		mov	si,bp
    4214 15AC  FC			 		cld				; Clear direction
    4215 15AD  B0 00			 		mov	al,0
    4216 15AF				loc_273:					;  xref A.15DB
    4217 15AF  16			 		push	ss
    4218 15B0  1F			 		pop	ds
    4219 15B1  BA 0080			 		mov	dx,80h
    4220				;a.15b4
    4221 15B4				loc_274:					;  xref A.15C5
    4222 15B4  56			 		push	si
    4223 15B5  57			 		push	di
    4224 15B6  B9 0008			 		mov	cx,8
    4225 15B9  F3/ A6			 		repe	cmpsb			; Rep zf=1+cx >0 Cmp [si] to es:[di]
    4226 15BB  5F			 		pop	di
    4227 15BC  5E			 		pop	si
    4228 15BD  74 1E			 		jz	loc_275			; Jump if zero
    4229 15BF  FE C0			 		inc	al
    4230 15C1  83 C7 08			 		add	di,8
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-78


    4231 15C4  4A			 		dec	dx
    4232 15C5  75 ED			 		jnz	loc_274			; Jump if not zero
    4233 15C7  3C 00			 		cmp	al,0
    4234 15C9  74 12			 		je	loc_275			; Jump if equal
    4235 15CB  2B C0			 		sub	ax,ax
    4236 15CD  8E D8			 		mov	ds,ax
    4237 15CF  C4 3E 007C		 		les	di,dword ptr ds:Int1Fv	; (0000:007C=5E9h) Load seg:offset ptr
    4238 15D3  8C C0			 		mov	ax,es
    4239 15D5  0B C7			 		or	ax,di
    4240 15D7  74 04			 		jz	loc_275			; Jump if zero
    4241 15D9  B0 80			 		mov	al,80h
    4242 15DB  EB D2			 		jmp	short loc_273		; (15AF)
    4243 15DD				loc_275:					;  xref A.15BD, 15C9, 15D7
    4244 15DD  83 C4 08			 		add	sp,8
    4245 15E0  E9 1136 R		 		jmp	loc_200			; (1136)
    4246				
    4247				;===============================================================================
    4248				 ;                              SUBROUTINE
    4249				 ;
    4250				 ;         Called from:   A.150F
    4251				;===============================================================================
    4252				;a.15e3
    4253 15E3				sub_43		proc	near
    4254 15E3  80 E3 03			 		and	bl,3
    4255 15E6  8A C3			 		mov	al,bl
    4256 15E8  51			 		push	cx
    4257 15E9  B9 0003			 		mov	cx,3
    4258				
    4259 15EC				locloop_276:					;  xref A.15F2
    4260 15EC  D0 E0			 		shl	al,1			; Shift w/zeros fill
    4261 15EE  D0 E0			 		shl	al,1			; Shift w/zeros fill
    4262 15F0  0A D8			 		or	bl,al
    4263 15F2  E2 F8			 		loop	locloop_276		; Loop if cx > 0
    4264				
    4265 15F4  8A FB			 		mov	bh,bl
    4266 15F6  59			 		pop	cx
    4267 15F7  C3			 		retn
    4268 15F8				sub_43		endp
    4269				
    4270				
    4271				;===============================================================================
    4272				 ;                              SUBROUTINE
    4273				 ;
    4274				 ;         Called from:   A.1517, 1530
    4275				;===============================================================================
    4276				;a.15f8
    4277 15F8				sub_44		proc	near
    4278 15F8  52			 		push	dx
    4279 15F9  51			 		push	cx
    4280 15FA  53			 		push	bx
    4281 15FB  BA 0000			 		mov	dx,0
    4282 15FE  B9 0001			 		mov	cx,1
    4283 1601				loc_277:					;  xref A.1613
    4284 1601  8B D8			 		mov	bx,ax
    4285 1603  23 D9			 		and	bx,cx
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-79


    4286 1605  0B D3			 		or	dx,bx
    4287 1607  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4288 1609  D1 E1			 		shl	cx,1			; Shift w/zeros fill
    4289 160B  8B D8			 		mov	bx,ax
    4290 160D  23 D9			 		and	bx,cx
    4291 160F  0B D1			 		or	dx,cx
    4292 1611  D1 E1			 		shl	cx,1			; Shift w/zeros fill
    4293 1613  73 EC			 		jnc	loc_277			; Jump if carry=0
    4294 1615  8B C2			 		mov	ax,dx
    4295 1617  5B			 		pop	bx
    4296 1618  59			 		pop	cx
    4297 1619  5A			 		pop	dx
    4298 161A  C3			 		retn
    4299 161B				sub_44		endp
    4300				
    4301				
    4302				;===============================================================================
    4303				 ;                              SUBROUTINE
    4304				 ;
    4305				 ;         Called from:   A.1590, 1597
    4306				;===============================================================================
    4307				;a.161b
    4308 161B				sub_45		proc	near
    4309 161B  8A 24			 		mov	ah,[si]
    4310 161D  8A 44 01			 		mov	al,[si+1]
    4311 1620  B9 C000			 		mov	cx,0C000h
    4312 1623  B2 00			 		mov	dl,0
    4313 1625				loc_278:					;  xref A.1631
    4314 1625  85 C1			 		test	ax,cx
    4315 1627  F8			 		clc				; Clear carry flag
    4316 1628  74 01			 		jz	loc_279			; Jump if zero
    4317 162A  F9			 		stc				; Set carry flag
    4318 162B				loc_279:					;  xref A.1628
    4319 162B  D0 D2			 		rcl	dl,1			; Rotate thru carry
    4320 162D  D1 E9			 		shr	cx,1			; Shift w/zeros fill
    4321 162F  D1 E9			 		shr	cx,1			; Shift w/zeros fill
    4322 1631  73 F2			 		jnc	loc_278			; Jump if carry=0
    4323 1633  88 56 00			 		mov	[bp],dl
    4324 1636  45			 		inc	bp
    4325 1637  C3			 		retn
    4326 1638				sub_45		endp
    4327				
    4328				
    4329				;===============================================================================
    4330				 ;                              SUBROUTINE
    4331				 ;
    4332				 ;         Called from:   A.14B0, 155F
    4333				;===============================================================================
    4334				;a.1638
    4335 1638				sub_46		proc	near
    4336 1638  A1 0050 R		 		mov	ax,word ptr ds:[vid_curs_pos0]	; (A.0050=74AAh) cursor position
    4337				
    4338				; External Entry into Subroutine 
					
    4339				 ;
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-80


    4340				 ;         Called from:   A.13CE, 1428
    4341				;a.163b
    4342 163B				sub_47:
    4343 163B  53			 		push	bx
    4344 163C  8B D8			 		mov	bx,ax
    4345 163E  8A C4			 		mov	al,ah
    4346 1640  F6 26 004A R		 		mul	byte ptr ds:[video_columns]	; (A.004A=0) ax = data * al columns
    4347 1644  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4348 1646  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4349 1648  2A FF			 		sub	bh,bh
    4350 164A  03 C3			 		add	ax,bx
    4351 164C  5B			 		pop	bx
    4352 164D  C3			 		retn
    4353 164E				sub_46		endp
    4354				
    4355				;--- WRITE TTY ------------------------------------------------------------------
    4356				;a.164e
    4357 164E				WRITE_TTY:					;  xref A.0FED, 101B
    4358 164E  50			 		push	ax
    4359 164F  50			 		push	ax
    4360 1650  B4 03			 		mov	ah,3
    4361 1652  CD 10			 		int	10h			; Video display   ah=functn 03h
    4362				 						;  get cursor loc in dx, mode cx
    4363 1654  58			 		pop	ax
    4364 1655  3C 08			 		cmp	al,8
    4365 1657  74 59			 		je	loc_288			; Jump if equal
    4366 1659  3C 0D			 		cmp	al,0Dh
    4367 165B  74 5E			 		je	loc_289			; Jump if equal
    4368 165D  3C 0A			 		cmp	al,0Ah
    4369 165F  74 5E			 		je	loc_290			; Jump if equal
    4370 1661  3C 07			 		cmp	al,7
    4371 1663  74 61			 		je	loc_291			; Jump if equal
    4372 1665  8A 3E 0062 R		 		mov	bh,ds:video_page	; (0040:0062=0)
    4373 1669  B4 0A			 		mov	ah,0Ah
    4374 166B  B9 0001			 		mov	cx,1
    4375 166E  CD 10			 		int	10h			; Video display   ah=functn 0Ah
    4376				 						;  set char al at present curs
    4377				 						;   cx=# of chars to replicate
    4378 1670  FE C2			 		inc	dl
    4379 1672  3A 16 004A R		 		cmp	dl,byte ptr ds:video_columns	; (0040:004A=50h)
    4380 1676  75 36			 		jne	loc_287			; Jump if not equal
    4381 1678  B2 00			 		mov	dl,0
    4382 167A  80 FE 18			 		cmp	dh,18h
    4383 167D  75 2D			 		jne	loc_286			; Jump if not equal
    4384 167F				loc_281:					;  xref A.16C4
    4385 167F  B4 02			 		mov	ah,2
    4386 1681  B7 00			 		mov	bh,0
    4387 1683  CD 10			 		int	10h			; Video display   ah=functn 02h
    4388				 						;  set cursor location in dx
    4389 1685  A0 0049 R		 		mov	al,byte ptr ds:[video_mode]	; (A.0049=66h)
    4390 1688  3C 04			 		cmp	al,4
    4391 168A  72 06			 		jb	loc_282			; Jump if below
    4392 168C  3C 07			 		cmp	al,7
    4393 168E  B7 00			 		mov	bh,0
    4394 1690  75 06			 		jnz	loc_283			; Jump if not zero
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-81


    4395 1692				loc_282:					;  xref A.168A
    4396 1692  B4 08			 		mov	ah,8
    4397 1694  CD 10			 		int	10h			; Video display   ah=functn 08h
    4398				 						;  get char al & attrib ah @curs
    4399 1696  8A FC			 		mov	bh,ah
    4400 1698				loc_283:					;  xref A.1690
    4401 1698  B8 0601			 		mov	ax,601h
    4402 169B  B9 0000			 		mov	cx,0
    4403 169E  B6 18			 		mov	dh,18h
    4404 16A0  8A 16 004A R		 		mov	dl,byte ptr ds:[video_columns]	; (A.004A=0)
    4405 16A4  FE CA			 		dec	dl
    4406 16A6				loc_284:					;  xref A.16B0
    4407 16A6  CD 10			 		int	10h			; Video display   ah=functn 02h
    4408				 						;  set cursor location in dx
    4409				;a.16a8
    4410 16A8				loc_285:					;  xref A.16CB
    4411 16A8  58			 		pop	ax
    4412 16A9  E9 1136 R		 		jmp	loc_200			; (1136)
    4413 16AC				loc_286:					;  xref A.167D, 16C2
    4414 16AC  FE C6			 		inc	dh
    4415 16AE				loc_287:					;  xref A.1676, 16B5, 16B9, 16BD
    4416 16AE  B4 02			 		mov	ah,2
    4417 16B0  EB F4			 		jmp	short loc_284		; (16A6)
    4418 16B2				loc_288:					;  xref A.1657
    4419 16B2  80 FA 00			 		cmp	dl,0
    4420 16B5  74 F7			 		je	loc_287			; Jump if equal
    4421 16B7  FE CA			 		dec	dl
    4422 16B9  EB F3			 		jmp	short loc_287		; (16AE)
    4423 16BB				loc_289:					;  xref A.165B
    4424 16BB  B2 00			 		mov	dl,0
    4425 16BD  EB EF			 		jmp	short loc_287		; (16AE)
    4426 16BF				loc_290:					;  xref A.165F
    4427 16BF  80 FE 18			 		cmp	dh,18h
    4428 16C2  75 E8			 		jne	loc_286			; Jump if not equal
    4429 16C4  EB B9			 		jmp	short loc_281		; (167F)
    4430 16C6				loc_291:					;  xref A.1663
    4431 16C6  B3 02			 		mov	bl,2
    4432 16C8  E8 05C3 R		 		call	BEEP			; (05C3)
    4433 16CB  EB DB			 		jmp	short loc_285		; (16A8)
    4434				
    4435				;a.16cd
    4436				;Light Pen offset table
    4437 16CD  03 03 05 05 03 03	PENOFF:	db	3, 3, 5, 5, 3, 3, 3, 4		; Data table (indexed access) xref A.1704
    4438       03 04			
    4439				     		
    4440				
    4441				;--- READ LPEN -----------------------------------------------------------------
    4442				;a.16d5
    4443 16D5				READ_LPEN:					;  xref A.0FD9, 101B
    4444 16D5  B4 00			 		mov	ah,0
    4445 16D7  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    4446 16DB  83 C2 06			 		add	dx,6
    4447 16DE  EC			 		in	al,dx			; port 3DAh, CGA/EGA vid status
    4448 16DF  A8 04			 		test	al,4
    4449 16E1  75 78			 		jnz	loc_297			; Jump if not zero
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-82


    4450 16E3  A8 02			 		test	al,2
    4451 16E5  74 7E			 		jz	loc_298			; Jump if zero
    4452 16E7  B4 10			 		mov	ah,10h
    4453 16E9  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    4454 16ED  8A C4			 		mov	al,ah
    4455 16EF  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    4456				 						;  al = 10h, light pen high
    4457 16F0  42			 		inc	dx
    4458 16F1  EC			 		in	al,dx			; port 3D5h, CGA/EGA indxd data
    4459 16F2  8A E8			 		mov	ch,al
    4460 16F4  4A			 		dec	dx
    4461 16F5  FE C4			 		inc	ah
    4462 16F7  8A C4			 		mov	al,ah
    4463 16F9  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    4464				 						;  al = 11h, light pen low
    4465 16FA  42			 		inc	dx
    4466 16FB  EC			 		in	al,dx			; port 3D5h, CGA/EGA indxd data
    4467 16FC  8A E5			 		mov	ah,ch
    4468 16FE  8A 1E 0049 R		 		mov	bl,ds:video_mode	; (0040:0049=3)
    4469 1702  2A FF			 		sub	bh,bh
    4470 1704  2E: 8A 9F 16CD R		 		mov	bl,byte ptr cs:PENOFF[bx]	; (A.16CD=3)
    4471 1709  2B C3			 		sub	ax,bx
    4472 170B  2B 06 004E R		 		sub	ax,ds:video_segment	; (0040:004E=0)
    4473 170F  79 03			 		jns	loc_293			; Jump if not sign
    4474 1711  B8 0000			 		mov	ax,0
    4475				;a.1714
    4476 1714				loc_293:					;  xref A.170F
    4477 1714  B1 03			 		mov	cl,3
    4478 1716  80 3E 0049 R 04		 		cmp	byte ptr ds:video_mode,4	; (0040:0049=3)
    4479 171B  72 2A			 		jb	loc_295			; Jump if below
    4480 171D  80 3E 0049 R 07		 		cmp	byte ptr ds:video_mode,7	; (0040:0049=3)
    4481 1722  74 23			 		je	loc_295			; Jump if equal
    4482 1724  B2 28			 		mov	dl,28h			; '('
    4483 1726  F6 F2			 		div	dl			; al, ah rem = ax/reg
    4484 1728  8A E8			 		mov	ch,al
    4485 172A  02 ED			 		add	ch,ch
    4486 172C  8A DC			 		mov	bl,ah
    4487 172E  2A FF			 		sub	bh,bh
    4488 1730  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	; (0040:0049=3)
    4489 1735  75 04			 		jne	loc_294			; Jump if not equal
    4490 1737  B1 04			 		mov	cl,4
    4491 1739  D0 E4			 		shl	ah,1			; Shift w/zeros fill
    4492 173B				loc_294:					;  xref A.1735
    4493 173B  D3 E3			 		shl	bx,cl			; Shift w/zeros fill
    4494 173D  8A D4			 		mov	dl,ah
    4495 173F  8A F0			 		mov	dh,al
    4496 1741  D0 EE			 		shr	dh,1			; Shift w/zeros fill
    4497 1743  D0 EE			 		shr	dh,1			; Shift w/zeros fill
    4498 1745  EB 12			 		jmp	short loc_296		; (1759)
    4499 1747				loc_295:					;  xref A.171B, 1722
    4500 1747  F6 36 004A R		 		div	byte ptr ds:video_columns	; (0040:004A=50h) al,ah rem = ax/dat
					a
    4501 174B  8A F0			 		mov	dh,al
    4502 174D  8A D4			 		mov	dl,ah
    4503 174F  D2 E0			 		shl	al,cl			; Shift w/zeros fill
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-83


    4504 1751  8A E8			 		mov	ch,al
    4505 1753  8A DC			 		mov	bl,ah
    4506 1755  32 FF			 		xor	bh,bh			; Zero register
    4507 1757  D3 E3			 		shl	bx,cl			; Shift w/zeros fill
    4508				;a.1759
    4509 1759				loc_296:					;  xref A.1745
    4510 1759  B4 01			 		mov	ah,1
    4511 175B				loc_297:					;  xref A.16E1
    4512 175B  52			 		push	dx
    4513 175C  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    4514 1760  83 C2 07			 		add	dx,7
    4515 1763  EE			 		out	dx,al			; port 3DBh, CGA light pen clr
    4516 1764  5A			 		pop	dx
    4517 1765				loc_298:					;  xref A.16E5
    4518 1765  5F			 		pop	di
    4519 1766  5E			 		pop	si
    4520 1767  1F			 		pop	ds
    4521 1768  1F			 		pop	ds
    4522 1769  1F			 		pop	ds
    4523 176A  1F			 		pop	ds
    4524 176B  07			 		pop	es
    4525 176C  CF			 		iret				; Interrupt return
    4526				
    4527				;-----------------------------------------------------------------------
    4528				;	CHARACTER GENERATOR GRAPHICS FOR 320X200 AND 640X200 GRAPHICS
    4529				;-----------------------------------------------------------------------
    4530				;	ORG	0FA6EH
    4531				; Looks like it runs to FE6Dh (400h bytes) in the PC. Data is in 8-byte lines.
    4532				; Cut and pasted from the PCBIOS because they're grouped in 8-byte lines and
    4533				; have the character code. I edited certain ones to match CM5 (certain bytes
    4534				; don't match - most are 7Eh swapped for 73h).
    4535				
    4536				 ;a.176d
    4537 176D				GRAFIX:
    4538 176D  00 00 00 00 00 00			db	000H,000H,000H,000H,000H,000H,000H,000H ; D_00 x
    4539       00 00			
    4540 1775  73 81 A5 81 BD 99			db	073H,081H,0A5H,081H,0BDH,099H,081H,073H ; D_01 x
    4541       81 73			
    4542 177D  73 FF DB FF C3 E7			db	073H,0FFH,0DBH,0FFH,0C3H,0E7H,0FFH,07EH ; D_02 x
    4543       FF 7E			
    4544 1785  6C FE FE FE 7C 38			db	06CH,0FEH,0FEH,0FEH,07CH,038H,010H,000H ; D_03 x 
    4545       10 00			
    4546				
    4547 178D  10 38 7C FE 7C 38			db	010H,038H,07CH,0FEH,07CH,038H,010H,008H ; D_04 x
    4548       10 08			
    4549 1795  38 7C 38 FE FE 7C			db	038H,07CH,038H,0FEH,0FEH,07CH,038H,07CH ; D_05 x
    4550       38 7C			
    4551 179D  10 10 38 7C FE 7C			db	010H,010H,038H,07CH,0FEH,07CH,038H,07CH ; D_06 x
    4552       38 7C			
    4553 17A5  00 00 18 3C 3C 18			db	000H,000H,018H,03CH,03CH,018H,000H,000H ; D_07 x
    4554       00 00			
    4555				
    4556 17AD  FF FF E7 C3 C3 E7			db	0FFH,0FFH,0E7H,0C3H,0C3H,0E7H,0FFH,0FFH ; D_08 x
    4557       FF FF			
    4558 17B5  00 3C 66 42 42 66			db	000H,03CH,066H,042H,042H,066H,03CH,000H ; D_09 x
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-84


    4559       3C 00			
    4560 17BD  FF C3 99 BD B0 99			db	0FFH,0C3H,099H,0BDH,0B0H,099H,0C3H,0FFH ; D_0A x
    4561       C3 FF			
    4562 17C5  0F 07 0F 7D CC CC			db	00FH,007H,00FH,07DH,0CCH,0CCH,0CCH,078H ; D_08 x
    4563       CC 78			
    4564				
    4565 17CD  3C 66 66 66 3C 18			db	03CH,066H,066H,066H,03CH,018H,07EH,018H ; D_0C x
    4566       7E 18			
    4567 17D5  3F 3F 3F 30 30 70			db	03FH,03FH,03FH,030H,030H,070H,0F0H,0E0H ; D_0D x
    4568       F0 E0			
    4569 17DD  7F 63 7F 63 63 67			db	07FH,063H,07FH,063H,063H,067H,0E6H,0C0H ; D_0E x
    4570       E6 C0			
    4571 17E5  99 5A 3C E7 E7 3C			db	099H,05AH,03CH,0E7H,0E7H,03CH,05AH,099H ; D_0F x
    4572       5A 99			
    4573				
    4574 17ED  80 E0 F8 FE F8 E0			db	080H,0E0H,0F8H,0FEH,0F8H,0E0H,080H,000H ; D_10
    4575       80 00			
    4576 17F5  02 0E 3E FE 3E 0E			db	002H,00EH,03EH,0FEH,03EH,00EH,002H,000H ; D_11
    4577       02 00			
    4578 17FD  18 3C 7E 18 18 7E			db	018H,03CH,07EH,018H,018H,07EH,03CH,018H ; D_12
    4579       3C 18			
    4580 1805  66 66 66 66 66 00			db	066H,066H,066H,066H,066H,000H,066H,000H ; D_13
    4581       66 00			
    4582						
    4583 180D  7F DB DB 7B 1B 1B			db	07FH,0DBH,0DBH,07BH,01BH,01BH,01BH,000H ; D_14
    4584       1B 00			
    4585 1815  3E 63 38 6C 6C 38			db	03EH,063H,038H,06CH,06CH,038H,0CCH,078H ; D_15
    4586       CC 78			
    4587 181D  00 00 00 00 7E 7E			db	000H,000H,000H,000H,07EH,07EH,07EH,000H ; D_16
    4588       7E 00			
    4589 1825  18 3C 7E 18 7E 3C			db	018H,03CH,07EH,018H,07EH,03CH,018H,0FFH ; D_17
    4590       18 FF			
    4591				
    4592 182D  18 3C 7E 18 18 18			db	018H,03CH,07EH,018H,018H,018H,018H,000H ; D_18
    4593       18 00			
    4594 1835  18 18 18 18 73 3C			db	018H,018H,018H,018H,073H,03CH,018H,000H ; D_19
    4595       18 00			
    4596 183D  00 18 0C FE 0C 18			db	000H,018H,00CH,0FEH,00CH,018H,000H,000H ; D_1A
    4597       00 00			
    4598 1845  00 30 60 FE 60 30			db	000H,030H,060H,0FEH,060H,030H,000H,000H ; D_1B
    4599       00 00			
    4600				
    4601 184D  00 00 C0 C0 C0 FE			db	000H,000H,0C0H,0C0H,0C0H,0FEH,000H,000H ; D_1C
    4602       00 00			
    4603 1855  00 24 66 FF 66 24			db	000H,024H,066H,0FFH,066H,024H,000H,000H ; D_1D
    4604       00 00			
    4605 185D  00 18 3C 7E FF FF			db	000H,018H,03CH,07EH,0FFH,0FFH,000H,000H ; D_1E
    4606       00 00			
    4607 1865  00 FF FF 7E 3C 18			db	000H,0FFH,0FFH,07EH,03CH,018H,000H,000H ; D_1F
    4608       00 00			
    4609				
    4610 186D  00 00 00 00 00 00			db	000H,000H,000H,000H,000H,000H,000H,000H ; SP D_20
    4611       00 00			
    4612 1875  30 78 78 30 30 00			db	030H,078H,078H,030H,030H,000H,030H,000H ; ! D_21
    4613       30 00			
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-85


    4614 187D  6C 6C 6C 00 00 00			db	06CH,06CH,06CH,000H,000H,000H,000H,000H ; " D_22
    4615       00 00			
    4616 1885  6C 6C FE 6C FE 6C			db	06CH,06CH,0FEH,06CH,0FEH,06CH,06CH,000H ; # D_23
    4617       6C 00			
    4618				
    4619 188D  30 7C C0 78 0C F8			db	030H,07CH,0C0H,078H,00CH,0F8H,030H,000H ; $ D_24
    4620       30 00			
    4621 1895  00 C6 CC 18 30 66			db	000H,0C6H,0CCH,018H,030H,066H,0C6H,000H ; PER CENT D_25
    4622       C6 00			
    4623 189D  38 6C 38 76 DC CC			db	038H,06CH,038H,076H,0DCH,0CCH,076H,000H ; & D_26
    4624       76 00			
    4625 18A5  60 60 C0 00 00 00			db	060H,060H,0C0H,000H,000H,000H,000H,000H ; ' D_27
    4626       00 00			
    4627				
    4628 18AD  18 30 60 60 60 30			db	018H,030H,060H,060H,060H,030H,018H,000H ; ( D_28
    4629       18 00			
    4630 18B5  60 30 18 18 18 30			db	060H,030H,018H,018H,018H,030H,060H,000H ; ) D_29
    4631       60 00			
    4632 18BD  00 66 3C FF 3C 66			db	000H,066H,03CH,0FFH,03CH,066H,000H,000H ; * D_2A
    4633       00 00			
    4634 18C5  00 30 30 FC 30 30			db	000H,030H,030H,0FCH,030H,030H,000H,000H ; + D_2B
    4635       00 00			
    4636				
    4637 18CD  00 00 00 00 00 30			db	000H,000H,000H,000H,000H,030H,030H,060H ; , D_2C
    4638       30 60			
    4639 18D5  00 00 00 FC 00 00			db	000H,000H,000H,0FCH,000H,000H,000H,000H ; - D_2D
    4640       00 00			
    4641 18DD  00 00 00 00 00 30			db	000H,000H,000H,000H,000H,030H,030H,000H ; . D_2E
    4642       30 00			
    4643 18E5  06 0C 18 30 60 C0			db	006H,00CH,018H,030H,060H,0C0H,080H,000H ; / D_2F
    4644       80 00			
    4645				
    4646 18ED  7C C6 CE DE F6 E6			db	07CH,0C6H,0CEH,0DEH,0F6H,0E6H,07CH,000H ; 0 D_30
    4647       7C 00			
    4648 18F5  30 70 30 30 30 30			db	030H,070H,030H,030H,030H,030H,0FCH,000H ; 1 D_31
    4649       FC 00			
    4650 18FD  78 CC 0C 38 60 CC			db	078H,0CCH,00CH,038H,060H,0CCH,0FCH,000H ; 2 D_32
    4651       FC 00			
    4652 1905  78 CC 0C 38 0C CC			db	078H,0CCH,00CH,038H,00CH,0CCH,078H,000H ; 3 D_33
    4653       78 00			
    4654				
    4655 190D  1C 3C 6C CC FE 0C			db	01CH,03CH,06CH,0CCH,0FEH,00CH,01EH,000H ; 4 D_34
    4656       1E 00			
    4657 1915  FC C0 F8 0C 0C CC			db	0FCH,0C0H,0F8H,00CH,00CH,0CCH,078H,000H ; 5 D_35
    4658       78 00			
    4659 191D  38 60 C0 F8 CC CC			db	038H,060H,0C0H,0F8H,0CCH,0CCH,078H,000H ; 6 D_36
    4660       78 00			
    4661 1925  FC CC 0C 18 30 30			db	0FCH,0CCH,00CH,018H,030H,030H,030H,000H ; 7 D_37
    4662       30 00			
    4663				
    4664 192D  78 CC CC 78 CC CC			db	078H,0CCH,0CCH,078H,0CCH,0CCH,078H,000H ; 8 D_38
    4665       78 00			
    4666 1935  78 CC CC 7C 0C 18			db	078H,0CCH,0CCH,07CH,00CH,018H,070H,000H ; 9 D_39
    4667       70 00			
    4668 193D  00 30 30 00 00 30			db	000H,030H,030H,000H,000H,030H,030H,000H ; : D_3A
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-86


    4669       30 00			
    4670 1945  00 30 30 00 00 30			db	000H,030H,030H,000H,000H,030H,030H,060H ; ; D_3B
    4671       30 60			
    4672				
    4673 194D  18 30 60 C0 60 30			db	018H,030H,060H,0C0H,060H,030H,018H,000H ; < D_3C
    4674       18 00			
    4675 1955  00 00 FC 00 00 FC			db	000H,000H,0FCH,000H,000H,0FCH,000H,000H ; = D_3D
    4676       00 00			
    4677 195D  60 30 18 0C 18 30			db	060H,030H,018H,00CH,018H,030H,060H,000H ; > D_3E
    4678       60 00			
    4679 1965  78 CC 0C 18 30 00			db	078H,0CCH,00CH,018H,030H,000H,030H,000H ; ? D_3F
    4680       30 00			
    4681				
    4682 196D  7C C6 DE DE DE C0			db	07CH,0C6H,0DEH,0DEH,0DEH,0C0H,078H,000H ; @ D_40
    4683       78 00			
    4684 1975  30 78 CC CC FC CC			db	030H,078H,0CCH,0CCH,0FCH,0CCH,0CCH,000H ; A D_41
    4685       CC 00			
    4686 197D  FC 66 66 7C 66 66			db	0FCH,066H,066H,07CH,066H,066H,0FCH,000H ; B D_42
    4687       FC 00			
    4688 1985  3C 66 C0 C0 C0 66			db	03CH,066H,0C0H,0C0H,0C0H,066H,03CH,000H ; C D_43
    4689       3C 00			
    4690				
    4691 198D  F8 6C 66 66 66 6C			db	0F8H,06CH,066H,066H,066H,06CH,0F8H,000H ; D D_44
    4692       F8 00			
    4693 1995  FE 62 68 78 68 62			db	0FEH,062H,068H,078H,068H,062H,0FEH,000H ; E D_45
    4694       FE 00			
    4695 199D  FE 62 68 78 68 60			db	0FEH,062H,068H,078H,068H,060H,0F0H,000H ; F D_46
    4696       F0 00			
    4697 19A5  3C 66 C0 C0 CE 66			db	03CH,066H,0C0H,0C0H,0CEH,066H,03EH,000H ; G D_47
    4698       3E 00			
    4699				
    4700 19AD  CC CC CC FC CC CC			db	0CCH,0CCH,0CCH,0FCH,0CCH,0CCH,0CCH,000H ; H D_48
    4701       CC 00			
    4702 19B5  78 30 30 30 30 30			db	078H,030H,030H,030H,030H,030H,078H,000H ; I D_49
    4703       78 00			
    4704 19BD  1E 0C 0C 0C CC CC			db	01EH,00CH,00CH,00CH,0CCH,0CCH,078H,000H ; J D_4A
    4705       78 00			
    4706 19C5  E6 66 6C 78 6C 66			db	0E6H,066H,06CH,078H,06CH,066H,0E6H,000H ; K D_4B
    4707       E6 00			
    4708				
    4709 19CD  F0 60 60 60 62 66			db	0F0H,060H,060H,060H,062H,066H,0FEH,000H ; L D_4C
    4710       FE 00			
    4711 19D5  C6 EE FE FE D6 C6			db	0C6H,0EEH,0FEH,0FEH,0D6H,0C6H,0C6H,000H ; M D_4C
    4712       C6 00			
    4713 19DD  C6 E6 F6 DE CE C6			db	0C6H,0E6H,0F6H,0DEH,0CEH,0C6H,0C6H,000H ; N D_4E
    4714       C6 00			
    4715 19E5  38 6C C6 C6 C6 6C			db	038H,06CH,0C6H,0C6H,0C6H,06CH,038H,000H ; O D_4F
    4716       38 00			
    4717				
    4718 19ED  FC 66 66 7C 60 60			db	0FCH,066H,066H,07CH,060H,060H,0F0H,000H ; P D_50
    4719       F0 00			
    4720 19F5  78 CC CC CC DC 78			db	078H,0CCH,0CCH,0CCH,0DCH,078H,01CH,000H ; Q D_51
    4721       1C 00			
    4722 19FD  FC 66 66 7C 6C 66			db	0FCH,066H,066H,07CH,06CH,066H,0E6H,000H ; R D_52
    4723       E6 00			
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-87


    4724 1A05  78 CC E0 70 1C CC			db	078H,0CCH,0E0H,070H,01CH,0CCH,078H,000H ; S D_53
    4725       78 00			
    4726				
    4727 1A0D  FC B4 30 30 30 30			db	0FCH,0B4H,030H,030H,030H,030H,078H,000H ; T D_54
    4728       78 00			
    4729 1A15  CC CC CC CC CC CC			db	0CCH,0CCH,0CCH,0CCH,0CCH,0CCH,0FCH,000H ; U D_55
    4730       FC 00			
    4731 1A1D  CC CC CC CC CC 78			db	0CCH,0CCH,0CCH,0CCH,0CCH,078H,0C0H,000H ; V D_56
    4732       C0 00			
    4733 1A25  C6 C6 C6 D6 FE EE			db	0C6H,0C6H,0C6H,0D6H,0FEH,0EEH,0C6H,000H ; W D_57
    4734       C6 00			
    4735				
    4736 1A2D  C6 C6 6C 38 38 6C			db	0C6H,0C6H,06CH,038H,038H,06CH,0C6H,000H ; X D_58
    4737       C6 00			
    4738 1A35  CC CC CC 78 30 30			db	0CCH,0CCH,0CCH,078H,030H,030H,078H,000H ; Y D_59
    4739       78 00			
    4740 1A3D  FE C6 8C 18 32 66			db	0FEH,0C6H,08CH,018H,032H,066H,0FEH,000H ; Z D_5A
    4741       FE 00			
    4742 1A45  78 60 60 60 60 60			db	078H,060H,060H,060H,060H,060H,078H,000H ; [ D_5B
    4743       78 00			
    4744				
    4745 1A4D  C0 60 30 18 0C 06			db	0C0H,060H,030H,018H,00CH,006H,002H,000H ; BACKSLASH D_5C
    4746       02 00			
    4747 1A55  78 18 18 18 18 18			db	078H,018H,018H,018H,018H,018H,078H,000H ; ] D_5D
    4748       78 00			
    4749 1A5D  10 38 6C C6 00 00			db	010H,038H,06CH,0C6H,000H,000H,000H,000H ; CIRCUMFLEX D_5E
    4750       00 00			
    4751 1A65  00 00 00 00 00 00			db	000H,000H,000H,000H,000H,000H,000H,0FFH ; _ D_5F
    4752       00 FF			
    4753				
    4754 1A6D  30 30 18 00 00 00			db	030H,030H,018H,000H,000H,000H,000H,000H ;   D_60
    4755       00 00			
    4756 1A75  00 00 78 0C 7C CC			db	000H,000H,078H,00CH,07CH,0CCH,076H,000H ; LOWER CASE A D_61
    4757       76 00			
    4758 1A7D  E0 60 60 7C 66 66			db	0E0H,060H,060H,07CH,066H,066H,0DCH,000H ; L.C. B D_62
    4759       DC 00			
    4760 1A85  00 00 78 CC C0 CC			db	000H,000H,078H,0CCH,0C0H,0CCH,078H,000H ; L.C. C D_63
    4761       78 00			
    4762				
    4763 1A8D  1C 0C 0C 7C CC CC			db	01CH,00CH,00CH,07CH,0CCH,0CCH,076H,000H ; L.C. D D_64
    4764       76 00			
    4765 1A95  00 00 78 CC FC C0			db	000H,000H,078H,0CCH,0FCH,0C0H,078H,000H ; L.C. E D_65
    4766       78 00			
    4767 1A9D  38 6C 60 F0 60 60			db	038H,06CH,060H,0F0H,060H,060H,0F0H,000H ; L.C. F D_66
    4768       F0 00			
    4769 1AA5  00 00 76 CC CC 7C			db	000H,000H,076H,0CCH,0CCH,07CH,00CH,0F8H ; L.C. G D_67
    4770       0C F8			
    4771				
    4772 1AAD  E0 60 6C 76 66 66			db	0E0H,060H,06CH,076H,066H,066H,0E6H,000H ; L.C. H D_68
    4773       E6 00			
    4774 1AB5  30 00 70 30 30 30			db	030H,000H,070H,030H,030H,030H,078H,000H ; L.C. I D_69
    4775       78 00			
    4776 1ABD  0C 00 0C 0C 0C CC			db	00CH,000H,00CH,00CH,00CH,0CCH,0CCH,078H ; L.C. J D_6A
    4777       CC 78			
    4778 1AC5  E0 60 66 6C 78 6C			db	0E0H,060H,066H,06CH,078H,06CH,0E6H,000H ; L.C. K D_6B
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-88


    4779       E6 00			
    4780				
    4781 1ACD  70 30 30 30 30 30			db	070H,030H,030H,030H,030H,030H,078H,000H ; L.C. L D_6C
    4782       78 00			
    4783 1AD5  00 00 CC FE FE D6			db	000H,000H,0CCH,0FEH,0FEH,0D6H,0C6H,000H ; L.C. M D_6D
    4784       C6 00			
    4785 1ADD  00 00 F8 CC CC CC			db	000H,000H,0F8H,0CCH,0CCH,0CCH,0CCH,000H ; L.C. N D_6E
    4786       CC 00			
    4787 1AE5  00 00 78 CC CC CC			db	000H,000H,078H,0CCH,0CCH,0CCH,078H,000H ; L.C. O D_6F
    4788       78 00			
    4789				
    4790 1AED  00 00 DC 66 66 7C			db	000H,000H,0DCH,066H,066H,07CH,060H,0F0H ; L.C. P D_70
    4791       60 F0			
    4792 1AF5  00 00 76 CC CC 7C			db	000H,000H,076H,0CCH,0CCH,07CH,00CH,01EH ; L.C. Q D_71
    4793       0C 1E			
    4794 1AFD  00 00 DC 76 66 60			db	000H,000H,0DCH,076H,066H,060H,0F0H,000H ; L.C. R D_72
    4795       F0 00			
    4796 1B05  00 00 7C C0 78 0C			db	000H,000H,07CH,0C0H,078H,00CH,0F8H,000H ; L.C. S D_73
    4797       F8 00			
    4798				
    4799 1B0D  10 30 7C 30 30 34			db	010H,030H,07CH,030H,030H,034H,018H,000H ; L.C. T D_74
    4800       18 00			
    4801 1B15  00 00 CC CC CC CC			db	000H,000H,0CCH,0CCH,0CCH,0CCH,076H,000H ; L.C. U D_75
    4802       76 00			
    4803 1B1D  00 00 CC CC CC 78			db	000H,000H,0CCH,0CCH,0CCH,078H,030H,000H ; L.C. V D_76
    4804       30 00			
    4805 1B25  00 00 C6 D6 FE FE			db	000H,000H,0C6H,0D6H,0FEH,0FEH,06CH,000H ; L.C. W D_77
    4806       6C 00			
    4807				
    4808 1B2D  00 00 C6 6C 38 6C			db	000H,000H,0C6H,06CH,038H,06CH,0C6H,000H ; L.C. X D_78
    4809       C6 00			
    4810 1B35  00 00 CC CC CC 7C			db	000H,000H,0CCH,0CCH,0CCH,07CH,00CH,0F8H ; L.C. Y D_79
    4811       0C F8			
    4812 1B3D  00 00 FC 98 30 64			db	000H,000H,0FCH,098H,030H,064H,0FCH,000H ; L.C. Z D_7A
    4813       FC 00			
    4814 1B45  1C 30 30 E0 30 30			db	01CH,030H,030H,0E0H,030H,030H,01CH,000H ; { D_7B
    4815       1C 00			
    4816				
    4817 1B4D  18 18 18 00 18 18			db	018H,018H,018H,000H,018H,018H,018H,000H ; | D_7C
    4818       18 00			
    4819 1B55  E0 30 30 1C 30 30			db	0E0H,030H,030H,01CH,030H,030H,0E0H,000H ; } D_7D
    4820       E0 00			
    4821 1B5D  76 DC 00 00 00 00			db	076H,0DCH,000H,000H,000H,000H,000H,000H ; TILDE D_7E
    4822       00 00			
    4823 1B65  00 10 38 6C C6 C6			db	000H,010H,038H,06CH,0C6H,0C6H,0FEH,000H ; DELTA D_7F
    4824       FE 00			
    4825				; This ends at a.1b70
    4826				
    4827				IF	ROMSEARCH
    4828				;***** Expansion ROM code *****
    4829				; This is called after the hardware is initialized but before
    4830				; the video is displayed. Borrowed from the Generic XT BIOS. The expansion
    4831				; ROM spec denotes the area C8000-EE000 starting on 2k boundries. Expansion
    4832				; devices are usually 8K (2764) EPROMS.
    4833				;
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-89


    4834				EXPROM: MOV	DX,0C800h                       ; ROM segment start
    4835					PUSH 	DS
    4836				
    4837				FNDROM: MOV	DS,DX                           ; Load ROM segment
    4838					XOR	BX,BX                           ;  ...ID offset
    4839					MOV	AX,[BX]                         ; Read the ROM id
    4840					CMP	AX,0AA55h
    4841					JNZ	NXTROM                          ;  ...not valid ROM
    4842					MOV	AX,40h
    4843					MOV	ES,AX
    4844					MOV	AH,0
    4845					MOV	AL,[BX+2]                       ; Get ROM size (bytes * 512)
    4846					MOV	CL,5
    4847					SHL	AX,CL                           ; Now ROM size in segments
    4848					ADD	DX,AX                           ;  ...add base segment
    4849					MOV	CL,4
    4850					SHL	AX,CL                           ; ROM address in bytes
    4851					MOV	CX,AX                           ;  ...checksum requires CX
    4852					CALL	CHK_01                          ; Find ROM checksum
    4853					JNZ	BADROM                          ;  ...bad ROM
    4854					PUSH	DX
    4855					MOV	word ptr ES:[gen_io_ptr],3	; 67h Offset  for ROM being setup
    4856					MOV     ES:[gen_io_ptr+2],DS		; 69h Segment for ROM being setup
    4857					CALL	dword ptr ES:[gen_io_ptr]	;  ...call ROM initialization
    4858					POP	DX
    4859					JMP	short FND_01			; see if there are any more ROMs
    4860				
    4861				BADROM: OR      Byte ptr ES:[scratch1],ER_ROM          ; ROM present, bad checksum 15h
    4862				
    4863				NXTROM: ADD     DX,80h                          ; Segment for next ROM
    4864				
    4865				FND_01: CMP     DX,0F600h                       ; End of ROM space
    4866					JL      FNDROM                          ;  ...no, continue
    4867					POP	DS				;  ...yes, clean up stack and return
    4868					RET
    4869				
    4870				CHKSUM: MOV     CX,2000h                        ; Bytes in 2764 eprom
    4871				CHK_01: MOV     AL,0                            ;  ...zero checksum
    4872				ADDBYT: ADD     AL,[BX]                         ; Add byte to checksum
    4873					INC     BX                              ;  ...BX --> next byte
    4874					LOOP    ADDBYT                          ;  ...loop until done
    4875					OR      AL,AL                           ; Set condition codes
    4876					RET                                     ;  ...and return
    4877				ENDIF
    4878				
    4879				; this ends at about 1BCF
    4880				;
    4881				; In Monitor v3.3, the SCSI code resides near the end of the ROM
    4882				; before some RAM test code and the 186 init. It is included as a
    4883				; library file (i.e., "scsi.lib"), which I assume is a plain text
    4884				; file.
    4885				;include "scsimon.asm"
    4886				;a.1c00
    4887				;	org	01c00h
    4888					ENTRY	01C00h
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-90


    4889 1B6D  0093[                 1	        db      pad DUP(0) 
    4890				include "INIT186.ASM"
    4891			     C	; CPU 186 defined in CM5.ASM
    4892			     C	; 1C00h
    4893 1C00                        C	COLDST:
    4894 1C00  8C C8                 C		mov	ax,cs
    4895 1C02  8E D8                 C		mov	ds,ax
    4896 1C04  8E C0                 C		mov	es,ax
    4897 1C06  BE 1C29 R             C		mov	si,offset inittbl	;1c29h
    4898 1C09  FC                    C		cld
    4899 1C0A                        C	loc_309:				;  xref A.1C13
    4900 1C0A  AD                    C	 	lodsw				; String [si] to ax
    4901 1C0B  85 C0                 C	 	test	ax,ax
    4902 1C0D  74 06                 C	 	jz	loc_310			; Jump if zero
    4903 1C0F  8B D0                 C	 	mov	dx,ax
    4904 1C11  AD                    C	 	lodsw				; String [si] to ax
    4905 1C12  EF                    C	 	out	dx,ax			; port 4552h ??I/O Non-standard
    4906 1C13  EB F5                 C	 	jmp	short loc_309		; (1C0A)
    4907			     C	; work on second table
    4908			     C	;1c15
    4909 1C15                        C	loc_310:				;  xref A.1C0D
    4910 1C15  BE 1C5F R             C	 	mov	si,offset inittbl2	; (A.1C5F=82h)
    4911 1C18  BA 0000               C	 	mov	dx,0
    4912 1C1B                        C	loc_311:				;  xref A.1C24
    4913 1C1B  AC                    C	 	lodsb				; String [si] to al
    4914 1C1C  84 C0                 C	 	test	al,al
    4915 1C1E  74 06                 C	 	jz	loc_312			; Jump if zero
    4916 1C20  8A D0                 C	 	mov	dl,al
    4917 1C22  AC                    C	 	lodsb				; String [si] to al
    4918 1C23  EE                    C	 	out	dx,al			; port 82h, DMA page reg ch 3
    4919 1C24  EB F5                 C	 	jmp	short loc_311		; (1C1B)
    4920			     C	
    4921 1C26                        C	loc_312:				;  xref A.1C1E
    4922 1C26  E9 001F R             C	 	jmp	COLD2			;loc_2	;*(001F)
    4923			     C	
    4924			     C	;a.1c29
    4925			     C	; Initialization table. First word is the port and
    4926			     C	; second word is the value.
    4927 1C29                        C	inittbl:
    4928			     C	;    	db	0A0h,0FFh, 38h,0FEh
    4929			     C	;	db	0A2h,0FFh, 0F8h, 3Fh
    4930			     C	;	db	0A4h,0FFh, 3Ah, 00h
    4931			     C	;    	db	0A6h,0FFh, 38h, 40h
    4932			     C	;	db	0A8h,0FFh, 38h,0A0h
    4933			     C	;	db	52h,0FFh, 06h, 00h
    4934			     C	;	db	54h,0FFh, 07h, 00h
    4935			     C	;	db	56h,0FFh, 03h,0C0h
    4936			     C	;	db	5Ah,0FFh, 06h, 00h
    4937			     C	;    	db	5Ch,0FFh, 07h, 00h
    4938			     C	;	db	5Eh,0FFh, 03h,0C0h
    4939			     C	;	db	62h,0FFh, 20h, 4Eh
    4940			     C	;   	db	66h,0FFh, 01h,0C0h
    4941 1C29  FFA0 FE38             C	    	dw	CSCR+UMCR, 0FE38h		; Upper memory: 8k block @ FE000h
    4942			     C							; to allow for a larger ROM...
    4943			     C							; 16k @ FC000h: 0FC38h
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-91


    4944			     C							; 32k @ F8000h: 0F838h 
    4945 1C2D  FFA2 3FF8             C		dw	CSCR+LMCR, 3FF8h		; Lower memory: 256k block @ 0-3FFFFh
    4946 1C31  FFA4 003A             C		dw	CSCR+PACS, 003Ah		; 2 wait states @ 0
    4947 1C35  FFA6 4038             C	    	dw	CSCR+MMCS, 4038h		; Middle block start @ 40000h, 0WS with RDY
    4948 1C39  FFA8 A038             C		dw	CSCR+MPCS, 0A038h		; 256k total block, 64k selects, 0WS with RD
					Y
    4949 1C3D  FF52 0006             C		dw	TM0CR+TMRCA, 0006h
    4950 1C41  FF54 0007             C		dw	TM0CR+TMRCB, 0007h
    4951 1C45  FF56 C003             C		dw	TM0CR+TMRCW, 0C003h
    4952 1C49  FF5A 0006             C		dw	TM1CR+TMRCA, 0006h
    4953 1C4D  FF5C 0007             C	    	dw	TM1CR+TMRCB, 0007h
    4954 1C51  FF5E C003             C		dw	TM1CR+TMRCW, 0C003h
    4955 1C55  FF62 4E20             C		dw	TM2CR+TMRCA, 4E20h
    4956 1C59  FF66 C001             C	   	dw	TM2CR+TMRCW, 0C001h
    4957 1C5D  00 00                 C		db	0,0
    4958			     C	
    4959			     C	; Initialization table 2. DMA registers for DMA 1 and 2
    4960 1C5F                        C	inittbl2:
    4961 1C5F  82 00                 C	 	db	82h, 00h		; DMA1
    4962 1C61  82 00                 C		db	82h, 00h
    4963 1C63  82 00                 C		db	82h, 00h
    4964 1C65  82 40                 C		db	82h, 40h
    4965 1C67  82 CE                 C		db	82h, 0CEh
    4966 1C69  82 37                 C		db	82h, 37h
    4967 1C6B  C2 00                 C		db	0C2h, 00h		; DMA2
    4968 1C6D  C2 00                 C		db	0C2h, 00h
    4969 1C6F  C2 00                 C		db	0C2h, 00h
    4970 1C71  C2 40                 C		db	0C2h, 40h
    4971 1C73  C2 CE                 C		db	0C2h, 0CEh
    4972 1C75  C2 37                 C		db	0C2h, 37h
    4973 1C77  D6 82                 C		db	0D6h, 82h
    4974 1C79  D4 0F                 C		db	0D4h, 0Fh
    4975 1C7B  00 00                 C		db	0,0
    4976			     C	; should end at 1C7C
    4977			     C	;
    4978			     C	; END OF INIT186.ASM
    4979				; should end at 1fefh
    4980				
    4981				;******************************************************************************
    4982				; Restart Address
    4983				;	org	01FF0h
    4984					ENTRY 	01FF0h			; this should put fill bytes before
    4985 1C7D  0373[                 1	        db      pad DUP(0) 
    4986					PUBLIC	POWER
    4987 1FF0				POWER:	jmpf	0FE00h, COLDST
    4988 1FF0  EA                    1	        db      0EAh; 
    4989 1FF1  1C00 R FE00           1	        dw      COLDST,0FE00h 
    4990 1FF5  0009[				db	9 dup (0)
    4991	   00			
    4992			 ]	
    4993				
    4994				; NOTE: the original ROM did not have an equipment byte.
    4995 1FFE  FB				db	0FBh			; model byte for later XT
    4996				; Checksum byte needs to be patched after the binary image is created.
    4997 1FFF				cksumb:
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-92


    4998 1FFF  00				db	0			; checksum byte xref A.14EB, 1504
    4999				
    5000 2000				code	ends
    5001				end 	POWER

Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-1


Macros:

		N a m e			Lines

ENTRY  . . . . . . . . . . . . .  	   8
JMPF . . . . . . . . . . . . . .  	   2

Segments and Groups:

                N a m e         	Length	 Align	Combine Class

CODE . . . . . . . . . . . . . .  	2000	PARA	NONE	
DATA . . . . . . . . . . . . . .  	0084	AT	0040	
DOSDIR . . . . . . . . . . . . .  	0200	AT	0050	

Symbols:            

                N a m e         	Type	 Value	 Attr

ACIA0BASE  . . . . . . . . . . .  	NUMBER	00C0	
ACIA1BASE  . . . . . . . . . . .  	NUMBER	0080	
ACT_DISP_PAGE  . . . . . . . . .  	L NEAR	119F	CODE
ALT_KEY  . . . . . . . . . . . .  	NUMBER	0038	
ALT_SHIFT  . . . . . . . . . . .  	NUMBER	0008	

BANNER . . . . . . . . . . . . .  	L NEAR	0000	CODE
BEEP . . . . . . . . . . . . . .  	N PROC	05C3	CODE	Length = 0022
BEEP_1 . . . . . . . . . . . . .  	L NEAR	05DA	CODE

C58253CTL  . . . . . . . . . . .  	NUMBER	0043	
C58255CMD  . . . . . . . . . . .  	NUMBER	0063	
C58255PA . . . . . . . . . . . .  	NUMBER	0060	
C58255PB . . . . . . . . . . . .  	NUMBER	0061	
C58255PC . . . . . . . . . . . .  	NUMBER	0062	
C5TIMER0 . . . . . . . . . . . .  	NUMBER	0040	
C5TIMER1 . . . . . . . . . . . .  	NUMBER	0041	
C5TIMER2 . . . . . . . . . . . .  	NUMBER	0042	
CAPS_KEY . . . . . . . . . . . .  	NUMBER	003A	
CAPS_SHIFT . . . . . . . . . . .  	NUMBER	0040	
CAPS_STATE . . . . . . . . . . .  	NUMBER	0040	
CDRAM  . . . . . . . . . . . . .  	NUMBER	FFE2	
CGACOLOR . . . . . . . . . . . .  	NUMBER	03D9	
CGAMODE  . . . . . . . . . . . .  	NUMBER	03D8	
CGASTAT  . . . . . . . . . . . .  	NUMBER	03DA	
CKSUMB . . . . . . . . . . . . .  	L NEAR	1FFF	CODE
CMDDISKFMT . . . . . . . . . . .  	L NEAR	06CE	CODE
CMDDISKRD  . . . . . . . . . . .  	L NEAR	06C0	CODE
CMDDISKSTAT  . . . . . . . . . .  	L NEAR	06BC	CODE
CMDDISKVER . . . . . . . . . . .  	L NEAR	06C7	CODE
CMDDISKWRT . . . . . . . . . . .  	L NEAR	0714	CODE
CMDKBDCHK  . . . . . . . . . . .  	L NEAR	0B57	CODE
CMDKBDCHRIN  . . . . . . . . . .  	L NEAR	0B3E	CODE
CMDKBDSHIFT  . . . . . . . . . .  	L NEAR	0B68	CODE
CMDRESETDISK . . . . . . . . . .  	L NEAR	068F	CODE
COLD2  . . . . . . . . . . . . .  	L NEAR	001F	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-2


COLDST . . . . . . . . . . . . .  	L NEAR	1C00	CODE
COMTO  . . . . . . . . . . . . .  	L BYTE	007C	DATA	Length = 0004
CR . . . . . . . . . . . . . . .  	NUMBER	000D	
CSCR . . . . . . . . . . . . . .  	NUMBER	FFA0	
CTL_KEY  . . . . . . . . . . . .  	NUMBER	001D	
CTL_SHIFT  . . . . . . . . . . .  	NUMBER	0004	
CTRLP  . . . . . . . . . . . . .  	NUMBER	0002	

D0CR . . . . . . . . . . . . . .  	NUMBER	0014	
D1CR . . . . . . . . . . . . . .  	NUMBER	0016	
DATAP  . . . . . . . . . . . . .  	NUMBER	0000	
DATA_121E  . . . . . . . . . . .  	NUMBER	2000	
DATA_122E  . . . . . . . . . . .  	NUMBER	2001	
DATA_49E . . . . . . . . . . . .  	NUMBER	0000	
DATA_50E . . . . . . . . . . . .  	NUMBER	03FE	
DATA_79  . . . . . . . . . . . .  	L NEAR	00EF	CODE
DATA_81  . . . . . . . . . . . .  	L NEAR	038B	CODE
DATA_82  . . . . . . . . . . . .  	L NEAR	050A	CODE
DATA_84  . . . . . . . . . . . .  	L NEAR	0BE0	CODE
DATA_85  . . . . . . . . . . . .  	L NEAR	0BE8	CODE
DATA_86  . . . . . . . . . . . .  	L NEAR	0C43	CODE
DATA_88  . . . . . . . . . . . .  	L NEAR	0DF2	CODE
DEBUGF . . . . . . . . . . . . .  	ALIAS	 TRUE		
DEFIRET  . . . . . . . . . . . .  	L NEAR	0596	CODE
DEL_KEY  . . . . . . . . . . . .  	NUMBER	0053	
DFINTS . . . . . . . . . . . . .  	NUMBER	0094	
DMA0 . . . . . . . . . . . . . .  	NUMBER	FFC0	
DMA1 . . . . . . . . . . . . . .  	NUMBER	FFD0	
DMACW  . . . . . . . . . . . . .  	NUMBER	000A	
DMADP  . . . . . . . . . . . . .  	NUMBER	0004	
DMADP1 . . . . . . . . . . . . .  	NUMBER	0006	
DMASP  . . . . . . . . . . . . .  	NUMBER	0000	
DMASP1 . . . . . . . . . . . . .  	NUMBER	0002	
DMATC  . . . . . . . . . . . . .  	NUMBER	0008	
DOCHECKSUM . . . . . . . . . . .  	N PROC	0140	CODE	Length = 0011
DSK_MOTOR_STAT . . . . . . . . .  	L BYTE	003F	DATA
DSK_MOTOR_TMR  . . . . . . . . .  	L BYTE	0040	DATA
DSK_RECAL_STAT . . . . . . . . .  	L BYTE	003E	DATA
DSK_RET_CODE . . . . . . . . . .  	L BYTE	0041	DATA
DYNHALT  . . . . . . . . . . . .  	L NEAR	0597	CODE

EDRAM  . . . . . . . . . . . . .  	NUMBER	FFE4	
EOIREG . . . . . . . . . . . . .  	NUMBER	0002	
EQUIP_BITS . . . . . . . . . . .  	L WORD	0010	DATA
ER_BIOS  . . . . . . . . . . . .  	NUMBER	0001	
ER_CRT . . . . . . . . . . . . .  	NUMBER	0004	
ER_MEM . . . . . . . . . . . . .  	NUMBER	0010	
ER_RAM . . . . . . . . . . . . .  	NUMBER	0002	
ER_ROM . . . . . . . . . . . . .  	NUMBER	0020	

FALSE  . . . . . . . . . . . . .  	NUMBER	0000	
FDCBASE  . . . . . . . . . . . .  	NUMBER	0090	
FDCD . . . . . . . . . . . . . .  	NUMBER	03F1	
FDCDMA . . . . . . . . . . . . .  	NUMBER	00A0	
FDCS . . . . . . . . . . . . . .  	ALIAS	 FDPORT		
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-3


FDDATA . . . . . . . . . . . . .  	NUMBER	0092	
FDDMA  . . . . . . . . . . . . .  	NUMBER	0094	
FDMA . . . . . . . . . . . . . .  	NUMBER	03F2	
FDPORT . . . . . . . . . . . . .  	NUMBER	03F0	
FDSTAT . . . . . . . . . . . . .  	ALIAS	 FDCBASE		

GEN_INT_OCCURED  . . . . . . . .  	L BYTE	006B	DATA
GEN_IO_PTR . . . . . . . . . . .  	L WORD	0067	DATA
GETPDPB  . . . . . . . . . . . .  	N PROC	0834	CODE	Length = 0011
GRAFIX . . . . . . . . . . . . .  	L NEAR	176D	CODE

HD . . . . . . . . . . . . . . .  	L BYTE	0074	DATA	Length = 0004
HOLD_STATE . . . . . . . . . . .  	NUMBER	0008	

I14_1  . . . . . . . . . . . . .  	L NEAR	0304	CODE
I14_2  . . . . . . . . . . . . .  	L NEAR	030B	CODE
I14_EXIT . . . . . . . . . . . .  	L NEAR	0312	CODE
ICR  . . . . . . . . . . . . . .  	NUMBER	FF20	
INITEQUIPLIST  . . . . . . . . .  	N PROC	0473	CODE	Length = 0042
INITFLOPPY . . . . . . . . . . .  	N PROC	05F6	CODE	Length = 0025
INITKBDCTRLR . . . . . . . . . .  	N PROC	0B6E	CODE	Length = 004C
INITKEYBOARD . . . . . . . . . .  	N PROC	0AD4	CODE	Length = 0053
INITPRINTER  . . . . . . . . . .  	N PROC	0224	CODE	Length = 0020
INITSERIALPORTS  . . . . . . . .  	N PROC	02BC	CODE	Length = 0026
INITSERPORTS . . . . . . . . . .  	L NEAR	0319	CODE
INITTBL  . . . . . . . . . . . .  	L NEAR	1C29	CODE
INITTBL2 . . . . . . . . . . . .  	L NEAR	1C5F	CODE
INITTIMERS . . . . . . . . . . .  	N PROC	04B5	CODE	Length = 0055
INS_KEY  . . . . . . . . . . . .  	NUMBER	0052	
INS_SHIFT  . . . . . . . . . . .  	NUMBER	0080	
INS_STATE  . . . . . . . . . . .  	NUMBER	0080	
INT00HANDLER . . . . . . . . . .  	L NEAR	0113	CODE
INT00V . . . . . . . . . . . . .  	NUMBER	0000	
INT01V . . . . . . . . . . . . .  	NUMBER	0004	
INT06HANDLER . . . . . . . . . .  	L NEAR	00E0	CODE
INT06V . . . . . . . . . . . . .  	NUMBER	0018	
INT08HANDLER . . . . . . . . . .  	L NEAR	0521	CODE
INT08V . . . . . . . . . . . . .  	NUMBER	0020	
INT09HANDLER . . . . . . . . . .  	L NEAR	0CF2	CODE
INT09V . . . . . . . . . . . . .  	NUMBER	0024	
INT0BHANDLER . . . . . . . . . .  	L NEAR	07E9	CODE
INT0BV . . . . . . . . . . . . .  	NUMBER	002C	
INT0CHANDLER . . . . . . . . . .  	L NEAR	0511	CODE
INT0CR . . . . . . . . . . . . .  	NUMBER	0018	
INT0CV . . . . . . . . . . . . .  	NUMBER	0030	
INT0DHANDLER . . . . . . . . . .  	L NEAR	0CE4	CODE
INT0DV . . . . . . . . . . . . .  	NUMBER	0034	
INT10HANDLER . . . . . . . . . .  	L NEAR	0FF1	CODE
INT10V . . . . . . . . . . . . .  	NUMBER	0040	
INT11HANDLER . . . . . . . . . .  	L NEAR	01B4	CODE
INT11V . . . . . . . . . . . . .  	NUMBER	0044	
INT12HANDLER . . . . . . . . . .  	L NEAR	01A9	CODE
INT12V . . . . . . . . . . . . .  	NUMBER	0048	
INT13HANDLER . . . . . . . . . .  	L NEAR	061B	CODE
INT13V . . . . . . . . . . . . .  	NUMBER	004C	
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-4


INT14HANDLER . . . . . . . . . .  	L NEAR	02E2	CODE
INT14V . . . . . . . . . . . . .  	NUMBER	0050	
INT15V . . . . . . . . . . . . .  	NUMBER	0054	
INT16HANDLER . . . . . . . . . .  	L NEAR	0B27	CODE
INT16V . . . . . . . . . . . . .  	NUMBER	0058	
INT17HANDLER . . . . . . . . . .  	L NEAR	0244	CODE
INT17V . . . . . . . . . . . . .  	NUMBER	005C	
INT17_EXIT . . . . . . . . . . .  	L NEAR	025B	CODE
INT18V . . . . . . . . . . . . .  	NUMBER	0060	
INT19V . . . . . . . . . . . . .  	NUMBER	0064	
INT1AHANDLER . . . . . . . . . .  	L NEAR	0562	CODE
INT1AV . . . . . . . . . . . . .  	NUMBER	0068	
INT1BV . . . . . . . . . . . . .  	NUMBER	006C	
INT1CR . . . . . . . . . . . . .  	NUMBER	001A	
INT1CV . . . . . . . . . . . . .  	NUMBER	0070	
INT1DV . . . . . . . . . . . . .  	NUMBER	0074	
INT1EV . . . . . . . . . . . . .  	NUMBER	0078	
INT1FV . . . . . . . . . . . . .  	NUMBER	007C	
INT2CR . . . . . . . . . . . . .  	NUMBER	001C	
INT3CR . . . . . . . . . . . . .  	NUMBER	001E	
INTS . . . . . . . . . . . . . .  	NUMBER	03F2	
INT_1D . . . . . . . . . . . . .  	L NEAR	1020	CODE
INT_1E . . . . . . . . . . . . .  	L NEAR	0AC9	CODE
IPLLOC . . . . . . . . . . . . .  	NUMBER	7C00	
IRR  . . . . . . . . . . . . . .  	NUMBER	000E	
ISR  . . . . . . . . . . . . . .  	NUMBER	0010	
ISVR . . . . . . . . . . . . . .  	NUMBER	000C	
IVR  . . . . . . . . . . . . . .  	ALIAS	 ICR		

KEYBD_ALT_NUM  . . . . . . . . .  	L BYTE	0019	DATA
KEYBD_BUFF . . . . . . . . . . .  	L WORD	001E	DATA	Length = 0010
KEYBD_FLAGS_1  . . . . . . . . .  	L BYTE	0017	DATA
KEYBD_FLAGS_2  . . . . . . . . .  	L BYTE	0018	DATA
KEYBD_Q_HEAD . . . . . . . . . .  	L WORD	001A	DATA
KEYBD_Q_TAIL . . . . . . . . . .  	L WORD	001C	DATA

LEFT_KEY . . . . . . . . . . . .  	NUMBER	002A	
LEFT_SHIFT . . . . . . . . . . .  	NUMBER	0002	
LF . . . . . . . . . . . . . . .  	NUMBER	000A	
LMCR . . . . . . . . . . . . . .  	NUMBER	0002	
LOCLOOP_100  . . . . . . . . . .  	L NEAR	088F	CODE
LOCLOOP_103  . . . . . . . . . .  	L NEAR	089D	CODE
LOCLOOP_105  . . . . . . . . . .  	L NEAR	08C7	CODE
LOCLOOP_106  . . . . . . . . . .  	L NEAR	08D5	CODE
LOCLOOP_114  . . . . . . . . . .  	L NEAR	09D3	CODE
LOCLOOP_118  . . . . . . . . . .  	L NEAR	0A16	CODE
LOCLOOP_123  . . . . . . . . . .  	L NEAR	0A38	CODE
LOCLOOP_125  . . . . . . . . . .  	L NEAR	0A61	CODE
LOCLOOP_137  . . . . . . . . . .  	L NEAR	0B78	CODE
LOCLOOP_138  . . . . . . . . . .  	L NEAR	0B89	CODE
LOCLOOP_14 . . . . . . . . . . .  	L NEAR	0202	CODE
LOCLOOP_17 . . . . . . . . . . .  	L NEAR	0268	CODE
LOCLOOP_190  . . . . . . . . . .  	L NEAR	0F9C	CODE
LOCLOOP_191  . . . . . . . . . .  	L NEAR	0FA5	CODE
LOCLOOP_196  . . . . . . . . . .  	L NEAR	10BB	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-5


LOCLOOP_229  . . . . . . . . . .  	L NEAR	1306	CODE
LOCLOOP_233  . . . . . . . . . .  	L NEAR	132A	CODE
LOCLOOP_236  . . . . . . . . . .  	L NEAR	134A	CODE
LOCLOOP_259  . . . . . . . . . .  	L NEAR	14DF	CODE
LOCLOOP_264  . . . . . . . . . .  	L NEAR	1512	CODE
LOCLOOP_27 . . . . . . . . . . .  	L NEAR	0341	CODE
LOCLOOP_276  . . . . . . . . . .  	L NEAR	15EC	CODE
LOCLOOP_31 . . . . . . . . . . .  	L NEAR	03B6	CODE
LOCLOOP_33 . . . . . . . . . . .  	L NEAR	03CC	CODE
LOCLOOP_36 . . . . . . . . . . .  	L NEAR	03F5	CODE
LOCLOOP_50 . . . . . . . . . . .  	L NEAR	046C	CODE
LOCLOOP_52 . . . . . . . . . . .  	L NEAR	04F3	CODE
LOCLOOP_61 . . . . . . . . . . .  	L NEAR	05AB	CODE
LOCLOOP_63 . . . . . . . . . . .  	L NEAR	05B6	CODE
LOCLOOP_64 . . . . . . . . . . .  	L NEAR	05BC	CODE
LOCLOOP_65 . . . . . . . . . . .  	L NEAR	05BE	CODE
LOCLOOP_7  . . . . . . . . . . .  	L NEAR	0148	CODE
LOCLOOP_9  . . . . . . . . . . .  	L NEAR	015E	CODE
LOCLOOP_93 . . . . . . . . . . .  	L NEAR	080F	CODE
LOCLOOP_96 . . . . . . . . . . .  	L NEAR	0821	CODE
LOC_10 . . . . . . . . . . . . .  	L NEAR	0168	CODE
LOC_101  . . . . . . . . . . . .  	L NEAR	0895	CODE
LOC_104  . . . . . . . . . . . .  	L NEAR	08BC	CODE
LOC_107  . . . . . . . . . . . .  	L NEAR	08E0	CODE
LOC_108  . . . . . . . . . . . .  	L NEAR	0906	CODE
LOC_109  . . . . . . . . . . . .  	L NEAR	0929	CODE
LOC_11 . . . . . . . . . . . . .  	L NEAR	0180	CODE
LOC_110  . . . . . . . . . . . .  	L NEAR	094C	CODE
LOC_111  . . . . . . . . . . . .  	L NEAR	096A	CODE
LOC_112  . . . . . . . . . . . .  	L NEAR	098C	CODE
LOC_113  . . . . . . . . . . . .  	L NEAR	09A6	CODE
LOC_115  . . . . . . . . . . . .  	L NEAR	09F9	CODE
LOC_116  . . . . . . . . . . . .  	L NEAR	0A02	CODE
LOC_117  . . . . . . . . . . . .  	L NEAR	0A11	CODE
LOC_119  . . . . . . . . . . . .  	L NEAR	0A1D	CODE
LOC_12 . . . . . . . . . . . . .  	L NEAR	01D9	CODE
LOC_120  . . . . . . . . . . . .  	L NEAR	0A22	CODE
LOC_121  . . . . . . . . . . . .  	L NEAR	0A27	CODE
LOC_122  . . . . . . . . . . . .  	L NEAR	0A2E	CODE
LOC_124  . . . . . . . . . . . .  	L NEAR	0A48	CODE
LOC_126  . . . . . . . . . . . .  	L NEAR	0A81	CODE
LOC_127  . . . . . . . . . . . .  	L NEAR	0A82	CODE
LOC_128  . . . . . . . . . . . .  	L NEAR	0A8B	CODE
LOC_129  . . . . . . . . . . . .  	L NEAR	0A9B	CODE
LOC_13 . . . . . . . . . . . . .  	L NEAR	01F4	CODE
LOC_130  . . . . . . . . . . . .  	L NEAR	0A9F	CODE
LOC_131  . . . . . . . . . . . .  	L NEAR	0AB0	CODE
LOC_132  . . . . . . . . . . . .  	L NEAR	0AC6	CODE
LOC_139  . . . . . . . . . . . .  	L NEAR	0BA6	CODE
LOC_141  . . . . . . . . . . . .  	L NEAR	0D1C	CODE
LOC_142  . . . . . . . . . . . .  	L NEAR	0D2F	CODE
LOC_144  . . . . . . . . . . . .  	L NEAR	0D48	CODE
LOC_145  . . . . . . . . . . . .  	L NEAR	0D5D	CODE
LOC_146  . . . . . . . . . . . .  	L NEAR	0D6B	CODE
LOC_147  . . . . . . . . . . . .  	L NEAR	0D71	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-6


LOC_148  . . . . . . . . . . . .  	L NEAR	0D78	CODE
LOC_149  . . . . . . . . . . . .  	L NEAR	0D90	CODE
LOC_150  . . . . . . . . . . . .  	L NEAR	0DAF	CODE
LOC_151  . . . . . . . . . . . .  	L NEAR	0DB7	CODE
LOC_152  . . . . . . . . . . . .  	L NEAR	0DCB	CODE
LOC_153  . . . . . . . . . . . .  	L NEAR	0DD4	CODE
LOC_154  . . . . . . . . . . . .  	L NEAR	0DDE	CODE
LOC_155  . . . . . . . . . . . .  	L NEAR	0E16	CODE
LOC_156  . . . . . . . . . . . .  	L NEAR	0E1F	CODE
LOC_157  . . . . . . . . . . . .  	L NEAR	0E3B	CODE
LOC_158  . . . . . . . . . . . .  	L NEAR	0E4C	CODE
LOC_159  . . . . . . . . . . . .  	L NEAR	0E5C	CODE
LOC_16 . . . . . . . . . . . . .  	L NEAR	0261	CODE
LOC_160  . . . . . . . . . . . .  	L NEAR	0E60	CODE
LOC_161  . . . . . . . . . . . .  	L NEAR	0E63	CODE
LOC_162  . . . . . . . . . . . .  	L NEAR	0E6D	CODE
LOC_163  . . . . . . . . . . . .  	L NEAR	0E90	CODE
LOC_164  . . . . . . . . . . . .  	L NEAR	0EA1	CODE
LOC_165  . . . . . . . . . . . .  	L NEAR	0EAB	CODE
LOC_166  . . . . . . . . . . . .  	L NEAR	0EB5	CODE
LOC_167  . . . . . . . . . . . .  	L NEAR	0EBF	CODE
LOC_168  . . . . . . . . . . . .  	L NEAR	0EC5	CODE
LOC_169  . . . . . . . . . . . .  	L NEAR	0EDA	CODE
LOC_170  . . . . . . . . . . . .  	L NEAR	0EE1	CODE
LOC_171  . . . . . . . . . . . .  	L NEAR	0EEB	CODE
LOC_172  . . . . . . . . . . . .  	L NEAR	0EF0	CODE
LOC_173  . . . . . . . . . . . .  	L NEAR	0EFE	CODE
LOC_174  . . . . . . . . . . . .  	L NEAR	0F0D	CODE
LOC_175  . . . . . . . . . . . .  	L NEAR	0F12	CODE
LOC_176  . . . . . . . . . . . .  	L NEAR	0F17	CODE
LOC_177  . . . . . . . . . . . .  	L NEAR	0F1E	CODE
LOC_178  . . . . . . . . . . . .  	L NEAR	0F25	CODE
LOC_179  . . . . . . . . . . . .  	L NEAR	0F2D	CODE
LOC_18 . . . . . . . . . . . . .  	L NEAR	0279	CODE
LOC_180  . . . . . . . . . . . .  	L NEAR	0F30	CODE
LOC_181  . . . . . . . . . . . .  	L NEAR	0F34	CODE
LOC_182  . . . . . . . . . . . .  	L NEAR	0F3D	CODE
LOC_183  . . . . . . . . . . . .  	L NEAR	0F57	CODE
LOC_184  . . . . . . . . . . . .  	L NEAR	0F5A	CODE
LOC_185  . . . . . . . . . . . .  	L NEAR	0F64	CODE
LOC_186  . . . . . . . . . . . .  	L NEAR	0F7C	CODE
LOC_187  . . . . . . . . . . . .  	L NEAR	0F82	CODE
LOC_188  . . . . . . . . . . . .  	L NEAR	0F84	CODE
LOC_189  . . . . . . . . . . . .  	L NEAR	0F95	CODE
LOC_19 . . . . . . . . . . . . .  	L NEAR	028C	CODE
LOC_192  . . . . . . . . . . . .  	L NEAR	100C	CODE
LOC_194  . . . . . . . . . . . .  	L NEAR	1084	CODE
LOC_195  . . . . . . . . . . . .  	L NEAR	10B8	CODE
LOC_197  . . . . . . . . . . . .  	L NEAR	10E1	CODE
LOC_198  . . . . . . . . . . . .  	L NEAR	10E4	CODE
LOC_199  . . . . . . . . . . . .  	L NEAR	1132	CODE
LOC_20 . . . . . . . . . . . . .  	L NEAR	02AB	CODE
LOC_200  . . . . . . . . . . . .  	L NEAR	1136	CODE
LOC_201  . . . . . . . . . . . .  	L NEAR	1139	CODE
LOC_204  . . . . . . . . . . . .  	L NEAR	1176	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-7


LOC_208  . . . . . . . . . . . .  	L NEAR	11D8	CODE
LOC_209  . . . . . . . . . . . .  	L NEAR	11DF	CODE
LOC_21 . . . . . . . . . . . . .  	L NEAR	02B7	CODE
LOC_212  . . . . . . . . . . . .  	L NEAR	121A	CODE
LOC_213  . . . . . . . . . . . .  	L NEAR	1228	CODE
LOC_214  . . . . . . . . . . . .  	L NEAR	1233	CODE
LOC_215  . . . . . . . . . . . .  	L NEAR	1236	CODE
LOC_216  . . . . . . . . . . . .  	L NEAR	123F	CODE
LOC_217  . . . . . . . . . . . .  	L NEAR	1252	CODE
LOC_218  . . . . . . . . . . . .  	L NEAR	1255	CODE
LOC_220  . . . . . . . . . . . .  	L NEAR	12A0	CODE
LOC_221  . . . . . . . . . . . .  	L NEAR	12AE	CODE
LOC_222  . . . . . . . . . . . .  	L NEAR	12B9	CODE
LOC_223  . . . . . . . . . . . .  	L NEAR	12BC	CODE
LOC_224  . . . . . . . . . . . .  	L NEAR	12C8	CODE
LOC_226  . . . . . . . . . . . .  	L NEAR	12D9	CODE
LOC_227  . . . . . . . . . . . .  	L NEAR	12E7	CODE
LOC_228  . . . . . . . . . . . .  	L NEAR	12ED	CODE
LOC_230  . . . . . . . . . . . .  	L NEAR	130C	CODE
LOC_232  . . . . . . . . . . . .  	L NEAR	131F	CODE
LOC_235  . . . . . . . . . . . .  	L NEAR	1341	CODE
LOC_239  . . . . . . . . . . . .  	L NEAR	137C	CODE
LOC_240  . . . . . . . . . . . .  	L NEAR	1383	CODE
LOC_241  . . . . . . . . . . . .  	L NEAR	139A	CODE
LOC_242  . . . . . . . . . . . .  	L NEAR	13B2	CODE
LOC_243  . . . . . . . . . . . .  	L NEAR	13BC	CODE
LOC_244  . . . . . . . . . . . .  	L NEAR	13CA	CODE
LOC_245  . . . . . . . . . . . .  	L NEAR	13E8	CODE
LOC_246  . . . . . . . . . . . .  	L NEAR	1400	CODE
LOC_247  . . . . . . . . . . . .  	L NEAR	140F	CODE
LOC_248  . . . . . . . . . . . .  	L NEAR	1411	CODE
LOC_249  . . . . . . . . . . . .  	L NEAR	141F	CODE
LOC_250  . . . . . . . . . . . .  	L NEAR	1423	CODE
LOC_251  . . . . . . . . . . . .  	L NEAR	1443	CODE
LOC_252  . . . . . . . . . . . .  	L NEAR	145F	CODE
LOC_253  . . . . . . . . . . . .  	L NEAR	146E	CODE
LOC_254  . . . . . . . . . . . .  	L NEAR	1470	CODE
LOC_255  . . . . . . . . . . . .  	L NEAR	147F	CODE
LOC_256  . . . . . . . . . . . .  	L NEAR	14AD	CODE
LOC_257  . . . . . . . . . . . .  	L NEAR	14C0	CODE
LOC_258  . . . . . . . . . . . .  	L NEAR	14CF	CODE
LOC_26 . . . . . . . . . . . . .  	L NEAR	0326	CODE
LOC_260  . . . . . . . . . . . .  	L NEAR	14E3	CODE
LOC_261  . . . . . . . . . . . .  	L NEAR	14EB	CODE
LOC_262  . . . . . . . . . . . .  	L NEAR	14FF	CODE
LOC_263  . . . . . . . . . . . .  	L NEAR	150B	CODE
LOC_265  . . . . . . . . . . . .  	L NEAR	1516	CODE
LOC_266  . . . . . . . . . . . .  	L NEAR	1528	CODE
LOC_267  . . . . . . . . . . . .  	L NEAR	1544	CODE
LOC_268  . . . . . . . . . . . .  	L NEAR	155F	CODE
LOC_269  . . . . . . . . . . . .  	L NEAR	1574	CODE
LOC_270  . . . . . . . . . . . .  	L NEAR	158C	CODE
LOC_271  . . . . . . . . . . . .  	L NEAR	1590	CODE
LOC_272  . . . . . . . . . . . .  	L NEAR	15A2	CODE
LOC_273  . . . . . . . . . . . .  	L NEAR	15AF	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-8


LOC_274  . . . . . . . . . . . .  	L NEAR	15B4	CODE
LOC_275  . . . . . . . . . . . .  	L NEAR	15DD	CODE
LOC_277  . . . . . . . . . . . .  	L NEAR	1601	CODE
LOC_278  . . . . . . . . . . . .  	L NEAR	1625	CODE
LOC_279  . . . . . . . . . . . .  	L NEAR	162B	CODE
LOC_28 . . . . . . . . . . . . .  	L NEAR	0365	CODE
LOC_281  . . . . . . . . . . . .  	L NEAR	167F	CODE
LOC_282  . . . . . . . . . . . .  	L NEAR	1692	CODE
LOC_283  . . . . . . . . . . . .  	L NEAR	1698	CODE
LOC_284  . . . . . . . . . . . .  	L NEAR	16A6	CODE
LOC_285  . . . . . . . . . . . .  	L NEAR	16A8	CODE
LOC_286  . . . . . . . . . . . .  	L NEAR	16AC	CODE
LOC_287  . . . . . . . . . . . .  	L NEAR	16AE	CODE
LOC_288  . . . . . . . . . . . .  	L NEAR	16B2	CODE
LOC_289  . . . . . . . . . . . .  	L NEAR	16BB	CODE
LOC_29 . . . . . . . . . . . . .  	L NEAR	0368	CODE
LOC_290  . . . . . . . . . . . .  	L NEAR	16BF	CODE
LOC_291  . . . . . . . . . . . .  	L NEAR	16C6	CODE
LOC_293  . . . . . . . . . . . .  	L NEAR	1714	CODE
LOC_294  . . . . . . . . . . . .  	L NEAR	173B	CODE
LOC_295  . . . . . . . . . . . .  	L NEAR	1747	CODE
LOC_296  . . . . . . . . . . . .  	L NEAR	1759	CODE
LOC_297  . . . . . . . . . . . .  	L NEAR	175B	CODE
LOC_298  . . . . . . . . . . . .  	L NEAR	1765	CODE
LOC_3  . . . . . . . . . . . . .  	L NEAR	0038	CODE
LOC_30 . . . . . . . . . . . . .  	L NEAR	03AB	CODE
LOC_309  . . . . . . . . . . . .  	L NEAR	1C0A	CODE
LOC_310  . . . . . . . . . . . .  	L NEAR	1C15	CODE
LOC_311  . . . . . . . . . . . .  	L NEAR	1C1B	CODE
LOC_312  . . . . . . . . . . . .  	L NEAR	1C26	CODE
LOC_32 . . . . . . . . . . . . .  	L NEAR	03C8	CODE
LOC_34 . . . . . . . . . . . . .  	L NEAR	03DE	CODE
LOC_35 . . . . . . . . . . . . .  	L NEAR	03E6	CODE
LOC_37 . . . . . . . . . . . . .  	L NEAR	0400	CODE
LOC_38 . . . . . . . . . . . . .  	L NEAR	0405	CODE
LOC_39 . . . . . . . . . . . . .  	L NEAR	0413	CODE
LOC_4  . . . . . . . . . . . . .  	L NEAR	004E	CODE
LOC_40 . . . . . . . . . . . . .  	L NEAR	0429	CODE
LOC_41 . . . . . . . . . . . . .  	L NEAR	0430	CODE
LOC_42 . . . . . . . . . . . . .  	L NEAR	0437	CODE
LOC_43 . . . . . . . . . . . . .  	L NEAR	043E	CODE
LOC_44 . . . . . . . . . . . . .  	L NEAR	0445	CODE
LOC_45 . . . . . . . . . . . . .  	L NEAR	044C	CODE
LOC_47 . . . . . . . . . . . . .  	L NEAR	0454	CODE
LOC_48 . . . . . . . . . . . . .  	L NEAR	0465	CODE
LOC_49 . . . . . . . . . . . . .  	L NEAR	0468	CODE
LOC_5  . . . . . . . . . . . . .  	L NEAR	0058	CODE
LOC_51 . . . . . . . . . . . . .  	L NEAR	04B8	CODE
LOC_53 . . . . . . . . . . . . .  	L NEAR	0533	CODE
LOC_54 . . . . . . . . . . . . .  	L NEAR	0553	CODE
LOC_55 . . . . . . . . . . . . .  	L NEAR	055C	CODE
LOC_56 . . . . . . . . . . . . .  	L NEAR	0573	CODE
LOC_57 . . . . . . . . . . . . .  	L NEAR	0575	CODE
LOC_58 . . . . . . . . . . . . .  	L NEAR	0587	CODE
LOC_59 . . . . . . . . . . . . .  	L NEAR	059A	CODE
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-9


LOC_6  . . . . . . . . . . . . .  	L NEAR	0098	CODE
LOC_60 . . . . . . . . . . . . .  	L NEAR	05A6	CODE
LOC_62 . . . . . . . . . . . . .  	L NEAR	05B1	CODE
LOC_67 . . . . . . . . . . . . .  	L NEAR	05E5	CODE
LOC_79 . . . . . . . . . . . . .  	L NEAR	06F2	CODE
LOC_81 . . . . . . . . . . . . .  	L NEAR	071E	CODE
LOC_82 . . . . . . . . . . . . .  	L NEAR	0728	CODE
LOC_83 . . . . . . . . . . . . .  	L NEAR	073C	CODE
LOC_84 . . . . . . . . . . . . .  	L NEAR	075E	CODE
LOC_85 . . . . . . . . . . . . .  	L NEAR	078F	CODE
LOC_86 . . . . . . . . . . . . .  	L NEAR	0792	CODE
LOC_87 . . . . . . . . . . . . .  	L NEAR	07CF	CODE
LOC_88 . . . . . . . . . . . . .  	L NEAR	07D1	CODE
LOC_90 . . . . . . . . . . . . .  	L NEAR	07D9	CODE
LOC_91 . . . . . . . . . . . . .  	L NEAR	07E3	CODE
LOC_92 . . . . . . . . . . . . .  	L NEAR	0808	CODE
LOC_94 . . . . . . . . . . . . .  	L NEAR	0816	CODE
LOC_95 . . . . . . . . . . . . .  	L NEAR	081F	CODE
LOC_97 . . . . . . . . . . . . .  	L NEAR	082A	CODE
LOC_98 . . . . . . . . . . . . .  	L NEAR	086A	CODE
LOC_99 . . . . . . . . . . . . .  	L NEAR	0888	CODE
LOC_RET_102  . . . . . . . . . .  	L NEAR	0897	CODE
LOC_RET_112  . . . . . . . . . .  	L NEAR	09A5	CODE
LOC_RET_140  . . . . . . . . . .  	L NEAR	0BDF	CODE
LOC_RET_46 . . . . . . . . . . .  	L NEAR	0453	CODE
LOC_RET_68 . . . . . . . . . . .  	L NEAR	05F5	CODE
LOC_RET_89 . . . . . . . . . . .  	L NEAR	07D8	CODE
LPENCLR  . . . . . . . . . . . .  	NUMBER	03DB	
LPENSET  . . . . . . . . . . . .  	NUMBER	03DC	
LPTTO  . . . . . . . . . . . . .  	L BYTE	0078	DATA	Length = 0004

MAIN_RAM_SIZE  . . . . . . . . .  	L WORD	0013	DATA
MASKR  . . . . . . . . . . . . .  	NUMBER	0008	
MAXCOLS  . . . . . . . . . . . .  	L NEAR	1068	CODE
MC6845R0 . . . . . . . . . . . .  	NUMBER	03D0	
MC6845R1 . . . . . . . . . . . .  	NUMBER	03D1	
MC6845R2 . . . . . . . . . . . .  	NUMBER	03D2	
MC6845R3 . . . . . . . . . . . .  	NUMBER	03D3	
MC6845R4 . . . . . . . . . . . .  	NUMBER	03D4	
MC6845R5 . . . . . . . . . . . .  	NUMBER	03D5	
MC6845R6 . . . . . . . . . . . .  	NUMBER	03D6	
MC6845R7 . . . . . . . . . . . .  	NUMBER	03D7	
MDRAM  . . . . . . . . . . . . .  	NUMBER	FFE0	
MFG_TEST . . . . . . . . . . . .  	L BYTE	0012	DATA
MMCS . . . . . . . . . . . . . .  	NUMBER	0006	
MODES  . . . . . . . . . . . . .  	L NEAR	1070	CODE
MPCS . . . . . . . . . . . . . .  	NUMBER	0008	
MSG1 . . . . . . . . . . . . . .  	L NEAR	00C9	CODE
MSG2 . . . . . . . . . . . . . .  	L NEAR	00FA	CODE
MSG3 . . . . . . . . . . . . . .  	L NEAR	0126	CODE
MSG4 . . . . . . . . . . . . . .  	L NEAR	0185	CODE
MSG5 . . . . . . . . . . . . . .  	L NEAR	0BBA	CODE

NEC_STAT . . . . . . . . . . . .  	L BYTE	0042	DATA	Length = 0007
NUM_KEY  . . . . . . . . . . . .  	NUMBER	0045	
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-10


NUM_SHIFT  . . . . . . . . . . .  	NUMBER	0020	
NUM_STATE  . . . . . . . . . . .  	NUMBER	0020	

PACS . . . . . . . . . . . . . .  	NUMBER	0004	
PAD  . . . . . . . . . . . . . .  	NUMBER	0373	
PCRBASE  . . . . . . . . . . . .  	NUMBER	FF00	
PDCOM  . . . . . . . . . . . . .  	NUMBER	FFF0	
PENOFF . . . . . . . . . . . . .  	L NEAR	16CD	CODE
PMR  . . . . . . . . . . . . . .  	NUMBER	000A	
POLLR  . . . . . . . . . . . . .  	NUMBER	0004	
POLLS  . . . . . . . . . . . . .  	NUMBER	0006	
POWER  . . . . . . . . . . . . .  	L NEAR	1FF0	CODE	Global
PPIBASE  . . . . . . . . . . . .  	NUMBER	00D0	
PPI_B  . . . . . . . . . . . . .  	NUMBER	00D2	
PPI_C  . . . . . . . . . . . . .  	NUMBER	00D4	
PPI_CR . . . . . . . . . . . . .  	NUMBER	00D6	
PRINTER_PORT . . . . . . . . . .  	NUMBER	00D0	
PRN_PORT_1 . . . . . . . . . . .  	L WORD	0008	DATA	Length = 0004
PROCCMD1 . . . . . . . . . . . .  	L NEAR	0663	CODE
PROCCMD2 . . . . . . . . . . . .  	L NEAR	0674	CODE
PROCCMD3 . . . . . . . . . . . .  	L NEAR	067B	CODE
PROCCMD4 . . . . . . . . . . . .  	L NEAR	0682	CODE
PROCCMD5 . . . . . . . . . . . .  	L NEAR	0689	CODE
PROCDISKCMD  . . . . . . . . . .  	N PROC	0649	CODE	Length = 01A0
PRTZSTR  . . . . . . . . . . . .  	N PROC	05E5	CODE	Length = 0011

RAMTEST  . . . . . . . . . . . .  	N PROC	01BF	CODE	Length = 0065
READ_AC_CURRENT  . . . . . . . .  	L NEAR	12CC	CODE
READ_CURSOR  . . . . . . . . . .  	L NEAR	1189	CODE
READ_DOT . . . . . . . . . . . .  	L NEAR	1353	CODE
READ_LPEN  . . . . . . . . . . .  	L NEAR	16D5	CODE
REGENL . . . . . . . . . . . . .  	L NEAR	1060	CODE
RIGHT_KEY  . . . . . . . . . . .  	NUMBER	0036	
RIGHT_SHIFT  . . . . . . . . . .  	NUMBER	0001	
ROMSEARCH  . . . . . . . . . . .  	ALIAS	 FALSE		
RR . . . . . . . . . . . . . . .  	NUMBER	FFFE	
RS232_PORT_1 . . . . . . . . . .  	L WORD	0000	DATA	Length = 0004

SCRATCH1 . . . . . . . . . . . .  	L BYTE	0015	DATA
SCROLL_DOWN  . . . . . . . . . .  	L NEAR	1290	CODE
SCROLL_KEY . . . . . . . . . . .  	NUMBER	0046	
SCROLL_SHIFT . . . . . . . . . .  	NUMBER	0010	
SCROLL_STATE . . . . . . . . . .  	NUMBER	0010	
SCROLL_UP  . . . . . . . . . . .  	L NEAR	120B	CODE
SCSI . . . . . . . . . . . . . .  	ALIAS	 FALSE		
SCSI_OPTIONS . . . . . . . . . .  	NUMBER	0000	
SETSERERRFL  . . . . . . . . . .  	N PROC	0420	CODE	Length = 0034
SET_COLOR  . . . . . . . . . . .  	L NEAR	11C3	CODE
SET_CPOS . . . . . . . . . . . .  	L NEAR	115F	CODE
SET_CTYPE  . . . . . . . . . . .  	L NEAR	113E	CODE
SET_MODE . . . . . . . . . . . .  	L NEAR	1078	CODE
SIGNBIT  . . . . . . . . . . . .  	L BYTE	0071	DATA
SUB_13 . . . . . . . . . . . . .  	N PROC	0808	CODE	Length = 002C
SUB_15 . . . . . . . . . . . . .  	N PROC	0845	CODE	Length = 0053
SUB_16 . . . . . . . . . . . . .  	N PROC	0898	CODE	Length = 002B
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-11


SUB_17 . . . . . . . . . . . . .  	N PROC	08C3	CODE	Length = 000A
SUB_18 . . . . . . . . . . . . .  	N PROC	08E7	CODE	Length = 00A5
SUB_19 . . . . . . . . . . . . .  	N PROC	09AD	CODE	Length = 0009
SUB_20 . . . . . . . . . . . . .  	N PROC	09B6	CODE	Length = 0009
SUB_21 . . . . . . . . . . . . .  	N PROC	09BF	CODE	Length = 0049
SUB_22 . . . . . . . . . . . . .  	N PROC	0A08	CODE	Length = 0044
SUB_23 . . . . . . . . . . . . .  	N PROC	0A4C	CODE	Length = 000D
SUB_24 . . . . . . . . . . . . .  	N PROC	0A59	CODE	Length = 002E
SUB_25 . . . . . . . . . . . . .  	N PROC	0A87	CODE	Length = 0017
SUB_26 . . . . . . . . . . . . .  	N PROC	0A9E	CODE	Length = 0014
SUB_27 . . . . . . . . . . . . .  	N PROC	0AB2	CODE	Length = 0017
SUB_30 . . . . . . . . . . . . .  	N PROC	0BD3	CODE	Length = 000D
SUB_31 . . . . . . . . . . . . .  	N PROC	0F8C	CODE	Length = 0025
SUB_32 . . . . . . . . . . . . .  	N PROC	0FB1	CODE	Length = 0020
SUB_33 . . . . . . . . . . . . .  	N PROC	1149	CODE	Length = 0016
SUB_34 . . . . . . . . . . . . .  	N PROC	1178	CODE	Length = 0011
SUB_35 . . . . . . . . . . . . .  	N PROC	11FA	CODE	Length = 0011
SUB_36 . . . . . . . . . . . . .  	N PROC	1259	CODE	Length = 0027
SUB_37 . . . . . . . . . . . . .  	N PROC	1280	CODE	Length = 0009
SUB_38 . . . . . . . . . . . . .  	N PROC	1289	CODE	Length = 0007
SUB_39 . . . . . . . . . . . . .  	N PROC	12F6	CODE	Length = 001C
SUB_40 . . . . . . . . . . . . .  	N PROC	1387	CODE	Length = 0043
SUB_41 . . . . . . . . . . . . .  	N PROC	1483	CODE	Length = 0019
SUB_42 . . . . . . . . . . . . .  	N PROC	149C	CODE	Length = 0011
SUB_43 . . . . . . . . . . . . .  	N PROC	15E3	CODE	Length = 0015
SUB_44 . . . . . . . . . . . . .  	N PROC	15F8	CODE	Length = 0023
SUB_45 . . . . . . . . . . . . .  	N PROC	161B	CODE	Length = 001D
SUB_46 . . . . . . . . . . . . .  	N PROC	1638	CODE	Length = 0016
SUB_47 . . . . . . . . . . . . .  	L NEAR	163B	CODE
SUB_6  . . . . . . . . . . . . .  	N PROC	0468	CODE	Length = 000B
SYSBOOT  . . . . . . . . . . . .  	L NEAR	0151	CODE

T0CR . . . . . . . . . . . . . .  	NUMBER	0012	
TIMER_HI . . . . . . . . . . . .  	L WORD	006E	DATA
TIMER_LOW  . . . . . . . . . . .  	L WORD	006C	DATA
TIMER_ROLLED . . . . . . . . . .  	L BYTE	0070	DATA
TM0CR  . . . . . . . . . . . . .  	NUMBER	FF50	
TM1CR  . . . . . . . . . . . . .  	NUMBER	FF58	
TM2CR  . . . . . . . . . . . . .  	NUMBER	FF60	
TMRCA  . . . . . . . . . . . . .  	NUMBER	0002	
TMRCB  . . . . . . . . . . . . .  	NUMBER	0004	
TMRCR  . . . . . . . . . . . . .  	NUMBER	0000	
TMRCW  . . . . . . . . . . . . .  	NUMBER	0006	
TRUE . . . . . . . . . . . . . .  	NUMBER	00FF	

UMCR . . . . . . . . . . . . . .  	NUMBER	0000	

VIDEO_BUF_SIZ  . . . . . . . . .  	L WORD	004C	DATA
VIDEO_COLOR  . . . . . . . . . .  	L BYTE	0066	DATA
VIDEO_COLUMNS  . . . . . . . . .  	L WORD	004A	DATA
VIDEO_MODE . . . . . . . . . . .  	L BYTE	0049	DATA
VIDEO_MODE_REG . . . . . . . . .  	L BYTE	0065	DATA
VIDEO_PAGE . . . . . . . . . . .  	L BYTE	0062	DATA
VIDEO_PORT . . . . . . . . . . .  	L WORD	0063	DATA
VIDEO_SEGMENT  . . . . . . . . .  	L WORD	004E	DATA
Microsoft (R) Macro Assembler Version 5.10A                 6/9/25 20:03:01

LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-12


VIDEO_STATE  . . . . . . . . . .  	L NEAR	11E9	CODE
VID_CURS_MODE  . . . . . . . . .  	L WORD	0060	DATA
VID_CURS_POS0  . . . . . . . . .  	L WORD	0050	DATA	Length = 0008
V_TABLE  . . . . . . . . . . . .  	L NEAR	0FD1	CODE

WARMBOOT . . . . . . . . . . . .  	L WORD	0072	DATA
WRITE_AC_CURRENT . . . . . . . .  	L NEAR	1312	CODE
WRITE_C_CURRENT  . . . . . . . .  	L NEAR	1334	CODE
WRITE_DOT  . . . . . . . . . . .  	L NEAR	1364	CODE
WRITE_TTY  . . . . . . . . . . .  	L NEAR	164E	CODE

XEROX  . . . . . . . . . . . . .  	L BYTE	0000	DOSDIR

@CPU . . . . . . . . . . . . . .  	TEXT  259		
@FILENAME  . . . . . . . . . . .  	TEXT  cm5		
@VERSION . . . . . . . . . . . .  	TEXT  510		


   4794 Source  Lines
   4814 Total   Lines
    588 Symbols

  45834 + 387312 Bytes symbol space free

      0 Warning Errors
      0 Severe  Errors
