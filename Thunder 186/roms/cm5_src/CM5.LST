Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-1


       1				TITLE LDP THUNDER REV 1.0 10/21/85 Colo
					r Magic ROM
       2				PAGE  59,132
       3				;option M510	; Assume MASM 5.1 if using MASM 6.11
       4				
       5				; NOTE: The Ampro LittleBoard 186 can boot from the SCSI channel
       6				;	so this might be an option... 
       7				;
       8				; There is a system equates file referenced from the monitor and
       9				; several hardware-specific files for initializing the 80186 and
      10				; as the includes for the storage hardware. These have been 
      11				; partially re-created.
      12				;
      13				; general items:
      14				;	tmr0 = serial 0 clock
      15				;	tmr1 = serial 1 clock
      16				;	UCS = ROM @ FE000
      17				;	LCS = 256k RAM
      18				;	DRQ0 = bus DMA0
      19				;	DRQ1 = floppy DRQ and bus DMA1
      20				;	INT0 = bus VI0			} need to verify
      21				;	INT1 = bus VI2/VI3		}
      22				;	INT2 = bus VI4			}
      23				;	INT3 = bus VI6/VI7 and RX1/RX2	}
      24				;	NMI = parity fail (unused with SRAM) and bus NMI
      25				;
      26				; SCSI IRQ 3, port 310h, D8000h
      27				;
      28				; The last byte has to be patched with DEBUG as follows
      29				;
      30				;   FFFF 00.xx          ( avoid ER_BIOS on bootstrap ) --------------------
      31				;									  |
      32				;									  |
      33				; where "xx" results in a zero checksum for the whole BIOS rom, for ex 	  |
      34				;                                                                         |
      35				;               masm BIOS;              ( Assemble BIOS source code)      |
      36				;               link BIOS;              ( Link the BIOS object code)      |
      37				;               debug BIOS.EXE          ( Exe2bin  BIOS binary code)      |
      38				;               -nBIOS.BIN              ( Name of the output binary)      |
      39				;               -eCS:1FFF               ( Opens BIOS checksum  byte)      |
      40				;;  ------->    .DC                     ( Force ROM checksum = zero) <-----
      41				;;              -rBX                    ( Opens hi order byte count)
      42				;;              :0                      (  ... must be 0 bytes long)
      43				;;              -rCX                    ( Opens lo order byte count)
      44				;;              :2000                   (  ... BIOS 2000 bytes long)
      45				;;              -wCS:0	                ( Output to BIOS.BIN   file)
      46				;;              -q
      47				
      48				
      49				;===============================================================================
      50				;  Defines
      51 = 0000				FALSE		equ	0
      52 = 00FF				TRUE		equ	0ffh
      53 =				DEBUGF		equ	TRUE		; allows marco expansion
      54 =				ROMSEARCH	equ	TRUE		; set true to include expansion ROM search
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-2


      55				
      56				; System compilation options
      57 =				WD100X		equ	FALSE
      58 =				CIA_HDO		equ	FALSE		;Control-it-all HD options installed
      59 =				CIA		equ	CIA_HDO
      60 =				SCSI		equ	TRUE
      61 =				HDO		equ	TRUE		;hard disk option; indicate either CIA or SCSI
      62				
      63				IF	SCSI
      64 = 0020					scsi_options	equ	00100000b	;indicate that SCSI is present
      65				ENDIF
      66				
      67				
      68				;===============================================================================
      69				;  Constants
      70				include "T186.ASM"		; system equates
      71			     C	; Lomas Thunder 186 specific code
      72			     C	;
      73			     C	
      74			     C	; 80186 Peripheral Control Registers
      75			     C	; At reset, this block starts at 0FF00h in I/O space
      76			     C	
      77 = FF00                      C	PCRBASE	equ	0ff00h
      78			     C	; Interrupts
      79 = FF20                      C	ICR	equ	PCRBASE+020h
      80 =                           C	IVR	equ	ICR
      81 = 0002                      C	EOIREG	equ	2	; specific EOI register
      82 = 0004                      C	POLLR	equ	4	; poll register
      83 = 0006                      C	POLLS	equ	6	; poll status register
      84 = 0008                      C	MASKR	equ	8	; mask register
      85 = 000A                      C	PMR	equ	0ah	; priority-level mask register
      86 = 000C                      C	ISVR	equ	0ch	; in-service register
      87 = 000E                      C	IRR	equ	0eh	; interrupt request register
      88 = 0010                      C	ISR	equ	010h	; interrupt status register
      89 = 0012                      C	T0CR	equ	012h	; timer 0 control register
      90 = 0014                      C	D0CR	equ	014h	; DMA0 control register
      91 = 0016                      C	D1CR	equ	016h	; DMA1 control register
      92 = 0018                      C	INT0CR	equ	018h	; INT0 control register
      93 = 001A                      C	INT1CR	equ	01ah	; INT1 control register
      94 = 0018                      C	INT2CR	equ	018h	; INT2 control register
      95 = 001A                      C	INT3CR	equ	01ah	; INT3 control register
      96			     C	; Timers
      97 = FF50                      C	TM0CR	equ	PCRBASE+050h
      98 = FF58                      C	TM1CR	equ	PCRBASE+058h
      99 = FF60                      C	TM2CR	equ	PCRBASE+060h
     100			     C	; offsets in timer control block
     101 = 0000                      C	TMRCR	equ	0	; control register
     102 = 0002                      C	TMRCA	equ	2	; count register A
     103 = 0004                      C	TMRCB	equ	4	; count register B
     104 = 0006                      C	TMRCW	equ	6	; mode/control word
     105			     C	; memory control
     106 = FFA0                      C	CSCR	equ	PCRBASE+0a0h
     107 =                           C	UMCR	equ	CSCR
     108 = 0002                      C	LMCR	equ	2
     109 = 0004                      C	PACS	equ	4
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-3


     110 = 0006                      C	MMCS	equ	6
     111 = 0008                      C	MPCS	equ	8
     112			     C	; DMA
     113 = FFC0                      C	DMA0	equ	PCRBASE+0C0h
     114 = FFD0                      C	DMA1	equ	PCRBASE+0d0h
     115			     C	; offsets in DMA control block
     116 = 0000                      C	DMASP	equ	0	; source pointer
     117 = 0002                      C	DMASP1	equ	2	; source pointer high 4 bits
     118 = 0004                      C	DMADP	equ	4	; destination pointer
     119 = 0006                      C	DMADP1	equ	6	; destination pointer high 4 bits
     120 = 0008                      C	DMATC	equ	8	; transfer count
     121 = 000A                      C	DMACW	equ	0ah	; control word
     122			     C	; other registers
     123 = FFE0                      C	MDRAM	equ	PCRBASE+0e0h
     124 = FFE2                      C	CDRAM	equ	PCRBASE+0e2h
     125 = FFE4                      C	EDRAM	equ	PCRBASE+0e4h
     126 = FFF0                      C	PDCOM	equ	PCRBASE+0f0h
     127			     C	; Relocation Register
     128 = FFFE                      C	RR	equ	PCRBASE+0feh
     129				include "CM5D.ASM"		; ColorMagic-specific ports/data
     130			     C	; Lomas Color Magic specific code
     131			     C	;
     132 = 0040                      C	C5TIMER0	equ	40h
     133 = 0041                      C	C5TIMER1	equ	41h
     134 = 0042                      C	C5TIMER2	equ	42h
     135 = 0043                      C	C58253CTL	equ	43h
     136 = 0060                      C	C58255PA	equ	60h 
     137 = 0061                      C	C58255PB	equ	61h 
     138 = 0062                      C	C58255PC	equ	62h
     139 = 0063                      C	C58255CMD	equ	63h
     140 = 03D0                      C	MC6845R0	equ	03D0h
     141 = 03D1                      C	MC6845R1	equ	03D1h
     142 = 03D2                      C	MC6845R2	equ	03D2h
     143 = 03D3                      C	MC6845R3	equ	03D3h
     144 = 03D4                      C	MC6845R4	equ	03D4h
     145 = 03D5                      C	MC6845R5	equ	03D5h
     146 = 03D6                      C	MC6845R6	equ	03D6h
     147 = 03D7                      C	MC6845R7	equ	03D7h
     148 = 03D8                      C	CGAMODE		equ	03D8h
     149 = 03D9                      C	CGACOLOR	equ	03D9h
     150 = 03DA                      C	CGASTAT		equ	03DAh
     151 = 03DB                      C	LPENCLR		equ	03DBh
     152 = 03DC                      C	LPENSET		equ	03DCh
     153			     C	; 8272 layout, which differs from NEC D765
     154 = 03F0                      C	FDPORT		EQU	03F0H		;BASE PORT ADDRESS FOR CONTROLLER (F0-F7)
     155 =                           C	FDCS		EQU	FDPORT		;STATUS REGISTER
     156 = 03F1                      C	FDCD		EQU	FDPORT+1	;DATA REGISTER
     157 = 03F2                      C	FDMA		EQU	FDPORT+2	;DMA ADDRESS (WHEN WRITE)
     158 = 03F2                      C	INTS		EQU	FDPORT+2	;STATUS REGISTER (WHEN READ)
     159			     C	; D765 Layout
     160			     C	;FDCP		EQU	FDPORT+2	;Control Port
     161			     C	;INTS		EQU	FDPORT+4	;Main Status Register
     162			     C	;FDCD		EQU	FDPORT+5	;Data Register
     163			     C	
     164			     C	
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-4


     165				
     166 = 0000				Int00v		equ	0			; (0000:0000=0CA60h)  0 DIV/0
     167 = 0004				Int01v		equ	4			; (0000:0004=0F4h)    1 SST
     168 = 0018				Int06v		equ	18h			; (0000:0018=0CA60h)  6 invalid opcode
     169 = 0020				Int08v		equ	20h			; (0000:0020=0FEA5h)  8 Timer hardware IRQ
     170 = 0024				Int09v		equ	24h			; (0000:0024=0E987h)  9 Keyboard IRQ
     171 = 002C				Int0Bv		equ	2Ch			; (0000:002C=0CE80h) 0B serial 2 IRQ
     172 = 0030				Int0Cv		equ	30h			; (0000:0030=0CE80h) 0C serial 1 IRQ
     173 = 0034				Int0Dv		equ	34h			; (0000:0034=3ADBh)  0D hard disk IRQ
     174 = 0040				Int10v		equ	40h			; (0000:0040=0EEh)   10 video
     175 = 0044				Int11v		equ	44h			; (0000:0044=0CB20h) 11 equipment
     176 = 0048				Int12v		equ	48h			; (0000:0048=0CB40h) 12 memory size
     177 = 004C				Int13v		equ	4Ch			; (0000:004C=0CF60h) 13 diskette/HD I/O
     178 = 0050				Int14v		equ	50h			; (0000:0050=0CB80h) 14 serial
     179 = 0054				Int15v		equ	54h			; (0000:0054=0CBA0h) 15 system services
     180 = 0058				Int16v		equ	58h			; (0000:0058=0CFC0h) 16 keyboard
     181 = 005C				Int17v		equ	5Ch			; (0000:005C=0CBC0h) 17 printer
     182 = 0060				Int18v		equ	60h			; (0000:0060=0CD00h) 18 Basic ROM
     183 = 0064				Int19v		equ	64h			; (0000:0064=0CC60h) 19 IPL
     184 = 0068				Int1Av		equ	68h			; (0000:0068=0CBE0h) 1A TOD
     185 = 006C				Int1Bv		equ	6Ch			; (0000:006C=0D1C0h) 1B Keyboard BREAK addr
     186 = 0070				Int1Cv		equ	70h			; (0000:0070=0CC00h) 1C user timer
     187 = 0074				Int1Dv		equ	74h			; (0000:0074=0C958h) 1D 6845 video init
     188 = 0078				Int1Ev		equ	78h			; (0000:0078=0CA60h) 1E DPB
     189 = 007C				Int1Fv		equ	7Ch			; (0000:007C=5E9h)   1F video graphic table
     190				
     191 = 7C00				IPLLOC		equ	7C00h			;*(0000:7C00=0)	boot location
     192 = 0000				data_49e	equ	0			;*(1000:0000=75h)
     193 = 03FE				data_50e	equ	3FEh			;*(1040:03FE=3)
     194				; Outside of ROM address
     195 = 2000				data_121e	equ	2000h			;*(A.2000=0)
     196 = 2001				data_122e	equ	2001h			;*(A.2001=0)
     197				; Also odd location
     198 = 0049				data_123e	equ	49h			; (C000:0049=0)
     199				
     200				; The Lomas BIOS doesn't produce error codes, but these might be useful.
     201 = 0001				ER_BIOS equ     01h             ; Bad ROM bios checksum, patch last byte
     202 = 0002				ER_RAM  equ     02h             ; Bad RAM in main memory, replace
     203 = 0004				ER_CRT  equ     04h             ; Bad RAM in video card, replace
     204 = 0010				ER_MEM  equ     10h             ; Bad RAM in vector area, replace
     205 = 0020				ER_ROM  equ     20h             ; Bad ROM in expansion area, bad checksum
     206				
     207 = 000A				LF      equ     0Ah
     208 = 000D				CR      equ     0Dh
     209				
     210				
     211				;===============================================================================
     212				;  Compiler directives
     213				;
     214				.LFCOND                                         ; List  False  Conditionals
     215				.186
     216				ASSUME  DS:data, SS:code, CS:code, ES:code
     217				
     218				
     219				;===============================================================================
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-5


     220				;  Data segment - BIOS Data Segment
     221				;
     222 0000				data	segment at 40H				; IBM compatible data structures
     223 0000  0004[			rs232_port_1	dw	4 dup (?)		; (0040:0000=3F8h)
     224	   ????			
     225			 ]	
     226				
     227 0008  0004[			prn_port_1	dw	4 dup (?)		; (0040:0008=378h)
     228	   ????			
     229			 ]	
     230				
     231 0010  0000			equip_bits	dw	?			; (0040:0010=4467h)
     232 0012  00			mfg_test	db	?			; 0012
     233 0013  0000			main_ram_size	dw	?			; (0040:0013=280h)
     234 0015  00			scratch1	db	? 			; scratch pad
     235 0016  00					db	?
     236				;---------------[Keyboard data area]------------;
     237 0017  00			keybd_flags_1	db	?			; (0040:0017=0)
     238 0018  00			keybd_flags_2	db	?			; (0040:0018=0)
     239 0019  00			keybd_alt_num	db	?			; (0040:0019=0)
     240 001A  0000			keybd_q_head	dw	?			; (0040:001A=30h)
     241 001C  0000			keybd_q_tail	dw	?			; (0040:001C=30h)
     242 001E  0010[			keybd_buff	dw	16 dup (?)		; 001E
     243	   ????			
     244			 ]	
     245				
     246				;---------------[Diskette data area]------------;
     247 003E  00			dsk_recal_stat	db	?			; (0040:003E=0)
     248 003F  00			dsk_motor_stat	db	?			; (0040:003F=0)
     249 0040  00			dsk_motor_tmr	db	?			; (0040:0040=0)
     250 0041  00			dsk_ret_code	db	?			; (0040:0041=0)
     251 0042  0007[			nec_stat	db	7 dup (?)		; (0040:0042=0)	NEC status 7 bytes
     252	   ??			
     253			 ]	
     254				
     255				;---------------[Video display area]------------;
     256 0049  00			video_mode	db	?			; (0040:0049=3)
     257 004A  0000			video_columns	dw	?			; (0040:004A=50h)
     258 004C  0000			video_buf_siz	dw	?			; (0040:004C=1000h)
     259 004E  0000			video_segment	dw	?			; (0040:004E=0)
     260 0050  0008[			vid_curs_pos0	dw	8 dup (?)		; (0040:0050=184Fh)
     261	   ????			
     262			 ]	
     263				
     264 0060  0000			vid_curs_mode	dw	?			; (0040:0060=2000h)
     265 0062  00			video_page	db	?			; (0040:0062=0)
     266 0063  0000			video_port	dw	?			; (0040:0063=3D4h)
     267 0065  00			video_mode_reg	db	?			; (0040:0065=29h)
     268 0066  00			video_color	db	?			; (0040:0066=30h)
     269				;---------------[Used to setup ROM]-------------;
     270 0067  0000 0000		gen_io_ptr	dw	?,?			; (0040:0067=0) ; Eprom base Offset,Segment
     271 006B  00			gen_int_occured	db	?			; (0040:006B=0) ; Last spurious interrupt IR
					Q
     272				;---------------[Timer data area]---------------;
     273 006C  0000			timer_low	dw	?			; (0040:006C=696Fh)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-6


     274 006E  0000			timer_hi	dw	?			; (0040:006E=16h)
     275 0070  00			timer_rolled	db	?			; (0040:0070=0)
     276				;---------------[System data area]--------------;
     277 0071  00			signbit		db      ?		; 40:71 ; Sign bit set if break
     278 0072  0000			warmboot	dw      ?		; 40:72 ; Warm boot if 1234h value
     279				;---------------[Hard disk scratchpad]----------;
     280 0074  0004[			HD		db	4 dup (0)  	; 40:74 ; scratch pad area
     281	   00			
     282			 ]	
     283				
     284				;---------------[Timout areas/PRT/LPT]----------;
     285 0078  0004[			lptto		db      4 dup(?)        ; 40:78 ; Ticks for LPT 1-4 timeouts
     286	   ??			
     287			 ]	
     288				
     289 007C  0004[			comto 		db      4 dup(?)        ; 40:7C ; Ticks for COM 1-4 timeouts
     290	   ??			
     291			 ]	
     292				
     293				;---------------[Keyboard buf start/nd]---------;
     294				; 	dw      ?               ; 40:80         ; Contains 1Eh, buffer start
     295				;	dw      ?               ; 40:82         ; Contains 3Eh, buffer end
     296				;
     297				; SCSI -- might not be needed if using card with option ROM because work space
     298				; would be allocated from there. This table is 25 bytes (19h) long.
     299				IF	SCSI
     300 0080  0000				COMMAND_TABLE	dw	?		;command offset pointer
     301 0082  0000				CMND_PTR	dw	?		;segment of commands
     302 0084  0000				CMND_SEG	dw	?		;segment of commands
     303 0086  0000				TRANS_CNT	dw	?		;will read 512 bytes
     304 0088  0000				SDMA_OFF	dw	?		;buffer pointer
     305 008A  0000				SDMA_SEG	dw	?		;segment of buffer pointer
     306 008C  00				SCSI_STATUS_IN	db	?		;status in
     307 008D  00				SCSI_STATUS_OUT	db	?		;status out
     308 008E  00				SCSI_MSG_IN	db	?		;received message
     309 008F  00				SCSI_MSG_OUT	db	?		;send message
     310 0090  00				SCSI_MSG_FLAG	db	?		;send message flag
     311				
     312 0091  00				READ_WRITE_BLOCK	db	?	;read command for 8425
     313 0092  00				SCSI_CMND_CNT		db	?	;number of byte in the command
     314 0093  00				SCSI_CMND		db	?	;read command
     315 0094  00				BLOCK_HIGH		db	?	;msb of 21 bit block address, low 5 bits of 
					byte
     316 0095  00				BLOCK_MIDDLE		db	?	;middle bbyte of address
     317 0096  00				BLOCK_LOW		db	?	;low byte of address
     318 0097  00				SCOUNT			db	?	;number of blocks to read, 0 =256
     319 0098  00				CONTROL_BYTE		db	?	;control byte is always 0
     320				ENDIF
     321				
     322 0099				data	ends
     323				
     324				;===============================================================================
     325				;  D O S   D A T A   S E G M E N T
     326				;===============================================================================
     327				; probably not needed for the Lomas but might be used for hard disk
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-7


     328				; sector data.
     329 0000				dosdir  SEGMENT at 50h                          ; Boot disk directory from IPL
     330 0000				xerox   label   byte                            ;  0 if Print Screen idle
     331				                                                ;  1 if PrtSc xeroxing screen
     332				                                                ;255 if PrtSc error in xerox
     333				                                                ;  ...non-grafix PrtSc in bios
     334 0000  0200[			        db      200h dup(?)                     ; PC-DOS bootstrap procedure
     335	   ??			
     336			 ]	
     337				
     338				                                                ;  ...IO.SYS buffers the
     339				                                                ;  ...directory of the boot
     340				                                                ;  ...device here at IPL time
     341				                                                ;  ...when locating the guts
     342				                                                ;  ...of the operating system
     343				                                                ;  ...filename "MSDOS.SYS"
     344 0200				dosdir  ends
     345				
     346				
     347				;===============================================================================
     348				;  I O . S Y S   D A T A   S E G M E N T  (IO.SYS initial load segment)
     349				;===============================================================================
     350				;dosseg  SEGMENT at 70h                          ; "Kernel" of PC-DOS op sys
     351				
     352				;IO.SYS driver/bootstrap code loaded by the boot block to       CONTIGUOUS<---
     353				;	70:0 Usually loads the first 3 sectors of IO.SYS.		     |
     354				;MSDOS.SYS operating system kernel immediately follows IO.SYS and            |
     355				;	doesn`t have to be contiguous. The DOS operating system		     |
     356				;	binary image is loaded by transient code in IO.SYS.	             |
     357				;dosseg  ends                                    ;                            |
     358				
     359				
     360				;===============================================================================
     361				;  I P L   D A T A   S E G M E N T  (loaded with bootstrap code from MBR)
     362				;===============================================================================
     363				;iplseg  SEGMENT at 0h                           ; Segment for boot block      |
     364				;The following boot block is loaded with 512 bytes on the first sector of     |
     365				;the bootable device by code resident in the ROM-resident bios.  Control is   |
     366				;then transferred to the first word 0000:7C00 of the disk-resident bootstrap  |
     367				;        ORG     07C00h                          ;  ..offset for boot block    |
     368				;boot    db      200h dup(?)                     ;  ..start disk resident boot--
     369				;iplseg  ends
     370				
     371				
     372				;===============================================================================
     373				;  C O D E   S E G M E N T  (BIOS code segment)
     374				;===============================================================================
     375 0000				code    SEGMENT
     376				
     377				entry   macro   x
     378				        pad     =BANNER - $ + x	; - 0E000h
     379				        if pad LT 0
     380				        .err
     381				        %out    'No room for ENTRY point'
     382				        endif
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-8


     383				        if pad GT 0
     384				        db      pad DUP(0)
     385				        endif
     386				endm
     387				
     388				jmpf    macro   x,y
     389				        db      0EAh;
     390				        dw      y,x
     391				endm
     392				
     393				
     394				; this code sits at F:E000
     395				;	org	0E000h	
     396 0000					org	0		; zero-start ROM
     397 0000  4C 44 50 20 54 48	banner: 	db	"LDP THUNDER REV 1.0 10/21/85", 0ah, 0dh, 0
     398       55 4E 44 45 52 20	
     399       52 45 56 20 31 2E	
     400       30 20 31 30 2F 32	
     401       31 2F 38 35 0A 0D	
     402       00			
     403				
     404				; Continues from CPU initialization code at 1C00h initializes the 80186
     405				; internal registers. The expansion ROM call has to occur after the hardware
     406				; initializes but before video.
     407 001F				COLD2:
     408 001F  FA			        	cli
     409 0020  B8 8000			 		mov	ax,8000h 		; send EOI twice
     410 0023  BA FF22			 		mov	dx,0FF22h		; PCRBASE+ICR+EOIREG
     411 0026  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     412 0027  B8 8000			 		mov	ax,8000h
     413 002A  BA FF22			 		mov	dx,0FF22h		; PCRBASE+ICR+EOIREG
     414 002D  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     415				
     416				; test first 64k of RAM
     417 002E  FC			 		cld				; Clear direction
     418 002F  33 DB			 		xor	bx,bx			; Zero register
     419 0031  8E DB			 		mov	ds,bx
     420 0033  8E C3			 		mov	es,bx
     421 0035  B8 5555			 		mov	ax,5555h
     422 0038				loc_3:						;  xref A.0056
     423 0038  B9 8000			 		mov	cx,8000h
     424 003B  8B F3			 		mov	si,bx
     425 003D  8B FB			 		mov	di,bx
     426 003F  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
     427 0041  B9 8000			 		mov	cx,8000h
     428 0044  F3/ AF			 		repe	scasw			; Rep zf=1+cx >0 Scan es:[di] for ax
     429 0046  E3 06			 		jcxz	loc_4			; Jump if cx=0
     430 0048  BA 0066			 		mov	dx,66h
     431 004B  E9 0597 R		 		jmp	DynHalt			; (0597) memory test error?
     432				
     433 004E				loc_4:						;  xref A.0046
     434 004E  3D AAAA					cmp	ax,0AAAAh
     435 0051  74 05			 		je	loc_5			; Jump if equal
     436 0053  B8 AAAA			 		mov	ax,0AAAAh
     437 0056  EB E0			 		jmp	short loc_3		; (0038)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-9


     438				
     439				; this clears 64k of RAM.
     440 0058				loc_5:						;  xref A.0051
     441 0058  B8 0000			 		mov	ax,0
     442 005B  B9 8000			 		mov	cx,8000h
     443 005E  8B F8			 		mov	di,ax
     444 0060  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
     445				
     446				; grab DIV/0 and SST vectors
     447 0062  B8 0113 R		 		mov	ax,offset INT00HANDLER	;113h
     448 0065  A3 0000			 		mov	ds:Int00v,ax		; (0000:0000=0CA60h)
     449 0068  8C 0E 0002		 		mov	ds:Int00v+2,cs		; (0000:0002=0F000h)
     450 006C  BE 0000			 		mov	si,Int00v		; (0000:0000=60h)
     451 006F  BF 0004			 		mov	di,Int01v		; (0000:0004=0F4h)
     452				
     453				;fill interrupt table with default vector pointing to INT00
     454 0072  B9 01FE			 		mov	cx,1FEh
     455 0075  F3/ A5			 		rep	movsw			; Rep when cx >0 Mov [si] to es:[di]
     456				
     457				; set invalid opcode handler
     458 0077  B8 00E0 R		 		mov	ax,offset INT06HANDLER	;0E0h
     459 007A  A3 0018			 		mov	ds:Int06v,ax		; (0000:0018=0CA60h)
     460 007D  8C 0E 001A		 		mov	ds:Int06v+2,cs		; (0000:001A=0F000h)
     461				
     462				; do main ROM checksum. It's odd that if the checksum fails, it
     463				; continues booting anyway. In the IBM PC, the PC halts.
     464 0081  FA			 		cli				; Disable interrupts
     465 0082  B8 0030			 		mov	ax,30h
     466 0085  8E D0			 		mov	ss,ax
     467 0087  BC 0100			 		mov	sp,100h
     468 008A  E8 0FB1 R		 		call	sub_32			; (0FB1)
     469 008D  E8 0140 R		 		call	DoChecksum		; (0140)
     470 0090  74 06			 		jz	loc_6			; Jump if zero
     471 0092  BE 00C9 R		 		mov	si,offset msg1		; (A.00C9='ROM checksum fai')
     472 0095  E8 05E5 R		 		call	prtzstr			; (05E5)
     473				; display boot message and assign key vectors. In the IBM PC,
     474				; the video sign-on is the last thing done after it passes
     475				; all hardware tests and all subsystems are initialized. In the Lomas
     476				; the sign-on message is printed before much of that is done, and
     477				; no hardware tests, other than memory, are performed.
     478 0098				loc_6:						;  xref A.0090
     479 0098  BE 0000 R		 		mov	si,offset banner	; (A.0000=4Ch)
     480 009B  E8 05E5 R		 		call	prtzstr			; (05E5)
     481 009E  E8 0473 R		 		call	sub_7			; (0473) vectors 18, 19, 15, 1B, 11 and 1C
     482 00A1  E8 04B5 R		 		call	sub_8			; (04B5) vectors 0C, 08, 1A and timers
     483 00A4  E8 01BF R		 		call	sub_2			; (01BF) ram sizing
     484 00A7  E8 0AD4 R		 		call	sub_28			; (0AD4) vectors 16, 0D, 09 keyboard
     485 00AA  E8 05F6 R		 		call	sub_11			; (05F6) vectos 13, 0B, 1E
     486				;*****
     487				; This might be a good place to put the expansion ROM code. But, we may want
     488				;	to swap the position of the disk reset with the two other vector traps
     489				;	although a regular SCSI card is unlikely to trap serial/parallel ports.
     490				;	Since the LomasSCSI has 4 serial ports, unsure if this is important.
     491				;		call	EXPROM
     492				;*****
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-10


     493 00AD  B4 00			 		mov	ah,0
     494 00AF  CD 13			 		int	13h			; Disk  dl=drive ?  ah=func 00h
     495				 						;  reset disk, al=return status
     496 00B1  E8 02BC R		 		call	sub_4			; (02BC) vector 14 serial 0
     497 00B4  E8 0224 R		 		call	sub_3			; (0224) vector 17 printer
     498				; re-send EOIs
     499 00B7  B8 8000			 		mov	ax,8000h
     500 00BA  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
     501 00BD  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     502 00BE  B8 8000			 		mov	ax,8000h
     503 00C1  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
     504 00C4  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
     505 00C5  FB			 		sti				; Enable interrupts
     506 00C6  E9 0151 R		 		jmp	SysBoot			; (0151) boot the floppy drive
     507				
     508 00C9  52 4F 4D 20 63 68	msg1:		db	'ROM checksum failure', 0Ah, 0Dh, 0
     509       65 63 6B 73 75 6D	
     510       20 66 61 69 6C 75	
     511       72 65 0A 0D 00		
     512				
     513				 ;a.00e0
     514 00E0				INT06HANDLER:
     515 00E0  55			 		push	bp
     516 00E1  8B EC			 		mov	bp,sp
     517 00E3  50			 		push	ax
     518 00E4  53			 		push	bx
     519 00E5  51			 		push	cx
     520 00E6  52			 		push	dx
     521 00E7  56			 		push	si
     522 00E8  57			 		push	di
     523 00E9  BE 00FA R		 		mov	si,offset msg2
     524 00EC  E8 05E5 R		 		call	prtzstr
     525 00EF				data_79:
     526 00EF  FF 46 02			 		inc	word ptr [bp+2]
     527 00F2  5F			 		pop	di
     528 00F3  5E			 		pop	si
     529 00F4  5A			 		pop	dx
     530 00F5  59			 		pop	cx
     531 00F6  5B			 		pop	bx
     532 00F7  58			 		pop	AX
     533 00F8  5D					pop	bp
     534 00F9  CF			 		iret
     535				
     536 00FA  42 61 64 20 6F 70	msg2:		db	'Bad opcode encountered', 0Ah, 0Dh,0
     537       63 6F 64 65 20 65	
     538       6E 63 6F 75 6E 74	
     539       65 72 65 64 0A 0D	
     540       00			
     541				
     542				;a.0113
     543 0113				INT00HANDLER:
     544 0113  50			 		push	ax
     545 0114  53			 		push	bx
     546 0115  51			 		push	cx
     547 0116  52			 		push	dx
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-11


     548 0117  56			 		push	si
     549 0118  57			 		push	di
     550 0119  BE 0126 R		 		mov	si,offset msg3
     551 011C  E8 05E5 R		 		call	prtzstr
     552 011F  5F			 		pop	di
     553 0120  5E			 		pop	si
     554 0121  5A			 		pop	dx
     555 0122  59			 		pop	cx
     556 0123  5B			 		pop	bx
     557 0124  58			 		pop	AX
     558 0125  CF			 		iret
     559				;a.0126
     560 0126  42 61 64 20 69 6E	msg3:		db	'Bad interrupt received.', 0Ah, 0Dh,0
     561       74 65 72 72 75 70	
     562       74 20 72 65 63 65	
     563       69 76 65 64 2E 0A	
     564       0D 00			
     565				
     566				
     567				
     568				;===============================================================================
     569				;                              SUBROUTINE
     570				;
     571				;         Called from:   A.008D
     572				;===============================================================================
     573				;a.0140
     574 0140				DoChecksum	proc	near
     575 0140  BB 0000			 		mov	bx,0			; (A.0000=4Ch)
     576 0143  B0 00			 		mov	al,0
     577 0145  B9 2000			 		mov	cx,2000h
     578				
     579 0148				locloop_7:					;  xref A.014C
     580 0148  2E: 02 07		 		add	al,cs:[bx]
     581 014B  43			 		inc	bx
     582 014C  E2 FA			 		loop	locloop_7		; Loop if cx > 0
     583				
     584 014E  84 C0			 		test	al,al
     585 0150  C3			 		retn
     586 0151				DoChecksum	endp
     587				
     588				;===============================================================================
     589				;  Boot the Diskette
     590				;===============================================================================
     591				;a.0151
     592 0151				SysBoot:					;  xref A.00C6, 017E
     593 0151  BE 0185 R		 		mov	si,offset msg4		;185h	; (A.0185='Attempting to ')
     594 0154  E8 05E5 R		 		call	prtzstr			; (05E5)
     595 0157  33 C0			 		xor	ax,ax			; Zero register
     596 0159  8E C0			 		mov	es,ax
     597 015B  B9 0004			 		mov	cx,4			; 4 retries
     598				
     599 015E				locloop_9:					;  xref A.0166
     600 015E  51			 		push	cx
     601 015F  B4 00			 		mov	ah,0
     602 0161  CD 13			 		int	13h			; Disk  dl=drive a  ah=func 00h
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-12


     603				 						;  reset disk, al=return status
     604 0163  59			 		pop	cx
     605 0164  73 02			 		jnc	loc_10			; Jump if carry=0
     606 0166  E2 F6			 		loop	locloop_9		; Loop if cx > 0
     607				
     608 0168				loc_10:						;  xref A.0164
     609 0168  BB 7C00			 		mov	bx,IPLLOC		; 07c00h (0000:7C00=0)
     610 016B  8B D0			 		mov	dx,ax			; head 0, drive a
     611 016D  B9 0001			 		mov	cx,1			; cyl 0, sector 1
     612 0170  B0 08			 		mov	al,8			; 8 sectors
     613 0172  B4 02			 		mov	ah,2			; func 2
     614 0174  CD 13			 		int	13h			; Disk  dl=drive a  ah=func 02h
     615				 						;  read sectors to memory es:bx
     616				 						;   al=#,ch=cyl,cl=sectr,dh=head
     617 0176  73 08			 		jnc	loc_11			; all good, jump to boot code
     618 0178  B9 0019			 		mov	cx,19h
     619 017B  E8 0468 R		 		call	sub_6			; (0468) delay
     620 017E  EB D1			 		jmp	short SysBoot		; (0151)
     621				
     622				; Jump to the loaded boot sector
     623 0180				loc_11:						;  xref A.0176
     624						jmpf	0,IPLLOC
     625 0180  EA                    1	        db      0EAh; 
     626 0181  7C00 0000             1	        dw      IPLLOC,0 
     627				;		db	0EAh
     628				; 		dw	7C00h, 0
     629				
     630 0185  41 74 74 65 6D 70	msg4:		db	'Attempting to boot from diskette.', 0Dh, 0Ah, 0
     631       74 69 6E 67 20 74	
     632       6F 20 62 6F 6F 74	
     633       20 66 72 6F 6D 20	
     634       64 69 73 6B 65 74	
     635       74 65 2E 0D 0A 00	
     636				
     637				 ;a.01a9
     638				 ; Get memory size in AX
     639 01A9				INT12HANDLER:
     640 01A9  1E			        push   ds
     641 01AA  B8 0040			        mov    ax,40h
     642 01AD  8E D8			        mov    ds,ax
     643 01AF  A1 0013 R		        mov    ax,ds:main_ram_size	; 40:13 memory size in kbytes (INT 12h)
     644 01B2  1F			        pop    ds
     645 01B3  CF			        iret
     646				
     647				 ;a.01b4
     648				 ; get equipment list
     649 01B4				INT11HANDLER:
     650 01B4  1E			        push   ds
     651 01B5  B8 0040			        mov    ax,40h
     652 01B8  8E D8			        mov    ds,ax
     653 01BA  A1 0010 R		        mov    ax,ds:equip_bits		; 40:10 equip list (INT 11h)
     654 01BD  1F			        pop    ds
     655 01BE  CF			        iret
     656				
     657				
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-13


     658				;===============================================================================
     659				 ;                              SUBROUTINE
     660				 ;
     661				 ;         Called from:   A.00A4
     662				;===============================================================================
     663				;a.1bf 
     664				; this tests all RAM
     665 01BF				sub_2		proc	near
     666 01BF  FC			 		cld				; Clear direction
     667 01C0  1E			 		push	ds
     668 01C1  06			 		push	es
     669 01C2  B8 0040			 		mov	ax,40h
     670 01C5  8E D8			 		mov	ds,ax
     671 01C7  BB 1000			 		mov	bx,1000h
     672 01CA  C7 06 0013 R 0040	 		mov	word ptr ds:main_ram_size,40h	; (0040:0013=280h)
     673 01D0  B8 55AA			 		mov	ax,55AAh
     674 01D3  BA AA55			 		mov	dx,0AA55h
     675 01D6  BF 03FE			 		mov	di,data_50e		; (1040:03FE=3)
     676 01D9				loc_12:						;  xref A.01F2
     677 01D9  8E C3			 		mov	es,bx
     678 01DB  26: 89 05		 		mov	es:[di],ax
     679 01DE  52			 		push	dx
     680 01DF  5A			 		pop	dx
     681 01E0  26: 39 05		 		cmp	es:[di],ax
     682 01E3  75 0F			 		jne	loc_13			; Jump if not equal
     683 01E5  FF 06 0013 R		 		inc	word ptr ds:main_ram_size	; (0040:0013=280h)
     684 01E9  83 C3 40			 		add	bx,40h
     685 01EC  81 FB B7FF		 		cmp	bx,0B7FFh
     686 01F0  73 02			 		jae	loc_13			; Jump if above or =
     687 01F2  EB E5			 		jmp	short loc_12		; (01D9)
     688 01F4				loc_13:						;  xref A.01E3, 01F0
     689 01F4  A1 0013 R		 		mov	ax,ds:main_ram_size	; (0040:0013=280h)
     690 01F7  2D 0040			 		sub	ax,40h
     691 01FA  8B C8			 		mov	cx,ax
     692 01FC  BB 1000			 		mov	bx,1000h
     693 01FF  B8 0000			 		mov	ax,0
     694				
     695 0202				locloop_14:					;  xref A.0211
     696 0202  BF 0000			 		mov	di,data_49e		; (1000:0000=75h)
     697 0205  8E C3			 		mov	es,bx
     698 0207  51			 		push	cx
     699 0208  B9 0200			 		mov	cx,200h
     700 020B  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
     701 020D  59			 		pop	cx
     702 020E  83 C3 40			 		add	bx,40h
     703 0211  E2 EF			 		loop	locloop_14		; Loop if cx > 0
     704				
     705 0213  33 C0			 		xor	ax,ax			; Zero register
     706 0215  8E D8			 		mov	ds,ax
     707 0217  B8 01A9 R		 		mov	ax,offset INT12HANDLER	;1A9h
     708 021A  A3 0048			 		mov	ds:Int12v,ax		; (0000:0048=0CB40h)
     709 021D  8C 0E 004A		 		mov	ds:Int12v+2,cs		; (0000:004A=0F000h)
     710 0221  07			 		pop	es
     711 0222  1F			 		pop	ds
     712 0223  C3			 		retn
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-14


     713 0224				sub_2		endp
     714				
     715				
     716				;===============================================================================
     717				 ;                              SUBROUTINE
     718				 ;
     719				 ;         Called from:   A.00B4
     720				;===============================================================================
     721				;a.0224 
     722				; Grab INT17 (printer) vector
     723 0224				sub_3		proc	near
     724 0224  1E			 		push	ds
     725 0225  33 C0			 		xor	ax,ax			; Zero register
     726 0227  8E D8			 		mov	ds,ax
     727 0229  B8 0244 R		 		mov	ax,offset INT17HANDLER	;244h
     728 022C  A3 005C			 		mov	ds:Int17v,ax		; (0000:005C=0CBC0h)
     729 022F  8C 0E 005E		 		mov	ds:Int17v+2,cs		; (0000:005E=0F000h)
     730 0233  B8 0040			 		mov	ax,40h
     731 0236  8E D8			 		mov	ds,ax
     732 0238  C7 06 0008 R 00D0	 		mov	word ptr ds:prn_port_1,0D0h	; (0040:0008=378h)
     733 023E  1F			 		pop	ds
     734 023F  B4 01			 		mov	ah,1
     735 0241  CD 17			 		int	17h			; Printer  dx=prn?, ah=func 01h
     736				 						;  initialize, ah=return status
     737 0243  C3			 		retn
     738 0244				sub_3		endp
     739				
     740				;a.0244
     741				; Int17 handler
     742 0244				INT17HANDLER:
     743 0244  FB			 		sti				; Enable interrupts
     744 0245  1E			 		push	ds
     745 0246  52			 		push	dx
     746 0247  51			 		push	cx
     747 0248  53			 		push	bx
     748 0249  56			 		push	si
     749 024A  BB 0040			 		mov	bx,40h
     750 024D  8E DB			 		mov	ds,bx
     751 024F  84 E4			 		test	ah,ah
     752 0251  74 0E			 		jz	loc_16			; Jump if zero
     753 0253  FE CC			 		dec	ah
     754 0255  74 35			 		jz	loc_19			; Jump if zero
     755 0257  FE CC			 		dec	ah
     756 0259  74 50			 		jz	loc_20			; Jump if zero
     757 025B				loc_15:						;  xref A.0277, 02BA
     758 025B  5E			 		pop	si
     759 025C  5B			 		pop	bx
     760 025D  59			 		pop	cx
     761 025E  5A			 		pop	dx
     762 025F  1F			 		pop	ds
     763 0260  CF			 		iret				; Interrupt return
     764 0261				loc_16:						;  xref A.0251
     765 0261  50			 		push	ax
     766 0262  B3 32			 		mov	bl,32h			; '2'
     767 0264  33 C9			 		xor	cx,cx			; Zero register
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-15


     768 0266  E6 D0			 		out	0D0h,al		; port 0D0h, DMA-2 command reg
     769				
     770 0268				locloop_17:					;  xref A.026E, 0272
     771 0268  E4 D2			 		in	al,0D2h		; port 0D2h ??I/O Non-standard
     772 026A  A8 20			 		test	al,20h			; ' '
     773 026C  74 0B			 		jz	loc_18			; Jump if zero
     774 026E  E2 F8			 		loop	locloop_17		; Loop if cx > 0
     775				
     776 0270  FE CB			 		dec	bl
     777 0272  75 F4			 		jnz	locloop_17		; Jump if not zero
     778 0274  80 CC 01			 		or	ah,1
     779 0277  EB E2			 		jmp	short loc_15		; (025B)
     780				;a.0279		
     781 0279				loc_18:						;  xref A.026C
     782 0279  B0 01			 		mov	al,1
     783 027B  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
     784 027D  50			 		push	ax
     785 027E  58			 		pop	ax
     786 027F  B0 00			 		mov	al,0
     787 0281  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
     788 0283  50			 		push	ax
     789 0284  58			 		pop	ax
     790 0285  B0 01			 		mov	al,1
     791 0287  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
     792 0289  58			 		pop	ax
     793 028A  EB 1F			 		jmp	short loc_20		; (02AB)
     794				;a.028c
     795 028C				loc_19:						;  xref A.0255
     796 028C  50			 		push	ax
     797 028D  B0 01			 		mov	al,1
     798 028F  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
     799 0291  50			 		push	ax
     800 0292  58			 		pop	ax
     801 0293  B0 03			 		mov	al,3
     802 0295  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
     803 0297  50			 		push	ax
     804 0298  58			 		pop	ax
     805 0299  B0 06			 		mov	al,6
     806 029B  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
     807 029D  50			 		push	ax
     808 029E  58			 		pop	ax
     809 029F  B0 04			 		mov	al,4
     810 02A1  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
     811 02A3  E8 08C3 R		 		call	sub_17			; (08C3)
     812 02A6  B0 05			 		mov	al,5
     813 02A8  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
     814 02AA  58			 		pop	ax
     815				;a.02ab		
     816 02AB				loc_20:						;  xref A.0259, 028A
     817 02AB  50			 		push	ax
     818 02AC  E4 D2			 		in	al,0D2h			; port 0D2h ??I/O Non-standard
     819 02AE  B3 10			 		mov	bl,10h
     820 02B0  A8 20			 		test	al,20h			; ' '
     821 02B2  74 03			 		jz	loc_21			; Jump if zero
     822 02B4  80 CB 80			 		or	bl,80h
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-16


     823 02B7				loc_21:						;  xref A.02B2
     824 02B7  58			 		pop	ax
     825 02B8  8A E3			 		mov	ah,bl
     826 02BA  EB 9F			 		jmp	short loc_15		; (025B)
     827				
     828				;===============================================================================
     829				 ;                              SUBROUTINE
     830				 ;
     831				 ;         Called from:   A.00B1
     832				;===============================================================================
     833				;a.02bc
     834				; Grab INT14 serial vector
     835 02BC				sub_4		proc	near
     836 02BC  1E			 		push	ds
     837 02BD  33 C0			 		xor	ax,ax	
     838 02BF  8E D8			 		mov	ds,ax
     839 02C1  B8 02E2 R		 		mov	ax,offset INT14HANDLER	;2E2h
     840 02C4  A3 0050			 		mov	ds:Int14v,ax		; (0000:0050=0CB80h)
     841 02C7  8C 0E 0052		 		mov	ds:Int14v+2,cs		; (0000:0052=0F000h)
     842 02CB  B8 0040			 		mov	ax,40h
     843 02CE  8E D8			 		mov	ds,ax
     844				; should code bb 00 00
     845 02D0  BB 0000 R		 		mov	bx,offset rs232_port_1		; (0040:0000=0F8h)
     846 02D3  B8 0080			 		mov	ax,80h
     847 02D6  89 07			 		mov	[bx],ax
     848 02D8  B8 00C0			 		mov	ax,0C0h
     849 02DB  83 C3 02			 		add	bx,2
     850 02DE  89 07			 		mov	[bx],ax
     851 02E0  1F			 		pop	ds
     852 02E1  C3			 		retn
     853 02E2				sub_4		endp
     854				
     855				;a.02e2
     856				; Int14 Handler
     857 02E2				INT14HANDLER:
     858 02E2  1E			 		push	ds
     859 02E3  52			 		push	dx
     860 02E4  56			 		push	si
     861 02E5  57			 		push	di
     862 02E6  53			 		push	bx
     863 02E7  51			 		push	cx
     864 02E8  8B F2			 		mov	si,dx
     865 02EA  D1 E6			 		shl	si,1			; Shift w/zeros fill
     866 02EC  BA 0040			 		mov	dx,40h
     867 02EF  8E DA			 		mov	ds,dx
     868 02F1  8B 94 0000 R		 		mov	dx,ds:rs232_port_1[si]	; (0040:0000=3F8h)
     869 02F5  0B D2			 		or	dx,dx			; Zero ?
     870 02F7  74 19			 		jz	loc_24			; Jump if zero
     871 02F9  0A E4			 		or	ah,ah			; Zero ?
     872 02FB  74 1C			 		jz	loc_25			; Jump if zero
     873 02FD  FE CC			 		dec	ah
     874 02FF  75 03			 		jnz	loc_22			; Jump if not zero
     875 0301  E9 03AB R		 		jmp	loc_30			; (03AB)
     876 0304				loc_22:						;  xref A.02FF
     877 0304  FE CC			 		dec	ah
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-17


     878 0306  75 03			 		jnz	loc_23			; Jump if not zero
     879 0308  E9 03E6 R		 		jmp	loc_35			; (03E6)
     880 030B				loc_23:						;  xref A.0306
     881 030B  FE CC			 		dec	ah
     882 030D  75 03			 		jnz	loc_24			; Jump if not zero
     883 030F  E9 0454 R		 		jmp	loc_47			; (0454)
     884 0312				loc_24:						;  xref A.02F7, 030D, 03C5, 03DB
     885				 						;            03E3, 0402, 041D, 0465
     886 0312  59			 		pop	cx
     887 0313  5B			 		pop	bx
     888 0314  5F			 		pop	di
     889 0315  5E			 		pop	si
     890 0316  5A			 		pop	dx
     891 0317  1F			 		pop	ds
     892 0318  CF			 		iret				; Interrupt return
     893 0319				loc_25:						;  xref A.02FB
     894 0319  50			 		push	ax
     895 031A  B4 42			 		mov	ah,42h			; 'B'
     896 031C  8A D8			 		mov	bl,al
     897 031E  F6 C3 04			 		test	bl,4
     898 0321  74 03			 		jz	loc_26			; Jump if zero
     899 0323  80 CC C0			 		or	ah,0C0h
     900 0326				loc_26:						;  xref A.0321
     901 0326  80 CC 40			 		or	ah,40h			; '@'
     902 0329  D0 C3			 		rol	bl,1			; Rotate
     903 032B  B0 30			 		mov	al,30h			; '0'
     904 032D  22 C3			 		and	al,bl
     905 032F  0A E0			 		or	ah,al
     906 0331  D0 C3			 		rol	bl,1			; Rotate
     907 0333  B0 0C			 		mov	al,0Ch
     908 0335  22 C3			 		and	al,bl
     909 0337  0A E0			 		or	ah,al
     910 0339  83 C2 02			 		add	dx,2
     911 033C  B0 00			 		mov	al,0
     912 033E  B9 0003			 		mov	cx,3
     913				
     914				;a.0341
     915 0341				locloop_27:					;  xref A.0345
     916 0341  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
     917 0342  E8 08C3 R		 		call	sub_17			; (08C3)
     918 0345  E2 FA			 		loop	locloop_27		; Loop if cx > 0
     919				
     920 0347  B0 40			 		mov	al,40h			; '@'
     921 0349  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
     922 034A  E8 08C3 R		 		call	sub_17			; (08C3)
     923 034D  8A C4			 		mov	al,ah
     924 034F  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
     925 0350  58			 		pop	ax
     926 0351  D0 C0			 		rol	al,1			; Rotate
     927 0353  D0 C0			 		rol	al,1			; Rotate
     928 0355  D0 C0			 		rol	al,1			; Rotate
     929 0357  24 07			 		and	al,7
     930 0359  52			 		push	dx
     931 035A  81 FA 0082		 		cmp	dx,82h
     932 035E  77 05			 		ja	loc_28			; Jump if above
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-18


     933 0360  BA FF5A			 		mov	dx,0FF5Ah		;PCRBASE+T1CR+TMRCA
     934 0363  EB 03			 		jmp	short loc_29		; (0368)
     935 0365				loc_28:						;  xref A.035E
     936 0365  BA FF52			 		mov	dx,0FF52h		;PCRBASE+T0CR+TMRCA
     937				
     938 0368				loc_29:						;  xref A.0363
     939 0368  B4 00			 		mov	ah,0
     940 036A  D1 E0			 		shl	ax,1			; Shift w/zeros fill
     941 036C  D1 E0			 		shl	ax,1			; Shift w/zeros fill
     942 036E  BB 038B R		 		mov	bx,offset data_81	; (A.038B=38h)
     943 0371  03 D8			 		add	bx,ax
     944 0373  2E: 8B 07		 		mov	ax,cs:[bx]
     945 0376  EF			 		out	dx,ax			; port 0FF52h ??I/O Non-standard
     946 0377  83 C2 02			 		add	dx,2			;PCRBASE+T0CR+TMRCA
     947 037A  83 C3 02			 		add	bx,2
     948 037D  2E: 8B 07		 		mov	ax,cs:[bx]
     949 0380  E8 08C3 R		 		call	sub_17			; (08C3)
     950 0383  EF			 		out	dx,ax			; port 0FF54h ??I/O Non-standard
     951 0384  5A			 		pop	dx			; PCRBASE+T0CR+TMRCB
     952 0385  83 EA 02			 		sub	dx,2
     953 0388  E9 0454 R		 		jmp	loc_47			; (0454)
     954				
     955				; Int14 parameters?
     956				;a.038b
     957 038B				data_81:						; xref A.036E
     958 038B  38 02 38 02 A1 01	     		db	 38h, 02h, 38h, 02h,0A1h, 01h,0A1h
     959       A1			
     960 0392  01 D0 00 D1 00 68	     		db	 01h,0D0h, 00h,0D1h, 00h, 68h
     961 0398  00 68 00 34 00 34	     		db	 00h, 68h, 00h, 34h, 00h, 34h
     962 039E  00 1A 00 1A 00 0D	     		db	 00h, 1Ah, 00h, 1Ah, 00h, 0Dh
     963 03A4  00 0D 00 06 00 07	     		db	 00h, 0Dh, 00h, 06h, 00h, 07h
     964 03AA  00			 		db	 00h
     965				
     966 03AB				loc_30:						;  xref A.0301
     967 03AB  50			 		push	ax
     968 03AC  83 C2 02			 		add	dx,2
     969 03AF  B0 37			 		mov	al,37h			; '7'
     970 03B1  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
     971 03B2  33 C9			 		xor	cx,cx			; Zero register
     972 03B4  B3 04			 		mov	bl,4
     973				
     974 03B6				locloop_31:					;  xref A.03BB, 03BF
     975 03B6  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
     976 03B7  A8 80			 		test	al,80h
     977 03B9  75 0D			 		jnz	loc_32			; Jump if not zero
     978 03BB  E2 F9			 		loop	locloop_31		; Loop if cx > 0
     979				
     980 03BD  FE CB			 		dec	bl
     981 03BF  75 F5			 		jnz	locloop_31		; Jump if not zero
     982 03C1  58			 		pop	ax
     983 03C2  80 CC 80			 		or	ah,80h
     984 03C5  E9 0312 R		 		jmp	loc_24			; (0312)
     985 03C8				loc_32:						;  xref A.03B9
     986 03C8  33 C9			 		xor	cx,cx			; Zero register
     987 03CA  B3 02			 		mov	bl,2
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-19


     988				
     989 03CC				locloop_33:					;  xref A.03D1, 03D5
     990 03CC  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
     991 03CD  A8 01			 		test	al,1
     992 03CF  75 0D			 		jnz	loc_34			; Jump if not zero
     993 03D1  E2 F9			 		loop	locloop_33		; Loop if cx > 0
     994				
     995 03D3  FE CB			 		dec	bl
     996 03D5  75 F5			 		jnz	locloop_33		; Jump if not zero
     997 03D7  58			 		pop	ax
     998 03D8  80 CC 80			 		or	ah,80h
     999 03DB  E9 0312 R		 		jmp	loc_24			; (0312)
    1000 03DE				loc_34:						;  xref A.03CF
    1001 03DE  83 EA 02			 		sub	dx,2
    1002 03E1  58			 		pop	ax
    1003 03E2  EE			 		out	dx,al			; port 0, DMA-1 bas&add ch 0
    1004 03E3  E9 0312 R		 		jmp	loc_24			; (0312)
    1005 03E6				loc_35:						;  xref A.0308
    1006				; 		and	byte ptr ds:[71h],7Fh	; (A.0071=0) signbit
    1007 03E6  80 26 0071 R 7F				and	byte ptr ds:[signbit],7Fh
    1008 03EB  83 C2 02			 		add	dx,2
    1009 03EE  B0 37			 		mov	al,37h			; '7'
    1010 03F0  EE			 		out	dx,al			; port 2, DMA-1 bas&add ch 1
    1011 03F1  33 C9			 		xor	cx,cx			; Zero register
    1012 03F3  B3 04			 		mov	bl,4
    1013				
    1014				;a.03f5
    1015 03F5				locloop_36:					;  xref A.03FA, 03FE
    1016 03F5  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1017 03F6  A8 80			 		test	al,80h
    1018 03F8  75 0B			 		jnz	loc_38			; Jump if not zero
    1019 03FA  E2 F9			 		loop	locloop_36		; Loop if cx > 0
    1020				
    1021 03FC  FE CB			 		dec	bl
    1022 03FE  75 F5			 		jnz	locloop_36		; Jump if not zero
    1023 0400				loc_37:						;  xref A.0411
    1024 0400  B4 80			 		mov	ah,80h
    1025 0402  E9 0312 R		 		jmp	loc_24			; (0312)
    1026 0405				loc_38:						;  xref A.03F8, 040F
    1027 0405  EC			 		in	al,dx			; port 2, DMA-1 bas&add ch 1
    1028 0406  A8 02			 		test	al,2
    1029 0408  75 09			 		jnz	loc_39			; Jump if not zero
    1030				; 		test	byte ptr ds:[71h],80h	; (A.0071=0)
    1031 040A  F6 06 0071 R 80				test	byte ptr ds:[signbit],80h
    1032 040F  74 F4			 		jz	loc_38			; Jump if zero
    1033 0411  EB ED			 		jmp	short loc_37		; (0400)
    1034 0413				loc_39:						;  xref A.0408
    1035 0413  E8 0420 R		 		call	sub_5			; (0420)
    1036 0416  80 E4 1E			 		and	ah,1Eh
    1037 0419  83 EA 02			 		sub	dx,2
    1038 041C  EC			 		in	al,dx			; port 0, DMA-1 bas&add ch 0
    1039 041D  E9 0312 R		 		jmp	loc_24			; (0312)
    1040				
    1041				;===============================================================================
    1042				 ;                              SUBROUTINE
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-20


    1043				 ;
    1044				 ;         Called from:   A.0413, 0458
    1045				;===============================================================================
    1046				; Tests some variable for bit flags. Maybe serial errors?
    1047				;a.0420
    1048 0420				sub_5		proc	near
    1049 0420  B4 00			 		mov	ah,0
    1050 0422  A8 01			 		test	al,1
    1051 0424  74 03			 		jz	loc_40			; Jump if zero
    1052 0426  80 CC 20			 		or	ah,20h			; ' '
    1053 0429				loc_40:						;  xref A.0424
    1054 0429  A8 02			 		test	al,2
    1055 042B  74 03			 		jz	loc_41			; Jump if zero
    1056 042D  80 CC 01			 		or	ah,1
    1057 0430				loc_41:						;  xref A.042B
    1058 0430  A8 04			 		test	al,4
    1059 0432  74 03			 		jz	loc_42			; Jump if zero
    1060 0434  80 CC 40			 		or	ah,40h			; '@'
    1061 0437				loc_42:						;  xref A.0432
    1062 0437  A8 08			 		test	al,8
    1063 0439  74 03			 		jz	loc_43			; Jump if zero
    1064 043B  80 CC 04			 		or	ah,4
    1065 043E				loc_43:						;  xref A.0439
    1066 043E  A8 10			 		test	al,10h
    1067 0440  74 03			 		jz	loc_44			; Jump if zero
    1068 0442  80 CC 02			 		or	ah,2
    1069 0445				loc_44:						;  xref A.0440
    1070 0445  A8 20			 		test	al,20h			; ' '
    1071 0447  74 03			 		jz	loc_45			; Jump if zero
    1072 0449  80 CC 08			 		or	ah,8
    1073 044C				loc_45:						;  xref A.0447
    1074 044C  A8 40			 		test	al,40h			; '@'
    1075 044E  74 03			 		jz	loc_ret_46		; Jump if zero
    1076 0450  80 CC 10			 		or	ah,10h
    1077				
    1078 0453				loc_ret_46:					;  xref A.044E
    1079 0453  C3			 		retn
    1080 0454				sub_5		endp
    1081				
    1082 0454				loc_47:						;  xref A.030F, 0388
    1083 0454  83 C2 02			 		add	dx,2
    1084 0457  EC			 		in	al,dx			; port 4, DMA-1 bas&add ch 2
    1085 0458  E8 0420 R		 		call	sub_5			; (0420)
    1086 045B  24 80			 		and	al,80h
    1087 045D  84 C0			 		test	al,al
    1088 045F  B0 F0			 		mov	al,0F0h
    1089 0461  75 02			 		jnz	loc_48			; Jump if not zero
    1090 0463  B0 00			 		mov	al,0
    1091 0465				loc_48:						;  xref A.0461
    1092 0465  E9 0312 R		 		jmp	loc_24			; (0312)
    1093				
    1094				;===============================================================================
    1095				 ;                              SUBROUTINE
    1096				 ;
    1097				 ;         Called from:   A.017B
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-21


    1098				;===============================================================================
    1099				;a.0468
    1100 0468				sub_6		proc	near
    1101 0468				loc_49:						;  xref A.0470
    1102 0468  FB			 		sti				; Enable interrupts
    1103 0469  51			 		push	cx
    1104 046A  33 C9			 		xor	cx,cx			; Zero register
    1105				
    1106 046C				locloop_50:					;  xref A.046C
    1107 046C  E2 FE			 		loop	locloop_50		; Loop if cx > 0
    1108				
    1109 046E  59			 		pop	cx
    1110 046F  49			 		dec	cx
    1111 0470  75 F6			 		jnz	loc_49			; Jump if not zero
    1112 0472  C3			 		retn
    1113 0473				sub_6		endp
    1114				
    1115				
    1116				;===============================================================================
    1117				 ;                              SUBROUTINE
    1118				 ;
    1119				 ;         Called from:   A.009E
    1120				;===============================================================================
    1121				; setup certain handlers to default to IRET and set equipment bits
    1122				;a.0473
    1123 0473				sub_7		proc	near
    1124 0473  1E			 		push	ds
    1125 0474  33 C0			 		xor	ax,ax			; Zero register
    1126 0476  8E D8			 		mov	ds,ax
    1127 0478  B8 0596 R		 		mov	ax,offset DefIRET		; default IRET 596h
    1128 047B  A3 0060			 		mov	ds:Int18v,ax		; (0000:0060=0CD00h)
    1129 047E  A3 0064			 		mov	ds:Int19v,ax		; (0000:0064=0CC60h)
    1130 0481  8C 0E 0062		 		mov	ds:Int18v+2,cs		; (0000:0062=0F000h)
    1131 0485  8C 0E 0066		 		mov	ds:Int19v+2,cs		; (0000:0066=0F000h)
    1132 0489  A3 0054			 		mov	ds:Int15v,ax		; (0000:0054=0CBA0h)
    1133 048C  8C 0E 0056		 		mov	ds:Int15v+2,cs		; (0000:0056=0F000h)
    1134 0490  A3 006C			 		mov	ds:Int1Bv,ax		; (0000:006C=0D1C0h)
    1135 0493  8C 0E 006E		 		mov	ds:Int1Bv+2,cs		; (0000:006E=0F000h)
    1136 0497  A3 0070			 		mov	ds:Int1Cv,ax		; (0000:0070=0CC00h)
    1137 049A  8C 0E 0072		 		mov	ds:Int1Cv+2,cs		; (0000:0072=0F000h)
    1138				
    1139 049E  B8 01B4 R		 		mov	ax,offset INT11HANDLER	; equip list 1B4h
    1140 04A1  A3 0044			 		mov	ds:Int11v,ax		; (0000:0044=0CB20h)
    1141 04A4  8C 0E 0046		 		mov	ds:Int11v+2,cs		; (0000:0046=0F000h)
    1142 04A8  B8 0040			 		mov	ax,40h
    1143 04AB  8E D8			 		mov	ds,ax
    1144 04AD  B8 446D			 		mov	ax,446Dh		; 01000100 / 01101101
    1145 04B0  A3 0010 R		 		mov	ds:equip_bits,ax	; (0040:0010=4467h)
    1146 04B3  1F			 		pop	ds
    1147 04B4  C3			 		retn
    1148 04B5				sub_7		endp
    1149				
    1150				
    1151				;===============================================================================
    1152				 ;                              SUBROUTINE
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-22


    1153				 ;
    1154				 ;         Called from:   A.00A1
    1155				;===============================================================================
    1156				; setup default handlers 08h, 0ch, and 1ah.
    1157				;a.04b5
    1158 04B5				sub_8		proc	near
    1159 04B5  1E			 		push	ds
    1160 04B6  9C			 		pushf				; Push flags
    1161 04B7  FA			 		cli				; Disable interrupts
    1162 04B8				loc_51:
    1163 04B8  33 C0			 		xor	ax,ax			; Zero register
    1164 04BA  8E D8			 		mov	ds,ax
    1165				;***** Note: the following codes as B8 0511 while the original
    1166				;***** codes as B8 0513.
    1167 04BC  B8 0511 R		 		mov	ax,offset INT0CHANDLER	;513h
    1168				;*****
    1169 04BF  A3 0030			 		mov	ds:Int0Cv,ax		; (0000:0030=0CE80h)
    1170 04C2  8C 0E 0032		 		mov	ds:Int0Cv+2,cs		; (0000:0032=0F000h)
    1171 04C6  B8 0521 R		 		mov	ax,offset INT08HANDLER	;521h
    1172 04C9  A3 0020			 		mov	ds:Int08v,ax		; (0000:0020=0FEA5h)
    1173 04CC  8C 0E 0022		 		mov	ds:Int08v+2,cs		; (0000:0022=0F000h)
    1174 04D0  B8 0562 R		 		mov	ax,offset INT1AHANDLER	;562h
    1175 04D3  A3 0068			 		mov	ds:Int1Av,ax		; (0000:0068=0CBE0h)
    1176 04D6  8C 0E 006A		 		mov	ds:Int1Av+2,cs		; (0000:006A=0F000h)
    1177 04DA  B8 0040			 		mov	ax,40h
    1178 04DD  8E D8			 		mov	ds,ax
    1179 04DF  33 C0			 		xor	ax,ax			; Zero register
    1180 04E1  A3 006C R		 		mov	ds:timer_low,ax		; (0040:006C=6980h)
    1181 04E4  A3 006E R		 		mov	ds:timer_hi,ax		; (0040:006E=16h)
    1182 04E7  A2 0070 R		 		mov	ds:timer_rolled,al	; (0040:0070=0)
    1183 04EA  BE 050A R		 		mov	si,offset data_82	; (A.050A=36h)
    1184 04ED  B9 0003			 		mov	cx,3
    1185 04F0  BA 0040			 		mov	dx,40h
    1186				
    1187 04F3				locloop_52:					;  xref A.04FE
    1188 04F3  2E: AC			 		lods	byte ptr cs:[si]	; String [si] to al
    1189 04F5  E6 43			 		out	43h,al			; port 43h, 8253 timer control
    1190 04F7  2E: AC			 		lods	byte ptr cs:[si]	; String [si] to al
    1191 04F9  EE			 		out	dx,al			; port 40h, 8253 timer 0 clock
    1192 04FA  2E: AC			 		lods	byte ptr cs:[si]	; String [si] to al
    1193 04FC  EE			 		out	dx,al			; port 40h, 8253 timer 0 clock
    1194 04FD  42			 		inc	dx
    1195 04FE  E2 F3			 		loop	locloop_52		; Loop if cx > 0
    1196				
    1197 0500  BA FF38			 		mov	dx,0FF38h		;PCRBASE+ICR+INT0CR
    1198 0503  B8 0000			 		mov	ax,0
    1199 0506  EF			 		out	dx,ax			; port 0FF38h ??I/O Non-standard
    1200 0507  9D			 		popf				; Pop flags
    1201 0508  1F			 		pop	ds
    1202 0509  C3			 		retn
    1203 050A				sub_8		endp
    1204				
    1205				; 80186 timer 0 configuration bytes
    1206				;a.050a
    1207 050A  36 00 00 76 A9 04	data_82:	db	36h, 00h, 00h, 76h,0A9h, 04h,0B6h
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-23


    1208       B6			
    1209				
    1210				; a.0511
    1211 0511				INT0CHANDLER:
    1212 0511  A9 5004			 		test	ax,5004h
    1213 0514  52			 		push	dx
    1214 0515  B8 8000			 		mov	ax,8000h
    1215 0518  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
    1216 051B  EF			 		out	dx,ax
    1217 051C  5A			 		pop	dx
    1218 051D  58			 		pop	ax
    1219 051E  CD 08			 		INT	08h 
    1220 0520  CF			 		iret
    1221				
    1222				;a.0521
    1223 0521				INT08HANDLER:
    1224 0521  50			 		push	ax
    1225 0522  52			 		push	dx
    1226 0523  1E			 		push	ds
    1227 0524  B8 0040			 		mov	ax,40h
    1228 0527  8E D8			 		mov	ds,ax
    1229 0529  FF 06 006C R		 		inc	word ptr ds:[timer_low]
    1230 052D  75 04			 		jnz	loc_53
    1231 052F  FF 06 006E R		 		inc	word ptr ds:[timer_hi]
    1232 0533				loc_53:
    1233 0533  83 3E 006E R 18		 		cmp	word ptr ds:[timer_hi],18h	; (A.006E=0BF00h)
    1234 0538  75 19			 		jne	loc_54				; Jump if not equal
    1235 053A  81 3E 006C R 00B0	 		cmp	word ptr ds:[timer_low],0B0h	; (A.006C=0BEh)
    1236 0540  75 11			 		jne	loc_54				; Jump if not equal
    1237 0542  C7 06 006E R 0000	 		mov	word ptr ds:[timer_hi],0	; (A.006E=0BF00h)
    1238 0548  C7 06 006C R 0000	 		mov	word ptr ds:[timer_low],0	; (A.006C=0BEh)
    1239 054E  C6 06 0070 R 01		 		mov	byte ptr ds:[timer_rolled],1	; (A.0070=4)
    1240 0553				loc_54:							;  xref A.0538, 0540
    1241 0553  FE 0E 0040 R		 		dec	byte ptr ds:[dsk_motor_tmr]	; (A.0040=0ABh)
    1242 0557  75 03			 		jnz	loc_55				; Jump if not zero
    1243 0559  E8 09AD R		 		call	sub_19				; (09AD)
    1244 055C				loc_55:							;  xref A.0557
    1245 055C  CD 1C			 		int	1Ch				; Timer break (call each 18.2ms)
    1246 055E  1F			 		pop	ds
    1247 055F  5A			 		pop	dx
    1248 0560  58			 		pop	ax
    1249 0561  CF			 		iret				; Interrupt return
    1250				
    1251				;a.0562
    1252 0562				INT1AHANDLER:
    1253 0562  1E			 		push	ds
    1254 0563  FA			 		cli				; Disable interrupts
    1255 0564  50			 		push	ax
    1256 0565  B8 0040			 		mov	ax,40h
    1257 0568  8E D8			 		mov	ds,ax
    1258 056A  58			 		pop	ax
    1259 056B  0A E4			 		or	ah,ah			; Zero ?
    1260 056D  74 06			 		jz	loc_57			; Jump if zero
    1261 056F  FE CC			 		dec	ah
    1262 0571  74 14			 		jz	loc_58			; Jump if zero
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-24


    1263 0573				loc_56:						;  xref A.0585, 0594
    1264 0573  1F			 		pop	ds
    1265 0574  CF			 		iret				; Interrupt return
    1266				
    1267 0575				loc_57:							;  xref A.056D
    1268 0575  A0 0070 R		 		mov	al,byte ptr ds:[timer_rolled]	; (A.0070=4)
    1269 0578  C6 06 0070 R 00		 		mov	byte ptr ds:[timer_rolled],0	; (A.0070=4)
    1270 057D  8B 0E 006E R		 		mov	cx,word ptr ds:[timer_hi]	; (A.006E=0BF00h)
    1271 0581  8B 16 006C R		 		mov	dx,word ptr ds:[timer_low]	; (A.006C=0BEh)
    1272 0585  EB EC			 		jmp	short loc_56			; (0573)
    1273 0587				loc_58:							;  xref A.0571
    1274 0587  89 16 006C R		 		mov	word ptr ds:[timer_low],dx	; (A.006C=0BEh)
    1275 058B  89 0E 006E R		 		mov	word ptr ds:[timer_hi],cx	; (A.006E=0BF00h)
    1276 058F  C6 06 0070 R 00		 		mov	byte ptr ds:[timer_rolled],0	; (A.0070=4)
    1277 0594  EB DD			 		jmp	short loc_56			; (0573)
    1278 0596  CF			 DefIRET:	iret	
    1279				
    1280 0597				 DynHalt:					;  xref A.004B, 0598
    1281 0597  FA			 		cli				; Disable interrupts
    1282 0598  EB FD			 		jmp	short DynHalt		; (0597)
    1283				
    1284				;a.059a
    1285				;* No entry point to code
    1286				; Doesn't seem to have an absolute reference anywhere
    1287 059A				loc_59:
    1288 059A  9C			 		pushf				; Push flags
    1289 059B  FA			 		cli				; Disable interrupts
    1290 059C  1E			 		push	ds
    1291 059D  B8 0040			 		mov	ax,40h
    1292 05A0  8E D8			 		mov	ds,ax
    1293 05A2  0A F6			 		or	dh,dh			; Zero ?
    1294 05A4  74 0B			 		jz	loc_62			; Jump if zero
    1295 05A6				loc_60:						;  xref A.05AF
    1296 05A6  B3 06			 		mov	bl,6
    1297 05A8  E8 05C3 R		 		call	BEEP			; (05C3)
    1298				
    1299 05AB				locloop_61:					;  xref A.05AB
    1300 05AB  E2 FE			 		loop	locloop_61		; Loop if cx > 0
    1301				
    1302 05AD  FE CE			 		dec	dh
    1303 05AF  75 F5			 		jnz	loc_60			; Jump if not zero
    1304 05B1				loc_62:						;  xref A.05A4, 05BA
    1305 05B1  B3 01			 		mov	bl,1
    1306 05B3  E8 05C3 R		 		call	BEEP			; (05C3)
    1307				
    1308 05B6				locloop_63:					;  xref A.05B6
    1309 05B6  E2 FE			 		loop	locloop_63		; Loop if cx > 0
    1310				
    1311 05B8  FE CA			 		dec	dl
    1312 05BA  75 F5			 		jnz	loc_62			; Jump if not zero
    1313				
    1314 05BC				locloop_64:					;  xref A.05BC
    1315 05BC  E2 FE			 		loop	locloop_64		; Loop if cx > 0
    1316				
    1317				
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-25


    1318 05BE				locloop_65:					;  xref A.05BE
    1319 05BE  E2 FE			 		loop	locloop_65		; Loop if cx > 0
    1320				
    1321 05C0  1F			 		pop	ds
    1322 05C1  9D			 		popf				; Pop flags
    1323 05C2  C3			 		retn
    1324				
    1325				;===============================================================================
    1326				 ;                              SUBROUTINE
    1327				 ;
    1328				 ;         Called from:   A.05A8, 05B3, 16C8
    1329				;===============================================================================
    1330				;a.05c3
    1331				; should ax,cx be preserved?
    1332 05C3				BEEP		proc	near
    1333 05C3  B0 B6			 		mov	al,0B6h
    1334 05C5  E6 43			 		out	43h,al			; port 43h, 8253 timer control
    1335 05C7  B8 0533			 		mov	ax,533h
    1336 05CA  E6 42			 		out	42h,al			; port 42h, 8253 timer 2 spkr
    1337 05CC  8A C4			 		mov	al,ah
    1338 05CE  E6 42			 		out	42h,al			; port 42h, 8253 timer 2 spkr
    1339 05D0  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    1340 05D2  8A E0			 		mov	ah,al
    1341 05D4  0C 03			 		or	al,3
    1342 05D6  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    1343 05D8  2B C9			 		sub	cx,cx
    1344				
    1345 05DA				BEEP_1:						;  xref A.05DA, 05DE
    1346 05DA  E2 FE			 		loop	BEEP_1			; Loop if cx > 0
    1347 05DC  FE CB			 		dec	bl
    1348 05DE  75 FA			 		jnz	BEEP_1			; Jump if not zero
    1349 05E0  8A C4			 		mov	al,ah
    1350 05E2  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    1351 05E4  C3			 		retn
    1352 05E5				BEEP		endp
    1353				
    1354				
    1355				;===============================================================================
    1356				 ;                              SUBROUTINE
    1357				 ;
    1358				 ;         Called from:   A.0095, 009B, 0154, 0BA9
    1359				;===============================================================================
    1360				;a.05e5
    1361 05E5				prtzstr		proc	near
    1362 05E5				loc_67:						;  xref A.05F3
    1363 05E5  2E: 8A 04		 		mov	al,cs:[si]
    1364 05E8  46			 		inc	si
    1365 05E9  84 C0			 		test	al,al
    1366 05EB  74 08			 		jz	loc_ret_68		; Jump if zero
    1367 05ED  B7 00			 		mov	bh,0
    1368 05EF  B4 0E			 		mov	ah,0Eh
    1369 05F1  CD 10			 		int	10h			; Video display   ah=functn 0Eh
    1370				 						;  write char al, teletype mode
    1371 05F3  EB F0			 		jmp	short loc_67		; (05E5)
    1372				
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-26


    1373 05F5				loc_ret_68:					;  xref A.05EB
    1374 05F5  C3			 		retn
    1375 05F6				 prtzstr	endp
    1376				
    1377				
    1378				;===============================================================================
    1379				 ;                              SUBROUTINE
    1380				 ;
    1381				 ;         Called from:   A.00AA
    1382				;===============================================================================
    1383				;a.05f6
    1384				; grab disk vectors and second serial hardware IRQ
    1385 05F6				sub_11		proc	near
    1386 05F6  1E			 		push	ds
    1387 05F7  33 C0			 		xor	ax,ax			; Zero register
    1388 05F9  8E D8			 		mov	ds,ax
    1389 05FB  B8 061B R		 		mov	ax,offset INT13HANDLER	;61Bh
    1390 05FE  A3 004C			 		mov	ds:Int13v,ax		; (0000:004C=0CF60h)
    1391 0601  8C 0E 004E		 		mov	ds:Int13v+2,cs		; (0000:004E=0F000h)
    1392 0605  B8 07E9 R		 		mov	ax,offset INT0BHANDLER	;7E9h
    1393 0608  A3 002C			 		mov	ds:Int0Bv,ax		; (0000:002C=0CE80h)
    1394 060B  8C 0E 002E		 		mov	ds:Int0Bv+2,cs		; (0000:002E=0F000h)
    1395 060F  B8 0AC9 R		 		mov	ax,offset INT_1E	;0AC9h
    1396 0612  A3 0078			 		mov	ds:Int1Ev,ax		; (0000:0078=0CA60h)
    1397 0615  8C 0E 007A		 		mov	word ptr ds:Int1Ev+2,cs	; (0000:007A=0F000h)
    1398 0619  1F			 		pop	ds
    1399 061A  C3			 		retn
    1400 061B				sub_11		endp
    1401				
    1402				;a.061b
    1403				; INT13 Handler
    1404 061B				INT13HANDLER:
    1405 061B  FB			 		sti				; Enable interrupts
    1406 061C  53			 		push	bx
    1407 061D  51			 		push	cx
    1408 061E  1E			 		push	ds
    1409 061F  56			 		push	si
    1410 0620  57			 		push	di
    1411 0621  55			 		push	bp
    1412 0622  52			 		push	dx
    1413 0623  8B EC			 		mov	bp,sp
    1414 0625  BE 0040			 		mov	si,40h
    1415 0628  8E DE			 		mov	ds,si
    1416 062A  E8 0649 R		 		call	sub_12			; (0649)
    1417 062D  BB 0004			 		mov	bx,4
    1418 0630  E8 0834 R		 		call	GetpDPB			; (0834)
    1419 0633  88 26 0040 R		 		mov	ds:dsk_motor_tmr,ah	; (0040:0040=0)
    1420 0637  8A 26 0041 R		 		mov	ah,ds:dsk_ret_code	; (0040:0041=0)
    1421 063B  80 FC 01			 		cmp	ah,1
    1422 063E  F5			 		cmc				; Complement carry
    1423 063F  5A			 		pop	dx
    1424 0640  5D			 		pop	bp
    1425 0641  5F			 		pop	di
    1426 0642  5E			 		pop	si
    1427 0643  1F			 		pop	ds
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-27


    1428 0644  59			 		pop	cx
    1429 0645  5B			 		pop	bx
    1430 0646  CA 0002			 		retf	2			; Return far
    1431				
    1432				;===============================================================================
    1433				;                               SUBROUTINE
    1434				;
    1435				;         Called from:   A.062A
    1436				;===============================================================================
    1437				;a.0649
    1438				; setup for disk call?
    1439 0649				sub_12		proc	near
    1440 0649  8A F0			 		mov	dh,al
    1441 064B  A2 006B R		 		mov	ds:gen_int_occured,al	; (0040:006B=0)
    1442 064E  80 26 003F R 3F		 		and	byte ptr ds:dsk_motor_stat,3Fh	; (0040:003F=0) '?'
    1443 0653  B0 FF			 		mov	al,0FFh
    1444 0655  A2 0040 R		 		mov	ds:dsk_motor_tmr,al	; (0040:0040=0)
    1445 0658  0A E4			 		or	ah,ah			; Zero ?
    1446 065A  74 33			 		jz	loc_74			; Jump if zero
    1447 065C  FE CC			 		dec	ah
    1448 065E  75 03			 		jnz	loc_69			; Jump if not zero
    1449 0660  EB 5A			 		jmp	short loc_75		; (06BC)
    1450 0662  90			 		db	90h
    1451 0663				loc_69:						;  xref A.065E
    1452 0663  C6 06 0041 R 00		 		mov	byte ptr ds:dsk_ret_code,0	; (0040:0041=0)
    1453 0668  80 FA 04			 		cmp	dl,4
    1454 066B  73 1C			 		jae	loc_73			; Jump if above or =
    1455 066D  FE CC			 		dec	ah
    1456 066F  75 03			 		jnz	loc_70			; Jump if not zero
    1457 0671  EB 4D			 		jmp	short loc_76		; (06C0)
    1458 0673  90			 		db	90h
    1459 0674				loc_70:						;  xref A.066F
    1460 0674  FE CC			 		dec	ah
    1461 0676  75 03			 		jnz	loc_71			; Jump if not zero
    1462 0678  E9 0714 R		 		jmp	loc_80			; (0714)
    1463 067B				loc_71:						;  xref A.0676
    1464 067B  FE CC			 		dec	ah
    1465 067D  75 03			 		jnz	loc_72			; Jump if not zero
    1466 067F  EB 46			 		jmp	short loc_77		; (06C7)
    1467 0681  90			 		db	90h
    1468 0682				loc_72:						;  xref A.067D
    1469 0682  FE CC			 		dec	ah
    1470 0684  75 03			 		jnz	loc_73			; Jump if not zero
    1471 0686  EB 46			 		jmp	short loc_78		; (06CE)
    1472 0688  90			 		db	90h
    1473 0689				loc_73:						;  xref A.066B, 0684
    1474 0689  C6 06 0041 R 01		 		mov	byte ptr ds:dsk_ret_code,1	; (0040:0041=0)
    1475 068E  C3			 		retn
    1476 068F				loc_74:						;  xref A.065A
    1477 068F  E8 0A4C R		 		call	sub_23			; (0A4C)
    1478 0692  E8 0A9E R		 		call	sub_26			; (0A9E)
    1479 0695  B4 03			 		mov	ah,3
    1480 0697  E8 0808 R		 		call	sub_13			; (0808)
    1481 069A  BB 0001			 		mov	bx,1
    1482 069D  E8 0834 R		 		call	GetpDPB			; (0834)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-28


    1483 06A0  BB 0003			 		mov	bx,3
    1484 06A3  E8 0834 R		 		call	GetpDPB			; (0834)
    1485 06A6  C6 06 0041 00		 		mov	byte ptr ds:[41h],0	; (A.0041=0B9h)
    1486 06AB  C6 06 003E 00		 		mov	byte ptr ds:[3Eh],0	; (A.003E=0FBh)
    1487 06B0  C6 06 003F 00		 		mov	byte ptr ds:[3Fh],0	; (A.003F=0F3h)
    1488 06B5  E8 0A9E R		 		call	sub_26			; (0A9E)
    1489 06B8  E8 09AD R		 		call	sub_19			; (09AD)
    1490 06BB  C3			 		retn
    1491 06BC				loc_75:						;  xref A.0660
    1492 06BC  A0 0041			 		mov	al,byte ptr ds:[41h]	; (A.0041=0B9h)
    1493 06BF  C3			 		retn
    1494				;a.06c0
    1495 06C0				loc_76:						;  xref A.0671, 06CC
    1496 06C0  E8 08E7 R		 		call	sub_18			; (08E7)
    1497 06C3  B4 66			 		mov	ah,66h			; 'f'
    1498 06C5  EB 57			 		jmp	short loc_81		; (071E)
    1499 06C7				loc_77:						;  xref A.067F
    1500 06C7  80 0E 003F R 40		 		or	byte ptr ds:dsk_motor_stat,40h	; (0040:003F=0) '@'
    1501 06CC  EB F2			 		jmp	short loc_76		; (06C0)
    1502 06CE				loc_78:						;  xref A.0686
    1503 06CE  80 0E 003F R 80		 		or	byte ptr ds:dsk_motor_stat,80h	; (0040:003F=0)
    1504 06D3  E8 08E7 R		 		call	sub_18			; (08E7)
    1505 06D6  B4 4D			 		mov	ah,4Dh			; 'M'
    1506 06D8  50			 		push	ax
    1507 06D9  53			 		push	bx
    1508 06DA  52			 		push	dx
    1509 06DB  BB 0008			 		mov	bx,8
    1510 06DE  E8 0834 R		 		call	GetpDPB			; (0834)
    1511 06E1  8A C4			 		mov	al,ah
    1512 06E3  32 E4			 		xor	ah,ah			; Zero register
    1513 06E5  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    1514 06E7  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    1515 06E9  BA FFD8			 		mov	dx,0FFD8h		;PCRBASE+DMA1+DMATC
    1516 06EC  EF			 		out	dx,ax			; port 0FFD8h ??I/O Non-standard
    1517 06ED  5A			 		pop	dx
    1518 06EE  5B			 		pop	bx
    1519 06EF  58			 		pop	ax
    1520 06F0  EB 2C			 		jmp	short loc_81		; (071E)
    1521 06F2				loc_79:						;  xref A.075C
    1522 06F2  BB 0007			 		mov	bx,7
    1523 06F5  E8 0834 R		 		call	GetpDPB			; (0834)
    1524 06F8  BB 0009			 		mov	bx,9
    1525 06FB  E8 0834 R		 		call	GetpDPB			; (0834)
    1526 06FE  BB 000F			 		mov	bx,0Fh
    1527 0701  E8 0834 R		 		call	GetpDPB			; (0834)
    1528 0704  A1 0067			 		mov	ax,word ptr ds:[67h]	; (A.0067=8C00h)
    1529 0707  BA FFDA			 		mov	dx,0FFDAh		;PCRBASE+DMA1+DMACW
    1530 070A  EF			 		out	dx,ax			; port 0FFDAh ??I/O Non-standard
    1531 070B  BB 0011			 		mov	bx,11h
    1532 070E  E8 0834 R		 		call	GetpDPB			; (0834)
    1533 0711  EB 7C			 		jmp	short loc_85		; (078F)
    1534 0713  90			 		db	90h
    1535				;a.0714
    1536 0714				loc_80:						;  xref A.0678
    1537 0714  80 0E 003F 80		 		or	byte ptr ds:[3Fh],80h	; (A.003F=0F3h)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-29


    1538 0719  E8 08E7 R		 		call	sub_18			; (08E7)
    1539 071C  B4 45			 		mov	ah,45h			; 'E'
    1540 071E				loc_81:						;  xref A.06C5, 06F0
    1541 071E  73 08			 		jnc	loc_82			; Jump if carry=0
    1542 0720  C6 06 0041 09		 		mov	byte ptr ds:[41h],9	; (A.0041=0B9h)
    1543 0725  B0 00			 		mov	al,0
    1544 0727  C3			 		retn
    1545 0728				loc_82:						;  xref A.071E
    1546 0728  E8 0A9E R		 		call	sub_26			; (0A9E)
    1547 072B  80 26 003E 7F		 		and	byte ptr ds:[3Eh],7Fh	; (A.003E=0FBh)
    1548 0730  50			 		push	ax
    1549 0731  E8 09B6 R		 		call	sub_20			; (09B6)
    1550 0734  E8 0A59 R		 		call	sub_24			; (0A59)
    1551 0737  72 03			 		jc	loc_83			; Jump if carry Set
    1552 0739  E8 0845 R		 		call	sub_15			; (0845)
    1553				;a.073c
    1554 073C				loc_83:						;  xref A.0737
    1555 073C  58			 		pop	ax
    1556 073D  8A FC			 		mov	bh,ah
    1557 073F  72 51			 		jc	loc_86			; Jump if carry Set
    1558 0741  E8 0A9E R		 		call	sub_26			; (0A9E)
    1559 0744  E8 0808 R		 		call	sub_13			; (0808)
    1560 0747  8A 66 01			 		mov	ah,[bp+1]
    1561 074A  D0 E4			 		shl	ah,1			; Shift w/zeros fill
    1562 074C  D0 E4			 		shl	ah,1			; Shift w/zeros fill
    1563 074E  80 E4 04			 		and	ah,4
    1564 0751  0A 66 00			 		or	ah,[bp]
    1565 0754  E8 0808 R		 		call	sub_13			; (0808)
    1566 0757  80 FF 4D			 		cmp	bh,4Dh			; 'M'
    1567 075A  75 02			 		jne	loc_84			; Jump if not equal
    1568 075C  EB 94			 		jmp	short loc_79		; (06F2)
    1569				;a.075e
    1570 075E				loc_84:						;  xref A.075A
    1571 075E  8A E5			 		mov	ah,ch
    1572 0760  E8 0808 R		 		call	sub_13			; (0808)
    1573 0763  8A 66 01			 		mov	ah,[bp+1]
    1574 0766  E8 0808 R		 		call	sub_13			; (0808)
    1575 0769  8A E1			 		mov	ah,cl
    1576 076B  E8 0808 R		 		call	sub_13			; (0808)
    1577 076E  BB 0007			 		mov	bx,7
    1578 0771  E8 0834 R		 		call	GetpDPB			; (0834)
    1579 0774  8A E1			 		mov	ah,cl
    1580 0776  BB 0009			 		mov	bx,9
    1581 0779  E8 0834 R		 		call	GetpDPB			; (0834)
    1582 077C  BB 000B			 		mov	bx,0Bh
    1583 077F  E8 0834 R		 		call	GetpDPB			; (0834)
    1584 0782  A1 0067			 		mov	ax,word ptr ds:[67h]	; (A.0067=8C00h)
    1585 0785  BA FFDA			 		mov	dx,0FFDAh		;PCRBASE+DMA1+DMACW
    1586 0788  EF			 		out	dx,ax			; port 0FFDAh ??I/O Non-standard
    1587 0789  BB 000D			 		mov	bx,0Dh
    1588 078C  E8 0834 R		 		call	GetpDPB			; (0834)
    1589				;a.078f
    1590 078F				loc_85:						;  xref A.0711
    1591 078F  E8 09BF R		 		call	sub_21			; (09BF)
    1592 0792				loc_86:						;  xref A.073F
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-30


    1593 0792  72 45			 		jc	loc_90			; Jump if carry Set
    1594 0794  E8 0A08 R		 		call	sub_22			; (0A08)
    1595 0797  72 3F			 		jc	loc_ret_89		; Jump if carry Set
    1596 0799  FC			 		cld				; Clear direction
    1597 079A  BE 0042 R		 		mov	si,offset nec_stat		; (0040:0042=0)
    1598 079D  AC			 		lodsb				; String [si] to al
    1599 079E  24 C0			 		and	al,0C0h
    1600 07A0  74 41			 		jz	loc_91			; Jump if zero
    1601 07A2  3C 40			 		cmp	al,40h			; '@'
    1602 07A4  75 29			 		jne	loc_87			; Jump if not equal
    1603 07A6  AC			 		lodsb				; String [si] to al
    1604 07A7  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1605 07A9  B4 04			 		mov	ah,4
    1606 07AB  72 24			 		jc	loc_88			; Jump if carry Set
    1607 07AD  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1608 07AF  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1609 07B1  B4 10			 		mov	ah,10h
    1610 07B3  72 1C			 		jc	loc_88			; Jump if carry Set
    1611 07B5  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1612 07B7  B4 08			 		mov	ah,8
    1613 07B9  72 16			 		jc	loc_88			; Jump if carry Set
    1614 07BB  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1615 07BD  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1616 07BF  B4 04			 		mov	ah,4
    1617 07C1  72 0E			 		jc	loc_88			; Jump if carry Set
    1618 07C3  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1619 07C5  B4 03			 		mov	ah,3
    1620 07C7  72 08			 		jc	loc_88			; Jump if carry Set
    1621 07C9  D0 E0			 		shl	al,1			; Shift w/zeros fill
    1622 07CB  B4 02			 		mov	ah,2
    1623 07CD  72 02			 		jc	loc_88			; Jump if carry Set
    1624 07CF				loc_87:						;  xref A.07A4
    1625 07CF  B4 20			 		mov	ah,20h			; ' '
    1626 07D1				loc_88:						;  xref A.07AB, 07B3, 07B9, 07C1
    1627				 						;            07C7, 07CD
    1628 07D1  08 26 0041		 		or	byte ptr ds:[41h],ah	; (A.0041=0B9h)
    1629 07D5  E8 0AB2 R		 		call	sub_27			; (0AB2)
    1630				
    1631 07D8				loc_ret_89:					;  xref A.0797
    1632 07D8  C3			 		retn
    1633				;a.07d9
    1634 07D9				loc_90:						;  xref A.0792
    1635 07D9  E8 0A4C R		 		call	sub_23			; (0A4C)
    1636 07DC  E8 0A08 R		 		call	sub_22			; (0A08)
    1637 07DF  E8 0A9E R		 		call	sub_26			; (0A9E)
    1638 07E2  C3			 		retn
    1639 07E3				loc_91:						;  xref A.07A0
    1640 07E3  E8 0AB2 R		 		call	sub_27			; (0AB2)
    1641 07E6  32 E4			 		xor	ah,ah			; Zero register
    1642 07E8  C3			 		retn
    1643 07E9				sub_12		endp
    1644				
    1645				;a.07e9
    1646				; Int0B hardware IQR
    1647 07E9				INT0BHANDLER:				
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-31


    1648 07E9  50			 		push	ax
    1649 07EA  53			 		push	bx
    1650 07EB  51			 		push	cx
    1651 07EC  52			 		push	dx
    1652 07ED  1E			 		push	ds
    1653 07EE  E8 0A4C R		 		call	sub_23			; (0A4C)
    1654 07F1  B8 0040			 		mov	ax,40h
    1655 07F4  8E D8			 		mov	ds,ax
    1656 07F6  80 0E 003E R 80		 		or	byte ptr ds:dsk_recal_stat,80h	; (0040:003E=0)
    1657 07FB  B8 8000			 		mov	ax,8000h
    1658 07FE  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
    1659 0801  EF			 		out	dx,ax			; port 0FF22h ??I/O Non-standard
    1660 0802  1F			 		pop	ds
    1661 0803  5A			 		pop	dx
    1662 0804  59			 		pop	cx
    1663 0805  5B			 		pop	bx
    1664 0806  58			 		pop	ax
    1665 0807  CF			 		iret				; Interrupt return
    1666				
    1667				;===============================================================================
    1668				 ;                              SUBROUTINE
    1669				 ;
    1670				 ;         Called from:   A.0697, 0744, 0754, 0760, 0766, 076B, 0859
    1671				 ;                             085F, 086C, 0872, 0877, 08A2, 0993, 0A63
    1672				 ;                             0A69, 0AA1
    1673				;===============================================================================
    1674				;a.0808
    1675 0808				sub_13		proc	near
    1676 0808				loc_92:						;  xref A.0842
    1677 0808  52			 		push	dx
    1678 0809  51			 		push	cx
    1679 080A  BA 0090			 		mov	dx,90h
    1680 080D  33 C9			 		xor	cx,cx			; Zero register
    1681				
    1682 080F				locloop_93:					;  xref A.0814
    1683 080F  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    1684 0810  A8 40			 		test	al,40h			; '@'
    1685 0812  74 0B			 		jz	loc_95			; Jump if zero
    1686 0814  E2 F9			 		loop	locloop_93		; Loop if cx > 0
    1687				
    1688 0816				loc_94:						;  xref A.0828
    1689 0816  80 0E 0041 80		 		or	byte ptr ds:[41h],80h	; (A.0041=0B9h)
    1690 081B  59			 		pop	cx
    1691 081C  5A			 		pop	dx
    1692 081D  F9			 		stc				; Set carry flag
    1693 081E  C3			 		retn
    1694 081F				loc_95:						;  xref A.0812
    1695 081F  33 C9			 		xor	cx,cx			; Zero register
    1696				
    1697 0821				locloop_96:					;  xref A.0826
    1698 0821  EC			 		in	al,dx			; port 0, DMA-1 bas&add ch 0
    1699 0822  A8 80			 		test	al,80h
    1700 0824  75 04			 		jnz	loc_97			; Jump if not zero
    1701 0826  E2 F9			 		loop	locloop_96		; Loop if cx > 0
    1702				
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-32


    1703 0828  EB EC			 		jmp	short loc_94		; (0816)
    1704 082A				loc_97:						;  xref A.0824
    1705 082A  8A C4			 		mov	al,ah
    1706 082C  BA 0092			 		mov	dx,92h
    1707 082F  EE			 		out	dx,al			; port 92h ??I/O Non-standard
    1708 0830  59			 		pop	cx
    1709 0831  5A			 		pop	dx
    1710 0832  F8			 		clc				; Clear carry flag
    1711 0833  C3			 		retn
    1712 0834				sub_13		endp
    1713				
    1714				
    1715				;===============================================================================
    1716				 ;                              SUBROUTINE
    1717				 ;
    1718				 ;         Called from:   A.0630, 069D, 06A3, 06DE, 06F5, 06FB, 0701
    1719				 ;                             070E, 0771, 0779, 077F, 078C, 0884, 0979
    1720				 ;                             0ABF
    1721				;===============================================================================
    1722				; Get disk parameter table
    1723				;a.0834
    1724 0834				GetpDPB		proc	near
    1725 0834  1E			 		push	ds
    1726 0835  2B C0			 		sub	ax,ax
    1727 0837  8E D8			 		mov	ds,ax
    1728 0839  C5 36 0078		 		lds	si,dword ptr ds:Int1Ev	; (0000:0078=0CA60h) Load seg:offset p
    1729 083D  D1 EB			 		shr	bx,1			; Shift w/zeros fill
    1730 083F  8A 20			 		mov	ah,[bx+si]
    1731 0841  1F			 		pop	ds
    1732 0842  72 C4			 		jc	loc_92			; Jump if carry Set
    1733 0844  C3			 		retn
    1734 0845				GetpDPB		endp
    1735				
    1736				
    1737				;===============================================================================
    1738				 ;                              SUBROUTINE
    1739				 ;
    1740				 ;         Called from:   A.0739
    1741				;===============================================================================
    1742				;a.0845
    1743 0845				sub_15		proc	near
    1744 0845  51			 		push	cx
    1745 0846  B0 01			 		mov	al,1
    1746 0848  8A CA			 		mov	cl,dl
    1747 084A  D2 C0			 		rol	al,cl			; Rotate
    1748 084C  59			 		pop	cx
    1749 084D  84 06 003E		 		test	al,byte ptr ds:[3Eh]	; (A.003E=0FBh)
    1750 0851  75 17			 		jnz	loc_98			; Jump if not zero
    1751 0853  08 06 003E		 		or	byte ptr ds:[3Eh],al	; (A.003E=0FBh)
    1752 0857  B4 07			 		mov	ah,7
    1753 0859  E8 0808 R		 		call	sub_13			; (0808)
    1754 085C  8A 66 00			 		mov	ah,[bp]
    1755 085F  E8 0808 R		 		call	sub_13			; (0808)
    1756 0862  E8 0898 R		 		call	sub_16			; (0898)
    1757 0865  72 30			 		jc	loc_ret_102		; Jump if carry Set
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-33


    1758 0867  E8 0A9E R		 		call	sub_26			; (0A9E)
    1759 086A				loc_98:						;  xref A.0851
    1760 086A  B4 0F			 		mov	ah,0Fh
    1761 086C  E8 0808 R		 		call	sub_13			; (0808)
    1762 086F  8A 66 00			 		mov	ah,[bp]
    1763 0872  E8 0808 R		 		call	sub_13			; (0808)
    1764 0875  8A E5			 		mov	ah,ch
    1765 0877  E8 0808 R		 		call	sub_13			; (0808)
    1766 087A  E8 0898 R		 		call	sub_16			; (0898)
    1767 087D  9C			 		pushf				; Push flags
    1768 087E  E8 0A9E R		 		call	sub_26			; (0A9E)
    1769 0881  BB 0012			 		mov	bx,12h
    1770 0884  E8 0834 R		 		call	GetpDPB			; (0834)
    1771 0887  51			 		push	cx
    1772 0888				loc_99:						;  xref A.0893
    1773 0888  B9 044C			 		mov	cx,44Ch
    1774 088B  0A E4			 		or	ah,ah			; Zero ?
    1775 088D  74 06			 		jz	loc_101			; Jump if zero
    1776				
    1777 088F				locloop_100:					;  xref A.088F
    1778 088F  E2 FE			 		loop	locloop_100		; Loop if cx > 0
    1779				
    1780 0891  FE CC			 		dec	ah
    1781 0893  EB F3			 		jmp	short loc_99		; (0888)
    1782 0895				loc_101:					;  xref A.088D
    1783 0895  59			 		pop	cx
    1784 0896  9D			 		popf				; Pop flags
    1785				
    1786 0897				loc_ret_102:					;  xref A.0865
    1787 0897  C3			 		retn
    1788 0898				sub_15		endp
    1789				
    1790				
    1791				;===============================================================================
    1792				 ;                              SUBROUTINE
    1793				 ;
    1794				 ;         Called from:   A.0862, 087A
    1795				;===============================================================================
    1796				;a.0898
    1797 0898				sub_16		proc	near
    1798 0898  50			 		push	ax
    1799 0899  51			 		push	cx
    1800 089A  B9 4000			 		mov	cx,4000h
    1801				
    1802 089D				locloop_103:					;  xref A.08AE, 08B3
    1803 089D  E8 08C3 R		 		call	sub_17			; (08C3)
    1804 08A0  B4 08			 		mov	ah,8
    1805 08A2  E8 0808 R		 		call	sub_13			; (0808)
    1806 08A5  E8 0A87 R		 		call	sub_25			; (0A87)
    1807 08A8  A8 20			 		test	al,20h			; ' '
    1808 08AA  75 10			 		jnz	loc_104			; Jump if not zero
    1809 08AC  3C 80			 		cmp	al,80h
    1810 08AE  E1 ED			 		loopz	locloop_103		; Loop if zf=1, cx>0
    1811				
    1812 08B0  E8 0A87 R		 		call	sub_25			; (0A87)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-34


    1813 08B3  E2 E8			 		loop	locloop_103		; Loop if cx > 0
    1814				
    1815 08B5  E8 0A87 R		 		call	sub_25			; (0A87)
    1816 08B8  F9			 		stc				; Set carry flag
    1817 08B9  59			 		pop	cx
    1818 08BA  58			 		pop	ax
    1819 08BB  C3			 		retn
    1820 08BC				loc_104:					;  xref A.08AA
    1821 08BC  E8 0A87 R		 		call	sub_25			; (0A87)
    1822 08BF  F8			 		clc				; Clear carry flag
    1823 08C0  59			 		pop	cx
    1824 08C1  58			 		pop	ax
    1825 08C2  C3			 		retn
    1826 08C3				sub_16		endp
    1827				
    1828				
    1829				;===============================================================================
    1830				 ;                              SUBROUTINE
    1831				 ;
    1832				 ;         Called from:   A.02A3, 0342, 034A, 0380, 089D
    1833				;===============================================================================
    1834				;a.08c3
    1835 08C3				sub_17		proc	near
    1836 08C3  51			 		push	cx
    1837 08C4  B9 0100			 		mov	cx,100h
    1838				
    1839 08C7				locloop_105:					;  xref A.08C9
    1840 08C7  50			 		push	ax
    1841 08C8  58			 		pop	ax
    1842 08C9  E2 FC			 		loop	locloop_105		; Loop if cx > 0
    1843				
    1844 08CB  59			 		pop	cx
    1845 08CC  C3			 		retn
    1846 08CD				sub_17		endp
    1847				
    1848				 			                        ;* No entry point to code
    1849 08CD  50			 		push	ax
    1850 08CE  53			 		push	bx
    1851 08CF  51			 		push	cx
    1852 08D0  33 C9			 		xor	cx,cx			; Zero register
    1853 08D2  BB 0014			 		mov	bx,14h
    1854				
    1855 08D5				locloop_106:					;  xref A.08D9, 08DE
    1856 08D5  E4 90			 		in	al,90h			; port 90h ??I/O Non-standard
    1857 08D7  A8 80			 		test	al,80h
    1858 08D9  E1 FA			 		loopz	locloop_106		; Loop if zf=1, cx>0
    1859				
    1860 08DB  74 03			 		jz	loc_107			; Jump if zero
    1861 08DD  4B			 		dec	bx
    1862 08DE  75 F5			 		jnz	locloop_106		; Jump if not zero
    1863 08E0				loc_107:					;  xref A.08DB
    1864 08E0  E8 0A4C R		 		call	sub_23			; (0A4C)
    1865 08E3  59			 		pop	cx
    1866 08E4  5B			 		pop	bx
    1867 08E5  58			 		pop	ax
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-35


    1868 08E6  C3			 		retn
    1869				
    1870				;===============================================================================
    1871				 ;                              SUBROUTINE
    1872				 ;
    1873				 ;         Called from:   A.06C0, 06D3, 0719
    1874				;===============================================================================
    1875				;a.08e7
    1876 08E7				sub_18		proc	near
    1877 08E7  50			 		push	ax
    1878 08E8  53			 		push	bx
    1879 08E9  51			 		push	cx
    1880 08EA  52			 		push	dx
    1881 08EB  56			 		push	si
    1882 08EC  52			 		push	dx
    1883 08ED  8C C0			 		mov	ax,es
    1884 08EF  8B CB			 		mov	cx,bx
    1885 08F1  D1 C0			 		rol	ax,1			; Rotate
    1886 08F3  D1 C0			 		rol	ax,1			; Rotate
    1887 08F5  D1 C0			 		rol	ax,1			; Rotate
    1888 08F7  D1 C0			 		rol	ax,1			; Rotate
    1889 08F9  BB 000F			 		mov	bx,0Fh
    1890 08FC  23 D8			 		and	bx,ax
    1891 08FE  25 FFF0			 		and	ax,0FFF0h
    1892 0901  03 C1			 		add	ax,cx
    1893 0903  73 01			 		jnc	loc_108			; Jump if carry=0
    1894 0905  43			 		inc	bx
    1895				
    1896				 ; DMA1 transaction setup
    1897				 ;a.0906
    1898 0906				loc_108:					;  xref A.0903
    1899 0906  F6 06 003F R 80		 		test	byte ptr ds:dsk_motor_stat,80h	; (0040:003F=0)
    1900 090B  74 1C			 		jz	loc_109		; Jump if zero
    1901 090D  BA FFD0			 		mov	dx,0FFD0h		;PCRBASE+DMA1+DMASP
    1902 0910  EF			 		out	dx,ax			; port 0FFD0h ??I/O Non-standard
    1903 0911  BA FFD2			 		mov	dx,0FFD2h		;PCRBASE+DMA1+DMASP1
    1904 0914  8B C3			 		mov	ax,bx
    1905 0916  EF			 		out	dx,ax			; port 0FFD2h ??I/O Non-standard
    1906 0917  33 C0			 		xor	ax,ax			; Zero register
    1907 0919  BA FFD6			 		mov	dx,0FFD6h		;PCRBASE+DMA1+DMADP1
    1908 091C  EF			 		out	dx,ax			; port 0FFD6h ??I/O Non-standard
    1909 091D  BA FFD4			 		mov	dx,0FFD4h		;PCRBASE+DMA1+DMADP
    1910 0920  B8 00A0			 		mov	ax,0A0h
    1911 0923  EF			 		out	dx,ax			; port 0FFD4h ??I/O Non-standard
    1912 0924  BE 1786			 		mov	si,1786h
    1913 0927  EB 41			 		jmp	short loc_111		; (096A)
    1914 0929				loc_109:					;  xref A.090B
    1915 0929  F6 06 003F R 40		 		test	byte ptr ds:dsk_motor_stat,40h	; (0040:003F=0) '@'
    1916 092E  75 1C			 		jnz	loc_110		; Jump if not zero
    1917 0930  BA FFD4			 		mov	dx,0FFD4h		;PCRBASE+DMA1+DMADP
    1918 0933  EF			 		out	dx,ax			; port 0FFD4h ??I/O Non-standard
    1919 0934  BA FFD6			 		mov	dx,0FFD6h		;PCRBASE+DMA1+DMADP1
    1920 0937  8B C3			 		mov	ax,bx
    1921 0939  EF			 		out	dx,ax			; port 0FFD6h ??I/O Non-standard
    1922 093A  33 C0			 		xor	ax,ax			; Zero register
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-36


    1923 093C  BA FFD2			 		mov	dx,0FFD2h		;PCRBASE+DMA1+DMASP1
    1924 093F  EF			 		out	dx,ax			; port 0FFD2h ??I/O Non-standard
    1925 0940  BA FFD0			 		mov	dx,0FFD0h		;PCRBASE+DMA1+DMASP
    1926 0943  B8 00A0			 		mov	ax,0A0h
    1927 0946  EF			 		out	dx,ax			; port 0FFD0h ??I/O Non-standard
    1928 0947  BE A346			 		mov	si,0A346h
    1929 094A  EB 1E			 		jmp	short loc_111		; (096A)
    1930				;a.094c
    1931 094C				loc_110:					;  xref A.092E
    1932 094C  B8 E000			 		mov	ax,0E000h
    1933 094F  BA FFD4			 		mov	dx,0FFD4h		;PCRBASE+DMA1+DMADP
    1934 0952  EF			 		out	dx,ax			; port 0FFD4h ??I/O Non-standard
    1935 0953  BA FFD6			 		mov	dx,0FFD6h		;PCRBASE+DMA1+DMADP1
    1936 0956  B8 000F			 		mov	ax,0Fh
    1937 0959  EF			 		out	dx,ax			; port 0FFD6h ??I/O Non-standard
    1938 095A  33 C0			 		xor	ax,ax			; Zero register
    1939 095C  BA FFD2			 		mov	dx,0FFD2h		;PCRBASE+DMA1+DMASP1
    1940 095F  EF			 		out	dx,ax			; port 0FFD2h ??I/O Non-standard
    1941 0960  BA FFD0			 		mov	dx,0FFD0h		;PCRBASE+DMA1+DMASP
    1942 0963  B8 00A0			 		mov	ax,0A0h
    1943 0966  EF			 		out	dx,ax			; port 0FFD0h ??I/O Non-standard
    1944 0967  BE 8346			 		mov	si,8346h
    1945				;a.096a
    1946 096A				loc_111:					;  xref A.0927, 094A
    1947 096A  89 36 0067 R		 		mov	ds:gen_io_ptr,si	; (0040:0067=0)
    1948 096E  5A			 		pop	dx
    1949 096F  8A E6			 		mov	ah,dh
    1950 0971  2A C0			 		sub	al,al
    1951 0973  D1 E8			 		shr	ax,1			; Shift w/zeros fill
    1952 0975  50			 		push	ax
    1953 0976  BB 0006			 		mov	bx,6
    1954 0979  E8 0834 R		 		call	GetpDPB			; (0834)
    1955 097C  8A CC			 		mov	cl,ah
    1956 097E  58			 		pop	ax
    1957 097F  D3 E0			 		shl	ax,cl			; Shift w/zeros fill
    1958 0981  BA FFD8			 		mov	dx,0FFD8h		;PCRBASE+DMA1+DMATC
    1959 0984  EF			 		out	dx,ax			; port 0FFD8h ??I/O Non-standard
    1960 0985  F8			 		clc				; Clear carry flag
    1961 0986  5E			 		pop	si
    1962 0987  5A			 		pop	dx
    1963 0988  59			 		pop	cx
    1964 0989  5B			 		pop	bx
    1965 098A  58			 		pop	ax
    1966 098B  C3			 		retn
    1967 098C				sub_18		endp
    1968				
    1969				;a.098c
    1970				; used in setting up DMA transactions
    1971 098C				loc_112:
    1972				 			                        ;* No entry point to code
    1973 098C  E8 09BF R		 		call	sub_21			; (09BF)
    1974 098F  72 14			 		jc	loc_ret_112		; Jump if carry Set
    1975 0991  B4 08			 		mov	ah,8
    1976 0993  E8 0808 R		 		call	sub_13			; (0808)
    1977 0996  E8 0A08 R		 		call	sub_22			; (0A08)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-37


    1978 0999  72 0A			 		jc	loc_ret_112		; Jump if carry Set
    1979 099B  A0 0042			 		mov	al,byte ptr ds:[42h]	; (A.0042=0)
    1980 099E  24 60			 		and	al,60h			; '`'
    1981 09A0  3C 60			 		cmp	al,60h			; '`'
    1982 09A2  74 02			 		je	loc_113			; Jump if equal
    1983 09A4  F8			 		clc				; Clear carry flag
    1984				
    1985 09A5				loc_ret_112:					;  xref A.098F, 0999
    1986 09A5  C3			 		retn
    1987 09A6				loc_113:					;  xref A.09A2
    1988 09A6  80 0E 0041 40		 		or	byte ptr ds:[41h],40h	; (A.0041=0B9h) '@'
    1989 09AB  F9			 		stc				; Set carry flag
    1990 09AC  C3			 		retn
    1991				
    1992				;===============================================================================
    1993				 ;                              SUBROUTINE
    1994				 ;
    1995				 ;         Called from:   A.0559, 06B8
    1996				;===============================================================================
    1997				; since boards don't have standard PC-compatible port addresses, not sure
    1998				; what this is for.
    1999				;a.09ad
    2000 09AD				sub_19		proc	near
    2001 09AD  50			 		push	ax
    2002 09AE  52			 		push	dx
    2003 09AF  B0 05			 		mov	al,5
    2004 09B1  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
    2005 09B3  5A			 		pop	dx
    2006 09B4  58			 		pop	ax
    2007 09B5  C3			 		retn
    2008 09B6				sub_19		endp
    2009				
    2010				
    2011				;===============================================================================
    2012				 ;                              SUBROUTINE
    2013				 ;
    2014				 ;         Called from:   A.0731
    2015				;===============================================================================
    2016				; since boards don't have standard PC-compatible port addresses, not sure
    2017				; what this is for.
    2018				;a.09b6
    2019 09B6				sub_20		proc	near
    2020 09B6  50			 		push	ax
    2021 09B7  52			 		push	dx
    2022 09B8  B0 04			 		mov	al,4
    2023 09BA  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
    2024 09BC  5A			 		pop	dx
    2025 09BD  58			 		pop	ax
    2026 09BE  C3			 		retn
    2027 09BF				sub_20		endp
    2028				
    2029				
    2030				;===============================================================================
    2031				 ;                              SUBROUTINE
    2032				 ;
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-38


    2033				 ;         Called from:   A.078F, 098C
    2034				;===============================================================================
    2035				 ; Configure DMA1
    2036				 ; since boards don't have standard PC-compatible port addresses, not sure
    2037				; what this is for.
    2038				;a.09ad09bf
    2039 09BF				sub_21		proc	near
    2040 09BF  50			 		push	ax
    2041 09C0  53			 		push	bx
    2042 09C1  51			 		push	cx
    2043 09C2  52			 		push	dx
    2044 09C3  FA			 		cli				; Disable interrupts
    2045 09C4  B8 0000			 		mov	ax,0
    2046 09C7  BA FF36			 		mov	dx,0FF36h		;PCRBASE+ICR+D1CR
    2047 09CA  EF			 		out	dx,ax			; port 0FF36h ??I/O Non-standard
    2048 09CB  FB			 		sti				; Enable interrupts
    2049 09CC  BA 0090			 		mov	dx,90h
    2050 09CF  B3 C0			 		mov	bl,0C0h
    2051 09D1  33 C9			 		xor	cx,cx			; Zero register
    2052				
    2053 09D3				locloop_114:					;  xref A.09DA, 09DE
    2054 09D3  F6 06 003E 80		 		test	byte ptr ds:[3Eh],80h	; (A.003E=0FBh)
    2055 09D8  75 1F			 		jnz	loc_115			; Jump if not zero
    2056 09DA  E2 F7			 		loop	locloop_114		; Loop if cx > 0
    2057				
    2058 09DC  FE CB			 		dec	bl
    2059 09DE  75 F3			 		jnz	locloop_114		; Jump if not zero
    2060 09E0  FA			 		cli				; Disable interrupts
    2061 09E1  E8 0A4C R		 		call	sub_23			; (0A4C)
    2062 09E4  80 0E 0041 80		 		or	byte ptr ds:[41h],80h	; (A.0041=0B9h)
    2063 09E9  80 26 003E 7F		 		and	byte ptr ds:[3Eh],7Fh	; (A.003E=0FBh)
    2064 09EE  B8 0008			 		mov	ax,8
    2065 09F1  BA FF36			 		mov	dx,0FF36h		;PCRBASE+ICR+D1CR
    2066 09F4  EF			 		out	dx,ax			; port 0FF36h ??I/O Non-standard
    2067 09F5  FB			 		sti				; Enable interrupts
    2068 09F6  F9			 		stc				; Set carry flag
    2069 09F7  EB 09			 		jmp	short loc_116		; (0A02)
    2070 09F9				loc_115:					;  xref A.09D8
    2071 09F9  FA			 		cli				; Disable interrupts
    2072 09FA  B8 0008			 		mov	ax,8
    2073 09FD  BA FF36			 		mov	dx,0FF36h		;PCRBASE+ICR+D1CR
    2074 0A00  EF			 		out	dx,ax			; port 0FF36h ??I/O Non-standard
    2075 0A01  F8			 		clc				; Clear carry flag
    2076 0A02				loc_116:					;  xref A.09F7
    2077 0A02  FB			 		sti				; Enable interrupts
    2078 0A03  5A			 		pop	dx
    2079 0A04  59			 		pop	cx
    2080 0A05  5B			 		pop	bx
    2081 0A06  58			 		pop	ax
    2082 0A07  C3			 		retn
    2083 0A08				sub_21		endp
    2084				
    2085				
    2086				;===============================================================================
    2087				 ;                              SUBROUTINE
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-39


    2088				 ;
    2089				 ;         Called from:   A.0794, 07DC, 0996
    2090				;===============================================================================
    2091				; since boards don't have standard PC-compatible port addresses, not sure
    2092				; what this is for.
    2093				;a.0a08
    2094 0A08				sub_22		proc	near
    2095 0A08  FC			 		cld				; Clear direction
    2096 0A09  BF 0042			 		mov	di,42h			; (A.0042=0)
    2097 0A0C  51			 		push	cx
    2098 0A0D  52			 		push	dx
    2099 0A0E  53			 		push	bx
    2100 0A0F  B3 07			 		mov	bl,7
    2101 0A11				loc_117:					;  xref A.0A44
    2102 0A11  33 C9			 		xor	cx,cx			; Zero register
    2103 0A13  BA 0090			 		mov	dx,90h
    2104				
    2105 0A16				locloop_118:					;  xref A.0A1B
    2106 0A16  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    2107 0A17  A8 80			 		test	al,80h
    2108 0A19  75 07			 		jnz	loc_120			; Jump if not zero
    2109 0A1B  E2 F9			 		loop	locloop_118		; Loop if cx > 0
    2110				
    2111 0A1D				loc_119:					;  xref A.0A2C
    2112 0A1D  F9			 		stc				; Set carry flag
    2113 0A1E  5B			 		pop	bx
    2114 0A1F  5A			 		pop	dx
    2115 0A20  59			 		pop	cx
    2116 0A21  C3			 		retn
    2117 0A22				loc_120:					;  xref A.0A19
    2118 0A22  EC			 		in	al,dx			; port 0FFDAh ??I/O Non-standard
    2119 0A23  A8 40			 		test	al,40h			; '@'
    2120 0A25  75 07			 		jnz	loc_122			; Jump if not zero
    2121 0A27				loc_121:					;  xref A.0A46
    2122 0A27  80 0E 0041 20		 		or	byte ptr ds:[41h],20h	; (A.0041=0B9h) ' '
    2123 0A2C  EB EF			 		jmp	short loc_119		; (0A1D)
    2124 0A2E				loc_122:					;  xref A.0A25
    2125 0A2E  BA 0092			 		mov	dx,92h
    2126 0A31  EC			 		in	al,dx			; port 92h ??I/O Non-standard
    2127 0A32  88 05			 		mov	[di],al
    2128 0A34  47			 		inc	di
    2129 0A35  B9 0028			 		mov	cx,28h
    2130				
    2131				;a.0a38
    2132 0A38				locloop_123:					;  xref A.0A38
    2133 0A38  E2 FE			 		loop	locloop_123		; Loop if cx > 0
    2134				
    2135 0A3A  BA 0090			 		mov	dx,90h
    2136 0A3D  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    2137 0A3E  A8 10			 		test	al,10h
    2138 0A40  74 06			 		jz	loc_124			; Jump if zero
    2139 0A42  FE CB			 		dec	bl
    2140 0A44  75 CB			 		jnz	loc_117			; Jump if not zero
    2141 0A46  EB DF			 		jmp	short loc_121		; (0A27)
    2142 0A48				loc_124:					;  xref A.0A40
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-40


    2143 0A48  5B			 		pop	bx
    2144 0A49  5A			 		pop	dx
    2145 0A4A  59			 		pop	cx
    2146 0A4B  C3			 		retn
    2147 0A4C				sub_22		endp
    2148				
    2149				
    2150				;===============================================================================
    2151				 ;                              SUBROUTINE
    2152				 ;
    2153				 ;         Called from:   A.068F, 07D9, 07EE, 08E0, 09E1
    2154				;===============================================================================
    2155				; since boards don't have standard PC-compatible port addresses, not sure
    2156				; what this is for.
    2157				;a.0a4c
    2158 0A4C				sub_23		proc	near
    2159 0A4C  50			 		push	ax
    2160 0A4D  B0 0D			 		mov	al,0Dh
    2161 0A4F  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
    2162 0A51  50			 		push	ax
    2163 0A52  58			 		pop	ax
    2164 0A53  B0 0C			 		mov	al,0Ch
    2165 0A55  E6 D6			 		out	0D6h,al			; port 0D6h, DMA-2 mode reg
    2166 0A57  58			 		pop	ax
    2167 0A58  C3			 		retn
    2168 0A59				sub_23		endp
    2169				
    2170				
    2171				;===============================================================================
    2172				 ;                              SUBROUTINE
    2173				 ;
    2174				 ;         Called from:   A.0734
    2175				;===============================================================================
    2176				;a.0a59
    2177 0A59				sub_24		proc	near
    2178 0A59  50			 		push	ax
    2179 0A5A  53			 		push	bx
    2180 0A5B  51			 		push	cx
    2181 0A5C  52			 		push	dx
    2182 0A5D  B3 04			 		mov	bl,4
    2183 0A5F  33 C9			 		xor	cx,cx			; Zero register
    2184				
    2185 0A61				locloop_125:					;  xref A.0A73, 0A77
    2186 0A61  B4 04			 		mov	ah,4
    2187 0A63  E8 0808 R		 		call	sub_13			; (0808)
    2188 0A66  8A 66 00			 		mov	ah,[bp]
    2189 0A69  E8 0808 R		 		call	sub_13			; (0808)
    2190 0A6C  E8 0A87 R		 		call	sub_25			; (0A87)
    2191 0A6F  A8 20			 		test	al,20h			; ' '
    2192 0A71  75 0E			 		jnz	loc_126			; Jump if not zero
    2193 0A73  E2 EC			 		loop	locloop_125		; Loop if cx > 0
    2194				
    2195 0A75  FE CB			 		dec	bl
    2196 0A77  75 E8			 		jnz	locloop_125		; Jump if not zero
    2197 0A79  80 0E 0041 80		 		or	byte ptr ds:[41h],80h	; (A.0041=0B9h)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-41


    2198 0A7E  F9			 		stc				; Set carry flag
    2199 0A7F  EB 01			 		jmp	short loc_127		; (0A82)
    2200 0A81				loc_126:					;  xref A.0A71
    2201 0A81  F8			 		clc				; Clear carry flag
    2202 0A82				loc_127:					;  xref A.0A7F
    2203 0A82  5A			 		pop	dx
    2204 0A83  59			 		pop	cx
    2205 0A84  5B			 		pop	bx
    2206 0A85  58			 		pop	ax
    2207 0A86  C3			 		retn
    2208 0A87				sub_24		endp
    2209				
    2210				
    2211				;===============================================================================
    2212				 ;                              SUBROUTINE
    2213				 ;
    2214				 ;         Called from:   A.08A5, 08B0, 08B5, 08BC, 0A6C, 0AA4, 0AAB
    2215				;===============================================================================
    2216				;a.0a87
    2217 0A87				sub_25		proc	near
    2218 0A87  52			 		push	dx
    2219 0A88  BA 0090			 		mov	dx,90h
    2220 0A8B				loc_128:					;  xref A.0A8E
    2221 0A8B  EC			 		in	al,dx			; port 90h ??I/O Non-standard
    2222 0A8C  A8 80			 		test	al,80h
    2223 0A8E  74 FB			 		jz	loc_128			; Jump if zero
    2224 0A90  A8 40			 		test	al,40h			; '@'
    2225 0A92  74 07			 		jz	loc_129			; Jump if zero
    2226 0A94  BA 0092			 		mov	dx,92h
    2227 0A97  EC			 		in	al,dx			; port 92h ??I/O Non-standard
    2228 0A98  5A			 		pop	dx
    2229 0A99  F8			 		clc				; Clear carry flag
    2230 0A9A  C3			 		retn
    2231 0A9B				loc_129:					;  xref A.0A92
    2232 0A9B  5A			 		pop	dx
    2233 0A9C  F9			 		stc				; Set carry flag
    2234 0A9D  C3			 		retn
    2235 0A9E				sub_25		endp
    2236				
    2237				
    2238				;===============================================================================
    2239				 ;                              SUBROUTINE
    2240				 ;
    2241				 ;         Called from:   A.0692, 06B5, 0728, 0741, 07DF, 0867, 087E
    2242				;===============================================================================
    2243				;a.0a9e
    2244 0A9E				sub_26		proc	near
    2245 0A9E  50			 		push	ax
    2246 0A9F				loc_130:					;  xref A.0AAE
    2247 0A9F  B4 08			 		mov	ah,8
    2248 0AA1  E8 0808 R		 		call	sub_13			; (0808)
    2249 0AA4  E8 0A87 R		 		call	sub_25			; (0A87)
    2250 0AA7  3C 80			 		cmp	al,80h
    2251 0AA9  74 05			 		je	loc_131			; Jump if equal
    2252 0AAB  E8 0A87 R		 		call	sub_25			; (0A87)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-42


    2253 0AAE  EB EF			 		jmp	short loc_130		; (0A9F)
    2254 0AB0				loc_131:					;  xref A.0AA9
    2255 0AB0  58			 		pop	ax
    2256 0AB1  C3			 		retn
    2257 0AB2				sub_26		endp
    2258				
    2259				
    2260				;===============================================================================
    2261				 ;                              SUBROUTINE
    2262				 ;
    2263				 ;         Called from:   A.07D5, 07E3
    2264				;===============================================================================
    2265				;a.0ab2
    2266 0AB2				sub_27		proc	near
    2267 0AB2  A0 0045			 		mov	al,byte ptr ds:[45h]	; (A.0045=0AFh)
    2268 0AB5  3A C5			 		cmp	al,ch
    2269 0AB7  A0 0047			 		mov	al,byte ptr ds:[47h]	; (A.0047=6)
    2270 0ABA  74 0A			 		jz	loc_132			; Jump if zero
    2271 0ABC  BB 0008			 		mov	bx,8
    2272 0ABF  E8 0834 R		 		call	GetpDPB			; (0834)
    2273 0AC2  8A C4			 		mov	al,ah
    2274 0AC4  FE C0			 		inc	al
    2275 0AC6				loc_132:					;  xref A.0ABA
    2276 0AC6  2A C1			 		sub	al,cl
    2277 0AC8  C3			 		retn
    2278 0AC9				sub_27		endp
    2279				
    2280				; Diskette parameter table
    2281				;a.0ac9
    2282 0AC9				INT_1E:
    2283 0AC9  DF				db      11011111b	; specify byte 1: step rate (ms), head unload time (ms)
    2284								; 7:4 step 0E = 4ms
    2285								; 3:0 HUT  0F = 240ms
    2286 0ACA  02				db      2		; specify byte 2: head load time, non-DMA mode
    2287								; 7:1 HLT 01=4ms
    2288								; 0: non-DMA mode (always 0)
    2289 0ACB  80				db      80h		; motor turn-off delay (ticks)
    2290 0ACC  02				db      2		; bytes per sector (2=512)
    2291 0ACD  08				db      8		; sectors per track
    2292 0ACE  2A				db      2Ah		; gap length (2A=5.25"; 1B=3.5")
    2293 0ACF  FF				db      0FFh		; data length (ignored if BPS !=0)
    2294 0AD0  50				db      50h		; gap length (50=5.25"; 6C=3.5")
    2295 0AD1  F6				db      0F6h		; format fill byte
    2296 0AD2  19				db      19h		; head settle time (ms)
    2297 0AD3  04				db      4		; motor start time (in 1/8 seconds)
    2298				
    2299				
    2300				;===============================================================================
    2301				 ;                              SUBROUTINE
    2302				 ;
    2303				 ;         Called from:   A.00A7
    2304				;===============================================================================
    2305				; grab keyboard vectors
    2306				;a.0ad4
    2307 0AD4				sub_28		proc	near
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-43


    2308 0AD4  1E			 		push	ds
    2309 0AD5  9C			 		pushf				; Push flags
    2310 0AD6  FA			 		cli				; Disable interrupts
    2311 0AD7  33 C0			 		xor	ax,ax			; Zero register
    2312 0AD9  8E D8			 		mov	ds,ax
    2313 0ADB  B8 0B27 R		 		mov	ax,offset INT16HANDLER	;0B27h
    2314 0ADE  A3 0058			 		mov	ds:Int16v,ax		; (0000:0058=0CFC0h)
    2315 0AE1  8C 0E 005A		 		mov	ds:Int16v+2,cs		; (0000:005A=0F000h)
    2316 0AE5  B8 0CE4 R		 		mov	ax,offset INT0DHANDLER	;0CE4h
    2317 0AE8  A3 0034			 		mov	ds:Int0Dv,ax		; (0000:0034=3ADBh)
    2318 0AEB  8C 0E 0036		 		mov	ds:Int0Dv+2,cs		; (0000:0036=17B0h)
    2319 0AEF  B8 0CF2 R		 		mov	ax,offset INT09HANDLER	;0CF2h
    2320 0AF2  A3 0024			 		mov	ds:Int09v,ax		; (0000:0024=0E987h)
    2321 0AF5  8C 0E 0026		 		mov	ds:Int09v+2,cs		; (0000:0026=0F000h)
    2322 0AF9  B8 0040			 		mov	ax,40h
    2323 0AFC  8E D8			 		mov	ds,ax
    2324 0AFE  B8 001E			 		mov	ax,1Eh
    2325 0B01  A3 001A R		 		mov	ds:keybd_q_head,ax	; (0040:001A=30h)
    2326 0B04  A3 001C R		 		mov	ds:keybd_q_tail,ax	; (0040:001C=30h)
    2327 0B07  33 C0			 		xor	ax,ax			; Zero register
    2328 0B09  A2 0017 R		 		mov	ds:keybd_flags_1,al	; (0040:0017=0)
    2329 0B0C  A2 0018 R		 		mov	ds:keybd_flags_2,al	; (0040:0018=0)
    2330 0B0F  A2 0019 R		 		mov	ds:keybd_alt_num,al	; (0040:0019=0)
    2331 0B12  BA FF3A			 		mov	dx,0FF3Ah		;PCRBASE+ICR+INT1CR
    2332 0B15  B8 0001			 		mov	ax,1
    2333 0B18  EF			 		out	dx,ax			; port 0FF3Ah ??I/O Non-standard
    2334 0B19  B0 98			 		mov	al,98h
    2335 0B1B  E6 63			 		out	63h,al			; port 63h, 8255 mode reg
    2336 0B1D  B0 C0			 		mov	al,0C0h
    2337 0B1F  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2338 0B21  E8 0B6E R		 		call	sub_29			; (0B6E)
    2339 0B24  9D			 		popf				; Pop flags
    2340 0B25  1F			 		pop	ds
    2341 0B26  C3			 		retn
    2342 0B27				sub_28		endp
    2343				
    2344				;a.0b27
    2345 0B27				INT16HANDLER:
    2346 0B27  FB			 		sti				; Enable interrupts
    2347 0B28  1E			 		push	ds
    2348 0B29  53			 		push	bx
    2349 0B2A  BB 0040			 		mov	bx,40h
    2350 0B2D  8E DB			 		mov	ds,bx
    2351 0B2F  0A E4			 		or	ah,ah			; Zero ?
    2352 0B31  74 0B			 		jz	loc_134			; Jump if zero
    2353 0B33  FE CC			 		dec	ah
    2354 0B35  74 20			 		jz	loc_135			; Jump if zero
    2355 0B37  FE CC			 		dec	ah
    2356 0B39  74 2D			 		jz	loc_136			; Jump if zero
    2357 0B3B  5B			 		pop	bx
    2358 0B3C  1F			 		pop	ds
    2359 0B3D  CF			 		iret				; Interrupt return
    2360 0B3E				loc_134:					;  xref A.0B31, 0B49
    2361 0B3E  FB			 		sti				; Enable interrupts
    2362 0B3F  90			 		nop
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-44


    2363 0B40  FA			 		cli				; Disable interrupts
    2364 0B41  8B 1E 001A		 		mov	bx,word ptr ds:[1Ah]	; (A.001A=3538h)
    2365 0B45  3B 1E 001C		 		cmp	bx,word ptr ds:[1Ch]	; (A.001C=0D0Ah)
    2366 0B49  74 F3			 		je	loc_134			; Jump if equal
    2367 0B4B  8B 07			 		mov	ax,[bx]
    2368 0B4D  E8 0BD3 R		 		call	sub_30			; (0BD3)
    2369 0B50  89 1E 001A		 		mov	word ptr ds:[1Ah],bx	; (A.001A=3538h)
    2370 0B54  5B			 		pop	bx
    2371 0B55  1F			 		pop	ds
    2372 0B56  CF			 		iret				; Interrupt return
    2373 0B57				loc_135:					;  xref A.0B35
    2374 0B57  FA			 		cli				; Disable interrupts
    2375 0B58  8B 1E 001A		 		mov	bx,word ptr ds:[1Ah]	; (A.001A=3538h)
    2376 0B5C  3B 1E 001C		 		cmp	bx,word ptr ds:[1Ch]	; (A.001C=0D0Ah)
    2377 0B60  8B 07			 		mov	ax,[bx]
    2378 0B62  FB			 		sti				; Enable interrupts
    2379 0B63  5B			 		pop	bx
    2380 0B64  1F			 		pop	ds
    2381 0B65  CA 0002			 		retf	2			; Return far
    2382 0B68				loc_136:					;  xref A.0B39
    2383 0B68  A0 0017			 		mov	al,byte ptr ds:[17h]	; (A.0017=32h)
    2384 0B6B  5B			 		pop	bx
    2385 0B6C  1F			 		pop	ds
    2386 0B6D  CF			 		iret				; Interrupt return
    2387				
    2388				;===============================================================================
    2389				 ;                              SUBROUTINE
    2390				 ;
    2391				 ;         Called from:   A.0B21
    2392				;===============================================================================
    2393				;a.0b6e
    2394 0B6E				sub_29		proc	near
    2395 0B6E  FA			 		cli				; Disable interrupts
    2396 0B6F  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2397 0B71  24 3F			 		and	al,3Fh			; '?'
    2398 0B73  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2399				 						;  al = 0, speaker off
    2400 0B75  B9 A558			 		mov	cx,0A558h
    2401				
    2402 0B78				locloop_137:					;  xref A.0B78
    2403 0B78  E2 FE			 		loop	locloop_137		; Loop if cx > 0
    2404				
    2405 0B7A  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2406 0B7C  0C C0			 		or	al,0C0h
    2407 0B7E  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2408 0B80  24 3F			 		and	al,3Fh			; '?'
    2409 0B82  0C 40			 		or	al,40h			; '@'
    2410 0B84  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2411 0B86  33 C9			 		xor	cx,cx			; Zero register
    2412 0B88  FA			 		cli				; Disable interrupts
    2413				
    2414 0B89				locloop_138:					;  xref A.0B8D
    2415 0B89  E4 62			 		in	al,62h			; port 62h, 8255 C - sw2, etc.
    2416 0B8B  A8 10			 		test	al,10h
    2417 0B8D  E1 FA			 		loopz	locloop_138		; Loop if zf=1, cx>0
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-45


    2418				
    2419 0B8F  E3 15			 		jcxz	loc_139			; Jump if cx=0
    2420 0B91  E4 60			 		in	al,60h			; port 60h, keybd scan or sw1
    2421 0B93  50			 		push	ax
    2422 0B94  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2423 0B96  8A E0			 		mov	ah,al
    2424 0B98  0C 80			 		or	al,80h
    2425 0B9A  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2426 0B9C  8A C4			 		mov	al,ah
    2427 0B9E  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2428 0BA0  58			 		pop	ax
    2429 0BA1  3C AA			 		cmp	al,0AAh
    2430 0BA3  75 01			 		jne	loc_139			; Jump if not equal
    2431 0BA5  C3			 		retn
    2432 0BA6				loc_139:					;  xref A.0B8F, 0BA3
    2433 0BA6  BE 0BBA R		 		mov	si,offset msg5		; (A.0BBA='Keyboard reset f')
    2434 0BA9  E8 05E5 R		 		call	prtzstr			; (05E5)
    2435 0BAC  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2436 0BAE  8A E0			 		mov	ah,al
    2437 0BB0  0C 80			 		or	al,80h
    2438 0BB2  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2439 0BB4  8A C4			 		mov	al,ah
    2440 0BB6  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2441 0BB8  F9			 		stc				; Set carry flag
    2442 0BB9  C3			 		retn
    2443 0BBA				sub_29		endp
    2444				
    2445 0BBA  4B 65 79 62 6F 61	msg5:		db	'Keyboard reset failure', 0Ah, 0Dh,0
    2446       72 64 20 72 65 73	
    2447       65 74 20 66 61 69	
    2448       6C 75 72 65 0A 0D	
    2449       00			
    2450				
    2451				
    2452				;===============================================================================
    2453				 ;                              SUBROUTINE
    2454				 ;
    2455				 ;         Called from:   A.0B4D, 0F6A
    2456				;===============================================================================
    2457				;a.0bd3
    2458 0BD3				sub_30		proc	near
    2459 0BD3  83 C3 02			 		add	bx,2
    2460 0BD6  81 FB 003E		 		cmp	bx,word ptr 3Eh		; 81 fb 3e 00
    2461 0BDA  75 03			 		jne	loc_ret_140		; Jump if not equal
    2462 0BDC  BB 001E			 		mov	bx,1Eh
    2463				
    2464 0BDF				loc_ret_140:					;  xref A.0BDA
    2465 0BDF  C3			 		retn
    2466 0BE0				sub_30		endp
    2467				
    2468				; must be some sort of keyboard translatioon table
    2469				;a.0be0
    2470 0BE0  52			data_84:		db	52h			;  xref A.0D20
    2471 0BE1  3A 45 46 38 1D 2A	     		db	 3Ah, 45h, 46h, 38h, 1Dh, 2Ah
    2472 0BE7  36			 		db	 36h
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-46


    2473				;a.0be9
    2474 0BE8  80			data_85:	db	80h			; Data table (indexed access)
    2475				 						;  xref A.0D33
    2476 0BE9  40 20 10 08 04 02	     		db	 40h, 20h, 10h, 08h, 04h, 02h
    2477 0BEF  01 1B FF 00 FF FF	     		db	 01h, 1Bh,0FFh, 00h,0FFh,0FFh
    2478 0BF5  FF 1E FF FF FF FF	     		db	0FFh, 1Eh,0FFh,0FFh,0FFh,0FFh
    2479 0BFB  1F FF 7F FF 11 17	     		db	 1Fh,0FFh, 7Fh,0FFh, 11h, 17h
    2480 0C01  05 12 14 19 15 09	     		db	 05h, 12h, 14h, 19h, 15h, 09h
    2481 0C07  0F 10 1B 1D 0A FF	     		db	 0Fh, 10h, 1Bh, 1Dh, 0Ah,0FFh
    2482 0C0D  01 13 04 06 07 08	     		db	 01h, 13h, 04h, 06h, 07h, 08h
    2483 0C13  0A 0B 0C FF FF FF	     		db	 0Ah, 0Bh, 0Ch,0FFh,0FFh,0FFh
    2484 0C19  FF 1C 1A 18 03 16	     		db	0FFh, 1Ch, 1Ah, 18h, 03h, 16h
    2485 0C1F  02 0E 0D FF FF FF	     		db	 02h, 0Eh, 0Dh,0FFh,0FFh,0FFh
    2486 0C25  FF FF FF 20 FF		 		db	0FFh,0FFh,0FFh, 20h,0FFh
    2487 0C2A  5E 5F 60 61 62 63	     		db	'^_`abcdefg'
    2488       64 65 66 67		
    2489 0C34  FF FF 77 FF 84 FF	     		db	0FFh,0FFh, 77h,0FFh, 84h,0FFh
    2490 0C3A  73 FF 74 FF 75 FF	     		db	 73h,0FFh, 74h,0FFh, 75h,0FFh
    2491 0C40  76 FF FF			 		db	 76h,0FFh,0FFh
    2492				;a.0c43
    2493 0C43  1B 31 32 33 34 35	data_86:	db	1Bh, '1234567890-=', 8, 9, 'qwert'	;  xref A.0F2D
    2494       36 37 38 39 30 2D	
    2495       3D 08 09 71 77 65	
    2496       72 74			
    2497 0C57  79 75 69 6F 70 5B	     		db	'yuiop[]', 0Dh
    2498       5D 0D			
    2499 0C5F  FF			 		db	0FFh
    2500 0C60  61 73 64 66 67 68	     		db	'asdfghjkl',3bh,27h,60h
    2501       6A 6B 6C 3B 27 60	
    2502 0C6C  FF			 		db	0FFh
    2503 0C6D  5C 7A 78 63 76 62	     		db	'\zxcvbnm,./'
    2504       6E 6D 2C 2E 2F		
    2505 0C78  FF 2A FF 20 FF		 		db	0FFh, 2Ah,0FFh, 20h,0FFh
    2506 0C7D  1B 21 40 23 24		 		db	1Bh, '!@#$'
    2507 0C82  25 5E 26 2A 28 29	     		db	'%^&*()_+', 8
    2508       5F 2B 08			
    2509 0C8B  00			 		db	0
    2510 0C8C  51 57 45 52 54 59	     		db	'QWERTYUIOP{}', 0Dh
    2511       55 49 4F 50 7B 7D	
    2512       0D			
    2513 0C99  FF			 		db	0FFh
    2514 0C9A  41 53 44 46 47 48	     		db	'ASDFGHJKL:"~'
    2515       4A 4B 4C 3A 22 7E	
    2516 0CA6  FF			 		db	0FFh
    2517 0CA7  7C 5A 58 43 56 42	     		db	'|ZXCVBNM<>?'
    2518       4E 4D 3C 3E 3F		
    2519 0CB2  FF 00 FF 20 FF 54	     		db	0FFh, 00h,0FFh, 20h,0FFh, 54h
    2520 0CB8  55			 		db	 55h
    2521 0CB9  56 57 58 59 5A 5B	     		db	'VWXYZ[\]hiklmn'
    2522       5C 5D 68 69 6B 6C	
    2523       6D 6E			
    2524 0CC7  6F 70 71 37 38 39	     		db	'opq789-456+1230.GHI'
    2525       2D 34 35 36 2B 31	
    2526       32 33 30 2E 47 48	
    2527       49			
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-47


    2528 0CDA  FF 4B FF 4D FF 4F	     		db	0FFh, 4Bh,0FFh, 4Dh,0FFh, 4Fh
    2529 0CE0  50 51 52 53				db	50h, 51h, 52h, 53h 
    2530				 
    2531				;a.0ce4
    2532 0CE4				INT0DHANDLER:
    2533				; 	db	 50h, 52h
    2534				;    	db	0B8h, 00h, 80h,0BAh, 22h,0FFh
    2535				;     	db	0EFh, 5Ah, 58h,0CDh, 09h,0CFh
    2536 0CE4  50			 		push	ax
    2537 0CE5  52			 		push	dx
    2538 0CE6  B8 8000			 		mov	ax,8000h		; do EOI
    2539 0CE9  BA FF22			 		mov	dx,0FF22h		;PCRBASE+ICR+EOIREG
    2540 0CEC  EF			 		out	dx,ax
    2541 0CED  5A			 		pop	dx
    2542 0CEE  58			 		pop	ax
    2543 0CEF  CD 09			 		int	09
    2544 0CF1  CF			 		iret
    2545				
    2546				;a.0cf2
    2547 0CF2				INT09HANDLER:
    2548				;     	db	 50h, 53h, 51h, 52h, 56h, 57h
    2549				;     	db	 1Eh, 06h,0FCh,0B8h, 40h, 00h
    2550				;     	db	 8Eh,0D8h,0E4h, 60h,0A2h, 7Bh
    2551				;     	db	 00h, 50h,0E4h, 61h, 8Ah,0E0h
    2552				;     	db	 0Ch, 80h,0E6h, 61h, 86h,0E0h
    2553				;     	db	0E6h, 61h, 58h, 8Ah,0E0h, 3Ch
    2554				;     	db	0FFh, 75h, 03h,0E9h, 60h, 02h
    2555					;	sti
    2556 0CF2  50			 		push	ax
    2557 0CF3  53			 		push	bx
    2558 0CF4  51			 		push	cx
    2559 0CF5  52			 		push	dx
    2560 0CF6  56			 		push	si
    2561 0CF7  57			 		push	di
    2562 0CF8  1E			 		push	ds
    2563 0CF9  06			 		push	es
    2564 0CFA  FC			 		cld
    2565 0CFB  B8 0040			 		mov	ax,40h
    2566 0CFE  8E D8			 		mov	ds,ax
    2567 0D00  E4 60			 		in	al,60h 
    2568 0D02  A2 007B R		 		mov	ds:[lptto+3],al		;7b
    2569 0D05  50			 		push	ax
    2570 0D06  E4 61			 		in	al,61h 
    2571 0D08  8A E0			 		mov	ah,al
    2572 0D0A  0C 80			 		or	al,80h 
    2573 0D0C  E6 61			 		out	61h,al
    2574 0D0E  86 E0			 		xchg	ah,al
    2575 0D10  E6 61			 		out	61h,al
    2576 0D12  58			 		pop	ax
    2577 0D13  8A E0			 		mov	ah,al
    2578 0D15  3C FF			 		cmp	al,0FFh
    2579 0D17  75 03			 		jnz	loc_141
    2580 0D19  E9 0F7C R		 		jmp	loc_186			;0F7C
    2581				;a.0d1c
    2582 0D1C				loc_141:
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-48


    2583 0D1C  24 7F			 		and	al,7Fh
    2584 0D1E  0E			 		push	cs
    2585 0D1F  07			 		pop	es
    2586 0D20  BF 0BE0 R		 		mov	di,offset data_84	; (A.0BE0=52h)
    2587 0D23  B9 0008			 		mov	cx,8
    2588 0D26  F2/ AE			 		repne	scasb			; Rep zf=0+cx >0 Scan es:[di] for al
    2589 0D28  8A C4			 		mov	al,ah
    2590 0D2A  74 03			 		jz	loc_142			; Jump if zero
    2591 0D2C  E9 0DB7 R		 		jmp	loc_151			; (0DB7)
    2592 0D2F				loc_142:					;  xref A.0D2A
    2593 0D2F  81 EF 0BE1		 		sub	di,0BE1h
    2594 0D33  2E: 8A A5 0BE8 R		 		mov	ah,byte ptr cs:data_85[di]	; (A.0BE8=80h)
    2595 0D38  A8 80			 		test	al,80h
    2596 0D3A  75 54			 		jnz	loc_149			; Jump if not zero
    2597 0D3C  80 FC 10			 		cmp	ah,10h
    2598 0D3F  73 07			 		jae	loc_144			; Jump if above or =
    2599 0D41  08 26 0017		 		or	byte ptr ds:[17h],ah	; (A.0017=32h)
    2600 0D45  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    2601 0D48				loc_144:					;  xref A.0D3F
    2602 0D48  F6 06 0017 04		 		test	byte ptr ds:[17h],4	; (A.0017=32h)
    2603 0D4D  75 68			 		jnz	loc_151			; Jump if not zero
    2604 0D4F  3C 52			 		cmp	al,52h			; 'R'
    2605 0D51  75 25			 		jne	loc_148			; Jump if not equal
    2606 0D53  F6 06 0017 08		 		test	byte ptr ds:[17h],8	; (A.0017=32h)
    2607 0D58  74 03			 		jz	loc_145			; Jump if zero
    2608 0D5A  EB 5B			 		jmp	short loc_151		; (0DB7)
    2609 0D5C  90			 		db	90h
    2610				;a.0d5d
    2611 0D5D				loc_145:					;  xref A.0D58
    2612 0D5D  F6 06 0017 20		 		test	byte ptr ds:[17h],20h	; (A.0017=32h) ' '
    2613 0D62  75 0D			 		jnz	loc_147			; Jump if not zero
    2614 0D64  F6 06 0017 03		 		test	byte ptr ds:[17h],3	; (A.0017=32h)
    2615 0D69  74 0D			 		jz	loc_148			; Jump if zero
    2616 0D6B				loc_146:					;  xref A.0D76
    2617 0D6B  B8 5230			 		mov	ax,5230h
    2618 0D6E  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2619 0D71				loc_147:					;  xref A.0D62
    2620 0D71  F6 06 0017 03		 		test	byte ptr ds:[17h],3	; (A.0017=32h)
    2621 0D76  74 F3			 		jz	loc_146			; Jump if zero
    2622 0D78				loc_148:					;  xref A.0D51, 0D69
    2623 0D78  84 26 0018		 		test	ah,byte ptr ds:[18h]	; (A.0018=31h)
    2624 0D7C  75 4D			 		jnz	loc_152			; Jump if not zero
    2625 0D7E  08 26 0018		 		or	byte ptr ds:[18h],ah	; (A.0018=31h)
    2626 0D82  30 26 0017		 		xor	byte ptr ds:[17h],ah	; (A.0017=32h)
    2627 0D86  3C 52			 		cmp	al,52h			; 'R'
    2628 0D88  75 41			 		jne	loc_152			; Jump if not equal
    2629 0D8A  B8 5200			 		mov	ax,5200h
    2630 0D8D  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2631 0D90				loc_149:					;  xref A.0D3A
    2632 0D90  80 FC 10			 		cmp	ah,10h
    2633 0D93  73 1A			 		jae	loc_150			; Jump if above or =
    2634 0D95  F6 D4			 		not	ah
    2635 0D97  20 26 0017		 		and	byte ptr ds:[17h],ah	; (A.0017=32h)
    2636 0D9B  3C B8			 		cmp	al,0B8h
    2637 0D9D  75 2C			 		jne	loc_152			; Jump if not equal
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-49


    2638 0D9F  A0 0019			 		mov	al,byte ptr ds:[19h]	; (A.0019=2Fh)
    2639 0DA2  B4 00			 		mov	ah,0
    2640 0DA4  88 26 0019		 		mov	byte ptr ds:[19h],ah	; (A.0019=2Fh)
    2641 0DA8  3C 00			 		cmp	al,0
    2642 0DAA  74 1F			 		je	loc_152			; Jump if equal
    2643 0DAC  E9 0F3D R		 		jmp	loc_182			; (0F3D)
    2644				;a.0daf
    2645 0DAF				loc_150:					;  xref A.0D93
    2646 0DAF  F6 D4			 		not	ah
    2647 0DB1  20 26 0018		 		and	byte ptr ds:[18h],ah	; (A.0018=31h)
    2648 0DB5  EB 14			 		jmp	short loc_152		; (0DCB)
    2649 0DB7				loc_151:					;  xref A.0D2C, 0D4D, 0D5A
    2650 0DB7  3C 80			 		cmp	al,80h
    2651 0DB9  73 10			 		jae	loc_152			; Jump if above or =
    2652 0DBB  F6 06 0018 08		 		test	byte ptr ds:[18h],8	; (A.0018=31h)
    2653 0DC0  74 12			 		jz	loc_153			; Jump if zero
    2654 0DC2  3C 45			 		cmp	al,45h			; 'E'
    2655 0DC4  74 05			 		je	loc_152			; Jump if equal
    2656 0DC6  80 26 0018 F7		 		and	byte ptr ds:[18h],0F7h	; (A.0018=31h)
    2657 0DCB				loc_152:					;  xref A.0D45, 0D7C, 0D88, 0D9D
    2658				 						;            0DAA, 0DB5, 0DB9, 0DC4
    2659				 						;            0E39, 0E60, 0EA8, 0EDE
    2660				 						;            0F57, 0F79, 0F7F
    2661 0DCB  07			 		pop	es
    2662 0DCC  1F			 		pop	ds
    2663 0DCD  5F			 		pop	di
    2664 0DCE  5E			 		pop	si
    2665 0DCF  5A			 		pop	dx
    2666 0DD0  59			 		pop	cx
    2667 0DD1  5B			 		pop	bx
    2668 0DD2  58			 		pop	ax
    2669 0DD3  CF			 		iret				; Interrupt return
    2670				
    2671				; Ctrl-Alt-Del restart?
    2672				;a.0dd4
    2673 0DD4				loc_153:					;  xref A.0DC0
    2674 0DD4  F6 06 0017 08		 		test	byte ptr ds:[17h],8	; (A.0017=32h)
    2675 0DD9  75 03			 		jnz	loc_154			; Jump if not zero
    2676 0DDB  E9 0E6D R		 		jmp	loc_162			; (0E6D)
    2677 0DDE				loc_154:					;  xref A.0DD9
    2678 0DDE  F6 06 0017 04		 		test	byte ptr ds:[17h],4	; (A.0017=32h)
    2679 0DE3  74 31			 		jz	loc_155			; Jump if zero
    2680 0DE5  3C 53			 		cmp	al,53h			; 'S'
    2681 0DE7  75 2D			 		jne	loc_155			; Jump if not equal
    2682 0DE9  C7 06 0072 1234		 		mov	word ptr ds:[72h],1234h	; (A.0072=0FEB9h)
    2683 0DEF  E9 001F R				jmp	COLD2			;*(001F) go to cold restart
    2684				; 		db	0E9h, 2Dh,0F2h
    2685				
    2686				;a.0df2
    2687 0DF2  52 4F 50 51 4B 4C	data_88:	db	'ROPQKLMGHI'		;  xref A.0E1F
    2688       4D 47 48 49		
    2689 0DFC  10 11 12 13 14 15	     		db	 10h, 11h, 12h, 13h, 14h, 15h
    2690 0E02  16 17 18 19 1E 1F	     		db	 16h, 17h, 18h, 19h, 1Eh, 1Fh
    2691 0E08  20 21 22 23 24		 		db	' !"#$'
    2692 0E0D  25 26 2C 2D 2E 2F	     		db	'%&,-./012'
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-50


    2693       30 31 32			
    2694				;a.0e16
    2695 0E16				loc_155:					;  xref A.0DE3, 0DE7
    2696 0E16  3C 39			 		cmp	al,39h			; '9'
    2697 0E18  75 05			 		jne	loc_156			; Jump if not equal
    2698 0E1A  B0 20			 		mov	al,20h			; ' '
    2699 0E1C  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2700 0E1F				loc_156:					;  xref A.0E18
    2701 0E1F  BF 0DF2 R		 		mov	di,offset data_88	; (A.0DF2='ROPQKLMGHI')
    2702 0E22  B9 000A			 		mov	cx,0Ah
    2703 0E25  F2/ AE			 		repne	scasb			; Rep zf=0+cx >0 Scan es:[di] for al
    2704 0E27  75 12			 		jnz	loc_157			; Jump if not zero
    2705 0E29  81 EF 0DF3		 		sub	di,0DF3h
    2706 0E2D  A0 0019			 		mov	al,byte ptr ds:[19h]	; (A.0019=2Fh)
    2707 0E30  B4 0A			 		mov	ah,0Ah
    2708 0E32  F6 E4			 		mul	ah			; ax = reg * al
    2709 0E34  03 C7			 		add	ax,di
    2710 0E36  A2 0019			 		mov	byte ptr ds:[19h],al	; (A.0019=2Fh)
    2711 0E39  EB 90			 		jmp	short loc_152		; (0DCB)
    2712 0E3B				loc_157:					;  xref A.0E27
    2713 0E3B  C6 06 0019 00		 		mov	byte ptr ds:[19h],0	; (A.0019=2Fh)
    2714 0E40  B9 001A			 		mov	cx,1Ah
    2715 0E43  F2/ AE			 		repne	scasb			; Rep zf=0+cx >0 Scan es:[di] for al
    2716 0E45  75 05			 		jnz	loc_158			; Jump if not zero
    2717 0E47  B0 00			 		mov	al,0
    2718 0E49  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2719 0E4C				loc_158:					;  xref A.0E45
    2720 0E4C  3C 02			 		cmp	al,2
    2721 0E4E  72 0C			 		jb	loc_159			; Jump if below
    2722 0E50  3C 0E			 		cmp	al,0Eh
    2723 0E52  73 08			 		jae	loc_159			; Jump if above or =
    2724 0E54  80 C4 76			 		add	ah,76h			; 'v'
    2725 0E57  B0 00			 		mov	al,0
    2726 0E59  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2727 0E5C				loc_159:					;  xref A.0E4E, 0E52
    2728 0E5C  3C 3B			 		cmp	al,3Bh			; ';'
    2729 0E5E  73 03			 		jae	loc_161			; Jump if above or =
    2730				;a.0e60
    2731 0E60				loc_160:					;  xref A.0E65
    2732 0E60  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    2733 0E63				loc_161:					;  xref A.0E5E
    2734 0E63  3C 47			 		cmp	al,47h			; 'G'
    2735 0E65  73 F9			 		jae	loc_160			; Jump if above or =
    2736 0E67  BB 0CC1			 		mov	bx,0CC1h
    2737 0E6A  E9 0F82 R		 		jmp	loc_187			; (0F82)
    2738 0E6D				loc_162:					;  xref A.0DDB
    2739 0E6D  F6 06 0017 04		 		test	byte ptr ds:[17h],4	; (A.0017=32h)
    2740 0E72  74 51			 		jz	loc_168			; Jump if zero
    2741 0E74  3C 46			 		cmp	al,46h			; 'F'
    2742 0E76  75 18			 		jne	loc_163			; Jump if not equal
    2743 0E78  BB 001E			 		mov	bx,1Eh
    2744 0E7B  89 1E 001A		 		mov	word ptr ds:[1Ah],bx	; (A.001A=3538h)
    2745 0E7F  89 1E 001C		 		mov	word ptr ds:[1Ch],bx	; (A.001C=0D0Ah)
    2746 0E83  C6 06 0071 80		 		mov	byte ptr ds:[71h],80h	; (A.0071=0)
    2747 0E88  CD 1B			 		int	1Bh			; Keyboard break (cntrl-break)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-51


    2748 0E8A  B8 0000			 		mov	ax,0
    2749 0E8D  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2750 0E90				loc_163:					;  xref A.0E76
    2751 0E90  3C 45			 		cmp	al,45h			; 'E'
    2752 0E92  75 17			 		jne	loc_165			; Jump if not equal
    2753 0E94  80 0E 0018 08		 		or	byte ptr ds:[18h],8	; (A.0018=31h)
    2754 0E99  BA 03D8			 		mov	dx,3D8h
    2755 0E9C  A0 0065			 		mov	al,byte ptr ds:[65h]	; (A.0065=0A3h)
    2756 0E9F  EE			 		out	dx,al			; port 3D8h, CGA video control
    2757 0EA0  FB			 		sti				; Enable interrupts
    2758 0EA1				loc_164:					;  xref A.0EA6
    2759 0EA1  F6 06 0018 08		 		test	byte ptr ds:[18h],8	; (A.0018=31h)
    2760 0EA6  75 F9			 		jnz	loc_164			; Jump if not zero
    2761 0EA8  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    2762				;a.0eab
    2763 0EAB				loc_165:					;  xref A.0E92
    2764 0EAB  3C 37			 		cmp	al,37h			; '7'
    2765 0EAD  75 06			 		jne	loc_166			; Jump if not equal
    2766 0EAF  B8 7200			 		mov	ax,7200h
    2767 0EB2  E9 0F34 R		 		jmp	loc_181			; (0F34)
    2768 0EB5				loc_166:					;  xref A.0EAD
    2769 0EB5  BB 0BF0			 		mov	bx,0BF0h
    2770 0EB8  3C 3B			 		cmp	al,3Bh			; ';'
    2771 0EBA  73 03			 		jae	loc_167			; Jump if above or =
    2772 0EBC  EB 72			 		jmp	short loc_180		; (0F30)
    2773 0EBE  90			 		db	90h
    2774 0EBF				loc_167:					;  xref A.0EBA
    2775 0EBF  BB 0C2A			 		mov	bx,0C2Ah
    2776 0EC2  E9 0F82 R		 		jmp	loc_187			; (0F82)
    2777 0EC5				loc_168:					;  xref A.0E72
    2778 0EC5  3C 47			 		cmp	al,47h			; 'G'
    2779 0EC7  73 27			 		jae	loc_172			; Jump if above or =
    2780 0EC9  F6 06 0017 03		 		test	byte ptr ds:[17h],3	; (A.0017=32h)
    2781 0ECE  74 55			 		jz	loc_178			; Jump if zero
    2782 0ED0  3C 0F			 		cmp	al,0Fh
    2783 0ED2  75 06			 		jne	loc_169			; Jump if not equal
    2784 0ED4  B8 0F00			 		mov	ax,0F00h
    2785 0ED7  EB 5B			 		jmp	short loc_181		; (0F34)
    2786 0ED9  90			 		db	90h
    2787 0EDA				loc_169:					;  xref A.0ED2
    2788 0EDA  3C 37			 		cmp	al,37h			; '7'
    2789 0EDC  75 03			 		jne	loc_170			; Jump if not equal
    2790 0EDE  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    2791				;a.0ee1
    2792 0EE1				loc_170:					;  xref A.0EDC
    2793 0EE1  3C 3B			 		cmp	al,3Bh			; ';'
    2794 0EE3  72 06			 		jb	loc_171			; Jump if below
    2795 0EE5  BB 0CB7			 		mov	bx,0CB7h
    2796 0EE8  E9 0F82 R		 		jmp	loc_187			; (0F82)
    2797 0EEB				loc_171:					;  xref A.0EE3
    2798 0EEB  BB 0C7D			 		mov	bx,0C7Dh
    2799 0EEE  EB 40			 		jmp	short loc_180		; (0F30)
    2800 0EF0				loc_172:					;  xref A.0EC7
    2801 0EF0  F6 06 0017 20		 		test	byte ptr ds:[17h],20h	; (A.0017=32h) ' '
    2802 0EF5  75 20			 		jnz	loc_176			; Jump if not zero
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-52


    2803 0EF7  F6 06 0017 03		 		test	byte ptr ds:[17h],3	; (A.0017=32h)
    2804 0EFC  75 20			 		jnz	loc_177			; Jump if not zero
    2805 0EFE				loc_173:					;  xref A.0F1C
    2806 0EFE  3C 4A			 		cmp	al,4Ah			; 'J'
    2807 0F00  74 0B			 		je	loc_174			; Jump if equal
    2808 0F02  3C 4E			 		cmp	al,4Eh			; 'N'
    2809 0F04  74 0C			 		je	loc_175			; Jump if equal
    2810 0F06  2C 47			 		sub	al,47h			; 'G'
    2811 0F08  BB 0CD7			 		mov	bx,0CD7h
    2812 0F0B  EB 77			 		jmp	short loc_188		; (0F84)
    2813 0F0D				loc_174:					;  xref A.0F00
    2814 0F0D  B8 4A2D			 		mov	ax,4A2Dh
    2815 0F10  EB 22			 		jmp	short loc_181		; (0F34)
    2816				;a.0f12
    2817 0F12				loc_175:					;  xref A.0F04
    2818 0F12  B8 4E2B			 		mov	ax,4E2Bh
    2819 0F15  EB 1D			 		jmp	short loc_181		; (0F34)
    2820 0F17				loc_176:					;  xref A.0EF5
    2821 0F17  F6 06 0017 03		 		test	byte ptr ds:[17h],3	; (A.0017=32h)
    2822 0F1C  75 E0			 		jnz	loc_173			; Jump if not zero
    2823 0F1E				loc_177:					;  xref A.0EFC
    2824 0F1E  2C 46			 		sub	al,46h			; 'F'
    2825 0F20  BB 0CCA			 		mov	bx,0CCAh
    2826 0F23  EB 0B			 		jmp	short loc_180		; (0F30)
    2827 0F25				loc_178:					;  xref A.0ECE
    2828 0F25  3C 3B			 		cmp	al,3Bh			; ';'
    2829 0F27  72 04			 		jb	loc_179			; Jump if below
    2830 0F29  B0 00			 		mov	al,0
    2831 0F2B  EB 07			 		jmp	short loc_181		; (0F34)
    2832 0F2D				loc_179:					;  xref A.0F27
    2833 0F2D  BB 0C43 R		 		mov	bx,offset data_86	; (A.0C43=' 1234567890-=  q')
    2834				;a.0f30
    2835 0F30				loc_180:					;  xref A.0EBC, 0EEE, 0F23
    2836 0F30  FE C8			 		dec	al
    2837 0F32  2E: D7			 		xlat	cs:[bx]			; al=[al+[bx]] table
    2838 0F34				loc_181:					;  xref A.0D6E, 0D8D, 0E1C, 0E49
    2839				 						;            0E59, 0E8D, 0EB2, 0ED7
    2840				 						;            0F10, 0F15, 0F2B, 0F8A
    2841 0F34  3C FF			 		cmp	al,0FFh
    2842 0F36  74 1F			 		je	loc_183			; Jump if equal
    2843 0F38  80 FC FF			 		cmp	ah,0FFh
    2844 0F3B  74 1A			 		je	loc_183			; Jump if equal
    2845 0F3D				loc_182:					;  xref A.0DAC
    2846 0F3D  F6 06 0017 40		 		test	byte ptr ds:[17h],40h	; (A.0017=32h) '@'
    2847 0F42  74 20			 		jz	loc_185			; Jump if zero
    2848 0F44  F6 06 0017 03		 		test	byte ptr ds:[17h],3	; (A.0017=32h)
    2849 0F49  74 0F			 		jz	loc_184			; Jump if zero
    2850 0F4B  3C 41			 		cmp	al,41h			; 'A'
    2851 0F4D  72 15			 		jb	loc_185			; Jump if below
    2852 0F4F  3C 5A			 		cmp	al,5Ah			; 'Z'
    2853 0F51  77 11			 		ja	loc_185			; Jump if above
    2854 0F53  04 20			 		add	al,20h			; ' '
    2855 0F55  EB 0D			 		jmp	short loc_185		; (0F64)
    2856 0F57				loc_183:					;  xref A.0F36, 0F3B
    2857 0F57  E9 0DCB R		 		jmp	loc_152			; (0DCB)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-53


    2858 0F5A				loc_184:					;  xref A.0F49
    2859 0F5A  3C 61			 		cmp	al,61h			; 'a'
    2860 0F5C  72 06			 		jb	loc_185			; Jump if below
    2861 0F5E  3C 7A			 		cmp	al,7Ah			; 'z'
    2862 0F60  77 02			 		ja	loc_185			; Jump if above
    2863 0F62  2C 20			 		sub	al,20h			; ' '
    2864				;a.0f64
    2865 0F64				loc_185:					;  xref A.0F42, 0F4D, 0F51, 0F55
    2866				 						;            0F5C, 0F60
    2867 0F64  8B 1E 001C		 		mov	bx,word ptr ds:[1Ch]	; (A.001C=0D0Ah)
    2868 0F68  8B F3			 		mov	si,bx
    2869 0F6A  E8 0BD3 R		 		call	sub_30			; (0BD3)
    2870 0F6D  3B 1E 001A		 		cmp	bx,word ptr ds:[1Ah]	; (A.001A=3538h)
    2871 0F71  74 09			 		je	loc_186			; Jump if equal
    2872 0F73  89 04			 		mov	[si],ax
    2873 0F75  89 1E 001C		 		mov	word ptr ds:[1Ch],bx	; (A.001C=0D0Ah)
    2874 0F79  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    2875 0F7C				loc_186:					;  xref A.0F71
    2876 0F7C  E8 0F8C R		 		call	sub_31			; (0F8C)
    2877 0F7F  E9 0DCB R		 		jmp	loc_152			; (0DCB)
    2878 0F82				loc_187:					;  xref A.0E6A, 0EC2, 0EE8
    2879 0F82  2C 3B			 		sub	al,3Bh			; ';'
    2880 0F84				loc_188:					;  xref A.0F0B
    2881 0F84  2E: D7			 		xlat	cs:[bx]			; al=[al+[bx]] table
    2882 0F86  8A E0			 		mov	ah,al
    2883 0F88  B0 00			 		mov	al,0
    2884 0F8A  EB A8			 		jmp	short loc_181		; (0F34)
    2885				
    2886				;===============================================================================
    2887				 ;                              SUBROUTINE
    2888				 ;
    2889				 ;         Called from:   A.0F7C
    2890				;===============================================================================
    2891				;a.0f8c
    2892 0F8C				sub_31		proc	near
    2893 0F8C  50			 		push	ax
    2894 0F8D  53			 		push	bx
    2895 0F8E  51			 		push	cx
    2896 0F8F  BB 00C0			 		mov	bx,0C0h
    2897 0F92  E4 61			 		in	al,61h			; port 61h, 8255 port B, read
    2898 0F94  50			 		push	ax
    2899 0F95				loc_189:					;  xref A.0FA8
    2900 0F95  24 FC			 		and	al,0FCh
    2901 0F97  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2902				 						;  al = 0, speaker off
    2903 0F99  B9 0048			 		mov	cx,48h
    2904				
    2905 0F9C				locloop_190:					;  xref A.0F9C
    2906 0F9C  E2 FE			 		loop	locloop_190		; Loop if cx > 0
    2907				
    2908 0F9E  0C 02			 		or	al,2
    2909 0FA0  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2910 0FA2  B9 0048			 		mov	cx,48h
    2911				
    2912 0FA5				locloop_191:					;  xref A.0FA5
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-54


    2913 0FA5  E2 FE			 		loop	locloop_191		; Loop if cx > 0
    2914				
    2915 0FA7  4B			 		dec	bx
    2916 0FA8  75 EB			 		jnz	loc_189			; Jump if not zero
    2917 0FAA  58			 		pop	ax
    2918 0FAB  E6 61			 		out	61h,al			; port 61h, 8255 B - spkr, etc
    2919				 						;  al = 0, speaker off
    2920 0FAD  59			 		pop	cx
    2921 0FAE  5B			 		pop	bx
    2922 0FAF  58			 		pop	ax
    2923 0FB0  C3			 		retn
    2924 0FB1				sub_31		endp
    2925				
    2926				
    2927				;===============================================================================
    2928				 ;                              SUBROUTINE
    2929				 ;
    2930				 ;         Called from:   A.008A
    2931				;===============================================================================
    2932				; Grab INT10/1D video
    2933				;a.0fb1
    2934 0FB1				sub_32		proc	near
    2935 0FB1  1E			 		push	ds
    2936 0FB2  33 C0			 		xor	ax,ax				; Zero register
    2937 0FB4  8E D8			 		mov	ds,ax
    2938 0FB6  B8 0FF1 R		 		mov	ax,offset INT10HANDLER		;0FF1h
    2939 0FB9  A3 0040			 		mov	ds:Int10v,ax			; (0000:0040=0EEh)
    2940 0FBC  8C 0E 0042		 		mov	ds:Int10v+2,cs			; (0000:0042=0C000h)
    2941 0FC0  B8 1020 R		 		mov	ax,offset INT_1D		;1020h
    2942 0FC3  A3 0074			 		mov	ds:Int1Dv,ax			; (0000:0074=0C958h)
    2943 0FC6  8C 0E 0076		 		mov	word ptr ds:Int1Dv+2,cs		; (0000:0076=0F000h)
    2944 0FCA  1F			 		pop	ds
    2945 0FCB  B8 0003			 		mov	ax,3
    2946 0FCE  CD 10			 		int	10h				; Video display   ah=functn 00h
    2947				 							;  set display mode in al
    2948 0FD0  C3			 		retn
    2949 0FD1				sub_32		endp
    2950				
    2951				; INT10 function table
    2952				;a.0fd1
    2953 0FD1  1078 R			INT10FN:	dw	offset loc_193		;  xref A.101B
    2954 0FD3  113E R					dw	offset loc_202		;  xref A.101B
    2955 0FD5  115F R					dw	offset loc_203		;  xref A.101B
    2956 0FD7  1189 R					dw	offset loc_205		;  xref A.101B
    2957 0FD9  16D5 R					dw	offset loc_292		;  xref A.101B
    2958 0FDB  119F R					dw	offset loc_206		;  xref A.101B
    2959 0FDD  120B R					dw	offset loc_211		;  xref A.101B
    2960 0FDF  1290 R					dw	offset loc_219		;  xref A.101B
    2961 0FE1  12CC R					dw	offset loc_225		;  xref A.101B
    2962 0FE3  1312 R					dw	offset loc_231		;  xref A.101B
    2963 0FE5  1334 R					dw	offset loc_234		;  xref A.101B
    2964 0FE7  11C3 R					dw	offset loc_207		;  xref A.101B
    2965 0FE9  1364 R					dw	offset loc_238		;  xref A.101B
    2966 0FEB  1353 R					dw	offset loc_237		;  xref A.101B
    2967 0FED  164E R					dw	offset loc_280		;  xref A.101B
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-55


    2968 0FEF  11E9 R					dw	offset loc_210		;  xref A.101B
    2969				
    2970				;INT 10 Interrupt Handler
    2971				;a.0ff1
    2972 0FF1				INT10HANDLER:
    2973				;     	db	0FBh,0FCh, 06h, 1Eh, 52h, 51h
    2974				;     	db	 53h, 56h, 57h, 50h, 8Ah,0C4h
    2975				;     	db	 32h,0E4h,0D1h,0E0h, 8Bh,0F0h
    2976				;     	db	 3Dh, 20h, 00h, 72h, 04h, 58h
    2977				; 	db	0E9h, 2Ah, 01h
    2978 0FF1  FB					sti
    2979 0FF2  FC					cld
    2980 0FF3  06					push	es
    2981 0FF4  1E					push	ds
    2982 0FF5  52					push	dx
    2983 0FF6  51					push	cx
    2984 0FF7  53					push	bx
    2985 0FF8  56					push	si
    2986 0FF9  57					push	di
    2987 0FFA  50					push	ax
    2988 0FFB  8A C4					mov	al,ah
    2989 0FFD  32 E4					xor	ah,ah
    2990 0FFF  D1 E0					shl	ax,1
    2991 1001  8B F0					mov	si,ax
    2992 1003  3D 0020					cmp	ax,20h			; max functions?
    2993 1006  72 04					jb	loc_192			;100C
    2994 1008  58					pop	ax
    2995 1009  E9 1136 R				jmp	loc_200			;1136
    2996 100C				loc_192:
    2997 100C  B8 0040			 		mov	ax,40h
    2998 100F  8E D8			 		mov	ds,ax
    2999 1011  B8 B800			 		mov	ax,0B800h
    3000 1014  8E C0			 		mov	es,ax
    3001 1016  58			 		pop	ax
    3002 1017  8A 26 0049 R		 		mov	ah,ds:video_mode	; (0040:0049=3)
    3003 101B  2E: FF A4 0FD1 R		 		jmp	word ptr cs:INT10FN[si]	;*(A.0FD1=1078h)     16 entries
    3004				
    3005				;a.1020
    3006				; Video Parameter Table
    3007				;00h 16 BYTEs   6845 register values for modes 00h and 01h
    3008				;10h 16 BYTEs   6845 register values for modes 02h and 03h
    3009				;20h 16 BYTEs   6845 register values for modes 04h and 05h
    3010				;30h 16 BYTEs   6845 register values for modes 06h and 07h
    3011				;40h    WORD    bytes in video buffer for modes 00h and 01h (0800h)
    3012				;42h    WORD    bytes in video buffer for modes 02h and 03h (1000h)
    3013				;44h    WORD    bytes in video buffer for modes 04h and 05h (4000h)
    3014				;46h    WORD    bytes in video buffer for mode 06h (4000h)
    3015				;48h  8 BYTEs   columns on screen for each of modes 00h through 07h
    3016				;50h  8 BYTEs   CRT controller mode bytes for each of modes 00h through 07h
    3017 1020				INT_1D:
    3018 1020  38 28 2D 0A 1F 06			db	 38h, 28h, 2Dh, 0Ah, 1Fh, 06h	; Init string for 40 x 25
    3019 1026  19 1C 02 07 06 07			db	 19h, 1Ch, 02h, 07h, 06h, 07h
    3020 102C  00 00 00 00				db	 00h, 00h, 00h, 00h
    3021				
    3022 1030  71 50					db	 71h, 50h      			; Init string for 80 x 25 col
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-56


    3023 1032  5A 0A 1F 06 19 1C			db	 5Ah, 0Ah, 1Fh, 06h, 19h, 1Ch
    3024 1038  02 07 06 07 00 00			db	 02h, 07h, 06h, 07h, 00h, 00h
    3025 103E  00 00					db	 00h, 00h
    3026				
    3027 1040  38 28 2D 0A				db	 38h, 28h, 2Dh, 0Ah		; Init string for GRAPHIX
    3028 1044  7F 06 64 70 02 01			db	 7Fh, 06h, 64h, 70h, 02h, 01h
    3029 104A  06 07 00 00 00 00			db	 06h, 07h, 00h, 00h, 00h, 00h
    3030				
    3031 1050  61 50 52 0F 19 06			db	 61h, 50h, 52h, 0Fh, 19h, 06h	; Init string for 80 x 25 b/w
    3032 1056  19 19 02 0D 0B 0C			db	 19h, 19h, 02h, 0Dh, 0Bh, 0Ch
    3033 105C  00 00 00 00				db	 00h, 00h, 00h, 00h
    3034				
    3035				;a.1060	Regen lengths
    3036 1060  0800			REGENL:		dw	800h			; xref A.1111 40x25
    3037 1062  1000			     		dw	1000h			; 80x25
    3038 1064  4000					dw	4000h			; graphics
    3039 1066  4000					dw	4000h
    3040				;a.1068 Column lengths				; Data table (indexed access) xref A.1103
    3041 1068  28 28 50 50		MAXCOLS:	db	28h, 28h, 50h, 50h
    3042 106C  28 28 50 50				db	28h, 28h, 50h, 50h
    3043				;a;1070 table of mode sets			; Data table (indexed access) xref A.10FA
    3044 1070  2C 28 2D 29		MODES:		db	2Ch, 28h, 2Dh, 29h
    3045 1074  2A 2E 1E 29				db	2Ah, 2Eh, 1Eh, 29h
    3046				
    3047				; Indexed Entry Point 
					
    3048				;a.1078
    3049 1078				loc_193:					;  xref A.0FD1, 101B
    3050 1078  BA 03D4			 		mov	dx,3D4h
    3051 107B  B3 00			 		mov	bl,0
    3052 107D  3C 07			 		cmp	al,7
    3053 107F  72 03			 		jb	loc_194			; Jump if below
    3054 1081  E9 1136 R		 		jmp	loc_200			; (1136)
    3055 1084				loc_194:					;  xref A.107F
    3056 1084  8A E0			 		mov	ah,al
    3057 1086  A2 0049 R		 		mov	ds:video_mode,al	; (0040:0049=3)
    3058 1089  89 16 0063 R		 		mov	ds:video_port,dx	; (0040:0063=3D4h)
    3059 108D  1E			 		push	ds
    3060 108E  50			 		push	ax
    3061 108F  52			 		push	dx
    3062 1090  83 C2 04			 		add	dx,4
    3063 1093  8A C3			 		mov	al,bl
    3064 1095  EE			 		out	dx,al			; port 3D8h, CGA video control
    3065 1096  5A			 		pop	dx
    3066 1097  2B C0			 		sub	ax,ax
    3067 1099  8E D8			 		mov	ds,ax
    3068 109B  C5 1E 0074		 		lds	bx,dword ptr ds:Int1Dv	; (0000:0074=0C958h) Load seg:offset p
    3069 109F  58			 		pop	ax
    3070 10A0  B9 0010			 		mov	cx,10h
    3071 10A3  80 FC 02			 		cmp	ah,2
    3072 10A6  72 10			 		jb	loc_195			; Jump if below
    3073 10A8  03 D9			 		add	bx,cx
    3074 10AA  80 FC 04			 		cmp	ah,4
    3075 10AD  72 09			 		jb	loc_195			; Jump if below
    3076 10AF  03 D9			 		add	bx,cx
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-57


    3077 10B1  80 FC 07			 		cmp	ah,7
    3078 10B4  72 02			 		jb	loc_195			; Jump if below
    3079 10B6  03 D9			 		add	bx,cx
    3080 10B8				loc_195:					;  xref A.10A6, 10AD, 10B4
    3081 10B8  50			 		push	ax
    3082 10B9  32 E4			 		xor	ah,ah			; Zero register
    3083				
    3084				;a.10bb
    3085 10BB				locloop_196:					;  xref A.10C6
    3086 10BB  8A C4			 		mov	al,ah
    3087 10BD  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    3088				 						;  al = 0, horiz char total
    3089 10BE  42			 		inc	dx
    3090 10BF  FE C4			 		inc	ah
    3091 10C1  8A 07			 		mov	al,[bx]
    3092 10C3  EE			 		out	dx,al			; port 3D5h, CGA/EGA indxd data
    3093 10C4  43			 		inc	bx
    3094 10C5  4A			 		dec	dx
    3095 10C6  E2 F3			 		loop	locloop_196		; Loop if cx > 0
    3096				
    3097 10C8  58			 		pop	ax
    3098 10C9  1F			 		pop	ds
    3099 10CA  33 FF			 		xor	di,di			; Zero register
    3100 10CC  89 3E 004E R		 		mov	ds:video_segment,di	; (0040:004E=0)
    3101 10D0  C6 06 0062 R 00		 		mov	byte ptr ds:video_page,0	; (0040:0062=0)
    3102 10D5  B9 2000			 		mov	cx,2000h
    3103 10D8  80 FC 04			 		cmp	ah,4
    3104 10DB  72 04			 		jb	loc_197			; Jump if below
    3105 10DD  33 C0			 		xor	ax,ax			; Zero register
    3106 10DF  EB 03			 		jmp	short loc_198		; (10E4)
    3107 10E1				loc_197:					;  xref A.10DB
    3108 10E1  B8 0720			 		mov	ax,720h
    3109				;a.10e4
    3110 10E4				loc_198:					;  xref A.10DF
    3111 10E4  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
    3112 10E6  C7 06 0060 R 0067	 		mov	word ptr ds:vid_curs_mode,67h	; (0040:0060=2000h)
    3113 10EC  A0 0049 R		 		mov	al,ds:video_mode	; (0040:0049=3)
    3114 10EF  32 E4			 		xor	ah,ah			; Zero register
    3115 10F1  8B F0			 		mov	si,ax
    3116 10F3  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3117 10F7  83 C2 04			 		add	dx,4
    3118 10FA  2E: 8A 84 1070 R		 		mov	al,byte ptr cs:MODES[si]		; (A.1070=2Ch)
    3119 10FF  EE			 		out	dx,al			; port 3D8h, CGA video control
    3120 1100  A2 0065 R		 		mov	ds:video_mode_reg,al	; (0040:0065=29h)
    3121				
    3122 1103  2E: 8A 84 1068 R		 		mov	al,byte ptr cs:MAXCOLS[si]	; (A.1068='((PP((PP')
    3123 1108  32 E4			 		xor	ah,ah			; Zero register
    3124 110A  A3 004A R		 		mov	ds:video_columns,ax	; (0040:004A=50h)
    3125 110D  81 E6 000E		 		and	si,word ptr 0Eh
    3126 1111  2E: 8B 8C 1060 R		 		mov	cx,word ptr cs:REGENL[si]	; (A.1060=800h)
    3127 1116  89 0E 004C R		 		mov	ds:video_buf_siz,cx	; (0040:004C=1000h)
    3128 111A  B9 0008			 		mov	cx,8
    3129 111D  BF 0050 R		 		mov	di,offset vid_curs_pos0	; (0040:0050=4Fh) bf 0050
    3130 1120  1E			 		push	ds
    3131 1121  07			 		pop	es
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-58


    3132 1122  33 C0			 		xor	ax,ax			; Zero register
    3133 1124  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
    3134 1126  42			 		inc	dx
    3135 1127  B0 30			 		mov	al,30h			; '0'
    3136 1129  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	; (0040:0049=3)
    3137 112E  75 02			 		jne	loc_199			; Jump if not equal
    3138 1130  B0 3F			 		mov	al,3Fh			; '?'
    3139 1132				loc_199:					;  xref A.112E
    3140 1132  EE			 		out	dx,al			; port 3D9h, CGA color control
    3141 1133  A2 0066 R		 		mov	ds:video_color,al	; (0040:0066=30h)
    3142				;a.1136
    3143 1136				loc_200:					;  xref A.1081, 1147, 1176, 11C0
    3144				 						;            11DC, 1252, 12F3, 1331
    3145				 						;            1350, 1361, 1380, 141C
    3146				 						;            147C, 14FC, 155C, 15E0
    3147				 						;            16A9
    3148 1136  5F			 		pop	di
    3149 1137  5E			 		pop	si
    3150 1138  5B			 		pop	bx
    3151 1139				loc_201:					;  xref A.11F7
    3152 1139  59			 		pop	cx
    3153 113A  5A			 		pop	dx
    3154 113B  1F			 		pop	ds
    3155 113C  07			 		pop	es
    3156 113D  CF			 		iret				; Interrupt return
    3157				
    3158				; Indexed Entry Point 
					
    3159				
    3160 113E				loc_202:					;  xref A.0FD3, 101B
    3161 113E  B4 0A			 		mov	ah,0Ah
    3162 1140  89 0E 0060 R		 		mov	ds:vid_curs_mode,cx	; (0040:0060=2000h)
    3163 1144  E8 1149 R		 		call	sub_33			; (1149)
    3164 1147  EB ED			 		jmp	short loc_200		; (1136)
    3165				
    3166				;===============================================================================
    3167				 ;                              SUBROUTINE
    3168				 ;
    3169				 ;         Called from:   A.1144, 1185, 11B3
    3170				;===============================================================================
    3171				;a.1149
    3172 1149				sub_33		proc	near
    3173 1149  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3174 114D  8A C4			 		mov	al,ah
    3175 114F  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    3176				 						;  al = 0Ah, cursor start, mode
    3177 1150  42			 		inc	dx
    3178 1151  8A C5			 		mov	al,ch
    3179 1153  EE			 		out	dx,al			; port 3D5h, CGA/EGA indxd data
    3180 1154  4A			 		dec	dx
    3181 1155  8A C4			 		mov	al,ah
    3182 1157  FE C0			 		inc	al
    3183 1159  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    3184				 						;  al = 0Bh, cursor end
    3185 115A  42			 		inc	dx
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-59


    3186 115B  8A C1			 		mov	al,cl
    3187 115D  EE			 		out	dx,al			; port 3D5h, CGA/EGA indxd data
    3188 115E  C3			 		retn
    3189 115F				sub_33		endp
    3190				
    3191				
    3192				; Indexed Entry Point 
					
    3193				;a.115f
    3194 115F				loc_203:					;  xref A.0FD5, 101B
    3195 115F  8A CF			 		mov	cl,bh
    3196 1161  32 ED			 		xor	ch,ch			; Zero register
    3197 1163  D1 E1			 		shl	cx,1			; Shift w/zeros fill
    3198 1165  8B F1			 		mov	si,cx
    3199 1167  89 94 0050 R		 		mov	ds:vid_curs_pos0[si],dx	; (0040:0050=184Fh)
    3200 116B  38 3E 0062 R		 		cmp	ds:video_page,bh	; (0040:0062=0)
    3201 116F  75 05			 		jne	loc_204			; Jump if not equal
    3202 1171  8B C2			 		mov	ax,dx
    3203 1173  E8 1178 R		 		call	sub_34			; (1178)
    3204 1176				loc_204:					;  xref A.116F
    3205 1176  EB BE			 		jmp	short loc_200		; (1136)
    3206				
    3207				;===============================================================================
    3208				 ;                              SUBROUTINE
    3209				 ;
    3210				 ;         Called from:   A.1173, 11BD
    3211				;===============================================================================
    3212				;a.1178
    3213 1178				sub_34		proc	near
    3214 1178  E8 11FA R		 		call	sub_35			; (11FA)
    3215 117B  8B C8			 		mov	cx,ax
    3216 117D  03 0E 004E R		 		add	cx,ds:video_segment	; (0040:004E=0)
    3217 1181  D1 F9			 		sar	cx,1			; Shift w/sign fill
    3218 1183  B4 0E			 		mov	ah,0Eh
    3219 1185  E8 1149 R		 		call	sub_33			; (1149)
    3220 1188  C3			 		retn
    3221 1189				sub_34		endp
    3222				
    3223				
    3224				; Indexed Entry Point 
					
    3225				;a.1189
    3226 1189				loc_205:					;  xref A.0FD7, 101B
    3227 1189  8A DF			 		mov	bl,bh
    3228 118B  32 FF			 		xor	bh,bh			; Zero register
    3229 118D  D1 E3			 		shl	bx,1			; Shift w/zeros fill
    3230 118F  8B 97 0050 R		 		mov	dx,ds:vid_curs_pos0[bx]	; (0040:0050=184Fh)
    3231 1193  8B 0E 0060 R		 		mov	cx,ds:vid_curs_mode	; (0040:0060=2000h)
    3232 1197  5F			 		pop	di
    3233 1198  5E			 		pop	si
    3234 1199  5B			 		pop	bx
    3235 119A  58			 		pop	ax
    3236 119B  58			 		pop	ax
    3237 119C  1F			 		pop	ds
    3238 119D  07			 		pop	es
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-60


    3239 119E  CF			 		iret				; Interrupt return
    3240				
    3241				; Indexed Entry Point 
					
    3242				;a.119f
    3243 119F				loc_206:					;  xref A.0FDB, 101B
    3244 119F  A2 0062 R		 		mov	ds:video_page,al	; (0040:0062=0)
    3245 11A2  8B 0E 004C R		 		mov	cx,ds:video_buf_siz	; (0040:004C=1000h)
    3246 11A6  98			 		cbw				; Convrt byte to word
    3247 11A7  50			 		push	ax
    3248 11A8  F7 E1			 		mul	cx			; dx:ax = reg * ax
    3249 11AA  A3 004E R		 		mov	ds:video_segment,ax	; (0040:004E=0)
    3250 11AD  8B C8			 		mov	cx,ax
    3251 11AF  D1 F9			 		sar	cx,1			; Shift w/sign fill
    3252 11B1  B4 0C			 		mov	ah,0Ch
    3253 11B3  E8 1149 R		 		call	sub_33			; (1149)
    3254 11B6  5B			 		pop	bx
    3255 11B7  D1 E3			 		shl	bx,1			; Shift w/zeros fill
    3256 11B9  8B 87 0050 R		 		mov	ax,ds:vid_curs_pos0[bx]	; (0040:0050=184Fh)
    3257 11BD  E8 1178 R		 		call	sub_34			; (1178)
    3258 11C0  E9 1136 R		 		jmp	loc_200			; (1136)
    3259				
    3260				; Indexed Entry Point 
					
    3261				;a.11c3
    3262 11C3				loc_207:					;  xref A.0FE7, 101B
    3263 11C3  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3264 11C7  83 C2 05			 		add	dx,5
    3265 11CA  A0 0066 R		 		mov	al,ds:video_color	; (0040:0066=30h)
    3266 11CD  0A FF			 		or	bh,bh			; Zero ?
    3267 11CF  75 0E			 		jnz	loc_209			; Jump if not zero
    3268 11D1  24 E0			 		and	al,0E0h
    3269 11D3  80 E3 1F			 		and	bl,1Fh
    3270 11D6  0A C3			 		or	al,bl
    3271 11D8				loc_208:					;  xref A.11E3, 11E7
    3272 11D8  EE			 		out	dx,al			; port 3D9h, CGA color control
    3273 11D9  A2 0066 R		 		mov	ds:video_color,al	; (0040:0066=30h)
    3274 11DC  E9 1136 R		 		jmp	loc_200			; (1136)
    3275 11DF				loc_209:					;  xref A.11CF
    3276 11DF  24 DF			 		and	al,0DFh
    3277 11E1  D0 EB			 		shr	bl,1			; Shift w/zeros fill
    3278 11E3  73 F3			 		jnc	loc_208			; Jump if carry=0
    3279 11E5  0C 20			 		or	al,20h			; ' '
    3280 11E7  EB EF			 		jmp	short loc_208		; (11D8)
    3281				
    3282				; Indexed Entry Point 
					
    3283				;a.11e9
    3284 11E9				loc_210:					;  xref A.0FEF, 101B
    3285 11E9  8A 26 004A R		 		mov	ah,byte ptr ds:video_columns	; (0040:004A=50h)
    3286 11ED  A0 0049 R		 		mov	al,ds:video_mode	; (0040:0049=3)
    3287 11F0  8A 3E 0062 R		 		mov	bh,ds:video_page	; (0040:0062=0)
    3288 11F4  5F			 		pop	di
    3289 11F5  5E			 		pop	si
    3290 11F6  59			 		pop	cx
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-61


    3291 11F7  E9 1139 R		 		jmp	loc_201			; (1139)
    3292				
    3293				;===============================================================================
    3294				 ;                              SUBROUTINE
    3295				 ;
    3296				 ;         Called from:   A.1178, 1259, 130C
    3297				;===============================================================================
    3298				;a.11fa
    3299 11FA				sub_35		proc	near
    3300 11FA  53			 		push	bx
    3301 11FB  8B D8			 		mov	bx,ax
    3302 11FD  8A C4			 		mov	al,ah
    3303 11FF  F6 26 004A R		 		mul	byte ptr ds:video_columns	; (0040:004A=50h) ax = data * al
    3304 1203  32 FF			 		xor	bh,bh			; Zero register
    3305 1205  03 C3			 		add	ax,bx
    3306 1207  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    3307 1209  5B			 		pop	bx
    3308 120A  C3			 		retn
    3309 120B				sub_35		endp
    3310				
    3311				
    3312				; Indexed Entry Point 
					
    3313				;a.120b
    3314 120B				loc_211:					;  xref A.0FDD, 101B
    3315 120B  8A D8			 		mov	bl,al
    3316 120D  80 FC 04			 		cmp	ah,4
    3317 1210  72 08			 		jb	loc_212			; Jump if below
    3318 1212  80 FC 07			 		cmp	ah,7
    3319 1215  74 03			 		je	loc_212			; Jump if equal
    3320 1217  E9 13CA R		 		jmp	loc_244			; (13CA)
    3321 121A				loc_212:					;  xref A.1210, 1215
    3322 121A  53			 		push	bx
    3323 121B  8B C1			 		mov	ax,cx
    3324 121D  E8 1259 R		 		call	sub_36			; (1259)
    3325 1220  74 33			 		jz	loc_218			; Jump if zero
    3326 1222  03 F0			 		add	si,ax
    3327 1224  8A E6			 		mov	ah,dh
    3328 1226  2A E3			 		sub	ah,bl
    3329 1228				loc_213:					;  xref A.1231
    3330 1228  E8 1280 R		 		call	sub_37			; (1280)
    3331 122B  03 F5			 		add	si,bp
    3332 122D  03 FD			 		add	di,bp
    3333 122F  FE CC			 		dec	ah
    3334 1231  75 F5			 		jnz	loc_213			; Jump if not zero
    3335 1233				loc_214:					;  xref A.1257
    3336 1233  58			 		pop	ax
    3337 1234  B0 20			 		mov	al,20h			; ' '
    3338 1236				loc_215:					;  xref A.123D
    3339 1236  E8 1289 R		 		call	sub_38			; (1289)
    3340 1239  03 FD			 		add	di,bp
    3341 123B  FE CB			 		dec	bl
    3342 123D  75 F7			 		jnz	loc_215			; Jump if not zero
    3343 123F				loc_216:					;  xref A.12C5
    3344 123F  B8 0040			 		mov	ax,40h
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-62


    3345 1242  8E D8			 		mov	ds,ax
    3346 1244  80 3E 0049 R 07		 		cmp	byte ptr ds:video_mode,7	; (0040:0049=3)
    3347 1249  74 07			 		je	loc_217			; Jump if equal
    3348 124B  A0 0065 R		 		mov	al,ds:video_mode_reg	; (0040:0065=29h)
    3349 124E  BA 03D8			 		mov	dx,3D8h
    3350 1251  EE			 		out	dx,al			; port 3D8h, CGA video control
    3351 1252				loc_217:					;  xref A.1249
    3352 1252  E9 1136 R		 		jmp	loc_200			; (1136)
    3353 1255				loc_218:					;  xref A.1220
    3354 1255  8A DE			 		mov	bl,dh
    3355 1257  EB DA			 		jmp	short loc_214		; (1233)
    3356				
    3357				;===============================================================================
    3358				 ;                              SUBROUTINE
    3359				 ;
    3360				 ;         Called from:   A.121D, 12A3
    3361				;===============================================================================
    3362				;a.1259
    3363 1259				sub_36		proc	near
    3364 1259  E8 11FA R		 		call	sub_35			; (11FA)
    3365 125C  03 06 004E R		 		add	ax,ds:video_segment	; (0040:004E=0)
    3366 1260  8B F8			 		mov	di,ax
    3367 1262  8B F0			 		mov	si,ax
    3368 1264  2B D1			 		sub	dx,cx
    3369 1266  FE C6			 		inc	dh
    3370 1268  FE C2			 		inc	dl
    3371 126A  32 ED			 		xor	ch,ch			; Zero register
    3372 126C  8B 2E 004A R		 		mov	bp,ds:video_columns	; (0040:004A=50h)
    3373 1270  03 ED			 		add	bp,bp
    3374 1272  8A C3			 		mov	al,bl
    3375 1274  F6 26 004A R		 		mul	byte ptr ds:video_columns	; (0040:004A=50h) ax = data * al
    3376 1278  03 C0			 		add	ax,ax
    3377 127A  06			 		push	es
    3378 127B  1F			 		pop	ds
    3379 127C  80 FB 00			 		cmp	bl,0
    3380 127F  C3			 		retn
    3381 1280				sub_36		endp
    3382				
    3383				
    3384				;===============================================================================
    3385				 ;                              SUBROUTINE
    3386				 ;
    3387				 ;         Called from:   A.1228, 12AE
    3388				;===============================================================================
    3389				;a.1280
    3390 1280				sub_37		proc	near
    3391 1280  8A CA			 		mov	cl,dl
    3392 1282  56			 		push	si
    3393 1283  57			 		push	di
    3394 1284  F3/ A5			 		rep	movsw			; Rep when cx >0 Mov [si] to es:[di]
    3395 1286  5F			 		pop	di
    3396 1287  5E			 		pop	si
    3397 1288  C3			 		retn
    3398 1289				sub_37		endp
    3399				
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-63


    3400				
    3401				;===============================================================================
    3402				 ;                              SUBROUTINE
    3403				 ;
    3404				 ;         Called from:   A.1236, 12BC
    3405				;===============================================================================
    3406				;a.1289
    3407 1289				sub_38		proc	near
    3408 1289  8A CA			 		mov	cl,dl
    3409 128B  57			 		push	di
    3410 128C  F3/ AB			 		rep	stosw			; Rep when cx >0 Store ax to es:[di]
    3411 128E  5F			 		pop	di
    3412 128F  C3			 		retn
    3413 1290				sub_38		endp
    3414				
    3415				
    3416				; Indexed Entry Point 
					
    3417				;a.1290
    3418 1290				loc_219:					;  xref A.0FDF, 101B
    3419 1290  FD			 		std				; Set direction flag
    3420 1291  8A D8			 		mov	bl,al
    3421 1293  80 FC 04			 		cmp	ah,4
    3422 1296  72 08			 		jb	loc_220			; Jump if below
    3423 1298  80 FC 07			 		cmp	ah,7
    3424 129B  74 03			 		je	loc_220			; Jump if equal
    3425 129D  E9 1423 R		 		jmp	loc_250			; (1423)
    3426 12A0				loc_220:					;  xref A.1296, 129B
    3427 12A0  53			 		push	bx
    3428 12A1  8B C2			 		mov	ax,dx
    3429 12A3  E8 1259 R		 		call	sub_36			; (1259)
    3430 12A6  74 20			 		jz	loc_224			; Jump if zero
    3431 12A8  2B F0			 		sub	si,ax
    3432 12AA  8A E6			 		mov	ah,dh
    3433 12AC  2A E3			 		sub	ah,bl
    3434 12AE				loc_221:					;  xref A.12B7
    3435 12AE  E8 1280 R		 		call	sub_37			; (1280)
    3436 12B1  2B F5			 		sub	si,bp
    3437 12B3  2B FD			 		sub	di,bp
    3438 12B5  FE CC			 		dec	ah
    3439 12B7  75 F5			 		jnz	loc_221			; Jump if not zero
    3440 12B9				loc_222:					;  xref A.12CA
    3441 12B9  58			 		pop	ax
    3442 12BA  B0 20			 		mov	al,20h			; ' '
    3443 12BC				loc_223:					;  xref A.12C3
    3444 12BC  E8 1289 R		 		call	sub_38			; (1289)
    3445 12BF  2B FD			 		sub	di,bp
    3446 12C1  FE CB			 		dec	bl
    3447 12C3  75 F7			 		jnz	loc_223			; Jump if not zero
    3448 12C5  E9 123F R		 		jmp	loc_216			; (123F)
    3449 12C8				loc_224:					;  xref A.12A6
    3450 12C8  8A DE			 		mov	bl,dh
    3451 12CA  EB ED			 		jmp	short loc_222		; (12B9)
    3452				
    3453				; Indexed Entry Point 
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-64


					
    3454				;a.12cc
    3455 12CC				loc_225:					;  xref A.0FE1, 101B
    3456 12CC  80 FC 04			 		cmp	ah,4
    3457 12CF  72 08			 		jb	loc_226			; Jump if below
    3458 12D1  80 FC 07			 		cmp	ah,7
    3459 12D4  74 03			 		je	loc_226			; Jump if equal
    3460 12D6  E9 155F R		 		jmp	loc_268			; (155F)
    3461 12D9				loc_226:					;  xref A.12CF, 12D4
    3462 12D9  E8 12F6 R		 		call	sub_39			; (12F6)
    3463 12DC  8B F3			 		mov	si,bx
    3464 12DE  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    3465 12E2  83 C2 06			 		add	dx,6
    3466 12E5  06			 		push	es
    3467 12E6  1F			 		pop	ds
    3468 12E7				loc_227:					;  xref A.12EA
    3469 12E7  EC			 		in	al,dx			; port 3DAh, CGA/EGA vid status
    3470 12E8  A8 01			 		test	al,1
    3471 12EA  75 FB			 		jnz	loc_227			; Jump if not zero
    3472 12EC  FA			 		cli				; Disable interrupts
    3473 12ED				loc_228:					;  xref A.12F0
    3474 12ED  EC			 		in	al,dx			; port 3DAh, CGA/EGA vid status
    3475 12EE  A8 01			 		test	al,1
    3476 12F0  74 FB			 		jz	loc_228			; Jump if zero
    3477 12F2  AD			 		lodsw				; String [si] to ax
    3478 12F3  E9 1136 R		 		jmp	loc_200			; (1136)
    3479				
    3480				;===============================================================================
    3481				 ;                              SUBROUTINE
    3482				 ;
    3483				 ;         Called from:   A.12D9, 1323, 1343
    3484				;===============================================================================
    3485				;a.12f6
    3486 12F6				sub_39		proc	near
    3487 12F6  8A CF			 		mov	cl,bh
    3488 12F8  32 ED			 		xor	ch,ch			; Zero register
    3489 12FA  8B F1			 		mov	si,cx
    3490 12FC  D1 E6			 		shl	si,1			; Shift w/zeros fill
    3491 12FE  8B 84 0050 R		 		mov	ax,ds:vid_curs_pos0[si]	; (0040:0050=184Fh)
    3492 1302  33 DB			 		xor	bx,bx			; Zero register
    3493 1304  E3 06			 		jcxz	loc_230			; Jump if cx=0
    3494				
    3495 1306				locloop_229:					;  xref A.130A
    3496 1306  03 1E 004C R		 		add	bx,ds:video_buf_siz	; (0040:004C=1000h)
    3497 130A  E2 FA			 		loop	locloop_229		; Loop if cx > 0
    3498				
    3499 130C				loc_230:					;  xref A.1304
    3500 130C  E8 11FA R		 		call	sub_35			; (11FA)
    3501 130F  03 D8			 		add	bx,ax
    3502 1311  C3			 		retn
    3503 1312				sub_39		endp
    3504				
    3505				
    3506				; Indexed Entry Point 
					
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-65


    3507				;a.1312
    3508 1312				loc_231:					;  xref A.0FE3, 101B
    3509 1312  80 FC 04			 		cmp	ah,4
    3510 1315  72 08			 		jb	loc_232			; Jump if below
    3511 1317  80 FC 07			 		cmp	ah,7
    3512 131A  74 03			 		je	loc_232			; Jump if equal
    3513 131C  E9 14AD R		 		jmp	loc_256			; (14AD)
    3514 131F				loc_232:					;  xref A.1315, 131A
    3515 131F  8A E3			 		mov	ah,bl
    3516 1321  50			 		push	ax
    3517 1322  51			 		push	cx
    3518 1323  E8 12F6 R		 		call	sub_39			; (12F6)
    3519 1326  8B FB			 		mov	di,bx
    3520 1328  59			 		pop	cx
    3521 1329  5B			 		pop	bx
    3522				
    3523 132A				locloop_233:					;  xref A.132F
    3524 132A  FA			 		cli				; Disable interrupts
    3525 132B  8B C3			 		mov	ax,bx
    3526 132D  AB			 		stosw				; Store ax to es:[di]
    3527 132E  FB			 		sti				; Enable interrupts
    3528 132F  E2 F9			 		loop	locloop_233		; Loop if cx > 0
    3529				
    3530 1331  E9 1136 R		 		jmp	loc_200			; (1136)
    3531				
    3532				; Indexed Entry Point 
					
    3533				;a.1334
    3534 1334				loc_234:					;  xref A.0FE5, 101B
    3535 1334  80 FC 04			 		cmp	ah,4
    3536 1337  72 08			 		jb	loc_235			; Jump if below
    3537 1339  80 FC 07			 		cmp	ah,7
    3538 133C  74 03			 		je	loc_235			; Jump if equal
    3539 133E  E9 14AD R		 		jmp	loc_256			; (14AD)
    3540 1341				loc_235:					;  xref A.1337, 133C
    3541 1341  50			 		push	ax
    3542 1342  51			 		push	cx
    3543 1343  E8 12F6 R		 		call	sub_39			; (12F6)
    3544 1346  8B FB			 		mov	di,bx
    3545 1348  59			 		pop	cx
    3546 1349  5B			 		pop	bx
    3547				
    3548 134A				locloop_236:					;  xref A.134E
    3549 134A  8A C3			 		mov	al,bl
    3550 134C  AA			 		stosb				; Store al to es:[di]
    3551 134D  47			 		inc	di
    3552 134E  E2 FA			 		loop	locloop_236		; Loop if cx > 0
    3553				
    3554 1350  E9 1136 R		 		jmp	loc_200			; (1136)
    3555				
    3556				; Indexed Entry Point 
					
    3557				;a.1353
    3558 1353				loc_237:					;  xref A.0FEB, 101B
    3559 1353  E8 1387 R		 		call	sub_40			; (1387)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-66


    3560 1356  26: 8A 04		 		mov	al,es:[si]
    3561 1359  22 C4			 		and	al,ah
    3562 135B  D2 E0			 		shl	al,cl			; Shift w/zeros fill
    3563 135D  8A CE			 		mov	cl,dh
    3564 135F  D2 C0			 		rol	al,cl			; Rotate
    3565 1361  E9 1136 R		 		jmp	loc_200			; (1136)
    3566				
    3567				; Indexed Entry Point 
					
    3568				;a.1364
    3569 1364				loc_238:					;  xref A.0FE9, 101B
    3570 1364  50			 		push	ax
    3571 1365  50			 		push	ax
    3572 1366  E8 1387 R		 		call	sub_40			; (1387)
    3573 1369  D2 E8			 		shr	al,cl			; Shift w/zeros fill
    3574 136B  22 C4			 		and	al,ah
    3575 136D  26: 8A 0C		 		mov	cl,es:[si]
    3576 1370  5B			 		pop	bx
    3577 1371  F6 C3 80			 		test	bl,80h
    3578 1374  75 0D			 		jnz	loc_240			; Jump if not zero
    3579 1376  F6 D4			 		not	ah
    3580 1378  22 CC			 		and	cl,ah
    3581 137A  0A C1			 		or	al,cl
    3582 137C				loc_239:					;  xref A.1385
    3583 137C  26: 88 04		 		mov	es:[si],al
    3584 137F  58			 		pop	ax
    3585 1380  E9 1136 R		 		jmp	loc_200			; (1136)
    3586 1383				loc_240:					;  xref A.1374
    3587 1383  32 C1			 		xor	al,cl
    3588 1385  EB F5			 		jmp	short loc_239		; (137C)
    3589				
    3590				;===============================================================================
    3591				 ;                              SUBROUTINE
    3592				 ;
    3593				 ;         Called from:   A.1353, 1366
    3594				;===============================================================================
    3595				;a.1387
    3596 1387				sub_40		proc	near
    3597 1387  53			 		push	bx
    3598 1388  50			 		push	ax
    3599 1389  B0 28			 		mov	al,28h			; '('
    3600 138B  52			 		push	dx
    3601 138C  80 E2 FE			 		and	dl,0FEh
    3602 138F  F6 E2			 		mul	dl			; ax = reg * al
    3603 1391  5A			 		pop	dx
    3604 1392  F6 C2 01			 		test	dl,1
    3605 1395  74 03			 		jz	loc_241			; Jump if zero
    3606 1397  05 2000			 		add	ax,2000h
    3607 139A				loc_241:					;  xref A.1395
    3608 139A  8B F0			 		mov	si,ax
    3609 139C  58			 		pop	ax
    3610 139D  8B D1			 		mov	dx,cx
    3611 139F  BB 02C0			 		mov	bx,2C0h
    3612 13A2  B9 0302			 		mov	cx,302h
    3613 13A5  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	; (0040:0049=3)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-67


    3614 13AA  72 06			 		jb	loc_242			; Jump if below
    3615 13AC  BB 0180			 		mov	bx,180h
    3616 13AF  B9 0703			 		mov	cx,703h
    3617 13B2				loc_242:					;  xref A.13AA
    3618 13B2  22 EA			 		and	ch,dl
    3619 13B4  D3 EA			 		shr	dx,cl			; Shift w/zeros fill
    3620 13B6  03 F2			 		add	si,dx
    3621 13B8  8A F7			 		mov	dh,bh
    3622 13BA  2A C9			 		sub	cl,cl
    3623 13BC				loc_243:					;  xref A.13C2
    3624 13BC  D0 C8			 		ror	al,1			; Rotate
    3625 13BE  02 CD			 		add	cl,ch
    3626 13C0  FE CF			 		dec	bh
    3627 13C2  75 F8			 		jnz	loc_243			; Jump if not zero
    3628 13C4  8A E3			 		mov	ah,bl
    3629 13C6  D2 EC			 		shr	ah,cl			; Shift w/zeros fill
    3630 13C8  5B			 		pop	bx
    3631 13C9  C3			 		retn
    3632 13CA				sub_40		endp
    3633				
    3634				;a.13ca
    3635 13CA				loc_244:					;  xref A.1217
    3636 13CA  8A D8			 		mov	bl,al
    3637 13CC  8B C1			 		mov	ax,cx
    3638 13CE  E8 163B R		 		call	sub_47			; (163B)
    3639 13D1  8B F8			 		mov	di,ax
    3640 13D3  2B D1			 		sub	dx,cx
    3641 13D5  81 C2 0101		 		add	dx,101h
    3642 13D9  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3643 13DB  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3644 13DD  80 3E 0049 06		 		cmp	byte ptr ds:[49h],6	; (A.0049=66h)
    3645 13E2  73 04			 		jae	loc_245			; Jump if above or =
    3646 13E4  D0 E2			 		shl	dl,1			; Shift w/zeros fill
    3647 13E6  D1 E7			 		shl	di,1			; Shift w/zeros fill
    3648 13E8				loc_245:					;  xref A.13E2
    3649 13E8  06			 		push	es
    3650 13E9  1F			 		pop	ds
    3651 13EA  2A ED			 		sub	ch,ch
    3652 13EC  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    3653 13EE  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    3654 13F0  74 2D			 		jz	loc_249			; Jump if zero
    3655 13F2  8A C3			 		mov	al,bl
    3656 13F4  B4 50			 		mov	ah,50h			; 'P'
    3657 13F6  F6 E4			 		mul	ah			; ax = reg * al
    3658 13F8  8B F7			 		mov	si,di
    3659 13FA  03 F0			 		add	si,ax
    3660 13FC  8A E6			 		mov	ah,dh
    3661 13FE  2A E3			 		sub	ah,bl
    3662 1400				loc_246:					;  xref A.140D
    3663 1400  E8 1483 R		 		call	sub_41			; (1483)
    3664 1403  81 EE 1FB0		 		sub	si,1FB0h
    3665 1407  81 EF 1FB0		 		sub	di,1FB0h
    3666 140B  FE CC			 		dec	ah
    3667 140D  75 F1			 		jnz	loc_246			; Jump if not zero
    3668 140F				loc_247:					;  xref A.1421
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-68


    3669 140F  8A C7			 		mov	al,bh
    3670 1411				loc_248:					;  xref A.141A
    3671 1411  E8 149C R		 		call	sub_42			; (149C)
    3672 1414  81 EF 1FB0		 		sub	di,1FB0h
    3673 1418  FE CB			 		dec	bl
    3674 141A  75 F5			 		jnz	loc_248			; Jump if not zero
    3675 141C  E9 1136 R		 		jmp	loc_200			; (1136)
    3676 141F				loc_249:					;  xref A.13F0
    3677 141F  8A DE			 		mov	bl,dh
    3678 1421  EB EC			 		jmp	short loc_247		; (140F)
    3679				;a.1423
    3680 1423				loc_250:					;  xref A.129D
    3681 1423  FD			 		std				; Set direction flag
    3682 1424  8A D8			 		mov	bl,al
    3683 1426  8B C2			 		mov	ax,dx
    3684 1428  E8 163B R		 		call	sub_47			; (163B)
    3685 142B  8B F8			 		mov	di,ax
    3686 142D  2B D1			 		sub	dx,cx
    3687 142F  81 C2 0101		 		add	dx,101h
    3688 1433  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3689 1435  D0 E6			 		shl	dh,1			; Shift w/zeros fill
    3690 1437  80 3E 0049 06		 		cmp	byte ptr ds:[49h],6	; (A.0049=66h)
    3691 143C  73 05			 		jae	loc_251			; Jump if above or =
    3692 143E  D0 E2			 		shl	dl,1			; Shift w/zeros fill
    3693 1440  D1 E7			 		shl	di,1			; Shift w/zeros fill
    3694 1442  47			 		inc	di
    3695				;a.1443
    3696 1443				loc_251:					;  xref A.143C
    3697 1443  06			 		push	es
    3698 1444  1F			 		pop	ds
    3699 1445  2A ED			 		sub	ch,ch
    3700 1447  81 C7 00F0 R		 		add	di,offset data_79+1	; (A.00F0=46h)
    3701 144B  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    3702 144D  D0 E3			 		shl	bl,1			; Shift w/zeros fill
    3703 144F  74 2E			 		jz	loc_255			; Jump if zero
    3704 1451  8A C3			 		mov	al,bl
    3705 1453  B4 50			 		mov	ah,50h			; 'P'
    3706 1455  F6 E4			 		mul	ah			; ax = reg * al
    3707 1457  8B F7			 		mov	si,di
    3708 1459  2B F0			 		sub	si,ax
    3709 145B  8A E6			 		mov	ah,dh
    3710 145D  2A E3			 		sub	ah,bl
    3711 145F				loc_252:					;  xref A.146C
    3712 145F  E8 1483 R		 		call	sub_41			; (1483)
    3713 1462  81 EE 2050		 		sub	si,2050h
    3714 1466  81 EF 2050		 		sub	di,2050h
    3715 146A  FE CC			 		dec	ah
    3716 146C  75 F1			 		jnz	loc_252			; Jump if not zero
    3717 146E				loc_253:					;  xref A.1481
    3718 146E  8A C7			 		mov	al,bh
    3719 1470				loc_254:					;  xref A.1479
    3720 1470  E8 149C R		 		call	sub_42			; (149C)
    3721 1473  81 EF 2050		 		sub	di,2050h
    3722 1477  FE CB			 		dec	bl
    3723 1479  75 F5			 		jnz	loc_254			; Jump if not zero
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-69


    3724 147B  FC			 		cld				; Clear direction
    3725 147C  E9 1136 R		 		jmp	loc_200			; (1136)
    3726 147F				loc_255:					;  xref A.144F
    3727 147F  8A DE			 		mov	bl,dh
    3728 1481  EB EB			 		jmp	short loc_253		; (146E)
    3729				
    3730				;===============================================================================
    3731				 ;                              SUBROUTINE
    3732				 ;
    3733				 ;         Called from:   A.1400, 145F
    3734				;===============================================================================
    3735				;a.1483
    3736 1483				sub_41		proc	near
    3737 1483  8A CA			 		mov	cl,dl
    3738 1485  56			 		push	si
    3739 1486  57			 		push	di
    3740 1487  F3/ A4			 		rep	movsb			; Rep when cx >0 Mov [si] to es:[di]
    3741 1489  5F			 		pop	di
    3742 148A  5E			 		pop	si
    3743 148B  81 C6 2000		 		add	si,data_121e		; (A.2000=0)
    3744 148F  81 C7 2000		 		add	di,data_121e		; (A.2000=0)
    3745 1493  56			 		push	si
    3746 1494  57			 		push	di
    3747 1495  8A CA			 		mov	cl,dl
    3748 1497  F3/ A4			 		rep	movsb			; Rep when cx >0 Mov [si] to es:[di]
    3749 1499  5F			 		pop	di
    3750 149A  5E			 		pop	si
    3751 149B  C3			 		retn
    3752 149C				sub_41		endp
    3753				
    3754				
    3755				;===============================================================================
    3756				 ;                              SUBROUTINE
    3757				 ;
    3758				 ;         Called from:   A.1411, 1470
    3759				;===============================================================================
    3760				;a.149c
    3761 149C				sub_42		proc	near
    3762 149C  8A CA			 		mov	cl,dl
    3763 149E  57			 		push	di
    3764 149F  F3/ AA			 		rep	stosb			; Rep when cx >0 Store al to es:[di]
    3765 14A1  5F			 		pop	di
    3766 14A2  81 C7 2000		 		add	di,data_121e		; (A.2000=0)
    3767 14A6  57			 		push	di
    3768 14A7  8A CA			 		mov	cl,dl
    3769 14A9  F3/ AA			 		rep	stosb			; Rep when cx >0 Store al to es:[di]
    3770 14AB  5F			 		pop	di
    3771 14AC  C3			 		retn
    3772 14AD				sub_42		endp
    3773				
    3774				;a.14ad
    3775 14AD				loc_256:					;  xref A.131C, 133E
    3776 14AD  B4 00			 		mov	ah,0
    3777 14AF  50			 		push	ax
    3778 14B0  E8 1638 R		 		call	sub_46			; (1638)
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-70


    3779 14B3  8B F8			 		mov	di,ax
    3780 14B5  58			 		pop	ax
    3781 14B6  3C 80			 		cmp	al,80h
    3782 14B8  73 06			 		jae	loc_257			; Jump if above or =
    3783 14BA  BE 176D R		 		mov	si,offset data_124	; (C000:176D=0)
    3784 14BD  0E			 		push	cs
    3785 14BE  EB 0F			 		jmp	short loc_258		; (14CF)
    3786 14C0				loc_257:					;  xref A.14B8
    3787 14C0  2C 80			 		sub	al,80h
    3788 14C2  1E			 		push	ds
    3789 14C3  2B F6			 		sub	si,si
    3790 14C5  8E DE			 		mov	ds,si
    3791 14C7  C5 36 007C		 		lds	si,dword ptr ds:Int1Fv	; (0000:007C=5E9h) Load seg:offset ptr
    3792 14CB  8C DA			 		mov	dx,ds
    3793 14CD  1F			 		pop	ds
    3794 14CE  52			 		push	dx
    3795 14CF				loc_258:					;  xref A.14BE
    3796 14CF  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    3797 14D1  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    3798 14D3  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    3799 14D5  03 F0			 		add	si,ax
    3800 14D7  80 3E 0049 06		 		cmp	byte ptr ds:[49h],6	; (A.0049=66h)
    3801 14DC  1F			 		pop	ds
    3802 14DD  72 2C			 		jc	loc_263			; Jump if carry Set
    3803				
    3804				;a.14df
    3805 14DF				locloop_259:					;  xref A.14FA
    3806 14DF  57			 		push	di
    3807 14E0  56			 		push	si
    3808 14E1  B6 04			 		mov	dh,4
    3809 14E3				loc_260:					;  xref A.14F5
    3810 14E3  AC			 		lodsb				; String [si] to al
    3811 14E4  F6 C3 80			 		test	bl,80h
    3812 14E7  75 16			 		jnz	loc_262			; Jump if not zero
    3813 14E9  AA			 		stosb				; Store al to es:[di]
    3814 14EA  AC			 		lodsb				; String [si] to al
    3815 14EB				loc_261:					;  xref A.1509
    3816 14EB  26: 88 85 1FFF R		 		mov	byte ptr es:data_120[di],al	; (A.1FFF=0E6h)
    3817 14F0  83 C7 4F			 		add	di,4Fh
    3818 14F3  FE CE			 		dec	dh
    3819 14F5  75 EC			 		jnz	loc_260			; Jump if not zero
    3820 14F7  5E			 		pop	si
    3821 14F8  5F			 		pop	di
    3822 14F9  47			 		inc	di
    3823 14FA  E2 E3			 		loop	locloop_259		; Loop if cx > 0
    3824				
    3825 14FC  E9 1136 R		 		jmp	loc_200			; (1136)
    3826 14FF				loc_262:					;  xref A.14E7
    3827 14FF  26: 32 05		 		xor	al,es:[di]
    3828 1502  AA			 		stosb				; Store al to es:[di]
    3829 1503  AC			 		lodsb				; String [si] to al
    3830 1504  26: 32 85 1FFF R		 		xor	al,byte ptr es:data_120[di]	; (A.1FFF=0E6h)
    3831 1509  EB E0			 		jmp	short loc_261		; (14EB)
    3832 150B				loc_263:					;  xref A.14DD
    3833 150B  8A D3			 		mov	dl,bl
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-71


    3834 150D  D1 E7			 		shl	di,1			; Shift w/zeros fill
    3835 150F  E8 15E3 R		 		call	sub_43			; (15E3)
    3836				
    3837				;a.1512
    3838 1512				locloop_264:					;  xref A.155A
    3839 1512  57			 		push	di
    3840 1513  56			 		push	si
    3841 1514  B6 04			 		mov	dh,4
    3842 1516				loc_265:					;  xref A.1553
    3843 1516  AC			 		lodsb				; String [si] to al
    3844 1517  E8 15F8 R		 		call	sub_44			; (15F8)
    3845 151A  23 C3			 		and	ax,bx
    3846 151C  F6 C2 80			 		test	dl,80h
    3847 151F  74 07			 		jz	loc_266			; Jump if zero
    3848 1521  26: 32 25		 		xor	ah,es:[di]
    3849 1524  26: 32 45 01		 		xor	al,es:[di+1]
    3850 1528				loc_266:					;  xref A.151F
    3851 1528  26: 88 25		 		mov	es:[di],ah
    3852 152B  26: 88 45 01		 		mov	es:[di+1],al
    3853 152F  AC			 		lodsb				; String [si] to al
    3854 1530  E8 15F8 R		 		call	sub_44			; (15F8)
    3855 1533  23 C3			 		and	ax,bx
    3856 1535  F6 C2 80			 		test	dl,80h
    3857 1538  74 0A			 		jz	loc_267			; Jump if zero
    3858 153A  26: 32 A5 2000		 		xor	ah,es:data_121e[di]	; (A.2000=0)
    3859 153F  26: 32 85 2001		 		xor	al,es:data_122e[di]	; (A.2001=0)
    3860 1544				loc_267:					;  xref A.1538
    3861 1544  26: 88 A5 2000		 		mov	es:data_121e[di],ah	; (A.2000=0)
    3862 1549  26: 88 85 2001		 		mov	es:data_122e[di],al	; (A.2001=0)
    3863 154E  83 C7 50			 		add	di,50h
    3864 1551  FE CE			 		dec	dh
    3865 1553  75 C1			 		jnz	loc_265			; Jump if not zero
    3866 1555  5E			 		pop	si
    3867 1556  5F			 		pop	di
    3868 1557  83 C7 02			 		add	di,2
    3869 155A  E2 B6			 		loop	locloop_264		; Loop if cx > 0
    3870				
    3871 155C  E9 1136 R		 		jmp	loc_200			; (1136)
    3872 155F				loc_268:					;  xref A.12D6
    3873 155F  E8 1638 R		 		call	sub_46			; (1638)
    3874 1562  8B F0			 		mov	si,ax
    3875 1564  83 EC 08			 		sub	sp,8
    3876 1567  8B EC			 		mov	bp,sp
    3877 1569  80 3E 0049 06		 		cmp	byte ptr ds:data_123e,6	; (C000:0049=0)
    3878 156E  06			 		push	es
    3879 156F  1F			 		pop	ds
    3880 1570  72 1A			 		jc	loc_270			; Jump if carry Set
    3881 1572  B6 04			 		mov	dh,4
    3882				;a.1574
    3883 1574				loc_269:					;  xref A.1587
    3884 1574  8A 04			 		mov	al,[si]
    3885 1576  88 46 00			 		mov	[bp],al
    3886 1579  45			 		inc	bp
    3887 157A  8A 84 2000		 		mov	al,ds:data_121e[si]	; (A.2000=0)
    3888 157E  88 46 00			 		mov	[bp],al
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-72


    3889 1581  45			 		inc	bp
    3890 1582  83 C6 50			 		add	si,50h
    3891 1585  FE CE			 		dec	dh
    3892 1587  75 EB			 		jnz	loc_269			; Jump if not zero
    3893 1589  EB 17			 		jmp	short loc_272		; (15A2)
    3894 158B  90			 		db	90h
    3895 158C				loc_270:					;  xref A.1570
    3896 158C  D1 E6			 		shl	si,1			; Shift w/zeros fill
    3897 158E  B6 04			 		mov	dh,4
    3898 1590				loc_271:					;  xref A.15A0
    3899 1590  E8 161B R		 		call	sub_45			; (161B)
    3900 1593  81 C6 2000		 		add	si,data_121e		; (A.2000=0)
    3901 1597  E8 161B R		 		call	sub_45			; (161B)
    3902 159A  81 EE 1FB0		 		sub	si,1FB0h
    3903 159E  FE CE			 		dec	dh
    3904 15A0  75 EE			 		jnz	loc_271			; Jump if not zero
    3905 15A2				loc_272:					;  xref A.1589
    3906 15A2  BF 176D R		 		mov	di,offset data_124		; (C000:176D=0)
    3907 15A5  0E			 		push	cs
    3908 15A6  07			 		pop	es
    3909 15A7  83 ED 08			 		sub	bp,8
    3910 15AA  8B F5			 		mov	si,bp
    3911 15AC  FC			 		cld				; Clear direction
    3912 15AD  B0 00			 		mov	al,0
    3913 15AF				loc_273:					;  xref A.15DB
    3914 15AF  16			 		push	ss
    3915 15B0  1F			 		pop	ds
    3916 15B1  BA 0080			 		mov	dx,80h
    3917				;a.15b4
    3918 15B4				loc_274:					;  xref A.15C5
    3919 15B4  56			 		push	si
    3920 15B5  57			 		push	di
    3921 15B6  B9 0008			 		mov	cx,8
    3922 15B9  F3/ A6			 		repe	cmpsb			; Rep zf=1+cx >0 Cmp [si] to es:[di]
    3923 15BB  5F			 		pop	di
    3924 15BC  5E			 		pop	si
    3925 15BD  74 1E			 		jz	loc_275			; Jump if zero
    3926 15BF  FE C0			 		inc	al
    3927 15C1  83 C7 08			 		add	di,8
    3928 15C4  4A			 		dec	dx
    3929 15C5  75 ED			 		jnz	loc_274			; Jump if not zero
    3930 15C7  3C 00			 		cmp	al,0
    3931 15C9  74 12			 		je	loc_275			; Jump if equal
    3932 15CB  2B C0			 		sub	ax,ax
    3933 15CD  8E D8			 		mov	ds,ax
    3934 15CF  C4 3E 007C		 		les	di,dword ptr ds:Int1Fv	; (0000:007C=5E9h) Load seg:offset ptr
    3935 15D3  8C C0			 		mov	ax,es
    3936 15D5  0B C7			 		or	ax,di
    3937 15D7  74 04			 		jz	loc_275			; Jump if zero
    3938 15D9  B0 80			 		mov	al,80h
    3939 15DB  EB D2			 		jmp	short loc_273		; (15AF)
    3940 15DD				loc_275:					;  xref A.15BD, 15C9, 15D7
    3941 15DD  83 C4 08			 		add	sp,8
    3942 15E0  E9 1136 R		 		jmp	loc_200			; (1136)
    3943				
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-73


    3944				;===============================================================================
    3945				 ;                              SUBROUTINE
    3946				 ;
    3947				 ;         Called from:   A.150F
    3948				;===============================================================================
    3949				;a.15e3
    3950 15E3				sub_43		proc	near
    3951 15E3  80 E3 03			 		and	bl,3
    3952 15E6  8A C3			 		mov	al,bl
    3953 15E8  51			 		push	cx
    3954 15E9  B9 0003			 		mov	cx,3
    3955				
    3956 15EC				locloop_276:					;  xref A.15F2
    3957 15EC  D0 E0			 		shl	al,1			; Shift w/zeros fill
    3958 15EE  D0 E0			 		shl	al,1			; Shift w/zeros fill
    3959 15F0  0A D8			 		or	bl,al
    3960 15F2  E2 F8			 		loop	locloop_276		; Loop if cx > 0
    3961				
    3962 15F4  8A FB			 		mov	bh,bl
    3963 15F6  59			 		pop	cx
    3964 15F7  C3			 		retn
    3965 15F8				sub_43		endp
    3966				
    3967				
    3968				;===============================================================================
    3969				 ;                              SUBROUTINE
    3970				 ;
    3971				 ;         Called from:   A.1517, 1530
    3972				;===============================================================================
    3973				;a.15f8
    3974 15F8				sub_44		proc	near
    3975 15F8  52			 		push	dx
    3976 15F9  51			 		push	cx
    3977 15FA  53			 		push	bx
    3978 15FB  BA 0000			 		mov	dx,0
    3979 15FE  B9 0001			 		mov	cx,1
    3980 1601				loc_277:					;  xref A.1613
    3981 1601  8B D8			 		mov	bx,ax
    3982 1603  23 D9			 		and	bx,cx
    3983 1605  0B D3			 		or	dx,bx
    3984 1607  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    3985 1609  D1 E1			 		shl	cx,1			; Shift w/zeros fill
    3986 160B  8B D8			 		mov	bx,ax
    3987 160D  23 D9			 		and	bx,cx
    3988 160F  0B D1			 		or	dx,cx
    3989 1611  D1 E1			 		shl	cx,1			; Shift w/zeros fill
    3990 1613  73 EC			 		jnc	loc_277			; Jump if carry=0
    3991 1615  8B C2			 		mov	ax,dx
    3992 1617  5B			 		pop	bx
    3993 1618  59			 		pop	cx
    3994 1619  5A			 		pop	dx
    3995 161A  C3			 		retn
    3996 161B				sub_44		endp
    3997				
    3998				
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-74


    3999				;===============================================================================
    4000				 ;                              SUBROUTINE
    4001				 ;
    4002				 ;         Called from:   A.1590, 1597
    4003				;===============================================================================
    4004				;a.161b
    4005 161B				sub_45		proc	near
    4006 161B  8A 24			 		mov	ah,[si]
    4007 161D  8A 44 01			 		mov	al,[si+1]
    4008 1620  B9 C000			 		mov	cx,0C000h
    4009 1623  B2 00			 		mov	dl,0
    4010 1625				loc_278:					;  xref A.1631
    4011 1625  85 C1			 		test	ax,cx
    4012 1627  F8			 		clc				; Clear carry flag
    4013 1628  74 01			 		jz	loc_279			; Jump if zero
    4014 162A  F9			 		stc				; Set carry flag
    4015 162B				loc_279:					;  xref A.1628
    4016 162B  D0 D2			 		rcl	dl,1			; Rotate thru carry
    4017 162D  D1 E9			 		shr	cx,1			; Shift w/zeros fill
    4018 162F  D1 E9			 		shr	cx,1			; Shift w/zeros fill
    4019 1631  73 F2			 		jnc	loc_278			; Jump if carry=0
    4020 1633  88 56 00			 		mov	[bp],dl
    4021 1636  45			 		inc	bp
    4022 1637  C3			 		retn
    4023 1638				sub_45		endp
    4024				
    4025				
    4026				;===============================================================================
    4027				 ;                              SUBROUTINE
    4028				 ;
    4029				 ;         Called from:   A.14B0, 155F
    4030				;===============================================================================
    4031				;a.1638
    4032 1638				sub_46		proc	near
    4033 1638  A1 0050			 		mov	ax,word ptr ds:[50h]	; (A.0050=74AAh)
    4034				
    4035				; External Entry into Subroutine 
					
    4036				 ;
    4037				 ;         Called from:   A.13CE, 1428
    4038				;a.163b
    4039 163B				sub_47:
    4040 163B  53			 		push	bx
    4041 163C  8B D8			 		mov	bx,ax
    4042 163E  8A C4			 		mov	al,ah
    4043 1640  F6 26 004A		 		mul	byte ptr ds:[4Ah]	; (A.004A=0) ax = data * al
    4044 1644  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4045 1646  D1 E0			 		shl	ax,1			; Shift w/zeros fill
    4046 1648  2A FF			 		sub	bh,bh
    4047 164A  03 C3			 		add	ax,bx
    4048 164C  5B			 		pop	bx
    4049 164D  C3			 		retn
    4050 164E				sub_46		endp
    4051				
    4052				
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-75


    4053				; Indexed Entry Point 
					
    4054				;a.164e
    4055 164E				loc_280:					;  xref A.0FED, 101B
    4056 164E  50			 		push	ax
    4057 164F  50			 		push	ax
    4058 1650  B4 03			 		mov	ah,3
    4059 1652  CD 10			 		int	10h			; Video display   ah=functn 03h
    4060				 						;  get cursor loc in dx, mode cx
    4061 1654  58			 		pop	ax
    4062 1655  3C 08			 		cmp	al,8
    4063 1657  74 59			 		je	loc_288			; Jump if equal
    4064 1659  3C 0D			 		cmp	al,0Dh
    4065 165B  74 5E			 		je	loc_289			; Jump if equal
    4066 165D  3C 0A			 		cmp	al,0Ah
    4067 165F  74 5E			 		je	loc_290			; Jump if equal
    4068 1661  3C 07			 		cmp	al,7
    4069 1663  74 61			 		je	loc_291			; Jump if equal
    4070 1665  8A 3E 0062 R		 		mov	bh,ds:video_page	; (0040:0062=0)
    4071 1669  B4 0A			 		mov	ah,0Ah
    4072 166B  B9 0001			 		mov	cx,1
    4073 166E  CD 10			 		int	10h			; Video display   ah=functn 0Ah
    4074				 						;  set char al at present curs
    4075				 						;   cx=# of chars to replicate
    4076 1670  FE C2			 		inc	dl
    4077 1672  3A 16 004A R		 		cmp	dl,byte ptr ds:video_columns	; (0040:004A=50h)
    4078 1676  75 36			 		jne	loc_287			; Jump if not equal
    4079 1678  B2 00			 		mov	dl,0
    4080 167A  80 FE 18			 		cmp	dh,18h
    4081 167D  75 2D			 		jne	loc_286			; Jump if not equal
    4082 167F				loc_281:					;  xref A.16C4
    4083 167F  B4 02			 		mov	ah,2
    4084 1681  B7 00			 		mov	bh,0
    4085 1683  CD 10			 		int	10h			; Video display   ah=functn 02h
    4086				 						;  set cursor location in dx
    4087 1685  A0 0049			 		mov	al,byte ptr ds:[49h]	; (A.0049=66h)
    4088 1688  3C 04			 		cmp	al,4
    4089 168A  72 06			 		jb	loc_282			; Jump if below
    4090 168C  3C 07			 		cmp	al,7
    4091 168E  B7 00			 		mov	bh,0
    4092 1690  75 06			 		jnz	loc_283			; Jump if not zero
    4093 1692				loc_282:					;  xref A.168A
    4094 1692  B4 08			 		mov	ah,8
    4095 1694  CD 10			 		int	10h			; Video display   ah=functn 08h
    4096				 						;  get char al & attrib ah @curs
    4097 1696  8A FC			 		mov	bh,ah
    4098 1698				loc_283:					;  xref A.1690
    4099 1698  B8 0601			 		mov	ax,601h
    4100 169B  B9 0000			 		mov	cx,0
    4101 169E  B6 18			 		mov	dh,18h
    4102 16A0  8A 16 004A		 		mov	dl,byte ptr ds:[4Ah]	; (A.004A=0)
    4103 16A4  FE CA			 		dec	dl
    4104 16A6				loc_284:					;  xref A.16B0
    4105 16A6  CD 10			 		int	10h			; Video display   ah=functn 02h
    4106				 						;  set cursor location in dx
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-76


    4107				;a.16a8
    4108 16A8				loc_285:					;  xref A.16CB
    4109 16A8  58			 		pop	ax
    4110 16A9  E9 1136 R		 		jmp	loc_200			; (1136)
    4111 16AC				loc_286:					;  xref A.167D, 16C2
    4112 16AC  FE C6			 		inc	dh
    4113 16AE				loc_287:					;  xref A.1676, 16B5, 16B9, 16BD
    4114 16AE  B4 02			 		mov	ah,2
    4115 16B0  EB F4			 		jmp	short loc_284		; (16A6)
    4116 16B2				loc_288:					;  xref A.1657
    4117 16B2  80 FA 00			 		cmp	dl,0
    4118 16B5  74 F7			 		je	loc_287			; Jump if equal
    4119 16B7  FE CA			 		dec	dl
    4120 16B9  EB F3			 		jmp	short loc_287		; (16AE)
    4121 16BB				loc_289:					;  xref A.165B
    4122 16BB  B2 00			 		mov	dl,0
    4123 16BD  EB EF			 		jmp	short loc_287		; (16AE)
    4124 16BF				loc_290:					;  xref A.165F
    4125 16BF  80 FE 18			 		cmp	dh,18h
    4126 16C2  75 E8			 		jne	loc_286			; Jump if not equal
    4127 16C4  EB B9			 		jmp	short loc_281		; (167F)
    4128 16C6				loc_291:					;  xref A.1663
    4129 16C6  B3 02			 		mov	bl,2
    4130 16C8  E8 05C3 R		 		call	BEEP			; (05C3)
    4131 16CB  EB DB			 		jmp	short loc_285		; (16A8)
    4132				
    4133				;a.16cd
    4134				;Light Pen offset table
    4135 16CD  03 03 05 05 03 03	PENOFF:	db	3, 3, 5, 5, 3, 3, 3, 4		; Data table (indexed access) xref A.1704
    4136       03 04			
    4137				     		
    4138				
    4139				; Indexed Entry Point 
					
    4140				;a.16d5
    4141 16D5				loc_292:					;  xref A.0FD9, 101B
    4142 16D5  B4 00			 		mov	ah,0
    4143 16D7  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    4144 16DB  83 C2 06			 		add	dx,6
    4145 16DE  EC			 		in	al,dx			; port 3DAh, CGA/EGA vid status
    4146 16DF  A8 04			 		test	al,4
    4147 16E1  75 78			 		jnz	loc_297			; Jump if not zero
    4148 16E3  A8 02			 		test	al,2
    4149 16E5  74 7E			 		jz	loc_298			; Jump if zero
    4150 16E7  B4 10			 		mov	ah,10h
    4151 16E9  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    4152 16ED  8A C4			 		mov	al,ah
    4153 16EF  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    4154				 						;  al = 10h, light pen high
    4155 16F0  42			 		inc	dx
    4156 16F1  EC			 		in	al,dx			; port 3D5h, CGA/EGA indxd data
    4157 16F2  8A E8			 		mov	ch,al
    4158 16F4  4A			 		dec	dx
    4159 16F5  FE C4			 		inc	ah
    4160 16F7  8A C4			 		mov	al,ah
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-77


    4161 16F9  EE			 		out	dx,al			; port 3D4h, CGA/EGA reg index
    4162				 						;  al = 11h, light pen low
    4163 16FA  42			 		inc	dx
    4164 16FB  EC			 		in	al,dx			; port 3D5h, CGA/EGA indxd data
    4165 16FC  8A E5			 		mov	ah,ch
    4166 16FE  8A 1E 0049 R		 		mov	bl,ds:video_mode	; (0040:0049=3)
    4167 1702  2A FF			 		sub	bh,bh
    4168 1704  2E: 8A 9F 16CD R		 		mov	bl,byte ptr cs:PENOFF[bx]	; (A.16CD=3)
    4169 1709  2B C3			 		sub	ax,bx
    4170 170B  2B 06 004E R		 		sub	ax,ds:video_segment	; (0040:004E=0)
    4171 170F  79 03			 		jns	loc_293			; Jump if not sign
    4172 1711  B8 0000			 		mov	ax,0
    4173				;a.1714
    4174 1714				loc_293:					;  xref A.170F
    4175 1714  B1 03			 		mov	cl,3
    4176 1716  80 3E 0049 R 04		 		cmp	byte ptr ds:video_mode,4	; (0040:0049=3)
    4177 171B  72 2A			 		jb	loc_295			; Jump if below
    4178 171D  80 3E 0049 R 07		 		cmp	byte ptr ds:video_mode,7	; (0040:0049=3)
    4179 1722  74 23			 		je	loc_295			; Jump if equal
    4180 1724  B2 28			 		mov	dl,28h			; '('
    4181 1726  F6 F2			 		div	dl			; al, ah rem = ax/reg
    4182 1728  8A E8			 		mov	ch,al
    4183 172A  02 ED			 		add	ch,ch
    4184 172C  8A DC			 		mov	bl,ah
    4185 172E  2A FF			 		sub	bh,bh
    4186 1730  80 3E 0049 R 06		 		cmp	byte ptr ds:video_mode,6	; (0040:0049=3)
    4187 1735  75 04			 		jne	loc_294			; Jump if not equal
    4188 1737  B1 04			 		mov	cl,4
    4189 1739  D0 E4			 		shl	ah,1			; Shift w/zeros fill
    4190 173B				loc_294:					;  xref A.1735
    4191 173B  D3 E3			 		shl	bx,cl			; Shift w/zeros fill
    4192 173D  8A D4			 		mov	dl,ah
    4193 173F  8A F0			 		mov	dh,al
    4194 1741  D0 EE			 		shr	dh,1			; Shift w/zeros fill
    4195 1743  D0 EE			 		shr	dh,1			; Shift w/zeros fill
    4196 1745  EB 12			 		jmp	short loc_296		; (1759)
    4197 1747				loc_295:					;  xref A.171B, 1722
    4198 1747  F6 36 004A R		 		div	byte ptr ds:video_columns	; (0040:004A=50h) al,ah rem = ax/dat
					a
    4199 174B  8A F0			 		mov	dh,al
    4200 174D  8A D4			 		mov	dl,ah
    4201 174F  D2 E0			 		shl	al,cl			; Shift w/zeros fill
    4202 1751  8A E8			 		mov	ch,al
    4203 1753  8A DC			 		mov	bl,ah
    4204 1755  32 FF			 		xor	bh,bh			; Zero register
    4205 1757  D3 E3			 		shl	bx,cl			; Shift w/zeros fill
    4206				;a.1759
    4207 1759				loc_296:					;  xref A.1745
    4208 1759  B4 01			 		mov	ah,1
    4209 175B				loc_297:					;  xref A.16E1
    4210 175B  52			 		push	dx
    4211 175C  8B 16 0063 R		 		mov	dx,ds:video_port	; (0040:0063=3D4h)
    4212 1760  83 C2 07			 		add	dx,7
    4213 1763  EE			 		out	dx,al			; port 3DBh, CGA light pen clr
    4214 1764  5A			 		pop	dx
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-78


    4215 1765				loc_298:					;  xref A.16E5
    4216 1765  5F			 		pop	di
    4217 1766  5E			 		pop	si
    4218 1767  1F			 		pop	ds
    4219 1768  1F			 		pop	ds
    4220 1769  1F			 		pop	ds
    4221 176A  1F			 		pop	ds
    4222 176B  07			 		pop	es
    4223 176C  CF			 		iret				; Interrupt return
    4224				
    4225				 ; this doesn't seem to code for anything useful through 1C00, so
    4226				 ; maybe it's data tables of some sort
    4227				 ;a.176d
    4228 176D  0008[			 data_124:	db	8 dup (0)
    4229	   00			
    4230			 ]	
    4231				
    4232 1775  73 81 A5 81 BD 99	     		db	 73h, 81h,0A5h, 81h,0BDh, 99h
    4233 177B  81 73 73 FF DB FF	     		db	 81h, 73h, 73h,0FFh,0DBh,0FFh
    4234 1781  C3 E7 FF 7E 6C FE	     		db	0C3h,0E7h,0FFh, 7Eh, 6Ch,0FEh
    4235 1787  FE FE 7C 38 10 00	     		db	0FEh,0FEh, 7Ch, 38h, 10h, 00h
    4236 178D  10 38 7C FE 7C 38	     		db	 10h, 38h, 7Ch,0FEh, 7Ch, 38h
    4237 1793  10 08 38 7C 38 FE	     		db	 10h, 08h, 38h, 7Ch, 38h,0FEh
    4238 1799  FE 7C 38 7C 10 10	     		db	0FEh, 7Ch, 38h, 7Ch, 10h, 10h
    4239 179F  38			 		db	38h
    4240				;a.17a0
    4241 17A0				loc_299:					;  xref A.17A0
    4242 17A0  7C FE			 		jl	loc_299			; Jump if <
    4243 17A2  7C 38			 		jl	$+3Ah			; Jump if <
    4244 17A4  7C 00			 		jl	$+2			; delay for I/O
    4245 17A6  00 18			 		add	[bx+si],bl
    4246 17A8  3C 3C			 		cmp	al,3Ch			; '<'
    4247 17AA  18 00			 		sbb	[bx+si],al
    4248				; 		add	bh,bh
    4249 17AC  00 FF					db	0, 0ffh
    4250 17AE  FF E7			 		jmp	di			;*
    4251				 			                        ;* No entry point to code
    4252 17B0  C3			 		retn
    4253				 			                        ;* No entry point to code
    4254 17B1  C3			 		retn
    4255				 			                        ;* No entry point to code
    4256 17B2  E7 FF			 		out	0FFh,ax			; port 0FFh ??I/O Non-standard
    4257 17B4  FF 00			 		inc	word ptr [bx+si]
    4258 17B6  3C 66			 		cmp	al,66h			; 'f'
    4259 17B8  42			 		inc	dx
    4260 17B9  42			 		inc	dx
    4261 17BA  66 3C 00 FF C3 99			db	 66h, 3Ch, 00h,0FFh,0C3h, 99h
    4262 17C0  BD B0 99 C3 FF 0F			db	0BDh,0B0h, 99h,0C3h,0FFh, 0Fh
    4263 17C6  07 0F 7D CC CC CC			db	 07h, 0Fh, 7Dh,0CCh,0CCh,0CCh
    4264 17CC  78 3C 66 66 66 3C			db	 78h, 3Ch, 66h, 66h, 66h, 3Ch
    4265 17D2  18 7E 18 3F 3F 3F			db	 18h, 7Eh, 18h, 3Fh, 3Fh, 3Fh
    4266 17D8  30 30 70 F0 E0 7F			db	 30h, 30h, 70h,0F0h,0E0h, 7Fh
    4267 17DE  63 7F 63 63 67 E6			db	 63h, 7Fh, 63h, 63h, 67h,0E6h
    4268 17E4  C0 99 5A 3C E7 E7			db	0C0h, 99h, 5Ah, 3Ch,0E7h,0E7h
    4269 17EA  3C 5A 99 80 E0 F8			db	 3Ch, 5Ah, 99h, 80h,0E0h,0F8h
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-79


    4270 17F0  FE F8 E0 80 00 02			db	0FEh,0F8h,0E0h, 80h, 00h, 02h
    4271 17F6  0E 3E FE 3E 0E 02			db	 0Eh, 3Eh,0FEh, 3Eh, 0Eh, 02h
    4272 17FC  00 18 3C 7E 18 18			db	 00h, 18h, 3Ch, 7Eh, 18h, 18h
    4273 1802  7E 3C 18 66 66 66			db	 7Eh, 3Ch, 18h, 66h, 66h, 66h
    4274 1808  66 66 00 66 00 7F			db	 66h, 66h, 00h, 66h, 00h, 7Fh
    4275 180E  DB DB 7B 1B 1B 1B			db	0DBh,0DBh, 7Bh, 1Bh, 1Bh, 1Bh
    4276 1814  00 3E 63 38 6C 6C			db	 00h, 3Eh, 63h, 38h, 6Ch, 6Ch
    4277 181A  38 CC 78 00 00 00			db	 38h,0CCh, 78h, 00h, 00h, 00h
    4278 1820  00 7E 7E 7E 00 18			db	 00h, 7Eh, 7Eh, 7Eh, 00h, 18h
    4279 1826  3C 7E 18 7E 3C 18			db	 3Ch, 7Eh, 18h, 7Eh, 3Ch, 18h
    4280 182C  FF 18 3C 7E 18 18			db	0FFh, 18h, 3Ch, 7Eh, 18h, 18h
    4281 1832  18 18 00 18 18 18			db	 18h, 18h, 00h, 18h, 18h, 18h
    4282 1838  18 73 3C 18 00 00			db	 18h, 73h, 3Ch, 18h, 00h, 00h
    4283 183E  18 0C FE 0C 18 00			db	 18h, 0Ch,0FEh, 0Ch, 18h, 00h
    4284 1844  00 00 30 60 FE 60			db	 00h, 00h, 30h, 60h,0FEh, 60h
    4285 184A  30 00 00 00 00 C0			db	 30h, 00h, 00h, 00h, 00h,0C0h
    4286 1850  C0 C0 FE 00 00 00			db	0C0h,0C0h,0FEh, 00h, 00h, 00h
    4287 1856  24 66 FF 66 24 00			db	 24h, 66h,0FFh, 66h, 24h, 00h
    4288 185C  00 00 18 3C 7E FF			db	 00h, 00h, 18h, 3Ch, 7Eh,0FFh
    4289 1862  FF 00 00 00 FF FF			db	0FFh, 00h, 00h, 00h,0FFh,0FFh
    4290 1868  7E 3C 18 00				db	 7Eh, 3Ch, 18h, 00h
    4291 186C  0009[			 		db	9 dup (0)
    4292	   00			
    4293			 ]	
    4294				
    4295 1875  30 78			 		db	 30h, 78h
    4296				;a.1877		
    4297 1877				loc_300:
    4298				 ;*		js	loc_301			;*Jump if sign=1
    4299 1877  78 30			 		db	 78h, 30h
    4300 1879  30 00			 		xor	[bx+si],al
    4301 187B  30 00			 		xor	[bx+si],al
    4302 187D  6C			 		insb				; Port dx to es:[di]
    4303 187E  6C			 		insb				; Port dx to es:[di]
    4304 187F  6C			 		insb				; Port dx to es:[di]
    4305 1880  00 00 00 00 00 6C			db	 00h, 00h, 00h, 00h, 00h, 6Ch
    4306 1886  6C FE 6C FE 6C 6C			db	 6Ch,0FEh, 6Ch,0FEh, 6Ch, 6Ch
    4307 188C  00 30 7C C0 78 0C			db	 00h, 30h, 7Ch,0C0h, 78h, 0Ch
    4308 1892  F8 30 00 00 C6 CC			db	0F8h, 30h, 00h, 00h,0C6h,0CCh
    4309 1898  18 30 66 C6 00 38			db	 18h, 30h, 66h,0C6h, 00h, 38h
    4310 189E  6C 38 76 DC CC 76			db	 6Ch, 38h, 76h,0DCh,0CCh, 76h
    4311 18A4  00 60 60 C0 00					db	 00h, 60h, 60h,0C0h, 00h
    4312 18A9  00 00 00 00 18 30			db	 00h, 00h, 00h, 00h, 18h, 30h
    4313 18AF  60 60 60 30 18 00			db	 60h, 60h, 60h, 30h, 18h, 00h
    4314 18B5  60 30 18 18 18 30			db	 60h, 30h, 18h, 18h, 18h, 30h
    4315 18BB  60 00 00 66 3C FF			db	 60h, 00h, 00h, 66h, 3Ch,0FFh
    4316 18C1  3C 66 00 00 00 30			db	 3Ch, 66h, 00h, 00h, 00h, 30h
    4317 18C7  30 FC			 		db	 30h,0FCh
    4318 18C9  30 30			 		db	 30h, 30h
    4319 18CB  0007[			 		db	7 dup (0)
    4320	   00			
    4321			 ]	
    4322				
    4323 18D2  30 30 60 00 00 00	     		db	 30h, 30h, 60h, 00h, 00h, 00h
    4324 18D8  FC			 		db	0FCh
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-80


    4325 18D9  0009[			 		db	9 dup (0)
    4326	   00			
    4327			 ]	
    4328				
    4329 18E2  30 30 00 06 0C 18	     		db	 30h, 30h, 00h, 06h, 0Ch, 18h
    4330 18E8  30 60 C0 80 00 7C	     		db	 30h, 60h,0C0h, 80h, 00h, 7Ch
    4331 18EE  C6 CE DE F6 E6 7C			db	0C6h,0CEh,0DEh,0F6h,0E6h, 7Ch
    4332 18F4  00			 		db	 00h
    4333 18F5  30 70 30 30 30 30	     		db	 30h, 70h, 30h, 30h, 30h, 30h
    4334 18FB				loc_302:					;  xref A.192D
    4335 18FB  FC			 		cld				; Clear direction
    4336 18FC  00 78 CC			 		add	[bx+si-34h],bh
    4337				 ;a.18fe
    4338				 ;loc_303:
    4339				 ;		int	3
    4340 18FF  0C 38			 		or	al,38h			; '8'
    4341 1901  60			 		pusha				; Save all regs
    4342 1902  CC			 		int	3			; Debug breakpoint
    4343 1903				loc_304:					;  xref A.1935
    4344 1903  FC			 		cld				; Clear direction
    4345 1904  00 78 CC			 		add	[bx+si-34h],bh
    4346 1907  0C 38			 		or	al,38h			; '8'
    4347 1909  0C CC			 		or	al,0CCh
    4348 190B  78 00			 		js	$+2			; delay for I/O
    4349 190D  1C 3C			 		sbb	al,3Ch			; '<'
    4350 190F  6C			 		insb				; Port dx to es:[di]
    4351 1910  CC			 		int	3			; Debug breakpoint
    4352 1911  FE 0C			 		dec	byte ptr [si]
    4353 1913  1E			 		push	ds
    4354				; 		add	ah,bh
    4355 1914  00 FC					db	0, 0fch
    4356 1916  C0 F8 0C			 		sar	al,0Ch			; Shift w/sign fill
    4357 1919  0C CC			 		or	al,0CCh
    4358 191B  78 00			 		js	$+2			; delay for I/O
    4359 191D  38 60 C0			 		cmp	[bx+si-40h],ah
    4360 1920  F8			 		clc				; Clear carry flag
    4361 1921  CC			 		int	3			; Debug breakpoint
    4362 1922  CC			 		int	3			; Debug breakpoint
    4363 1923  78 00			 		js	$+2			; delay for I/O
    4364 1925  FC			 		cld				; Clear direction
    4365 1926  CC			 		int	3			; Debug breakpoint
    4366 1927  0C 18			 		or	al,18h
    4367 1929  30 30			 		xor	[bx+si],dh
    4368 192B  30 00			 		xor	[bx+si],al
    4369 192D  78 CC			 		js	loc_302			; Jump if sign=1
    4370 192F  CC			 		int	3			; Debug breakpoint
    4371				 ;*		js	loc_303		;*Jump if sign=1 18fe
    4372 1930  78 CC			 		db	 78h,0CCh
    4373 1932  CC			 		int	3			; Debug breakpoint
    4374 1933  78 00			 		js	loc_305			; Jump if sign=1
    4375 1935				loc_305:					;  xref A.1933
    4376 1935  78 CC			 		js	loc_304			; Jump if sign=1
    4377 1937  CC			 		int	3			; Debug breakpoint
    4378 1938  7C 0C			 		jl	loc_306			; Jump if <
    4379				 ;*		sbb	[bx+si+0],dh
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-81


    4380 193A  18 70 00			 		db	 18h, 70h, 00h
    4381 193D  00 30 30 00 00 30	     		db	 00h, 30h, 30h, 00h, 00h, 30h
    4382 1943  30 00 00			 		db	 30h, 00h, 00h
    4383				;a.1946
    4384 1946				loc_306:					;  xref A.1938
    4385 1946  30 30			 		xor	[bx+si],dh
    4386 1948  00 00			 		add	[bx+si],al
    4387 194A  30 30			 		xor	[bx+si],dh
    4388 194C  60			 		pusha				; Save all regs
    4389 194D  18 30			 		sbb	[bx+si],dh
    4390 194F  60			 		pusha				; Save all regs
    4391 1950  C0 60 30 18		 		shl	byte ptr [bx+si+30h],18h	; Shift w/zeros fill
    4392 1954  00 00			 		add	[bx+si],al
    4393				; 		add	ah,bh
    4394 1956  00 FC					db	0, 0fch
    4395 1958  00 00			 		add	[bx+si],al
    4396 195A  FC			 		cld				; Clear direction
    4397 195B  00 00			 		add	[bx+si],al
    4398 195D  60			 		pusha				; Save all regs
    4399 195E  30 18			 		xor	[bx+si],bl
    4400 1960  0C 18			 		or	al,18h
    4401				 ;*		xor	[bx+si+0],ah
    4402 1962  30 60 00			 		db	 30h, 60h, 00h
    4403 1965  78 CC 0C 18 30 00			db	 78h,0CCh, 0Ch, 18h, 30h, 00h
    4404 196B  30 00 7C C6 DE DE			db	 30h, 00h, 7Ch,0C6h,0DEh,0DEh
    4405 1971  DE C0 78 00 30 78			db	0DEh,0C0h, 78h, 00h, 30h, 78h
    4406 1977  CC CC FC CC CC 00			db	0CCh,0CCh,0FCh,0CCh,0CCh, 00h
    4407 197D  FC 66 66 7C 66 66			db	0FCh, 66h, 66h, 7Ch, 66h, 66h
    4408 1983  FC 00 3C 66 C0 C0			db	0FCh, 00h, 3Ch, 66h,0C0h,0C0h
    4409 1989  C0 66 3C 00 F8 6C			db	0C0h, 66h, 3Ch, 00h,0F8h, 6Ch
    4410 198F  66 66 66 6C F8 00			db	 66h, 66h, 66h, 6Ch,0F8h, 00h
    4411 1995  FE 62 68 78 68 62			db	0FEh, 62h, 68h, 78h, 68h, 62h
    4412 199B  FE 00 FE 62 68 78			db	0FEh, 00h,0FEh, 62h, 68h, 78h
    4413 19A1  68 60 F0 00 3C 66			db	 68h, 60h,0F0h, 00h, 3Ch, 66h
    4414 19A7  C0 C0 CE 66 3E 00			db	0C0h,0C0h,0CEh, 66h, 3Eh, 00h
    4415 19AD  CC CC CC FC CC CC			db	0CCh,0CCh,0CCh,0FCh,0CCh,0CCh
    4416 19B3  CC 00 78 30 30 30			db	0CCh, 00h, 78h, 30h, 30h, 30h
    4417 19B9  30 30 78 00 1E 0C			db	 30h, 30h, 78h, 00h, 1Eh, 0Ch
    4418 19BF  0C 0C CC CC 78 00			db	 0Ch, 0Ch,0CCh,0CCh, 78h, 00h
    4419 19C5  E6 66 6C 78 6C 66			db	0E6h, 66h, 6Ch, 78h, 6Ch, 66h
    4420 19CB  E6 00 F0 60 60 60			db	0E6h, 00h,0F0h, 60h, 60h, 60h
    4421 19D1  62 66 FE 00 C6 EE			db	 62h, 66h,0FEh, 00h,0C6h,0EEh
    4422 19D7  FE FE D6 C6 C6 00			db	0FEh,0FEh,0D6h,0C6h,0C6h, 00h
    4423 19DD  C6 E6 F6 DE CE C6			db	0C6h,0E6h,0F6h,0DEh,0CEh,0C6h
    4424 19E3  C6 00 38 6C C6 C6			db	0C6h, 00h, 38h, 6Ch,0C6h,0C6h
    4425 19E9  C6 6C 38 00 FC 66			db	0C6h, 6Ch, 38h, 00h,0FCh, 66h
    4426 19EF  66 7C 60 60 F0 00			db	 66h, 7Ch, 60h, 60h,0F0h, 00h
    4427 19F5  78 CC CC CC DC 78			db	 78h,0CCh,0CCh,0CCh,0DCh, 78h
    4428 19FB  1C 00 FC 66 66 7C			db	 1Ch, 00h,0FCh, 66h, 66h, 7Ch
    4429 1A01  6C 66 E6 00 78 CC			db	 6Ch, 66h,0E6h, 00h, 78h,0CCh
    4430 1A07  E0 70 1C CC 78 00			db	0E0h, 70h, 1Ch,0CCh, 78h, 00h
    4431 1A0D  FC B4 30 30 30 30			db	0FCh,0B4h, 30h, 30h, 30h, 30h
    4432 1A13  78 00 CC CC CC CC			db	 78h, 00h,0CCh,0CCh,0CCh,0CCh
    4433 1A19  CC CC FC 00 CC CC			db	0CCh,0CCh,0FCh, 00h,0CCh,0CCh
    4434 1A1F  CC CC CC 78 C0 00			db	0CCh,0CCh,0CCh, 78h,0C0h, 00h
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-82


    4435 1A25  C6 C6 C6 D6 FE EE			db	0C6h,0C6h,0C6h,0D6h,0FEh,0EEh
    4436 1A2B  C6 00 C6 C6 6C 38			db	0C6h, 00h,0C6h,0C6h, 6Ch, 38h
    4437 1A31  38 6C C6 00 CC CC			db	 38h, 6Ch,0C6h, 00h,0CCh,0CCh
    4438 1A37  CC 78 30 30 78 00			db	0CCh, 78h, 30h, 30h, 78h, 00h
    4439 1A3D  FE C6 8C 18 32 66			db	0FEh,0C6h, 8Ch, 18h, 32h, 66h
    4440 1A43  FE 00 78 60 60 60			db	0FEh, 00h, 78h, 60h, 60h, 60h
    4441 1A49  60 60 78 00 C0 60			db	 60h, 60h, 78h, 00h,0C0h, 60h
    4442 1A4F  30 18 0C 06 02 00			db	 30h, 18h, 0Ch, 06h, 02h, 00h
    4443 1A55  78 18 18 18 18 18			db	 78h, 18h, 18h, 18h, 18h, 18h
    4444 1A5B  78 00 10 38 6C C6			db	 78h, 00h, 10h, 38h, 6Ch,0C6h
    4445 1A61  00 00					db	 00h, 00h
    4446 1A63  0009[					db	9 dup (0)
    4447	   00			
    4448			 ]	
    4449				
    4450 1A6C  FF 30 30					db	0FFh, 30h, 30h
    4451				;a.1a6f
    4452 1A6F				loc_308:
    4453 1A6F  18 00			 		sbb	[bx+si],al
    4454 1A71  00 00 00 00 00 00			db	 00h, 00h, 00h, 00h, 00h, 00h
    4455 1A77  78 0C 7C CC 76 00			db	 78h, 0Ch, 7Ch,0CCh, 76h, 00h
    4456 1A7D  E0 60 60 7C 66 66			db	0E0h, 60h, 60h, 7Ch, 66h, 66h
    4457 1A83  DC 00 00 00 78 CC			db	0DCh, 00h, 00h, 00h, 78h,0CCh
    4458 1A89  C0 CC 78 00 1C 0C			db	0C0h,0CCh, 78h, 00h, 1Ch, 0Ch
    4459 1A8F  0C 7C CC CC 76 00			db	 0Ch, 7Ch,0CCh,0CCh, 76h, 00h
    4460 1A95  00 00 78 CC FC C0			db	 00h, 00h, 78h,0CCh,0FCh,0C0h
    4461 1A9B  78 00 38 6C 60 F0			db	 78h, 00h, 38h, 6Ch, 60h,0F0h
    4462 1AA1  60 60 F0 00 00 00			db	 60h, 60h,0F0h, 00h, 00h, 00h
    4463 1AA7  76 CC CC 7C 0C F8			db	 76h,0CCh,0CCh, 7Ch, 0Ch,0F8h
    4464 1AAD  E0 60 6C 76 66 66			db	0E0h, 60h, 6Ch, 76h, 66h, 66h
    4465 1AB3  E6 00 30 00 70 30			db	0E6h, 00h, 30h, 00h, 70h, 30h
    4466 1AB9  30 30 78 00 0C 00			db	 30h, 30h, 78h, 00h, 0Ch, 00h
    4467 1ABF  0C 0C 0C CC CC 78			db	 0Ch, 0Ch, 0Ch,0CCh,0CCh, 78h
    4468 1AC5  E0 60 66 6C 78 6C			db	0E0h, 60h, 66h, 6Ch, 78h, 6Ch
    4469 1ACB  E6 00 70 30 30 30			db	0E6h, 00h, 70h, 30h, 30h, 30h
    4470 1AD1  30 30 78 00 00 00			db	 30h, 30h, 78h, 00h, 00h, 00h
    4471 1AD7  CC FE FE D6 C6 00			db	0CCh,0FEh,0FEh,0D6h,0C6h, 00h
    4472 1ADD  00 00 F8 CC CC CC			db	 00h, 00h,0F8h,0CCh,0CCh,0CCh
    4473 1AE3  CC 00 00 00 78 CC			db	0CCh, 00h, 00h, 00h, 78h,0CCh
    4474 1AE9  CC CC 78 00 00 00			db	0CCh,0CCh, 78h, 00h, 00h, 00h
    4475 1AEF  DC 66 66 7C 60 F0			db	0DCh, 66h, 66h, 7Ch, 60h,0F0h
    4476 1AF5  00 00 76 CC CC 7C			db	 00h, 00h, 76h,0CCh,0CCh, 7Ch
    4477 1AFB  0C 1E 00 00 DC 76			db	 0Ch, 1Eh, 00h, 00h,0DCh, 76h
    4478 1B01  66 60 F0 00 00 00			db	 66h, 60h,0F0h, 00h, 00h, 00h
    4479 1B07  7C C0 78 0C F8 00			db	 7Ch,0C0h, 78h, 0Ch,0F8h, 00h
    4480 1B0D  10 30 7C 30 30 34			db	 10h, 30h, 7Ch, 30h, 30h, 34h
    4481 1B13  18 00 00 00 CC CC			db	 18h, 00h, 00h, 00h,0CCh,0CCh
    4482 1B19  CC CC 76 00 00 00			db	0CCh,0CCh, 76h, 00h, 00h, 00h
    4483 1B1F  CC CC CC 78 30 00			db	0CCh,0CCh,0CCh, 78h, 30h, 00h
    4484 1B25  00 00 C6 D6 FE FE			db	 00h, 00h,0C6h,0D6h,0FEh,0FEh
    4485 1B2B  6C 00 00 00 C6 6C			db	 6Ch, 00h, 00h, 00h,0C6h, 6Ch
    4486 1B31  38 6C C6 00 00 00			db	 38h, 6Ch,0C6h, 00h, 00h, 00h
    4487 1B37  CC CC CC 7C 0C F8			db	0CCh,0CCh,0CCh, 7Ch, 0Ch,0F8h
    4488 1B3D  00 00 FC 98 30 64			db	 00h, 00h,0FCh, 98h, 30h, 64h
    4489 1B43  FC 00 1C 30 30 E0			db	0FCh, 00h, 1Ch, 30h, 30h,0E0h
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-83


    4490 1B49  30 30 1C 00 18 18			db	 30h, 30h, 1Ch, 00h, 18h, 18h
    4491 1B4F  18 00 18 18 18 00			db	 18h, 00h, 18h, 18h, 18h, 00h
    4492 1B55  E0 30 30 1C 30 30			db	0E0h, 30h, 30h, 1Ch, 30h, 30h
    4493 1B5B  E0 00 76 DC				db	0E0h, 00h, 76h,0DCh
    4494 1B5F  0007[			 		db	7 dup (0)
    4495	   00			
    4496			 ]	
    4497				
    4498				;a.1b66
    4499 1B66  10 38 6C C6 C6 FE	     		db	 10h, 38h, 6Ch,0C6h,0C6h,0FEh
    4500				;a.1b6c
    4501				; 		db	148 dup (0)		; should end @1bff
    4502				
    4503				IF	ROMSEARCH
    4504				;***** Expansion ROM code *****
    4505				; This is called after the hardware is initialized but before
    4506				; the video is displayed. Borrowed from the Generic XT BIOS.
    4507 1B6C  BA C800			EXPROM: MOV     DX,0C800h                       ; ROM segment start
    4508 1B6F  1E				PUSH    DS
    4509				
    4510 1B70  8E DA			FNDROM: MOV     DS,DX                           ; Load ROM segment
    4511 1B72  33 DB			        XOR     BX,BX                           ;  ...ID offset
    4512 1B74  8B 07			        MOV     AX,[BX]                         ; Read the ROM id
    4513 1B76  3D AA55			        CMP     AX,0AA55h
    4514 1B79  75 36			        JNZ     NXTROM                          ;  ...not valid ROM
    4515 1B7B  B8 0040			        MOV     AX,40h
    4516 1B7E  8E C0			        MOV     ES,AX
    4517 1B80  B4 00			        MOV     AH,0
    4518 1B82  8A 47 02			        MOV     AL,[BX+2]                       ; Get ROM size (bytes * 512)
    4519 1B85  B1 05			        MOV     CL,5
    4520 1B87  D3 E0			        SHL     AX,CL                           ; Now ROM size in segments
    4521 1B89  03 D0			        ADD     DX,AX                           ;  ...add base segment
    4522 1B8B  B1 04			        MOV     CL,4
    4523 1B8D  D3 E0			        SHL     AX,CL                           ; ROM address in bytes
    4524 1B8F  8B C8			        MOV     CX,AX                           ;  ...checksum requires CX
    4525 1B91  E8 1BBF R		        CALL    CHK_01                          ; Find ROM checksum
    4526 1B94  75 15			        JNZ     BADROM                          ;  ...bad ROM
    4527 1B96  52			        PUSH    DX
    4528 1B97  26: C7 06 0067 R 0003	        MOV     Word ptr ES:[gen_io_ptr],3	; 67h Offset  for ROM being setup
    4529 1B9E  26: 8C 1E 0069 R		        MOV     ES:[gen_io_ptr+2],DS		; 69h Segment for ROM being setup
    4530 1BA3  26: FF 1E 0067 R		        CALL    Dword ptr ES:[gen_io_ptr]	;  ...call ROM initialization
    4531 1BA8  5A			        POP     DX
    4532 1BA9  EB 0A			        JMP     short FND_01			; see if there are any more ROMs
    4533				
    4534 1BAB  26: 80 0E 0015 R 20	BADROM: OR      Byte ptr ES:[scratch1],ER_ROM          ; ROM present, bad checksum 15h
    4535				
    4536 1BB1  81 C2 0080		NXTROM: ADD     DX,80h                          ; Segment for next ROM
    4537				
    4538 1BB5  81 FA F600		FND_01: CMP     DX,0F600h                       ; End of ROM space
    4539 1BB9  7C B5			        JL      FNDROM                          ;  ...no, continue
    4540 1BBB  C3				ret
    4541				
    4542 1BBC  B9 2000			CHKSUM: MOV     CX,2000h                        ; Bytes in 2764 eprom
    4543 1BBF  B0 00			CHK_01: MOV     AL,0                            ;  ...zero checksum
    4544 1BC1  02 07			ADDBYT: ADD     AL,[BX]                         ; Add byte to checksum
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-84


    4545 1BC3  43				INC     BX                              ;  ...BX --> next byte
    4546 1BC4  E2 FB				LOOP    ADDBYT                          ;  ...loop until done
    4547 1BC6  0A C0				OR      AL,AL                           ; Set condition codes
    4548 1BC8  C3				RET                                     ;  ...and return
    4549				ENDIF
    4550				
    4551				;a.1c00
    4552 1C00					org	01c00h
    4553				include "INIT186.ASM"
    4554			     C	; CPU 186 defined in CM5.ASM
    4555			     C	; 1C00h
    4556 1C00                        C	COLDST:
    4557 1C00  8C C8                 C		mov	ax,cs
    4558 1C02  8E D8                 C		mov	ds,ax
    4559 1C04  8E C0                 C		mov	es,ax
    4560 1C06  BE 1C29 R             C		mov	si,offset inittbl	;1c29h
    4561 1C09  FC                    C		cld
    4562 1C0A                        C	loc_309:				;  xref A.1C13
    4563 1C0A  AD                    C	 	lodsw				; String [si] to ax
    4564 1C0B  85 C0                 C	 	test	ax,ax
    4565 1C0D  74 06                 C	 	jz	loc_310			; Jump if zero
    4566 1C0F  8B D0                 C	 	mov	dx,ax
    4567 1C11  AD                    C	 	lodsw				; String [si] to ax
    4568 1C12  EF                    C	 	out	dx,ax			; port 4552h ??I/O Non-standard
    4569 1C13  EB F5                 C	 	jmp	short loc_309		; (1C0A)
    4570			     C	; work on second table
    4571			     C	;1c15
    4572 1C15                        C	loc_310:				;  xref A.1C0D
    4573 1C15  BE 1C5F R             C	 	mov	si,offset inittbl2	; (A.1C5F=82h)
    4574 1C18  BA 0000               C	 	mov	dx,0
    4575 1C1B                        C	loc_311:				;  xref A.1C24
    4576 1C1B  AC                    C	 	lodsb				; String [si] to al
    4577 1C1C  84 C0                 C	 	test	al,al
    4578 1C1E  74 06                 C	 	jz	loc_312			; Jump if zero
    4579 1C20  8A D0                 C	 	mov	dl,al
    4580 1C22  AC                    C	 	lodsb				; String [si] to al
    4581 1C23  EE                    C	 	out	dx,al			; port 82h, DMA page reg ch 3
    4582 1C24  EB F5                 C	 	jmp	short loc_311		; (1C1B)
    4583			     C	
    4584 1C26                        C	loc_312:				;  xref A.1C1E
    4585 1C26  E9 001F R             C	 	jmp	COLD2			;loc_2	;*(001F)
    4586			     C	
    4587			     C	;a.1c29
    4588			     C	; Initialization table. First word is the port and
    4589			     C	; second word is the value.
    4590 1C29                        C	inittbl:
    4591 1C29  A0 FF 38 FE           C	    	db	0A0h,0FFh, 38h,0FEh
    4592 1C2D  A2 FF F8 3F           C		db	0A2h,0FFh, 0F8h, 3Fh
    4593 1C31  A4 FF 3A 00           C		db	0A4h,0FFh, 3Ah, 00h
    4594 1C35  A6 FF 38 40           C	     	db	0A6h,0FFh, 38h, 40h
    4595 1C39  A8 FF 38 A0           C		db	0A8h,0FFh, 38h,0A0h
    4596 1C3D  52 FF 06 00           C		db	52h,0FFh, 06h, 00h
    4597 1C41  54 FF 07 00           C		db	54h,0FFh, 07h, 00h
    4598 1C45  56 FF 03 C0           C		db	56h,0FFh, 03h,0C0h
    4599 1C49  5A FF 06 00           C		db	5Ah,0FFh, 06h, 00h
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Page     1-85


    4600 1C4D  5C FF 07 00           C	     	db	5Ch,0FFh, 07h, 00h
    4601 1C51  5E FF 03 C0           C		db	5Eh,0FFh, 03h,0C0h
    4602 1C55  62 FF 20 4E           C		db	62h,0FFh, 20h, 4Eh
    4603 1C59  66 FF 01 C0           C	    	db	66h,0FFh, 01h,0C0h
    4604 1C5D  00 00                 C		db	00h, 00h
    4605			     C	
    4606			     C	; Initialization table 2. Ports?
    4607 1C5F                        C	inittbl2:
    4608 1C5F  82 00 82 00 82 00     C	 	db	82h, 00h, 82h, 00h, 82h, 00h, 82h
    4609       82                    C	
    4610 1C66  40 82 CE 82 37 C2     C	     	db	 40h, 82h,0CEh, 82h, 37h,0C2h
    4611 1C6C  00 C2 00 C2 00 C2     C	     	db	 00h,0C2h, 00h,0C2h, 00h,0C2h
    4612 1C72  40 C2 CE C2 37 D6     C	     	db	 40h,0C2h,0CEh,0C2h, 37h,0D6h
    4613 1C78  82 D4 0F              C	 	db	 82h,0D4h, 0Fh
    4614			     C	;
    4615			     C	; END OF INIT186.ASM
    4616				
    4617				;******************************************************************************
    4618				; Restart Address
    4619				;	org	01FF0h
    4620					ENTRY 	01FF0h			; this should put fill bytes before
    4621 1C7B  0375[                 1	        db      pad DUP(0) 
    4622					PUBLIC	POWER
    4623 1FF0				POWER:	jmpf	0FE00h, COLDST
    4624 1FF0  EA                    1	        db      0EAh; 
    4625 1FF1  1C00 R FE00           1	        dw      COLDST,0FE00h 
    4626				;	db	10 dup (0)
    4627				;******************************************************************************
    4628					ENTRY 	01FFFh
    4629 1FF5  000A[                 1	        db      pad DUP(0) 
    4630 1FFF				data_120:
    4631 1FFF  E6				db	0E6h			; checksum byte xref A.14EB, 1504
    4632 2000				code    ENDS
    4633				END POWER

Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-1


Macros:

		N a m e			Lines

ENTRY  . . . . . . . . . . . . .  	   8
JMPF . . . . . . . . . . . . . .  	   2

Segments and Groups:

                N a m e         	Length	 Align	Combine Class

CODE . . . . . . . . . . . . . .  	2000	PARA	NONE	
DATA . . . . . . . . . . . . . .  	0099	AT	0040	
DOSDIR . . . . . . . . . . . . .  	0200	AT	0050	

Symbols:            

                N a m e         	Type	 Value	 Attr

ADDBYT . . . . . . . . . . . . .  	L NEAR	1BC1	CODE

BADROM . . . . . . . . . . . . .  	L NEAR	1BAB	CODE
BANNER . . . . . . . . . . . . .  	L NEAR	0000	CODE
BEEP . . . . . . . . . . . . . .  	N PROC	05C3	CODE	Length = 0022
BEEP_1 . . . . . . . . . . . . .  	L NEAR	05DA	CODE
BLOCK_HIGH . . . . . . . . . . .  	L BYTE	0094	DATA
BLOCK_LOW  . . . . . . . . . . .  	L BYTE	0096	DATA
BLOCK_MIDDLE . . . . . . . . . .  	L BYTE	0095	DATA

C58253CTL  . . . . . . . . . . .  	NUMBER	0043	
C58255CMD  . . . . . . . . . . .  	NUMBER	0063	
C58255PA . . . . . . . . . . . .  	NUMBER	0060	
C58255PB . . . . . . . . . . . .  	NUMBER	0061	
C58255PC . . . . . . . . . . . .  	NUMBER	0062	
C5TIMER0 . . . . . . . . . . . .  	NUMBER	0040	
C5TIMER1 . . . . . . . . . . . .  	NUMBER	0041	
C5TIMER2 . . . . . . . . . . . .  	NUMBER	0042	
CDRAM  . . . . . . . . . . . . .  	NUMBER	FFE2	
CGACOLOR . . . . . . . . . . . .  	NUMBER	03D9	
CGAMODE  . . . . . . . . . . . .  	NUMBER	03D8	
CGASTAT  . . . . . . . . . . . .  	NUMBER	03DA	
CHKSUM . . . . . . . . . . . . .  	L NEAR	1BBC	CODE
CHK_01 . . . . . . . . . . . . .  	L NEAR	1BBF	CODE
CIA  . . . . . . . . . . . . . .  	ALIAS	 CIA_HDO		
CIA_HDO  . . . . . . . . . . . .  	ALIAS	 FALSE		
CMND_PTR . . . . . . . . . . . .  	L WORD	0082	DATA
CMND_SEG . . . . . . . . . . . .  	L WORD	0084	DATA
COLD2  . . . . . . . . . . . . .  	L NEAR	001F	CODE
COLDST . . . . . . . . . . . . .  	L NEAR	1C00	CODE
COMMAND_TABLE  . . . . . . . . .  	L WORD	0080	DATA
COMTO  . . . . . . . . . . . . .  	L BYTE	007C	DATA	Length = 0004
CONTROL_BYTE . . . . . . . . . .  	L BYTE	0098	DATA
CR . . . . . . . . . . . . . . .  	NUMBER	000D	
CSCR . . . . . . . . . . . . . .  	NUMBER	FFA0	

Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-2


D0CR . . . . . . . . . . . . . .  	NUMBER	0014	
D1CR . . . . . . . . . . . . . .  	NUMBER	0016	
DATA_120 . . . . . . . . . . . .  	L NEAR	1FFF	CODE
DATA_121E  . . . . . . . . . . .  	NUMBER	2000	
DATA_122E  . . . . . . . . . . .  	NUMBER	2001	
DATA_123E  . . . . . . . . . . .  	NUMBER	0049	
DATA_124 . . . . . . . . . . . .  	L NEAR	176D	CODE
DATA_49E . . . . . . . . . . . .  	NUMBER	0000	
DATA_50E . . . . . . . . . . . .  	NUMBER	03FE	
DATA_79  . . . . . . . . . . . .  	L NEAR	00EF	CODE
DATA_81  . . . . . . . . . . . .  	L NEAR	038B	CODE
DATA_82  . . . . . . . . . . . .  	L NEAR	050A	CODE
DATA_84  . . . . . . . . . . . .  	L NEAR	0BE0	CODE
DATA_85  . . . . . . . . . . . .  	L NEAR	0BE8	CODE
DATA_86  . . . . . . . . . . . .  	L NEAR	0C43	CODE
DATA_88  . . . . . . . . . . . .  	L NEAR	0DF2	CODE
DEBUGF . . . . . . . . . . . . .  	ALIAS	 TRUE		
DEFIRET  . . . . . . . . . . . .  	L NEAR	0596	CODE
DMA0 . . . . . . . . . . . . . .  	NUMBER	FFC0	
DMA1 . . . . . . . . . . . . . .  	NUMBER	FFD0	
DMACW  . . . . . . . . . . . . .  	NUMBER	000A	
DMADP  . . . . . . . . . . . . .  	NUMBER	0004	
DMADP1 . . . . . . . . . . . . .  	NUMBER	0006	
DMASP  . . . . . . . . . . . . .  	NUMBER	0000	
DMASP1 . . . . . . . . . . . . .  	NUMBER	0002	
DMATC  . . . . . . . . . . . . .  	NUMBER	0008	
DOCHECKSUM . . . . . . . . . . .  	N PROC	0140	CODE	Length = 0011
DSK_MOTOR_STAT . . . . . . . . .  	L BYTE	003F	DATA
DSK_MOTOR_TMR  . . . . . . . . .  	L BYTE	0040	DATA
DSK_RECAL_STAT . . . . . . . . .  	L BYTE	003E	DATA
DSK_RET_CODE . . . . . . . . . .  	L BYTE	0041	DATA
DYNHALT  . . . . . . . . . . . .  	L NEAR	0597	CODE

EDRAM  . . . . . . . . . . . . .  	NUMBER	FFE4	
EOIREG . . . . . . . . . . . . .  	NUMBER	0002	
EQUIP_BITS . . . . . . . . . . .  	L WORD	0010	DATA
ER_BIOS  . . . . . . . . . . . .  	NUMBER	0001	
ER_CRT . . . . . . . . . . . . .  	NUMBER	0004	
ER_MEM . . . . . . . . . . . . .  	NUMBER	0010	
ER_RAM . . . . . . . . . . . . .  	NUMBER	0002	
ER_ROM . . . . . . . . . . . . .  	NUMBER	0020	
EXPROM . . . . . . . . . . . . .  	L NEAR	1B6C	CODE

FALSE  . . . . . . . . . . . . .  	NUMBER	0000	
FDCD . . . . . . . . . . . . . .  	NUMBER	03F1	
FDCS . . . . . . . . . . . . . .  	ALIAS	 FDPORT		
FDMA . . . . . . . . . . . . . .  	NUMBER	03F2	
FDPORT . . . . . . . . . . . . .  	NUMBER	03F0	
FNDROM . . . . . . . . . . . . .  	L NEAR	1B70	CODE
FND_01 . . . . . . . . . . . . .  	L NEAR	1BB5	CODE

GEN_INT_OCCURED  . . . . . . . .  	L BYTE	006B	DATA
GEN_IO_PTR . . . . . . . . . . .  	L WORD	0067	DATA
GETPDPB  . . . . . . . . . . . .  	N PROC	0834	CODE	Length = 0011

Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-3


HD . . . . . . . . . . . . . . .  	L BYTE	0074	DATA	Length = 0004
HDO  . . . . . . . . . . . . . .  	ALIAS	 TRUE		

ICR  . . . . . . . . . . . . . .  	NUMBER	FF20	
INITTBL  . . . . . . . . . . . .  	L NEAR	1C29	CODE
INITTBL2 . . . . . . . . . . . .  	L NEAR	1C5F	CODE
INT00HANDLER . . . . . . . . . .  	L NEAR	0113	CODE
INT00V . . . . . . . . . . . . .  	NUMBER	0000	
INT01V . . . . . . . . . . . . .  	NUMBER	0004	
INT06HANDLER . . . . . . . . . .  	L NEAR	00E0	CODE
INT06V . . . . . . . . . . . . .  	NUMBER	0018	
INT08HANDLER . . . . . . . . . .  	L NEAR	0521	CODE
INT08V . . . . . . . . . . . . .  	NUMBER	0020	
INT09HANDLER . . . . . . . . . .  	L NEAR	0CF2	CODE
INT09V . . . . . . . . . . . . .  	NUMBER	0024	
INT0BHANDLER . . . . . . . . . .  	L NEAR	07E9	CODE
INT0BV . . . . . . . . . . . . .  	NUMBER	002C	
INT0CHANDLER . . . . . . . . . .  	L NEAR	0511	CODE
INT0CR . . . . . . . . . . . . .  	NUMBER	0018	
INT0CV . . . . . . . . . . . . .  	NUMBER	0030	
INT0DHANDLER . . . . . . . . . .  	L NEAR	0CE4	CODE
INT0DV . . . . . . . . . . . . .  	NUMBER	0034	
INT10FN  . . . . . . . . . . . .  	L NEAR	0FD1	CODE
INT10HANDLER . . . . . . . . . .  	L NEAR	0FF1	CODE
INT10V . . . . . . . . . . . . .  	NUMBER	0040	
INT11HANDLER . . . . . . . . . .  	L NEAR	01B4	CODE
INT11V . . . . . . . . . . . . .  	NUMBER	0044	
INT12HANDLER . . . . . . . . . .  	L NEAR	01A9	CODE
INT12V . . . . . . . . . . . . .  	NUMBER	0048	
INT13HANDLER . . . . . . . . . .  	L NEAR	061B	CODE
INT13V . . . . . . . . . . . . .  	NUMBER	004C	
INT14HANDLER . . . . . . . . . .  	L NEAR	02E2	CODE
INT14V . . . . . . . . . . . . .  	NUMBER	0050	
INT15V . . . . . . . . . . . . .  	NUMBER	0054	
INT16HANDLER . . . . . . . . . .  	L NEAR	0B27	CODE
INT16V . . . . . . . . . . . . .  	NUMBER	0058	
INT17HANDLER . . . . . . . . . .  	L NEAR	0244	CODE
INT17V . . . . . . . . . . . . .  	NUMBER	005C	
INT18V . . . . . . . . . . . . .  	NUMBER	0060	
INT19V . . . . . . . . . . . . .  	NUMBER	0064	
INT1AHANDLER . . . . . . . . . .  	L NEAR	0562	CODE
INT1AV . . . . . . . . . . . . .  	NUMBER	0068	
INT1BV . . . . . . . . . . . . .  	NUMBER	006C	
INT1CR . . . . . . . . . . . . .  	NUMBER	001A	
INT1CV . . . . . . . . . . . . .  	NUMBER	0070	
INT1DV . . . . . . . . . . . . .  	NUMBER	0074	
INT1EV . . . . . . . . . . . . .  	NUMBER	0078	
INT1FV . . . . . . . . . . . . .  	NUMBER	007C	
INT2CR . . . . . . . . . . . . .  	NUMBER	0018	
INT3CR . . . . . . . . . . . . .  	NUMBER	001A	
INTS . . . . . . . . . . . . . .  	NUMBER	03F2	
INT_1D . . . . . . . . . . . . .  	L NEAR	1020	CODE
INT_1E . . . . . . . . . . . . .  	L NEAR	0AC9	CODE
IPLLOC . . . . . . . . . . . . .  	NUMBER	7C00	
IRR  . . . . . . . . . . . . . .  	NUMBER	000E	
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-4


ISR  . . . . . . . . . . . . . .  	NUMBER	0010	
ISVR . . . . . . . . . . . . . .  	NUMBER	000C	
IVR  . . . . . . . . . . . . . .  	ALIAS	 ICR		

KEYBD_ALT_NUM  . . . . . . . . .  	L BYTE	0019	DATA
KEYBD_BUFF . . . . . . . . . . .  	L WORD	001E	DATA	Length = 0010
KEYBD_FLAGS_1  . . . . . . . . .  	L BYTE	0017	DATA
KEYBD_FLAGS_2  . . . . . . . . .  	L BYTE	0018	DATA
KEYBD_Q_HEAD . . . . . . . . . .  	L WORD	001A	DATA
KEYBD_Q_TAIL . . . . . . . . . .  	L WORD	001C	DATA

LF . . . . . . . . . . . . . . .  	NUMBER	000A	
LMCR . . . . . . . . . . . . . .  	NUMBER	0002	
LOCLOOP_100  . . . . . . . . . .  	L NEAR	088F	CODE
LOCLOOP_103  . . . . . . . . . .  	L NEAR	089D	CODE
LOCLOOP_105  . . . . . . . . . .  	L NEAR	08C7	CODE
LOCLOOP_106  . . . . . . . . . .  	L NEAR	08D5	CODE
LOCLOOP_114  . . . . . . . . . .  	L NEAR	09D3	CODE
LOCLOOP_118  . . . . . . . . . .  	L NEAR	0A16	CODE
LOCLOOP_123  . . . . . . . . . .  	L NEAR	0A38	CODE
LOCLOOP_125  . . . . . . . . . .  	L NEAR	0A61	CODE
LOCLOOP_137  . . . . . . . . . .  	L NEAR	0B78	CODE
LOCLOOP_138  . . . . . . . . . .  	L NEAR	0B89	CODE
LOCLOOP_14 . . . . . . . . . . .  	L NEAR	0202	CODE
LOCLOOP_17 . . . . . . . . . . .  	L NEAR	0268	CODE
LOCLOOP_190  . . . . . . . . . .  	L NEAR	0F9C	CODE
LOCLOOP_191  . . . . . . . . . .  	L NEAR	0FA5	CODE
LOCLOOP_196  . . . . . . . . . .  	L NEAR	10BB	CODE
LOCLOOP_229  . . . . . . . . . .  	L NEAR	1306	CODE
LOCLOOP_233  . . . . . . . . . .  	L NEAR	132A	CODE
LOCLOOP_236  . . . . . . . . . .  	L NEAR	134A	CODE
LOCLOOP_259  . . . . . . . . . .  	L NEAR	14DF	CODE
LOCLOOP_264  . . . . . . . . . .  	L NEAR	1512	CODE
LOCLOOP_27 . . . . . . . . . . .  	L NEAR	0341	CODE
LOCLOOP_276  . . . . . . . . . .  	L NEAR	15EC	CODE
LOCLOOP_31 . . . . . . . . . . .  	L NEAR	03B6	CODE
LOCLOOP_33 . . . . . . . . . . .  	L NEAR	03CC	CODE
LOCLOOP_36 . . . . . . . . . . .  	L NEAR	03F5	CODE
LOCLOOP_50 . . . . . . . . . . .  	L NEAR	046C	CODE
LOCLOOP_52 . . . . . . . . . . .  	L NEAR	04F3	CODE
LOCLOOP_61 . . . . . . . . . . .  	L NEAR	05AB	CODE
LOCLOOP_63 . . . . . . . . . . .  	L NEAR	05B6	CODE
LOCLOOP_64 . . . . . . . . . . .  	L NEAR	05BC	CODE
LOCLOOP_65 . . . . . . . . . . .  	L NEAR	05BE	CODE
LOCLOOP_7  . . . . . . . . . . .  	L NEAR	0148	CODE
LOCLOOP_9  . . . . . . . . . . .  	L NEAR	015E	CODE
LOCLOOP_93 . . . . . . . . . . .  	L NEAR	080F	CODE
LOCLOOP_96 . . . . . . . . . . .  	L NEAR	0821	CODE
LOC_10 . . . . . . . . . . . . .  	L NEAR	0168	CODE
LOC_101  . . . . . . . . . . . .  	L NEAR	0895	CODE
LOC_104  . . . . . . . . . . . .  	L NEAR	08BC	CODE
LOC_107  . . . . . . . . . . . .  	L NEAR	08E0	CODE
LOC_108  . . . . . . . . . . . .  	L NEAR	0906	CODE
LOC_109  . . . . . . . . . . . .  	L NEAR	0929	CODE
LOC_11 . . . . . . . . . . . . .  	L NEAR	0180	CODE
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-5


LOC_110  . . . . . . . . . . . .  	L NEAR	094C	CODE
LOC_111  . . . . . . . . . . . .  	L NEAR	096A	CODE
LOC_112  . . . . . . . . . . . .  	L NEAR	098C	CODE
LOC_113  . . . . . . . . . . . .  	L NEAR	09A6	CODE
LOC_115  . . . . . . . . . . . .  	L NEAR	09F9	CODE
LOC_116  . . . . . . . . . . . .  	L NEAR	0A02	CODE
LOC_117  . . . . . . . . . . . .  	L NEAR	0A11	CODE
LOC_119  . . . . . . . . . . . .  	L NEAR	0A1D	CODE
LOC_12 . . . . . . . . . . . . .  	L NEAR	01D9	CODE
LOC_120  . . . . . . . . . . . .  	L NEAR	0A22	CODE
LOC_121  . . . . . . . . . . . .  	L NEAR	0A27	CODE
LOC_122  . . . . . . . . . . . .  	L NEAR	0A2E	CODE
LOC_124  . . . . . . . . . . . .  	L NEAR	0A48	CODE
LOC_126  . . . . . . . . . . . .  	L NEAR	0A81	CODE
LOC_127  . . . . . . . . . . . .  	L NEAR	0A82	CODE
LOC_128  . . . . . . . . . . . .  	L NEAR	0A8B	CODE
LOC_129  . . . . . . . . . . . .  	L NEAR	0A9B	CODE
LOC_13 . . . . . . . . . . . . .  	L NEAR	01F4	CODE
LOC_130  . . . . . . . . . . . .  	L NEAR	0A9F	CODE
LOC_131  . . . . . . . . . . . .  	L NEAR	0AB0	CODE
LOC_132  . . . . . . . . . . . .  	L NEAR	0AC6	CODE
LOC_134  . . . . . . . . . . . .  	L NEAR	0B3E	CODE
LOC_135  . . . . . . . . . . . .  	L NEAR	0B57	CODE
LOC_136  . . . . . . . . . . . .  	L NEAR	0B68	CODE
LOC_139  . . . . . . . . . . . .  	L NEAR	0BA6	CODE
LOC_141  . . . . . . . . . . . .  	L NEAR	0D1C	CODE
LOC_142  . . . . . . . . . . . .  	L NEAR	0D2F	CODE
LOC_144  . . . . . . . . . . . .  	L NEAR	0D48	CODE
LOC_145  . . . . . . . . . . . .  	L NEAR	0D5D	CODE
LOC_146  . . . . . . . . . . . .  	L NEAR	0D6B	CODE
LOC_147  . . . . . . . . . . . .  	L NEAR	0D71	CODE
LOC_148  . . . . . . . . . . . .  	L NEAR	0D78	CODE
LOC_149  . . . . . . . . . . . .  	L NEAR	0D90	CODE
LOC_15 . . . . . . . . . . . . .  	L NEAR	025B	CODE
LOC_150  . . . . . . . . . . . .  	L NEAR	0DAF	CODE
LOC_151  . . . . . . . . . . . .  	L NEAR	0DB7	CODE
LOC_152  . . . . . . . . . . . .  	L NEAR	0DCB	CODE
LOC_153  . . . . . . . . . . . .  	L NEAR	0DD4	CODE
LOC_154  . . . . . . . . . . . .  	L NEAR	0DDE	CODE
LOC_155  . . . . . . . . . . . .  	L NEAR	0E16	CODE
LOC_156  . . . . . . . . . . . .  	L NEAR	0E1F	CODE
LOC_157  . . . . . . . . . . . .  	L NEAR	0E3B	CODE
LOC_158  . . . . . . . . . . . .  	L NEAR	0E4C	CODE
LOC_159  . . . . . . . . . . . .  	L NEAR	0E5C	CODE
LOC_16 . . . . . . . . . . . . .  	L NEAR	0261	CODE
LOC_160  . . . . . . . . . . . .  	L NEAR	0E60	CODE
LOC_161  . . . . . . . . . . . .  	L NEAR	0E63	CODE
LOC_162  . . . . . . . . . . . .  	L NEAR	0E6D	CODE
LOC_163  . . . . . . . . . . . .  	L NEAR	0E90	CODE
LOC_164  . . . . . . . . . . . .  	L NEAR	0EA1	CODE
LOC_165  . . . . . . . . . . . .  	L NEAR	0EAB	CODE
LOC_166  . . . . . . . . . . . .  	L NEAR	0EB5	CODE
LOC_167  . . . . . . . . . . . .  	L NEAR	0EBF	CODE
LOC_168  . . . . . . . . . . . .  	L NEAR	0EC5	CODE
LOC_169  . . . . . . . . . . . .  	L NEAR	0EDA	CODE
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-6


LOC_170  . . . . . . . . . . . .  	L NEAR	0EE1	CODE
LOC_171  . . . . . . . . . . . .  	L NEAR	0EEB	CODE
LOC_172  . . . . . . . . . . . .  	L NEAR	0EF0	CODE
LOC_173  . . . . . . . . . . . .  	L NEAR	0EFE	CODE
LOC_174  . . . . . . . . . . . .  	L NEAR	0F0D	CODE
LOC_175  . . . . . . . . . . . .  	L NEAR	0F12	CODE
LOC_176  . . . . . . . . . . . .  	L NEAR	0F17	CODE
LOC_177  . . . . . . . . . . . .  	L NEAR	0F1E	CODE
LOC_178  . . . . . . . . . . . .  	L NEAR	0F25	CODE
LOC_179  . . . . . . . . . . . .  	L NEAR	0F2D	CODE
LOC_18 . . . . . . . . . . . . .  	L NEAR	0279	CODE
LOC_180  . . . . . . . . . . . .  	L NEAR	0F30	CODE
LOC_181  . . . . . . . . . . . .  	L NEAR	0F34	CODE
LOC_182  . . . . . . . . . . . .  	L NEAR	0F3D	CODE
LOC_183  . . . . . . . . . . . .  	L NEAR	0F57	CODE
LOC_184  . . . . . . . . . . . .  	L NEAR	0F5A	CODE
LOC_185  . . . . . . . . . . . .  	L NEAR	0F64	CODE
LOC_186  . . . . . . . . . . . .  	L NEAR	0F7C	CODE
LOC_187  . . . . . . . . . . . .  	L NEAR	0F82	CODE
LOC_188  . . . . . . . . . . . .  	L NEAR	0F84	CODE
LOC_189  . . . . . . . . . . . .  	L NEAR	0F95	CODE
LOC_19 . . . . . . . . . . . . .  	L NEAR	028C	CODE
LOC_192  . . . . . . . . . . . .  	L NEAR	100C	CODE
LOC_193  . . . . . . . . . . . .  	L NEAR	1078	CODE
LOC_194  . . . . . . . . . . . .  	L NEAR	1084	CODE
LOC_195  . . . . . . . . . . . .  	L NEAR	10B8	CODE
LOC_197  . . . . . . . . . . . .  	L NEAR	10E1	CODE
LOC_198  . . . . . . . . . . . .  	L NEAR	10E4	CODE
LOC_199  . . . . . . . . . . . .  	L NEAR	1132	CODE
LOC_20 . . . . . . . . . . . . .  	L NEAR	02AB	CODE
LOC_200  . . . . . . . . . . . .  	L NEAR	1136	CODE
LOC_201  . . . . . . . . . . . .  	L NEAR	1139	CODE
LOC_202  . . . . . . . . . . . .  	L NEAR	113E	CODE
LOC_203  . . . . . . . . . . . .  	L NEAR	115F	CODE
LOC_204  . . . . . . . . . . . .  	L NEAR	1176	CODE
LOC_205  . . . . . . . . . . . .  	L NEAR	1189	CODE
LOC_206  . . . . . . . . . . . .  	L NEAR	119F	CODE
LOC_207  . . . . . . . . . . . .  	L NEAR	11C3	CODE
LOC_208  . . . . . . . . . . . .  	L NEAR	11D8	CODE
LOC_209  . . . . . . . . . . . .  	L NEAR	11DF	CODE
LOC_21 . . . . . . . . . . . . .  	L NEAR	02B7	CODE
LOC_210  . . . . . . . . . . . .  	L NEAR	11E9	CODE
LOC_211  . . . . . . . . . . . .  	L NEAR	120B	CODE
LOC_212  . . . . . . . . . . . .  	L NEAR	121A	CODE
LOC_213  . . . . . . . . . . . .  	L NEAR	1228	CODE
LOC_214  . . . . . . . . . . . .  	L NEAR	1233	CODE
LOC_215  . . . . . . . . . . . .  	L NEAR	1236	CODE
LOC_216  . . . . . . . . . . . .  	L NEAR	123F	CODE
LOC_217  . . . . . . . . . . . .  	L NEAR	1252	CODE
LOC_218  . . . . . . . . . . . .  	L NEAR	1255	CODE
LOC_219  . . . . . . . . . . . .  	L NEAR	1290	CODE
LOC_22 . . . . . . . . . . . . .  	L NEAR	0304	CODE
LOC_220  . . . . . . . . . . . .  	L NEAR	12A0	CODE
LOC_221  . . . . . . . . . . . .  	L NEAR	12AE	CODE
LOC_222  . . . . . . . . . . . .  	L NEAR	12B9	CODE
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-7


LOC_223  . . . . . . . . . . . .  	L NEAR	12BC	CODE
LOC_224  . . . . . . . . . . . .  	L NEAR	12C8	CODE
LOC_225  . . . . . . . . . . . .  	L NEAR	12CC	CODE
LOC_226  . . . . . . . . . . . .  	L NEAR	12D9	CODE
LOC_227  . . . . . . . . . . . .  	L NEAR	12E7	CODE
LOC_228  . . . . . . . . . . . .  	L NEAR	12ED	CODE
LOC_23 . . . . . . . . . . . . .  	L NEAR	030B	CODE
LOC_230  . . . . . . . . . . . .  	L NEAR	130C	CODE
LOC_231  . . . . . . . . . . . .  	L NEAR	1312	CODE
LOC_232  . . . . . . . . . . . .  	L NEAR	131F	CODE
LOC_234  . . . . . . . . . . . .  	L NEAR	1334	CODE
LOC_235  . . . . . . . . . . . .  	L NEAR	1341	CODE
LOC_237  . . . . . . . . . . . .  	L NEAR	1353	CODE
LOC_238  . . . . . . . . . . . .  	L NEAR	1364	CODE
LOC_239  . . . . . . . . . . . .  	L NEAR	137C	CODE
LOC_24 . . . . . . . . . . . . .  	L NEAR	0312	CODE
LOC_240  . . . . . . . . . . . .  	L NEAR	1383	CODE
LOC_241  . . . . . . . . . . . .  	L NEAR	139A	CODE
LOC_242  . . . . . . . . . . . .  	L NEAR	13B2	CODE
LOC_243  . . . . . . . . . . . .  	L NEAR	13BC	CODE
LOC_244  . . . . . . . . . . . .  	L NEAR	13CA	CODE
LOC_245  . . . . . . . . . . . .  	L NEAR	13E8	CODE
LOC_246  . . . . . . . . . . . .  	L NEAR	1400	CODE
LOC_247  . . . . . . . . . . . .  	L NEAR	140F	CODE
LOC_248  . . . . . . . . . . . .  	L NEAR	1411	CODE
LOC_249  . . . . . . . . . . . .  	L NEAR	141F	CODE
LOC_25 . . . . . . . . . . . . .  	L NEAR	0319	CODE
LOC_250  . . . . . . . . . . . .  	L NEAR	1423	CODE
LOC_251  . . . . . . . . . . . .  	L NEAR	1443	CODE
LOC_252  . . . . . . . . . . . .  	L NEAR	145F	CODE
LOC_253  . . . . . . . . . . . .  	L NEAR	146E	CODE
LOC_254  . . . . . . . . . . . .  	L NEAR	1470	CODE
LOC_255  . . . . . . . . . . . .  	L NEAR	147F	CODE
LOC_256  . . . . . . . . . . . .  	L NEAR	14AD	CODE
LOC_257  . . . . . . . . . . . .  	L NEAR	14C0	CODE
LOC_258  . . . . . . . . . . . .  	L NEAR	14CF	CODE
LOC_26 . . . . . . . . . . . . .  	L NEAR	0326	CODE
LOC_260  . . . . . . . . . . . .  	L NEAR	14E3	CODE
LOC_261  . . . . . . . . . . . .  	L NEAR	14EB	CODE
LOC_262  . . . . . . . . . . . .  	L NEAR	14FF	CODE
LOC_263  . . . . . . . . . . . .  	L NEAR	150B	CODE
LOC_265  . . . . . . . . . . . .  	L NEAR	1516	CODE
LOC_266  . . . . . . . . . . . .  	L NEAR	1528	CODE
LOC_267  . . . . . . . . . . . .  	L NEAR	1544	CODE
LOC_268  . . . . . . . . . . . .  	L NEAR	155F	CODE
LOC_269  . . . . . . . . . . . .  	L NEAR	1574	CODE
LOC_270  . . . . . . . . . . . .  	L NEAR	158C	CODE
LOC_271  . . . . . . . . . . . .  	L NEAR	1590	CODE
LOC_272  . . . . . . . . . . . .  	L NEAR	15A2	CODE
LOC_273  . . . . . . . . . . . .  	L NEAR	15AF	CODE
LOC_274  . . . . . . . . . . . .  	L NEAR	15B4	CODE
LOC_275  . . . . . . . . . . . .  	L NEAR	15DD	CODE
LOC_277  . . . . . . . . . . . .  	L NEAR	1601	CODE
LOC_278  . . . . . . . . . . . .  	L NEAR	1625	CODE
LOC_279  . . . . . . . . . . . .  	L NEAR	162B	CODE
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-8


LOC_28 . . . . . . . . . . . . .  	L NEAR	0365	CODE
LOC_280  . . . . . . . . . . . .  	L NEAR	164E	CODE
LOC_281  . . . . . . . . . . . .  	L NEAR	167F	CODE
LOC_282  . . . . . . . . . . . .  	L NEAR	1692	CODE
LOC_283  . . . . . . . . . . . .  	L NEAR	1698	CODE
LOC_284  . . . . . . . . . . . .  	L NEAR	16A6	CODE
LOC_285  . . . . . . . . . . . .  	L NEAR	16A8	CODE
LOC_286  . . . . . . . . . . . .  	L NEAR	16AC	CODE
LOC_287  . . . . . . . . . . . .  	L NEAR	16AE	CODE
LOC_288  . . . . . . . . . . . .  	L NEAR	16B2	CODE
LOC_289  . . . . . . . . . . . .  	L NEAR	16BB	CODE
LOC_29 . . . . . . . . . . . . .  	L NEAR	0368	CODE
LOC_290  . . . . . . . . . . . .  	L NEAR	16BF	CODE
LOC_291  . . . . . . . . . . . .  	L NEAR	16C6	CODE
LOC_292  . . . . . . . . . . . .  	L NEAR	16D5	CODE
LOC_293  . . . . . . . . . . . .  	L NEAR	1714	CODE
LOC_294  . . . . . . . . . . . .  	L NEAR	173B	CODE
LOC_295  . . . . . . . . . . . .  	L NEAR	1747	CODE
LOC_296  . . . . . . . . . . . .  	L NEAR	1759	CODE
LOC_297  . . . . . . . . . . . .  	L NEAR	175B	CODE
LOC_298  . . . . . . . . . . . .  	L NEAR	1765	CODE
LOC_299  . . . . . . . . . . . .  	L NEAR	17A0	CODE
LOC_3  . . . . . . . . . . . . .  	L NEAR	0038	CODE
LOC_30 . . . . . . . . . . . . .  	L NEAR	03AB	CODE
LOC_300  . . . . . . . . . . . .  	L NEAR	1877	CODE
LOC_302  . . . . . . . . . . . .  	L NEAR	18FB	CODE
LOC_304  . . . . . . . . . . . .  	L NEAR	1903	CODE
LOC_305  . . . . . . . . . . . .  	L NEAR	1935	CODE
LOC_306  . . . . . . . . . . . .  	L NEAR	1946	CODE
LOC_308  . . . . . . . . . . . .  	L NEAR	1A6F	CODE
LOC_309  . . . . . . . . . . . .  	L NEAR	1C0A	CODE
LOC_310  . . . . . . . . . . . .  	L NEAR	1C15	CODE
LOC_311  . . . . . . . . . . . .  	L NEAR	1C1B	CODE
LOC_312  . . . . . . . . . . . .  	L NEAR	1C26	CODE
LOC_32 . . . . . . . . . . . . .  	L NEAR	03C8	CODE
LOC_34 . . . . . . . . . . . . .  	L NEAR	03DE	CODE
LOC_35 . . . . . . . . . . . . .  	L NEAR	03E6	CODE
LOC_37 . . . . . . . . . . . . .  	L NEAR	0400	CODE
LOC_38 . . . . . . . . . . . . .  	L NEAR	0405	CODE
LOC_39 . . . . . . . . . . . . .  	L NEAR	0413	CODE
LOC_4  . . . . . . . . . . . . .  	L NEAR	004E	CODE
LOC_40 . . . . . . . . . . . . .  	L NEAR	0429	CODE
LOC_41 . . . . . . . . . . . . .  	L NEAR	0430	CODE
LOC_42 . . . . . . . . . . . . .  	L NEAR	0437	CODE
LOC_43 . . . . . . . . . . . . .  	L NEAR	043E	CODE
LOC_44 . . . . . . . . . . . . .  	L NEAR	0445	CODE
LOC_45 . . . . . . . . . . . . .  	L NEAR	044C	CODE
LOC_47 . . . . . . . . . . . . .  	L NEAR	0454	CODE
LOC_48 . . . . . . . . . . . . .  	L NEAR	0465	CODE
LOC_49 . . . . . . . . . . . . .  	L NEAR	0468	CODE
LOC_5  . . . . . . . . . . . . .  	L NEAR	0058	CODE
LOC_51 . . . . . . . . . . . . .  	L NEAR	04B8	CODE
LOC_53 . . . . . . . . . . . . .  	L NEAR	0533	CODE
LOC_54 . . . . . . . . . . . . .  	L NEAR	0553	CODE
LOC_55 . . . . . . . . . . . . .  	L NEAR	055C	CODE
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-9


LOC_56 . . . . . . . . . . . . .  	L NEAR	0573	CODE
LOC_57 . . . . . . . . . . . . .  	L NEAR	0575	CODE
LOC_58 . . . . . . . . . . . . .  	L NEAR	0587	CODE
LOC_59 . . . . . . . . . . . . .  	L NEAR	059A	CODE
LOC_6  . . . . . . . . . . . . .  	L NEAR	0098	CODE
LOC_60 . . . . . . . . . . . . .  	L NEAR	05A6	CODE
LOC_62 . . . . . . . . . . . . .  	L NEAR	05B1	CODE
LOC_67 . . . . . . . . . . . . .  	L NEAR	05E5	CODE
LOC_69 . . . . . . . . . . . . .  	L NEAR	0663	CODE
LOC_70 . . . . . . . . . . . . .  	L NEAR	0674	CODE
LOC_71 . . . . . . . . . . . . .  	L NEAR	067B	CODE
LOC_72 . . . . . . . . . . . . .  	L NEAR	0682	CODE
LOC_73 . . . . . . . . . . . . .  	L NEAR	0689	CODE
LOC_74 . . . . . . . . . . . . .  	L NEAR	068F	CODE
LOC_75 . . . . . . . . . . . . .  	L NEAR	06BC	CODE
LOC_76 . . . . . . . . . . . . .  	L NEAR	06C0	CODE
LOC_77 . . . . . . . . . . . . .  	L NEAR	06C7	CODE
LOC_78 . . . . . . . . . . . . .  	L NEAR	06CE	CODE
LOC_79 . . . . . . . . . . . . .  	L NEAR	06F2	CODE
LOC_80 . . . . . . . . . . . . .  	L NEAR	0714	CODE
LOC_81 . . . . . . . . . . . . .  	L NEAR	071E	CODE
LOC_82 . . . . . . . . . . . . .  	L NEAR	0728	CODE
LOC_83 . . . . . . . . . . . . .  	L NEAR	073C	CODE
LOC_84 . . . . . . . . . . . . .  	L NEAR	075E	CODE
LOC_85 . . . . . . . . . . . . .  	L NEAR	078F	CODE
LOC_86 . . . . . . . . . . . . .  	L NEAR	0792	CODE
LOC_87 . . . . . . . . . . . . .  	L NEAR	07CF	CODE
LOC_88 . . . . . . . . . . . . .  	L NEAR	07D1	CODE
LOC_90 . . . . . . . . . . . . .  	L NEAR	07D9	CODE
LOC_91 . . . . . . . . . . . . .  	L NEAR	07E3	CODE
LOC_92 . . . . . . . . . . . . .  	L NEAR	0808	CODE
LOC_94 . . . . . . . . . . . . .  	L NEAR	0816	CODE
LOC_95 . . . . . . . . . . . . .  	L NEAR	081F	CODE
LOC_97 . . . . . . . . . . . . .  	L NEAR	082A	CODE
LOC_98 . . . . . . . . . . . . .  	L NEAR	086A	CODE
LOC_99 . . . . . . . . . . . . .  	L NEAR	0888	CODE
LOC_RET_102  . . . . . . . . . .  	L NEAR	0897	CODE
LOC_RET_112  . . . . . . . . . .  	L NEAR	09A5	CODE
LOC_RET_140  . . . . . . . . . .  	L NEAR	0BDF	CODE
LOC_RET_46 . . . . . . . . . . .  	L NEAR	0453	CODE
LOC_RET_68 . . . . . . . . . . .  	L NEAR	05F5	CODE
LOC_RET_89 . . . . . . . . . . .  	L NEAR	07D8	CODE
LPENCLR  . . . . . . . . . . . .  	NUMBER	03DB	
LPENSET  . . . . . . . . . . . .  	NUMBER	03DC	
LPTTO  . . . . . . . . . . . . .  	L BYTE	0078	DATA	Length = 0004

MAIN_RAM_SIZE  . . . . . . . . .  	L WORD	0013	DATA
MASKR  . . . . . . . . . . . . .  	NUMBER	0008	
MAXCOLS  . . . . . . . . . . . .  	L NEAR	1068	CODE
MC6845R0 . . . . . . . . . . . .  	NUMBER	03D0	
MC6845R1 . . . . . . . . . . . .  	NUMBER	03D1	
MC6845R2 . . . . . . . . . . . .  	NUMBER	03D2	
MC6845R3 . . . . . . . . . . . .  	NUMBER	03D3	
MC6845R4 . . . . . . . . . . . .  	NUMBER	03D4	
MC6845R5 . . . . . . . . . . . .  	NUMBER	03D5	
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-10


MC6845R6 . . . . . . . . . . . .  	NUMBER	03D6	
MC6845R7 . . . . . . . . . . . .  	NUMBER	03D7	
MDRAM  . . . . . . . . . . . . .  	NUMBER	FFE0	
MFG_TEST . . . . . . . . . . . .  	L BYTE	0012	DATA
MMCS . . . . . . . . . . . . . .  	NUMBER	0006	
MODES  . . . . . . . . . . . . .  	L NEAR	1070	CODE
MPCS . . . . . . . . . . . . . .  	NUMBER	0008	
MSG1 . . . . . . . . . . . . . .  	L NEAR	00C9	CODE
MSG2 . . . . . . . . . . . . . .  	L NEAR	00FA	CODE
MSG3 . . . . . . . . . . . . . .  	L NEAR	0126	CODE
MSG4 . . . . . . . . . . . . . .  	L NEAR	0185	CODE
MSG5 . . . . . . . . . . . . . .  	L NEAR	0BBA	CODE

NEC_STAT . . . . . . . . . . . .  	L BYTE	0042	DATA	Length = 0007
NXTROM . . . . . . . . . . . . .  	L NEAR	1BB1	CODE

PACS . . . . . . . . . . . . . .  	NUMBER	0004	
PAD  . . . . . . . . . . . . . .  	NUMBER	000A	
PCRBASE  . . . . . . . . . . . .  	NUMBER	FF00	
PDCOM  . . . . . . . . . . . . .  	NUMBER	FFF0	
PENOFF . . . . . . . . . . . . .  	L NEAR	16CD	CODE
PMR  . . . . . . . . . . . . . .  	NUMBER	000A	
POLLR  . . . . . . . . . . . . .  	NUMBER	0004	
POLLS  . . . . . . . . . . . . .  	NUMBER	0006	
POWER  . . . . . . . . . . . . .  	L NEAR	1FF0	CODE	Global
PRN_PORT_1 . . . . . . . . . . .  	L WORD	0008	DATA	Length = 0004
PRTZSTR  . . . . . . . . . . . .  	N PROC	05E5	CODE	Length = 0011

READ_WRITE_BLOCK . . . . . . . .  	L BYTE	0091	DATA
REGENL . . . . . . . . . . . . .  	L NEAR	1060	CODE
ROMSEARCH  . . . . . . . . . . .  	ALIAS	 TRUE		
RR . . . . . . . . . . . . . . .  	NUMBER	FFFE	
RS232_PORT_1 . . . . . . . . . .  	L WORD	0000	DATA	Length = 0004

SCOUNT . . . . . . . . . . . . .  	L BYTE	0097	DATA
SCRATCH1 . . . . . . . . . . . .  	L BYTE	0015	DATA
SCSI . . . . . . . . . . . . . .  	ALIAS	 TRUE		
SCSI_CMND  . . . . . . . . . . .  	L BYTE	0093	DATA
SCSI_CMND_CNT  . . . . . . . . .  	L BYTE	0092	DATA
SCSI_MSG_FLAG  . . . . . . . . .  	L BYTE	0090	DATA
SCSI_MSG_IN  . . . . . . . . . .  	L BYTE	008E	DATA
SCSI_MSG_OUT . . . . . . . . . .  	L BYTE	008F	DATA
SCSI_OPTIONS . . . . . . . . . .  	NUMBER	0020	
SCSI_STATUS_IN . . . . . . . . .  	L BYTE	008C	DATA
SCSI_STATUS_OUT  . . . . . . . .  	L BYTE	008D	DATA
SDMA_OFF . . . . . . . . . . . .  	L WORD	0088	DATA
SDMA_SEG . . . . . . . . . . . .  	L WORD	008A	DATA
SIGNBIT  . . . . . . . . . . . .  	L BYTE	0071	DATA
SUB_11 . . . . . . . . . . . . .  	N PROC	05F6	CODE	Length = 0025
SUB_12 . . . . . . . . . . . . .  	N PROC	0649	CODE	Length = 01A0
SUB_13 . . . . . . . . . . . . .  	N PROC	0808	CODE	Length = 002C
SUB_15 . . . . . . . . . . . . .  	N PROC	0845	CODE	Length = 0053
SUB_16 . . . . . . . . . . . . .  	N PROC	0898	CODE	Length = 002B
SUB_17 . . . . . . . . . . . . .  	N PROC	08C3	CODE	Length = 000A
SUB_18 . . . . . . . . . . . . .  	N PROC	08E7	CODE	Length = 00A5
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-11


SUB_19 . . . . . . . . . . . . .  	N PROC	09AD	CODE	Length = 0009
SUB_2  . . . . . . . . . . . . .  	N PROC	01BF	CODE	Length = 0065
SUB_20 . . . . . . . . . . . . .  	N PROC	09B6	CODE	Length = 0009
SUB_21 . . . . . . . . . . . . .  	N PROC	09BF	CODE	Length = 0049
SUB_22 . . . . . . . . . . . . .  	N PROC	0A08	CODE	Length = 0044
SUB_23 . . . . . . . . . . . . .  	N PROC	0A4C	CODE	Length = 000D
SUB_24 . . . . . . . . . . . . .  	N PROC	0A59	CODE	Length = 002E
SUB_25 . . . . . . . . . . . . .  	N PROC	0A87	CODE	Length = 0017
SUB_26 . . . . . . . . . . . . .  	N PROC	0A9E	CODE	Length = 0014
SUB_27 . . . . . . . . . . . . .  	N PROC	0AB2	CODE	Length = 0017
SUB_28 . . . . . . . . . . . . .  	N PROC	0AD4	CODE	Length = 0053
SUB_29 . . . . . . . . . . . . .  	N PROC	0B6E	CODE	Length = 004C
SUB_3  . . . . . . . . . . . . .  	N PROC	0224	CODE	Length = 0020
SUB_30 . . . . . . . . . . . . .  	N PROC	0BD3	CODE	Length = 000D
SUB_31 . . . . . . . . . . . . .  	N PROC	0F8C	CODE	Length = 0025
SUB_32 . . . . . . . . . . . . .  	N PROC	0FB1	CODE	Length = 0020
SUB_33 . . . . . . . . . . . . .  	N PROC	1149	CODE	Length = 0016
SUB_34 . . . . . . . . . . . . .  	N PROC	1178	CODE	Length = 0011
SUB_35 . . . . . . . . . . . . .  	N PROC	11FA	CODE	Length = 0011
SUB_36 . . . . . . . . . . . . .  	N PROC	1259	CODE	Length = 0027
SUB_37 . . . . . . . . . . . . .  	N PROC	1280	CODE	Length = 0009
SUB_38 . . . . . . . . . . . . .  	N PROC	1289	CODE	Length = 0007
SUB_39 . . . . . . . . . . . . .  	N PROC	12F6	CODE	Length = 001C
SUB_4  . . . . . . . . . . . . .  	N PROC	02BC	CODE	Length = 0026
SUB_40 . . . . . . . . . . . . .  	N PROC	1387	CODE	Length = 0043
SUB_41 . . . . . . . . . . . . .  	N PROC	1483	CODE	Length = 0019
SUB_42 . . . . . . . . . . . . .  	N PROC	149C	CODE	Length = 0011
SUB_43 . . . . . . . . . . . . .  	N PROC	15E3	CODE	Length = 0015
SUB_44 . . . . . . . . . . . . .  	N PROC	15F8	CODE	Length = 0023
SUB_45 . . . . . . . . . . . . .  	N PROC	161B	CODE	Length = 001D
SUB_46 . . . . . . . . . . . . .  	N PROC	1638	CODE	Length = 0016
SUB_47 . . . . . . . . . . . . .  	L NEAR	163B	CODE
SUB_5  . . . . . . . . . . . . .  	N PROC	0420	CODE	Length = 0034
SUB_6  . . . . . . . . . . . . .  	N PROC	0468	CODE	Length = 000B
SUB_7  . . . . . . . . . . . . .  	N PROC	0473	CODE	Length = 0042
SUB_8  . . . . . . . . . . . . .  	N PROC	04B5	CODE	Length = 0055
SYSBOOT  . . . . . . . . . . . .  	L NEAR	0151	CODE

T0CR . . . . . . . . . . . . . .  	NUMBER	0012	
TIMER_HI . . . . . . . . . . . .  	L WORD	006E	DATA
TIMER_LOW  . . . . . . . . . . .  	L WORD	006C	DATA
TIMER_ROLLED . . . . . . . . . .  	L BYTE	0070	DATA
TM0CR  . . . . . . . . . . . . .  	NUMBER	FF50	
TM1CR  . . . . . . . . . . . . .  	NUMBER	FF58	
TM2CR  . . . . . . . . . . . . .  	NUMBER	FF60	
TMRCA  . . . . . . . . . . . . .  	NUMBER	0002	
TMRCB  . . . . . . . . . . . . .  	NUMBER	0004	
TMRCR  . . . . . . . . . . . . .  	NUMBER	0000	
TMRCW  . . . . . . . . . . . . .  	NUMBER	0006	
TRANS_CNT  . . . . . . . . . . .  	L WORD	0086	DATA
TRUE . . . . . . . . . . . . . .  	NUMBER	00FF	

UMCR . . . . . . . . . . . . . .  	ALIAS	 CSCR		

VIDEO_BUF_SIZ  . . . . . . . . .  	L WORD	004C	DATA
Microsoft (R) Macro Assembler Version 5.10A                 10/28/24 09:18:5
LDP THUNDER REV 1.0 10/21/85 Color Magic ROM                Symbols-12


VIDEO_COLOR  . . . . . . . . . .  	L BYTE	0066	DATA
VIDEO_COLUMNS  . . . . . . . . .  	L WORD	004A	DATA
VIDEO_MODE . . . . . . . . . . .  	L BYTE	0049	DATA
VIDEO_MODE_REG . . . . . . . . .  	L BYTE	0065	DATA
VIDEO_PAGE . . . . . . . . . . .  	L BYTE	0062	DATA
VIDEO_PORT . . . . . . . . . . .  	L WORD	0063	DATA
VIDEO_SEGMENT  . . . . . . . . .  	L WORD	004E	DATA
VID_CURS_MODE  . . . . . . . . .  	L WORD	0060	DATA
VID_CURS_POS0  . . . . . . . . .  	L WORD	0050	DATA	Length = 0008

WARMBOOT . . . . . . . . . . . .  	L WORD	0072	DATA
WD100X . . . . . . . . . . . . .  	ALIAS	 FALSE		

XEROX  . . . . . . . . . . . . .  	L BYTE	0000	DOSDIR

@CPU . . . . . . . . . . . . . .  	TEXT  259		
@FILENAME  . . . . . . . . . . .  	TEXT  cm5		
@VERSION . . . . . . . . . . . .  	TEXT  510		


   4539 Source  Lines
   4559 Total   Lines
    590 Symbols

  45822 + 381824 Bytes symbol space free

      0 Warning Errors
      0 Severe  Errors
